/*! For license information please see main.b03dd0cb.js.LICENSE.txt */
!function(){var e={757:function(e,t,n){e.exports=n(727)},20:function(e,t,n){"use strict";n.r(t),n.d(t,{Abs:function(){return lt},Acos:function(){return pt},Acosh:function(){return ft},AdadeltaOptimizer:function(){return uc},AdagradOptimizer:function(){return lc},AdamOptimizer:function(){return hc},AdamaxOptimizer:function(){return vc},Add:function(){return ht},AddN:function(){return dt},All:function(){return mt},Any:function(){return vt},ArgMax:function(){return gt},ArgMin:function(){return yt},Asin:function(){return bt},Asinh:function(){return xt},Atan:function(){return kt},Atan2:function(){return Nt},Atanh:function(){return wt},AvgPool:function(){return It},AvgPool3D:function(){return Tt},AvgPool3DGrad:function(){return Ct},AvgPoolGrad:function(){return St},BatchMatMul:function(){return Et},BatchToSpaceND:function(){return At},Bincount:function(){return Rt},BroadcastArgs:function(){return Ft},BroadcastTo:function(){return _t},Callback:function(){return xS},CallbackList:function(){return Zb},Cast:function(){return Dt},Ceil:function(){return Ot},ClipByValue:function(){return Mt},Complex:function(){return Lt},ComplexAbs:function(){return zt},Concat:function(){return Pt},Conv2D:function(){return Zt},Conv2DBackpropFilter:function(){return Bt},Conv2DBackpropInput:function(){return Wt},Conv3D:function(){return Ut},Conv3DBackpropFilterV2:function(){return Vt},Conv3DBackpropInputV2:function(){return Gt},Cos:function(){return Ht},Cosh:function(){return jt},CropAndResize:function(){return Xt},Cumprod:function(){return qt},Cumsum:function(){return Kt},CustomCallback:function(){return Ub},DataStorage:function(){return re},DenseBincount:function(){return Yt},DepthToSpace:function(){return Qt},DepthwiseConv2dNative:function(){return Jt},DepthwiseConv2dNativeBackpropFilter:function(){return $t},DepthwiseConv2dNativeBackpropInput:function(){return en},Diag:function(){return tn},Dilation2D:function(){return nn},Dilation2DBackpropFilter:function(){return an},Dilation2DBackpropInput:function(){return rn},ENV:function(){return st},EarlyStopping:function(){return NS},Einsum:function(){return sn},Elu:function(){return un},EluGrad:function(){return cn},Environment:function(){return nt},Equal:function(){return pn},Erf:function(){return ln},Exp:function(){return fn},ExpandDims:function(){return hn},Expm1:function(){return dn},FFT:function(){return mn},Fill:function(){return vn},FlipLeftRight:function(){return gn},Floor:function(){return yn},FloorDiv:function(){return bn},FromPixels:function(){return fa},FusedBatchNorm:function(){return xn},FusedConv2D:function(){return ma},FusedDepthwiseConv2D:function(){return va},GatherNd:function(){return wn},GatherV2:function(){return kn},GraphModel:function(){return KT},Greater:function(){return Nn},GreaterEqual:function(){return In},History:function(){return Wb},IFFT:function(){return Tn},Identity:function(){return Sn},Imag:function(){return Cn},InputSpec:function(){return Sb},IsFinite:function(){return En},IsInf:function(){return An},IsNan:function(){return Rn},KernelBackend:function(){return ae},LRN:function(){return Wn},LRNGrad:function(){return Un},LayerVariable:function(){return wb},LayersModel:function(){return gk},LeakyRelu:function(){return _n},Less:function(){return Fn},LessEqual:function(){return Dn},LinSpace:function(){return On},Log:function(){return Mn},Log1p:function(){return Ln},LogSoftmax:function(){return Bn},LogicalAnd:function(){return zn},LogicalNot:function(){return Pn},LogicalOr:function(){return Zn},Max:function(){return Vn},MaxPool:function(){return Hn},MaxPool3D:function(){return qn},MaxPool3DGrad:function(){return Kn},MaxPoolGrad:function(){return jn},MaxPoolWithArgmax:function(){return Xn},Maximum:function(){return Gn},Mean:function(){return Yn},Min:function(){return Qn},Minimum:function(){return Jn},MirrorPad:function(){return $n},Mod:function(){return er},MomentumOptimizer:function(){return yc},Multinomial:function(){return tr},Multiply:function(){return nr},Neg:function(){return rr},NonMaxSuppressionV3:function(){return ir},NonMaxSuppressionV4:function(){return or},NonMaxSuppressionV5:function(){return sr},NotEqual:function(){return ar},OP_SCOPE_SUFFIX:function(){return ji},OneHot:function(){return cr},OnesLike:function(){return ur},Optimizer:function(){return sc},OptimizerConstructors:function(){return xc},Pack:function(){return lr},PadV2:function(){return pr},Pool:function(){return fr},Pow:function(){return hr},Prelu:function(){return dr},Prod:function(){return mr},RMSPropOptimizer:function(){return bc},RNN:function(){return _w},Range:function(){return vr},Rank:function(){return mi},Real:function(){return gr},RealDiv:function(){return on},Reciprocal:function(){return yr},Reduction:function(){return cd},Relu:function(){return br},Relu6:function(){return Sr},Reshape:function(){return xr},ResizeBilinear:function(){return Nr},ResizeBilinearGrad:function(){return Ir},ResizeNearestNeighbor:function(){return kr},ResizeNearestNeighborGrad:function(){return wr},Reverse:function(){return Tr},RotateWithOffset:function(){return ha},Round:function(){return Cr},Rsqrt:function(){return Er},SGDOptimizer:function(){return gc},ScatterNd:function(){return Ar},Select:function(){return Rr},Selu:function(){return _r},Sequential:function(){return Sk},Sigmoid:function(){return Lr},Sign:function(){return Mr},Sin:function(){return Dr},Sinh:function(){return Or},Slice:function(){return Fr},Softmax:function(){return Ur},Softplus:function(){return zr},SpaceToBatchND:function(){return Br},SparseFillEmptyRows:function(){return Vr},SparseReshape:function(){return Gr},SparseSegmentMean:function(){return Hr},SparseSegmentSum:function(){return jr},SparseToDense:function(){return qr},SplitV:function(){return Wr},Sqrt:function(){return Pr},Square:function(){return Xr},SquaredDifference:function(){return Kr},Step:function(){return pa},StridedSlice:function(){return Yr},StringNGrams:function(){return Qr},StringSplit:function(){return Jr},StringToHashBucketFast:function(){return $r},Sub:function(){return ea},Sum:function(){return Zr},SymbolicTensor:function(){return Tb},Tan:function(){return ta},Tanh:function(){return na},Tensor:function(){return hi},TensorBuffer:function(){return li},Tile:function(){return ra},TopK:function(){return aa},Transform:function(){return ia},Transpose:function(){return oa},Unique:function(){return sa},Unpack:function(){return ua},UnsortedSegmentSum:function(){return ca},Variable:function(){return xi},ZerosLike:function(){return la},_FusedMatMul:function(){return da},abs:function(){return dc},acos:function(){return kc},acosh:function(){return wc},add:function(){return ju},addN:function(){return Nc},all:function(){return Ic},any:function(){return Sc},argMax:function(){return Tc},argMin:function(){return Cc},asin:function(){return Ec},asinh:function(){return Ac},atan:function(){return Rc},atan2:function(){return _c},atanh:function(){return Fc},avgPool:function(){return Yc},avgPool3d:function(){return Qc},backend:function(){return Gu},backend_util:function(){return g},basicLSTMCell:function(){return nl},batchNorm:function(){return al},batchNorm2d:function(){return il},batchNorm3d:function(){return ol},batchNorm4d:function(){return sl},batchToSpaceND:function(){return rl},bincount:function(){return ul},booleanMaskAsync:function(){return nh},broadcastArgs:function(){return cl},broadcastTo:function(){return ll},broadcast_util:function(){return u},browser:function(){return c},buffer:function(){return rs},callbacks:function(){return TS},cast:function(){return as},ceil:function(){return pl},clipByValue:function(){return fl},clone:function(){return is},complex:function(){return Ki},concat:function(){return Jc},concat1d:function(){return hl},concat2d:function(){return dl},concat3d:function(){return ml},concat4d:function(){return vl},constraints:function(){return b},conv1d:function(){return yl},conv2d:function(){return gl},conv2dTranspose:function(){return xl},conv3d:function(){return kl},conv3dTranspose:function(){return Nl},copyRegisteredKernels:function(){return Ea},cos:function(){return Il},cosh:function(){return Sl},cosineWindow:function(){return fh},cumprod:function(){return Tl},cumsum:function(){return Cl},customGrad:function(){return ac},data:function(){return H},denseBincount:function(){return El},deprecationWarn:function(){return Eu},depthToSpace:function(){return Al},depthwiseConv2d:function(){return Rl},deregisterOp:function(){return RS},device_util:function(){return i},diag:function(){return _l},dilation2d:function(){return Fl},disableDeprecationWarnings:function(){return Cu},dispose:function(){return Ou},disposeVariables:function(){return Au},div:function(){return Ku},divNoNan:function(){return Ml},dot:function(){return Ll},dropout:function(){return lh},einsum:function(){return zl},elu:function(){return Pl},enableDebugMode:function(){return Tu},enableProdMode:function(){return Su},enclosingPowerOfTwo:function(){return ph},engine:function(){return Ru},env:function(){return it},equal:function(){return Dl},erf:function(){return Zl},exp:function(){return Bl},expandDims:function(){return Wl},expm1:function(){return Ul},eye:function(){return Gl},fft:function(){return Rf},fill:function(){return cc},findBackend:function(){return Wu},findBackendFactory:function(){return Uu},floor:function(){return Hl},floorDiv:function(){return qu},fused:function(){return m},gather:function(){return jl},gatherND:function(){return ch},gather_util:function(){return l},getBackend:function(){return Zu},getGradient:function(){return wa},getKernel:function(){return ka},getKernelsForBackend:function(){return Na},grad:function(){return $u},grads:function(){return ec},greater:function(){return ql},greaterEqual:function(){return Kl},ifft:function(){return _f},imag:function(){return Xl},image:function(){return _d},inTopKAsync:function(){return dh},initializers:function(){return x},input:function(){return Ak},io:function(){return o},irfft:function(){return Ff},isFinite:function(){return Yl},isInf:function(){return Ql},isNaN:function(){return Jl},keep:function(){return Mu},kernel_impls:function(){return y},layers:function(){return k},leakyRelu:function(){return $l},less:function(){return ep},lessEqual:function(){return tp},linalg:function(){return Fd},linspace:function(){return np},loadGraphModel:function(){return XT},loadLayersModel:function(){return Ek},localResponseNormalization:function(){return rp},log:function(){return ap},log1p:function(){return ip},logSigmoid:function(){return up},logSoftmax:function(){return pp},logSumExp:function(){return xp},logicalAnd:function(){return kp},logicalNot:function(){return wp},logicalOr:function(){return Np},logicalXor:function(){return Ip},losses:function(){return Dd},matMul:function(){return Cs},math:function(){return s},max:function(){return cp},maxPool:function(){return Sp},maxPool3d:function(){return Tp},maxPoolWithArgmax:function(){return Cp},maximum:function(){return mc},mean:function(){return Ep},memory:function(){return _u},meshgrid:function(){return _p},metrics:function(){return w},min:function(){return Fp},minimum:function(){return Dp},mirrorPad:function(){return Op},mod:function(){return Mp},model:function(){return Tk},models:function(){return N},moments:function(){return Lp},movingAverage:function(){return ih},mul:function(){return Xu},multiRNNCell:function(){return zp},multinomial:function(){return Pp},neg:function(){return op},nextFrame:function(){return Pd},norm:function(){return ah},notEqual:function(){return Zp},oneHot:function(){return Es},ones:function(){return Rp},onesLike:function(){return Bp},op:function(){return qi},outerProduct:function(){return Wp},pad:function(){return Up},pad1d:function(){return Vp},pad2d:function(){return Gp},pad3d:function(){return Hp},pad4d:function(){return jp},pool:function(){return Kp},pow:function(){return pc},prelu:function(){return Xp},print:function(){return os},prod:function(){return Yp},profile:function(){return Fu},rand:function(){return Qp},randomGamma:function(){return nf},randomNormal:function(){return rf},randomUniform:function(){return af},range:function(){return of},ready:function(){return Pu},real:function(){return sf},reciprocal:function(){return uf},registerBackend:function(){return Vu},registerCallbackConstructor:function(){return Rk},registerGradient:function(){return Sa},registerKernel:function(){return Ia},registerOp:function(){return ES},regularizers:function(){return I},relu:function(){return cf},relu6:function(){return lf},removeBackend:function(){return Bu},reshape:function(){return Xc},reverse:function(){return pf},reverse1d:function(){return ff},reverse2d:function(){return hf},reverse3d:function(){return df},reverse4d:function(){return mf},rfft:function(){return Of},round:function(){return vf},rsqrt:function(){return gf},scalar:function(){return oc},scatterND:function(){return oh},scatter_util:function(){return p},selu:function(){return yf},separableConv2d:function(){return bf},sequential:function(){return Ck},serialization:function(){return h},setBackend:function(){return zu},setPlatform:function(){return Hu},setdiff1dAsync:function(){return kf},sigmoid:function(){return $c},sign:function(){return wf},signal:function(){return Rd},sin:function(){return Nf},sinh:function(){return If},slice:function(){return el},slice1d:function(){return Sf},slice2d:function(){return Tf},slice3d:function(){return Cf},slice4d:function(){return Ef},slice_util:function(){return f},softmax:function(){return Af},softplus:function(){return sp},spaceToBatchND:function(){return qp},sparse:function(){return Od},sparseToDense:function(){return uh},spectral:function(){return Ad},split:function(){return Df},sqrt:function(){return Yu},square:function(){return Qu},squaredDifference:function(){return Mf},squeeze:function(){return Lf},stack:function(){return zf},step:function(){return Pf},stridedSlice:function(){return Zf},string:function(){return Md},sub:function(){return fc},sum:function(){return lp},sumOutType:function(){return Ni},tan:function(){return Bf},tanh:function(){return tl},tensor:function(){return Yi},tensor1d:function(){return Wf},tensor2d:function(){return Uf},tensor3d:function(){return Ms},tensor4d:function(){return Vf},tensor5d:function(){return Gf},tensor6d:function(){return Hf},tensor_util:function(){return a},test_util:function(){return d},tidy:function(){return Du},tile:function(){return Vl},time:function(){return Lu},topk:function(){return jf},train:function(){return Ld},transpose:function(){return As},truncatedNormal:function(){return qf},unique:function(){return Kf},unregisterGradient:function(){return Ca},unregisterKernel:function(){return Ta},unsortedSegmentSum:function(){return Xf},unstack:function(){return Yf},upcastType:function(){return wi},util:function(){return r},valueAndGrad:function(){return tc},valueAndGrads:function(){return nc},variable:function(){return Qf},variableGrads:function(){return rc},version:function(){return JV},version_converter:function(){return QT},version_core:function(){return Iu},version_layers:function(){return _x},where:function(){return Ol},whereAsync:function(){return eh},zeros:function(){return Ap},zerosLike:function(){return Ju}});var r={};n.r(r),n.d(r,{arraysEqual:function(){return ke},assert:function(){return me},assertNonNegativeIntegerDimensions:function(){return Qe},assertNonNull:function(){return ge},assertShapesMatch:function(){return ve},bytesFromStringArray:function(){return Pe},bytesPerElement:function(){return ze},checkConversionForErrors:function(){return De},clamp:function(){return ce},computeStrides:function(){return He},createScalarValue:function(){return qa},createShuffledIndices:function(){return Se},decodeString:function(){return Ja},distSquared:function(){return de},encodeString:function(){return Qa},fetch:function(){return Ya},fingerPrint64:function(){return ja},flatten:function(){return ye},getArrayFromDType:function(){return Fe},getTypedArrayFromDType:function(){return _e},hasEncodingLoss:function(){return Me},hexToLong:function(){return Fa},indexToLoc:function(){return $e},inferDtype:function(){return Ue},inferFromImplicitShape:function(){return Ee},isBoolean:function(){return Be},isFunction:function(){return Ve},isInt:function(){return we},isNumber:function(){return We},isPromise:function(){return et},isScalarShape:function(){return xe},isString:function(){return Ze},isTypedArray:function(){return Le},isValidDtype:function(){return Oe},locToIndex:function(){return Je},makeOnesTypedArray:function(){return Ke},makeZerosNestedTypedArray:function(){return Ye},makeZerosTypedArray:function(){return Xe},nearestDivisor:function(){return Ge},nearestLargerEven:function(){return le},now:function(){return Xa},parseAxisParam:function(){return Ae},randUniform:function(){return he},repeatedTry:function(){return Ce},rightPad:function(){return Te},shuffle:function(){return se},shuffleCombo:function(){return ue},sizeFromShape:function(){return be},sizeToSquarishShape:function(){return Ie},squeezeShape:function(){return Re},sum:function(){return fe},swap:function(){return pe},tanh:function(){return Ne},toNestedArray:function(){return qe},toTypedArray:function(){return Ka}});var a={};n.r(a),n.d(a,{assertTypesMatch:function(){return Si},getTensorsInContainer:function(){return Ci},isTensorInList:function(){return Ti},makeTypesMatch:function(){return Ii}});var i={};n.r(i),n.d(i,{isBrowser:function(){return Zi},isMobile:function(){return Pi},mockIsMobile:function(){return zi}});var o={};n.r(o),n.d(o,{browserFiles:function(){return ls},browserHTTPRequest:function(){return ws},concatenateArrayBuffers:function(){return oo},copyModel:function(){return Xo},decodeWeights:function(){return eo},encodeWeights:function(){return Ji},fromMemory:function(){return Ss},getLoadHandlers:function(){return yo},getModelArtifactsForJSON:function(){return co},getModelArtifactsInfoForJSON:function(){return po},getSaveHandlers:function(){return go},http:function(){return ks},isHTTPScheme:function(){return bs},listModels:function(){return Ho},loadWeights:function(){return ds},moveModel:function(){return Qo},registerLoadRouter:function(){return vo},registerSaveRouter:function(){return mo},removeModel:function(){return qo},weightsLoaderFactory:function(){return vs},withSaveHandler:function(){return Ts}});var s={};n.r(s),n.d(s,{confusionMatrix:function(){return _s}});var u={};n.r(u),n.d(u,{assertAndGetBroadcastShape:function(){return Os},getBroadcastDims:function(){return Fs},getReductionAxes:function(){return Ds}});var c={};n.r(c),n.d(c,{fromPixels:function(){return Us},fromPixelsAsync:function(){return Ps},toPixels:function(){return Bs}});var l={};n.r(l),n.d(l,{prepareAndValidate:function(){return Vs}});var p={};n.r(p),n.d(p,{calculateShapes:function(){return js},validateInput:function(){return Hs},validateUpdateShape:function(){return Gs}});var f={};n.r(f),n.d(f,{assertParamsValid:function(){return qs},computeFlatOffset:function(){return ou},computeOutShape:function(){return Xs},getNormalizedAxes:function(){return $s},isSliceContinous:function(){return iu},maskToAxes:function(){return Ks},parseSliceParams:function(){return su},sliceInfo:function(){return uu},startForAxis:function(){return ru},startIndicesWithElidedDims:function(){return eu},stopForAxis:function(){return au},stopIndicesWithElidedDims:function(){return tu},stridesForAxis:function(){return nu},stridesWithElidedDims:function(){return Ys}});var h={};n.r(h),n.d(h,{Serializable:function(){return lu},SerializationMap:function(){return pu},registerClass:function(){return fu}});var d={};n.r(d),n.d(d,{TEST_EPSILON_FLOAT16:function(){return hu},encodeStrings:function(){return Nu},expectArrayBuffersEqual:function(){return wu},expectArraysClose:function(){return du},expectArraysEqual:function(){return yu},expectNumbersClose:function(){return bu},expectPromiseToFail:function(){return gu},expectValuesInRange:function(){return ku},testEpsilon:function(){return mu}});var m={};n.r(m),n.d(m,{conv2d:function(){return xh},depthwiseConv2d:function(){return Nh},matMul:function(){return Ih}});var v={};n.r(v),n.d(v,{collectGatherOpShapeInfo:function(){return Om},computeOutShape:function(){return Dm},segOpComputeOptimalWindowSize:function(){return Fm}});var g={};n.r(g),n.d(g,{ERF_A1:function(){return Jd},ERF_A2:function(){return $d},ERF_A3:function(){return em},ERF_A4:function(){return tm},ERF_A5:function(){return nm},ERF_P:function(){return Qd},PARALLELIZE_THRESHOLD:function(){return Wd},SELU_SCALE:function(){return Yd},SELU_SCALEALPHA:function(){return Xd},applyActivation:function(){return yh},assertAndGetBroadcastShape:function(){return Os},assertAxesAreInnerMostDims:function(){return vp},assertParamsConsistent:function(){return Zd},assignToTypedArray:function(){return um},axesAreInnerMostDims:function(){return fp},calculateShapes:function(){return js},checkEinsumDimSizes:function(){return mm},checkPadOnDimRoundingMode:function(){return Kc},combineLocations:function(){return hp},complexWithEvenIndex:function(){return im},complexWithOddIndex:function(){return om},computeConv2DInfo:function(){return Lc},computeConv3DInfo:function(){return zc},computeDefaultPad:function(){return Pc},computeDilation2DInfo:function(){return Dc},computeOptimalWindowSize:function(){return Ud},computeOutAndReduceShapes:function(){return dp},computeOutShape:function(){return Bd},computePool2DInfo:function(){return Oc},computePool3DInfo:function(){return Mc},convertConv2DDataFormat:function(){return qc},decodeEinsumEquation:function(){return hm},eitherStridesOrDilationsAreOne:function(){return jc},expandShapeToKeepDim:function(){return mp},exponent:function(){return lm},exponents:function(){return cm},fromStringArrayToUint8:function(){return Lm},fromUint8ToStringArray:function(){return Mm},getAxesPermutation:function(){return gp},getBroadcastDims:function(){return Fs},getComplexWithIndex:function(){return sm},getEinsumComputePath:function(){return vm},getEinsumPermutation:function(){return dm},getFusedBiasGradient:function(){return gh},getFusedDyActivation:function(){return vh},getImageCenter:function(){return Vd},getInnerMostAxes:function(){return bp},getPermuted:function(){return Hd},getReductionAxes:function(){return Ds},getReshaped:function(){return Gd},getReshapedPermuted:function(){return jd},getSliceBeginCoords:function(){return qd},getSliceSize:function(){return Kd},getSparseFillEmptyRowsIndicesDenseShapeMismatch:function(){return xm},getSparseFillEmptyRowsNegativeIndexErrorMessage:function(){return km},getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:function(){return wm},getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:function(){return Sm},getSparseReshapeInputOutputMismatchErrorMessage:function(){return Cm},getSparseReshapeInputOutputMultipleErrorMessage:function(){return Tm},getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:function(){return Nm},getSparseReshapeNegativeOutputDimErrorMessage:function(){return Im},getSparseSegmentReductionIndicesOutOfRangeErrorMessage:function(){return _m},getSparseSegmentReductionNegativeSegmentIdsErrorMessage:function(){return Em},getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:function(){return Am},getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:function(){return Rm},getUndoAxesPermutation:function(){return yp},isIdentityPermutation:function(){return gm},log:function(){return ya},mergeRealAndImagArrays:function(){return rm},prepareAndValidate:function(){return Vs},prepareSplitSize:function(){return bm},segment_util:function(){return v},shouldFuse:function(){return bh},slice_util:function(){return f},splitRealAndImagArrays:function(){return am},tupleValuesAreOne:function(){return Hc},upcastType:function(){return wi},validateInput:function(){return Hs},validateUpdateShape:function(){return Gs},warn:function(){return ga}});var y={};n.r(y),n.d(y,{nonMaxSuppressionV3Impl:function(){return zh},nonMaxSuppressionV4Impl:function(){return Ph},nonMaxSuppressionV5Impl:function(){return Zh},whereImpl:function(){return Jf}});var b={};n.r(b),n.d(b,{maxNorm:function(){return Ug},minMaxNorm:function(){return Hg},nonNeg:function(){return Gg},unitNorm:function(){return Vg}});var x={};n.r(x),n.d(x,{constant:function(){return $y},glorotNormal:function(){return ob},glorotUniform:function(){return ib},heNormal:function(){return sb},heUniform:function(){return ub},identity:function(){return rb},leCunNormal:function(){return cb},leCunUniform:function(){return lb},ones:function(){return Jy},orthogonal:function(){return pb},randomNormal:function(){return tb},randomUniform:function(){return eb},truncatedNormal:function(){return nb},varianceScaling:function(){return ab},zeros:function(){return Qy}});var k={};n.r(k),n.d(k,{Layer:function(){return Rb},RNN:function(){return _w},RNNCell:function(){return Fw},activation:function(){return tI},add:function(){return lI},alphaDropout:function(){return eS},average:function(){return pI},averagePooling1d:function(){return xI},averagePooling2d:function(){return NI},averagePooling3d:function(){return TI},avgPool1d:function(){return kI},avgPool2d:function(){return II},avgPool3d:function(){return CI},avgPooling1d:function(){return wI},avgPooling2d:function(){return SI},avgPooling3d:function(){return EI},batchNormalization:function(){return gI},bidirectional:function(){return jI},concatenate:function(){return fI},conv1d:function(){return jN},conv2d:function(){return qN},conv2dTranspose:function(){return KN},conv3d:function(){return XN},conv3dTranspose:function(){return YN},convLstm2d:function(){return UI},convLstm2dCell:function(){return VI},cropping2D:function(){return JN},dense:function(){return nI},depthwiseConv2d:function(){return eI},dot:function(){return vI},dropout:function(){return rI},elu:function(){return BN},embedding:function(){return cI},flatten:function(){return iI},gaussianDropout:function(){return $I},gaussianNoise:function(){return JI},globalAveragePooling1d:function(){return AI},globalAveragePooling2d:function(){return RI},globalMaxPool1d:function(){return KI},globalMaxPool2d:function(){return XI},globalMaxPooling1d:function(){return _I},globalMaxPooling2d:function(){return FI},gru:function(){return LI},gruCell:function(){return zI},input:function(){return Ak},inputLayer:function(){return ZN},layerNormalization:function(){return yI},leakyReLU:function(){return UN},lstm:function(){return PI},lstmCell:function(){return ZI},masking:function(){return tS},maxPool1d:function(){return YI},maxPool2d:function(){return QI},maxPooling1d:function(){return DI},maxPooling2d:function(){return OI},maxPooling3d:function(){return MI},maximum:function(){return hI},minimum:function(){return dI},multiply:function(){return mI},permute:function(){return uI},prelu:function(){return VN},reLU:function(){return WN},repeatVector:function(){return oI},reshape:function(){return sI},rnn:function(){return GI},separableConv2d:function(){return QN},simpleRNN:function(){return BI},simpleRNNCell:function(){return WI},softmax:function(){return GN},spatialDropout1d:function(){return aI},stackedRNNCells:function(){return HI},thresholdedReLU:function(){return HN},timeDistributed:function(){return qI},upSampling2d:function(){return $N},zeroPadding2d:function(){return bI}});var w={};n.r(w),n.d(w,{MAPE:function(){return fS},MSE:function(){return mS},binaryAccuracy:function(){return nS},binaryCrossentropy:function(){return rS},categoricalAccuracy:function(){return iS},categoricalCrossentropy:function(){return oS},cosineProximity:function(){return cS},mape:function(){return hS},meanAbsoluteError:function(){return lS},meanAbsolutePercentageError:function(){return pS},meanSquaredError:function(){return dS},mse:function(){return vS},precision:function(){return sS},recall:function(){return uS},sparseCategoricalAccuracy:function(){return aS}});var N={};n.r(N),n.d(N,{modelFromJSON:function(){return bk}});var I={};n.r(I),n.d(I,{l1:function(){return yS},l1l2:function(){return gS},l2:function(){return bS}});var S={};n.r(S),n.d(S,{json:function(){return PS}});var T={};n.r(T),n.d(T,{json:function(){return ZS}});var C={};n.r(C),n.d(C,{json:function(){return BS}});var E={};n.r(E),n.d(E,{json:function(){return WS}});var A={};n.r(A),n.d(A,{json:function(){return US}});var R={};n.r(R),n.d(R,{json:function(){return VS}});var _={};n.r(_),n.d(_,{json:function(){return GS}});var F={};n.r(F),n.d(F,{json:function(){return HS}});var D={};n.r(D),n.d(D,{json:function(){return jS}});var O={};n.r(O),n.d(O,{json:function(){return qS}});var M={};n.r(M),n.d(M,{json:function(){return KS}});var L={};n.r(L),n.d(L,{json:function(){return XS}});var z={};n.r(z),n.d(z,{json:function(){return YS}});var P={};n.r(P),n.d(P,{json:function(){return QS}});var Z={};n.r(Z),n.d(Z,{json:function(){return JS}});var B={};n.r(B),n.d(B,{json:function(){return $S}});var W={};n.r(W),n.d(W,{json:function(){return eT}});var U={};n.r(U),n.d(U,{json:function(){return tT}});var V={};n.r(V),n.d(V,{json:function(){return nT}});var G={};n.r(G),n.d(G,{OP_SCOPE_SUFFIX:function(){return ji},abs:function(){return dc},acos:function(){return kc},acosh:function(){return wc},add:function(){return ju},addN:function(){return Nc},all:function(){return Ic},any:function(){return Sc},argMax:function(){return Tc},argMin:function(){return Cc},asin:function(){return Ec},asinh:function(){return Ac},atan:function(){return Rc},atan2:function(){return _c},atanh:function(){return Fc},avgPool:function(){return Yc},avgPool3d:function(){return Qc},basicLSTMCell:function(){return nl},batchNorm:function(){return al},batchNorm2d:function(){return il},batchNorm3d:function(){return ol},batchNorm4d:function(){return sl},batchToSpaceND:function(){return rl},bincount:function(){return ul},booleanMaskAsync:function(){return nh},broadcastArgs:function(){return cl},broadcastTo:function(){return ll},buffer:function(){return rs},cast:function(){return as},ceil:function(){return pl},clipByValue:function(){return fl},clone:function(){return is},complex:function(){return Ki},concat:function(){return Jc},concat1d:function(){return hl},concat2d:function(){return dl},concat3d:function(){return ml},concat4d:function(){return vl},conv1d:function(){return yl},conv2d:function(){return gl},conv2dTranspose:function(){return xl},conv3d:function(){return kl},conv3dTranspose:function(){return Nl},cos:function(){return Il},cosh:function(){return Sl},cosineWindow:function(){return fh},cumprod:function(){return Tl},cumsum:function(){return Cl},denseBincount:function(){return El},depthToSpace:function(){return Al},depthwiseConv2d:function(){return Rl},diag:function(){return _l},dilation2d:function(){return Fl},div:function(){return Ku},divNoNan:function(){return Ml},dot:function(){return Ll},dropout:function(){return lh},einsum:function(){return zl},elu:function(){return Pl},enclosingPowerOfTwo:function(){return ph},equal:function(){return Dl},erf:function(){return Zl},exp:function(){return Bl},expandDims:function(){return Wl},expm1:function(){return Ul},eye:function(){return Gl},fft:function(){return Rf},fill:function(){return cc},floor:function(){return Hl},floorDiv:function(){return qu},fused:function(){return m},gather:function(){return jl},gatherND:function(){return ch},greater:function(){return ql},greaterEqual:function(){return Kl},ifft:function(){return _f},imag:function(){return Xl},image:function(){return _d},inTopKAsync:function(){return dh},irfft:function(){return Ff},isFinite:function(){return Yl},isInf:function(){return Ql},isNaN:function(){return Jl},leakyRelu:function(){return $l},less:function(){return ep},lessEqual:function(){return tp},linalg:function(){return Fd},linspace:function(){return np},localResponseNormalization:function(){return rp},log:function(){return ap},log1p:function(){return ip},logSigmoid:function(){return up},logSoftmax:function(){return pp},logSumExp:function(){return xp},logicalAnd:function(){return kp},logicalNot:function(){return wp},logicalOr:function(){return Np},logicalXor:function(){return Ip},losses:function(){return Dd},matMul:function(){return Cs},max:function(){return cp},maxPool:function(){return Sp},maxPool3d:function(){return Tp},maxPoolWithArgmax:function(){return Cp},maximum:function(){return mc},mean:function(){return Ep},meshgrid:function(){return _p},min:function(){return Fp},minimum:function(){return Dp},mirrorPad:function(){return Op},mod:function(){return Mp},moments:function(){return Lp},movingAverage:function(){return ih},mul:function(){return Xu},multiRNNCell:function(){return zp},multinomial:function(){return Pp},neg:function(){return op},norm:function(){return ah},notEqual:function(){return Zp},oneHot:function(){return Es},ones:function(){return Rp},onesLike:function(){return Bp},op:function(){return qi},outerProduct:function(){return Wp},pad:function(){return Up},pad1d:function(){return Vp},pad2d:function(){return Gp},pad3d:function(){return Hp},pad4d:function(){return jp},pool:function(){return Kp},pow:function(){return pc},prelu:function(){return Xp},print:function(){return os},prod:function(){return Yp},rand:function(){return Qp},randomGamma:function(){return nf},randomNormal:function(){return rf},randomUniform:function(){return af},range:function(){return of},real:function(){return sf},reciprocal:function(){return uf},relu:function(){return cf},relu6:function(){return lf},reshape:function(){return Xc},reverse:function(){return pf},reverse1d:function(){return ff},reverse2d:function(){return hf},reverse3d:function(){return df},reverse4d:function(){return mf},rfft:function(){return Of},round:function(){return vf},rsqrt:function(){return gf},scalar:function(){return oc},scatterND:function(){return oh},selu:function(){return yf},separableConv2d:function(){return bf},setdiff1dAsync:function(){return kf},sigmoid:function(){return $c},sign:function(){return wf},signal:function(){return Rd},sin:function(){return Nf},sinh:function(){return If},slice:function(){return el},slice1d:function(){return Sf},slice2d:function(){return Tf},slice3d:function(){return Cf},slice4d:function(){return Ef},softmax:function(){return Af},softplus:function(){return sp},spaceToBatchND:function(){return qp},sparse:function(){return Od},sparseToDense:function(){return uh},spectral:function(){return Ad},split:function(){return Df},sqrt:function(){return Yu},square:function(){return Qu},squaredDifference:function(){return Mf},squeeze:function(){return Lf},stack:function(){return zf},step:function(){return Pf},stridedSlice:function(){return Zf},string:function(){return Md},sub:function(){return fc},sum:function(){return lp},tan:function(){return Bf},tanh:function(){return tl},tensor:function(){return Yi},tensor1d:function(){return Wf},tensor2d:function(){return Uf},tensor3d:function(){return Ms},tensor4d:function(){return Vf},tensor5d:function(){return Gf},tensor6d:function(){return Hf},tile:function(){return Vl},topk:function(){return jf},transpose:function(){return As},truncatedNormal:function(){return qf},unique:function(){return Kf},unsortedSegmentSum:function(){return Xf},unstack:function(){return Yf},variable:function(){return Qf},where:function(){return Ol},whereAsync:function(){return eh},zeros:function(){return Ap},zerosLike:function(){return Ju}});var H={};n.r(H),n.d(H,{CSVDataset:function(){return VC},Dataset:function(){return _C},FileDataSource:function(){return aE},TextLineDataset:function(){return LC},URLDataSource:function(){return iE},array:function(){return DC},csv:function(){return oE},func:function(){return sE},generator:function(){return uE},microphone:function(){return pE},version_data:function(){return hE},webcam:function(){return cE},zip:function(){return OC}});var j=n(181);function q(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=(0,j.Z)(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}var K=n(907);function X(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Y(e){return function(e){if(Array.isArray(e))return(0,K.Z)(e)}(e)||X(e)||(0,j.Z)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Q(e,t,n,r,a,i,o){try{var s=e[i](o),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,a)}function J(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){Q(i,r,a,o,s,"next",e)}function s(e){Q(i,r,a,o,s,"throw",e)}o(void 0)}))}}var $=n(671),ee=n(144),te=n(757),ne=n.n(te),re=function(){function e(t,n){(0,$.Z)(this,e),this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return(0,ee.Z)(e,[{key:"get",value:function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}},{key:"set",value:function(e,t){this.dataIdsCount++,this.data.set(e,t)}},{key:"has",value:function(e){return this.data.has(e)}},{key:"delete",value:function(e){return this.dataIdsCount--,this.data.delete(e)}},{key:"numDataIds",value:function(){return this.dataIdsCount}}]),e}(),ae=function(){function e(){(0,$.Z)(this,e)}return(0,ee.Z)(e,[{key:"refCount",value:function(e){return ie("refCount")}},{key:"incRef",value:function(e){return ie("incRef")}},{key:"timerAvailable",value:function(){return!0}},{key:"time",value:function(e){return ie("time")}},{key:"read",value:function(e){return ie("read")}},{key:"readSync",value:function(e){return ie("readSync")}},{key:"readToGPU",value:function(e,t){return ie("readToGPU")}},{key:"numDataIds",value:function(){return ie("numDataIds")}},{key:"disposeData",value:function(e,t){return ie("disposeData")}},{key:"write",value:function(e,t,n){return ie("write")}},{key:"move",value:function(e,t,n,r,a){return ie("move")}},{key:"memory",value:function(){return ie("memory")}},{key:"floatPrecision",value:function(){return ie("floatPrecision")}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"dispose",value:function(){return ie("dispose")}}]),e}();function ie(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}var oe=n(439);function se(e){for(var t=e.length,n=0;t>0;)n=Math.random()*t|0,pe(e,--t,n)}function ue(e,t){if(e.length!==t.length)throw new Error("Array sizes must match to be shuffled together "+"First array length was ".concat(e.length)+"Second array length was ".concat(t.length));for(var n=e.length,r=0;n>0;)r=Math.random()*n|0,pe(e,--n,r),pe(t,n,r)}function ce(e,t,n){return Math.max(e,Math.min(t,n))}function le(e){return e%2===0?e:e+1}function pe(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function fe(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function he(e,t){var n=Math.random();return t*n+(1-n)*e}function de(e,t){for(var n=0,r=0;r<e.length;r++){var a=Number(e[r])-Number(t[r]);n+=a*a}return n}function me(e,t){if(!e)throw new Error("string"===typeof t?t:t())}function ve(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";me(ke(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}function ge(e){me(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function ye(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),Array.isArray(e)||Le(e)&&!n)for(var r=0;r<e.length;++r)ye(e[r],t,n);else t.push(e);return t}function be(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function xe(e){return 0===e.length}function ke(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function we(e){return e%1===0}function Ne(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function Ie(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function Se(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return se(t),t}function Te(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function Ce(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 0},n=arguments.length>2?arguments[2]:void 0;return new Promise((function(r,a){var i=0;!function o(){if(e())r();else{i++;var s=t(i);null!=n&&i>=n?a():setTimeout(o,s)}}()}))}function Ee(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. "+"Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found ".concat(e[a]," at dim ").concat(a));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when ")+"there are 0 elements");if(t%n!==0)throw Error("The implicit shape can't be a fractional number. "+"Got ".concat(t," / ").concat(n));var i=e.slice();return i[r]=t/n,i}function Ae(e,t){var n=t.length;return me((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-".concat(n,", ").concat(n,") but ")+"got axis ".concat(e)})),me(e.every((function(e){return we(e)})),(function(){return"All values in axis param must be integers but "+"got axis ".concat(e)})),e.map((function(e){return e<0?n+e:e}))}function Re(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:Ae(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(e[s],"' is not 1"));(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function _e(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type ".concat(e));n=new Uint8Array(t)}return n}function Fe(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function De(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}function Oe(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function Me(e,t){return"complex64"!==t&&(("float32"!==t||"complex64"===e)&&(("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)))}function Le(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}function ze(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function Pe(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}function Ze(e){return"string"===typeof e||e instanceof String}function Be(e){return"boolean"===typeof e}function We(e){return"number"===typeof e}function Ue(e){return Array.isArray(e)?Ue(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":We(e)?"float32":Ze(e)?"string":Be(e)?"bool":"float32"}function Ve(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Ge(e,t){for(var n=t;n<e;++n)if(e%n===0)return n;return e}function He(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function je(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=new Array;if(1===t.length)for(var i=t[0]*(r?2:1),o=0;o<i;o++)a[o]=n[e+o];else for(var s=t[0],u=t.slice(1),c=u.reduce((function(e,t){return e*t}))*(r?2:1),l=0;l<s;l++)a[l]=je(e+l*c,u,n,r);return a}function qe(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0===e.length)return t[0];var r=e.reduce((function(e,t){return e*t}))*(n?2:1);if(0===r)return[];if(r!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length).concat(n?" for a complex tensor":"","."));return je(0,e,t,n)}function Ke(e,t){for(var n=Xe(e,t),r=0;r<n.length;r++)n[r]=1;return n}function Xe(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function Ye(e,t){var n=e.reduce((function(e,t){return e*t}),1);if(null==t||"float32"===t)return qe(e,new Float32Array(n));if("int32"===t)return qe(e,new Int32Array(n));if("bool"===t)return qe(e,new Uint8Array(n));throw new Error("Unknown data type ".concat(t))}function Qe(e){e.forEach((function(t){me(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(e,"].")}))}))}function Je(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function $e(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}function et(e){return e&&e.then&&"function"===typeof e.then}var tt="tfjsflags",nt=function(){function e(t){(0,$.Z)(this,e),this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=rt,this.populateURLFlags()}return(0,ee.Z)(e,[{key:"setPlatform",value:function(e,t){null!=this.platform&&(it().getBool("IS_TEST")||it().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t}},{key:"registerFlag",value:function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];it().getBool("IS_TEST")||it().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(r,".")),this.set(e,r)}}},{key:"getAsync",value:function(){var e=J(ne().mark((function e(t){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.flags)){e.next=2;break}return e.abrupt("return",this.flags[t]);case 2:return e.next=4,this.evaluateFlag(t);case 4:return this.flags[t]=e.sent,e.abrupt("return",this.flags[t]);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(et(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]}},{key:"getNumber",value:function(e){return this.get(e)}},{key:"getBool",value:function(e){return this.get(e)}},{key:"getFlags",value:function(){return this.flags}},{key:"features",get:function(){return this.flags}},{key:"set",value:function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}},{key:"evaluateFlag",value:function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}},{key:"setFlags",value:function(e){this.flags=Object.assign({},e)}},{key:"reset",value:function(){this.flags={},this.urlFlags={},this.populateURLFlags()}},{key:"populateURLFlags",value:function(){var e=this;if("undefined"!==typeof this.global&&"undefined"!==typeof this.global.location&&"undefined"!==typeof this.global.location.search){var t=this.getQueryParams(this.global.location.search);if(tt in t)t.tfjsflags.split(",").forEach((function(t){var n=t.split(":"),r=(0,oe.Z)(n,2),a=r[0],i=r[1];e.urlFlags[a]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if("".concat(+t)===t)return+t;throw new Error("Could not parse value flag value ".concat(t," for flag ").concat(e,"."))}(a,i)}))}}}]),e}();function rt(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return at(t,r[0],r[1]),r.join("=")})),t}function at(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function it(){return st}var ot,st=null;function ut(){if(null==ot){var e;if("undefined"!==typeof window)e=window;else if("undefined"!==typeof n.g)e=n.g;else if("undefined"!==typeof process)e=process;else{if("undefined"===typeof self)throw new Error("Could not find a global object");e=self}ot=e}return ot}function ct(e,t){var n=function(){var e=ut();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);var r=t();return n.set(e,r),n.get(e)}var lt="Abs",pt="Acos",ft="Acosh",ht="Add",dt="AddN",mt="All",vt="Any",gt="ArgMax",yt="ArgMin",bt="Asin",xt="Asinh",kt="Atan",wt="Atanh",Nt="Atan2",It="AvgPool",St="AvgPoolGrad",Tt="AvgPool3D",Ct="AvgPool3DGrad",Et="BatchMatMul",At="BatchToSpaceND",Rt="Bincount",_t="BroadcastTo",Ft="BroadcastArgs",Dt="Cast",Ot="Ceil",Mt="ClipByValue",Lt="Complex",zt="ComplexAbs",Pt="Concat",Zt="Conv2D",Bt="Conv2DBackpropFilter",Wt="Conv2DBackpropInput",Ut="Conv3D",Vt="Conv3DBackpropFilterV2",Gt="Conv3DBackpropInputV2",Ht="Cos",jt="Cosh",qt="Cumprod",Kt="Cumsum",Xt="CropAndResize",Yt="DenseBincount",Qt="DepthToSpace",Jt="DepthwiseConv2dNative",$t="DepthwiseConv2dNativeBackpropFilter",en="DepthwiseConv2dNativeBackpropInput",tn="Diag",nn="Dilation2D",rn="Dilation2DBackpropInput",an="Dilation2DBackpropFilter",on="RealDiv",sn="Einsum",un="Elu",cn="EluGrad",ln="Erf",pn="Equal",fn="Exp",hn="ExpandDims",dn="Expm1",mn="FFT",vn="Fill",gn="FlipLeftRight",yn="Floor",bn="FloorDiv",xn="FusedBatchNorm",kn="GatherV2",wn="GatherNd",Nn="Greater",In="GreaterEqual",Sn="Identity",Tn="IFFT",Cn="Imag",En="IsFinite",An="IsInf",Rn="IsNan",_n="LeakyRelu",Fn="Less",Dn="LessEqual",On="LinSpace",Mn="Log",Ln="Log1p",zn="LogicalAnd",Pn="LogicalNot",Zn="LogicalOr",Bn="LogSoftmax",Wn="LRN",Un="LRNGrad",Vn="Max",Gn="Maximum",Hn="MaxPool",jn="MaxPoolGrad",qn="MaxPool3D",Kn="MaxPool3DGrad",Xn="MaxPoolWithArgmax",Yn="Mean",Qn="Min",Jn="Minimum",$n="MirrorPad",er="Mod",tr="Multinomial",nr="Multiply",rr="Neg",ar="NotEqual",ir="NonMaxSuppressionV3",or="NonMaxSuppressionV4",sr="NonMaxSuppressionV5",ur="OnesLike",cr="OneHot",lr="Pack",pr="PadV2",fr="Pool",hr="Pow",dr="Prelu",mr="Prod",vr="Range",gr="Real",yr="Reciprocal",br="Relu",xr="Reshape",kr="ResizeNearestNeighbor",wr="ResizeNearestNeighborGrad",Nr="ResizeBilinear",Ir="ResizeBilinearGrad",Sr="Relu6",Tr="Reverse",Cr="Round",Er="Rsqrt",Ar="ScatterNd",Rr="Select",_r="Selu",Fr="Slice",Dr="Sin",Or="Sinh",Mr="Sign",Lr="Sigmoid",zr="Softplus",Pr="Sqrt",Zr="Sum",Br="SpaceToBatchND",Wr="SplitV",Ur="Softmax",Vr="SparseFillEmptyRows",Gr="SparseReshape",Hr="SparseSegmentMean",jr="SparseSegmentSum",qr="SparseToDense",Kr="SquaredDifference",Xr="Square",Yr="StridedSlice",Qr="StringNGrams",Jr="StringSplit",$r="StringToHashBucketFast",ea="Sub",ta="Tan",na="Tanh",ra="Tile",aa="TopK",ia="Transform",oa="Transpose",sa="Unique",ua="Unpack",ca="UnsortedSegmentSum",la="ZerosLike",pa="Step",fa="FromPixels",ha="RotateWithOffset",da="_FusedMatMul",ma="FusedConv2D",va="FusedDepthwiseConv2D";function ga(){var e;it().getBool("IS_TEST")||it().getBool("PROD")||(e=console).warn.apply(e,arguments)}function ya(){var e;it().getBool("IS_TEST")||it().getBool("PROD")||(e=console).log.apply(e,arguments)}var ba=ct("kernelRegistry",(function(){return new Map})),xa=ct("gradRegistry",(function(){return new Map}));function ka(e,t){var n=Aa(e,t);return ba.get(n)}function wa(e){return xa.get(e)}function Na(e){for(var t=ba.entries(),n=[];;){var r=t.next(),a=r.done,i=r.value;if(a)break;var o=(0,oe.Z)(i,2),s=o[0],u=o[1],c=s.split("_");(0,oe.Z)(c,1)[0]===e&&n.push(u)}return n}function Ia(e){var t=e.kernelName,n=e.backendName,r=Aa(t,n);ba.has(r)&&ga("The kernel '".concat(t,"' for backend ")+"'".concat(n,"' is already registered")),ba.set(r,e)}function Sa(e){var t=e.kernelName;xa.has(t)&&it().getBool("DEBUG")&&ga("Overriding the gradient for '".concat(t,"'")),xa.set(t,e)}function Ta(e,t){var n=Aa(e,t);if(!ba.has(n))throw new Error("The kernel '".concat(e,"' for backend ")+"'".concat(t,"' is not registered"));ba.delete(n)}function Ca(e){if(!xa.has(e))throw new Error("The gradient '".concat(e,"' for backend is not registered"));xa.delete(e)}function Ea(e,t){Na(e).forEach((function(e){Ia(Object.assign({},e,{backendName:t}))}))}function Aa(e,t){return"".concat(t,"_").concat(e)}var Ra=n(987),_a=n.n(Ra)()||Ra;function Fa(e){return _a.fromString(e,!0,16)}var Da=Fa("c3a5c85c97cb3127"),Oa=Fa("b492b66fbe98f273"),Ma=Fa("9ae16a3b2f90404f");function La(e){return e.xor(e.shru(47))}function za(e,t,n){var r=e.slice(t,t+n);return _a.fromBytes(Array.from(r),!0,!0)}function Pa(e,t){return za(e,t,8)}function Za(e,t){return za(e,t,4)}function Ba(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function Wa(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Fa("9ddfea08eb382d69"),r=e.xor(t).mul(n);r=r.xor(r.shru(47));var a=t.xor(r).mul(n);return a=(a=a.xor(a.shru(47))).mul(n)}function Ua(e,t,n,r){return function(e,t,n,r,a,i){a=a.add(e),i=Ba(i.add(a).add(r),21);var o=a;return a=(a=a.add(t)).add(n),i=i.add(Ba(a,44)),[a.add(r),i.add(o)]}(Pa(e,t),Pa(e,t+8),Pa(e,t+16),Pa(e,t+24),n,r)}function Va(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;if(t>=8){var n=Ma.add(2*t),r=Pa(e,0).add(Ma),a=Pa(e,t-8),i=Ba(a,37).mul(n).add(r),o=Ba(r,25).add(a).mul(n);return Wa(i,o,n)}if(t>=4){var s=Ma.add(2*t),u=Za(e,0);return Wa(u.shl(3).add(t),Za(e,t-4),s)}if(t>0){var c=e[0],l=e[t>>1],p=e[t-1],f=c+(l<<8),h=t+(p<<2);return La(Ma.mul(f).xor(Da.mul(h))).mul(Ma)}return Ma}function Ga(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=Ma.add(2*t),r=Pa(e,0).mul(Oa),a=Pa(e,8),i=Pa(e,t-8).mul(n),o=Pa(e,t-16).mul(Ma);return Wa(Ba(r.add(a),43).add(Ba(i,30)).add(o),r.add(Ba(a.add(Ma),18)).add(i),n)}function Ha(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=Ma.add(2*t),r=Pa(e,0).mul(Ma),a=Pa(e,8),i=Pa(e,t-8).mul(n),o=Pa(e,t-16).mul(Ma),s=Ba(r.add(a),43).add(Ba(i,30)).add(o),u=Wa(s,r.add(Ba(a.add(Ma),18)).add(i),n),c=Pa(e,16).mul(n),l=Pa(e,24),p=s.add(Pa(e,t-32)).mul(n),f=u.add(Pa(e,t-24)).mul(n);return Wa(Ba(c.add(l),43).add(Ba(p,30)).add(f),c.add(Ba(l.add(r),18)).add(p),n)}function ja(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=_a.fromNumber(81,!0);if(t<=32)return t<=16?Va(e,t):Ga(e,t);if(t<=64)return Ha(e,t);var r=n,a=n.mul(Oa).add(113),i=La(a.mul(Ma).add(113)).mul(Ma),o=[_a.UZERO,_a.UZERO],s=[_a.UZERO,_a.UZERO];r=r.mul(Ma).add(Pa(e,0));var u=0,c=64*(t-1>>6),l=c+(t-1&63)-63;do{r=Ba(r.add(a).add(o[0]).add(Pa(e,u+8)),37).mul(Oa),a=Ba(a.add(o[1]).add(Pa(e,u+48)),42).mul(Oa),r=r.xor(s[1]),a=a.add(o[0]).add(Pa(e,u+40)),i=Ba(i.add(s[0]),33).mul(Oa),o=Ua(e,u,o[1].mul(Oa),r.add(s[0])),s=Ua(e,u+32,i.add(s[1]),a.add(Pa(e,u+16)));var p=[r,i];i=p[0],r=p[1],u+=64}while(u!==c);var f=Oa.add(i.and(255).shl(1));u=l,s[0]=s[0].add(t-1&63),o[0]=o[0].add(s[0]),s[0]=s[0].add(o[0]),r=Ba(r.add(a).add(o[0]).add(Pa(e,u+8)),37).mul(f),a=Ba(a.add(o[1]).add(Pa(e,u+48)),42).mul(f),r=r.xor(s[1].mul(9)),a=a.add(o[0].mul(9).add(Pa(e,u+40))),i=Ba(i.add(s[0]),33).mul(f),o=Ua(e,u,o[1].mul(f),r.add(s[0])),s=Ua(e,u+32,i.add(s[1]),a.add(Pa(e,u+16)));var h=[r,i];return i=h[0],r=h[1],Wa(Wa(o[0],s[0],f).add(La(a).mul(Da)).add(i),Wa(o[1],s[1],f).add(r),f)}function qa(e,t){return"string"===t?Qa(e):Ka([e],t)}function Ka(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=ye(e)),it().getBool("DEBUG")&&De(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var n=new Uint8Array(e.length),r=0;r<n.length;++r)0!==Math.round(e[r])&&(n[r]=1);return n}throw new Error("Unknown data type ".concat(t))}function Xa(){return it().platform.now()}function Ya(e,t){return it().platform.fetch(e,t)}function Qa(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",it().platform.encode(e,t)}function Ja(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",it().platform.decode(e,t)}var $a=function(){function e(t,n){(0,$.Z)(this,e),this.backendTimer=t,this.logger=n,null==n&&(this.logger=new ei)}return(0,ee.Z)(e,[{key:"profileKernel",value:function(e,t,n){var r,a,i=function(){r=n()},o=Xa();if(this.backendTimer.timerAvailable())a=this.backendTimer.time(i);else{i();var s,u=q(r);try{for(u.s();!(s=u.n()).done;){s.value.dataSync()}}catch(p){u.e(p)}finally{u.f()}a=Promise.resolve({kernelMs:Xa()-o})}if(it().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var c=function(t){var n=r[t];n.data().then((function(t){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var a=e[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(n,"'")),!0}}(t,n.dtype,e)}))},l=0;l<r.length;l++)c(l);return{kernelName:e,outputs:r,inputs:t,timeMs:a.then((function(e){return e.kernelMs})),extraInfo:a.then((function(e){return null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""}))}}},{key:"logKernelProfile",value:function(e){var t=this,n=e.kernelName,r=e.outputs,a=e.timeMs,i=e.inputs,o=e.extraInfo;r.forEach((function(e){Promise.all([e.data(),a,o]).then((function(r){t.logger.logKernelProfile(n,e,r[0],r[1],i,r[2])}))}))}}]),e}();var ei=function(){function e(){(0,$.Z)(this,e)}return(0,ee.Z)(e,[{key:"logKernelProfile",value:function(e,t,n,r,a,i){var o="number"===typeof r?Te("".concat(r,"ms"),9):r.error,s=Te(e,25),u=t.rank,c=t.size,l=Te(t.shape.toString(),14),p="";for(var f in a){var h=a[f];if(null!=h){var d=h.shape||t.shape,m=d.length;p+="".concat(f,": ").concat(m,"D ").concat(m>0?d:""," ")}}console.log("%c".concat(s,"\t%c").concat(o,"\t%c").concat(u,"D ").concat(l,"\t%c").concat(c,"\t%c").concat(p,"\t%c").concat(i),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}]),e}();function ti(e,t,n){for(var r={},a={},i=0;i<t.length;i++)r[t[i].id]=!0;for(var o=0;o<e.length;o++){var s=e[o],u=s.inputs;for(var c in u){for(var l=u[c],p=!1,f=0;f<t.length;f++)if(r[l.id]){s.outputs.forEach((function(e){return r[e.id]=!0})),p=!0,a[s.id]=!0;break}if(p)break}}var h={};h[n.id]=!0;for(var d={},m=e.length-1;m>=0;m--)for(var v=e[m],g=v.inputs,y=0;y<v.outputs.length;y++)if(h[v.outputs[y].id]){for(var b in g)h[g[b].id]=!0,d[v.id]=!0;break}for(var x=[],k=0;k<e.length;k++){var w=e[k];if(a[w.id]&&d[w.id]){var N={};for(var I in w.inputs){var S=w.inputs[I];r[S.id]&&(N[I]=S)}var T=Object.assign({},w);T.inputs=N,T.outputs=w.outputs,x.push(T)}}return x}function ni(e,t,n,r){for(var a=function(a){var i=t[a],o=[];if(i.outputs.forEach((function(t){var n=e[t.id];null!=n?o.push(n):o.push(null)})),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(i.kernelName,"."));var s=i.gradient(o),u=function(t){if(!(t in s))throw new Error("Cannot backprop through input ".concat(t,". ")+"Available gradients found: ".concat(Object.keys(s),"."));var a=n((function(){return s[t]()}));if("float32"!==a.dtype)throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ")+"".concat(t," must have 'float32' dtype, but has '").concat(a.dtype,"'"));var o=i.inputs[t];if(!ke(a.shape,o.shape))throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ")+"'".concat(t,"' has shape '").concat(a.shape,"', which does not match ")+"the shape of the input '".concat(o.shape,"'"));if(null==e[o.id])e[o.id]=a;else{var u=e[o.id];e[o.id]=r(u,a),u.dispose()}};for(var c in i.inputs)u(c)},i=t.length-1;i>=0;i--)a(i)}var ri=n(136),ai=n(668);function ii(e,t,n,r){var a=He(t),i=function(e,t,n,r){var a=be(t),i=r[r.length-1],o=new Array(i).fill(0),s=t.length,u="complex64"===n?ci(e):e;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,p=0;p<i;p++)o[p]=Math.max(o[p],oi(u[l+p],0,n).length);return o}(e,t,n,a),o=t.length,s=ui(e,t,n,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(n)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(t,"]")),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}function oi(e,t,n){return Te(Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(7))," + ")+"".concat(parseFloat(e[1].toFixed(7)),"j"):Ze(e)?"'".concat(e,"'"):"bool"===n?si(e):parseFloat(e.toFixed(7)).toString(),t)}function si(e){return 0===e?"false":"true"}function ui(e,t,n,r,a){var i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o="complex64"===n?2:1,s=t[0],u=t.length;if(0===u){if("complex64"===n){var c=ci(e);return[oi(c[0],0,n)]}return"bool"===n?[si(e[0])]:[e[0].toString()]}if(1===u){if(s>20){var l=3*o,p=Array.from(e.slice(0,l)),f=Array.from(e.slice((s-3)*o,s*o));return"complex64"===n&&(p=ci(p),f=ci(f)),["["+p.map((function(e,t){return oi(e,a[t],n)})).join(", ")+", ..., "+f.map((function(e,t){return oi(e,a[s-3+t],n)})).join(", ")+"]"]}var h="complex64"===n?ci(e):Array.from(e);return["["+h.map((function(e,t){return oi(e,a[t],n)})).join(", ")+"]"]}var d=t.slice(1),m=r.slice(1),v=r[0]*o,g=[];if(s>20){for(var y=0;y<3;y++){var b=y*v,x=b+v;g.push.apply(g,Y(ui(e.slice(b,x),d,n,m,a,!1)))}g.push("...");for(var k=s-3;k<s;k++){var w=k*v,N=w+v;g.push.apply(g,Y(ui(e.slice(w,N),d,n,m,a,k===s-1)))}}else for(var I=0;I<s;I++){var S=I*v,T=S+v;g.push.apply(g,Y(ui(e.slice(S,T),d,n,m,a,I===s-1)))}var C=2===u?",":"";g[0]="["+g[0]+C;for(var E=1;E<g.length-1;E++)g[E]=" "+g[E]+C;for(var A=",\n",R=2;R<u;R++)A+="\n";return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":A),g}function ci(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var li=function(){function e(t,n,r){var a=this;if((0,$.Z)(this,e),this.dtype=n,this.shape=t.slice(),this.size=be(t),null!=r){var i=r.length;me(i===this.size,(function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")}))}if("complex64"===n)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Fe(n,this.size),this.strides=He(t)}return(0,ee.Z)(e,[{key:"set",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];0===r.length&&(r=[0]),me(r.length===this.rank,(function(){return"The number of provided coordinates (".concat(r.length,") must ")+"match the rank (".concat(t.rank,")")}));var i=this.locToIndex(r);this.values[i]=e}},{key:"get",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);for(var r=0,a=0,i=t;a<i.length;a++){var o=i[a];if(o<0||o>=this.shape[r]){var s="Requested out of range element at ".concat(t,". ")+"  Buffer shape=".concat(this.shape);throw new Error(s)}r++}for(var u=t[t.length-1],c=0;c<t.length-1;++c)u+=this.strides[c]*t[c];return this.values[u]}},{key:"locToIndex",value:function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}},{key:"indexToLoc",value:function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}},{key:"rank",get:function(){return this.shape.length}},{key:"toTensor",value:function(){return pi().makeTensor(this.values,this.shape,this.dtype)}}]),e}(),pi=null,fi=null;var hi=function(){function e(t,n,r,a){(0,$.Z)(this,e),this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=be(t),this.strides=He(t),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return(0,ee.Z)(e,[{key:"rank",get:function(){return this.shape.length}},{key:"buffer",value:function(){var e=J(ne().mark((function e(){var t;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",fi.buffer(this.shape,this.dtype,t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bufferSync",value:function(){return fi.buffer(this.shape,this.dtype,this.dataSync())}},{key:"array",value:function(){var e=J(ne().mark((function e(){var t;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",qe(this.shape,t,"complex64"===this.dtype));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"arraySync",value:function(){return qe(this.shape,this.dataSync(),"complex64"===this.dtype)}},{key:"data",value:function(){var e=J(ne().mark((function e(){var t,n;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.throwIfDisposed(),t=pi().read(this.dataId),"string"!==this.dtype){e.next=13;break}return e.next=5,t;case 5:return n=e.sent,e.prev=6,e.abrupt("return",n.map((function(e){return Ja(e)})));case 10:throw e.prev=10,e.t0=e.catch(6),new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().");case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[6,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"dataToGPU",value:function(e){return this.throwIfDisposed(),pi().readToGPU(this.dataId,e)}},{key:"dataSync",value:function(){this.throwIfDisposed();var e=pi().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return Ja(e)}))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}},{key:"bytes",value:function(){var e=J(ne().mark((function e(){var t;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.throwIfDisposed(),e.next=3,pi().read(this.dataId);case 3:if(t=e.sent,"string"!==this.dtype){e.next=8;break}return e.abrupt("return",t);case 8:return e.abrupt("return",new Uint8Array(t.buffer));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){this.isDisposed||(pi().disposeTensor(this),this.isDisposedInternal=!0)}},{key:"isDisposed",get:function(){return this.isDisposedInternal}},{key:"throwIfDisposed",value:function(){if(this.isDisposed)throw new Error("Tensor is disposed.")}},{key:"print",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return fi.print(this,e)}},{key:"clone",value:function(){return this.throwIfDisposed(),fi.clone(this)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.dataSync();return ii(t,this.shape,this.dtype,e)}},{key:"cast",value:function(e){return this.throwIfDisposed(),fi.cast(this,e)}},{key:"variable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),pi().makeVariable(this,e,t,n)}}]),e}();function di(){return ct("Tensor",(function(){return hi}))}Object.defineProperty(hi,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}}),di();var mi,vi,gi,yi,bi,xi=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e,r,a,i){var o;return(0,$.Z)(this,n),(o=t.call(this,e.shape,e.dtype,e.dataId,i)).trainable=r,o.name=a,o}return(0,ee.Z)(n,[{key:"assign",value:function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!ke(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and ")+"previous value (".concat(this.shape,") must match"));pi().disposeTensor(this),this.dataId=e.dataId,pi().incRef(this,null)}},{key:"dispose",value:function(){pi().disposeVariable(this),this.isDisposedInternal=!0}}]),n}(hi);Object.defineProperty(xi,Symbol.hasInstance,{value:function(e){return e instanceof hi&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(mi||(mi={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(vi||(vi={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(gi||(gi={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(yi||(yi={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(bi||(bi={}));var ki={float32:yi,int32:vi,bool:gi,complex64:bi};function wi(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return ki[e][t]}function Ni(e){return wi(e,"int32")}function Ii(e,t){if(e.dtype===t.dtype)return[e,t];var n=wi(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Si(e,t){me(e.dtype===t.dtype,(function(){return"The dtypes of the first(".concat(e.dtype,") and")+" second(".concat(t.dtype,") input must match")}))}function Ti(e,t){return t.some((function(t){return t.id===e.id}))}function Ci(e){var t=[];return Ei(e,t,new Set),t}function Ei(e,t,n){if(null!=e)if(e instanceof hi)t.push(e);else if(r=e,Array.isArray(r)||"object"===typeof r){var r,a=e;for(var i in a){var o=a[i];n.has(o)||(n.add(o),Ei(o,t,n))}}}function Ai(e){return null!=e.kernelName}var Ri=function(){function e(){(0,$.Z)(this,e),this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((function(e){return e.name}))))}}}return(0,ee.Z)(e,[{key:"dispose",value:function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()}}]),e}(),_i=function(){function e(t){(0,$.Z)(this,e),this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Ri}return(0,ee.Z)(e,[{key:"ready",value:function(){var e=J(ne().mark((function e(){var t,n,r;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.pendingBackendInit){e.next=2;break}return e.abrupt("return",this.pendingBackendInit.then((function(){})));case 2:if(null==this.backendInstance){e.next=4;break}return e.abrupt("return");case 4:t=this.getSortedBackends(),n=0;case 6:if(!(n<t.length)){e.next=18;break}return r=t[n],e.next=10,this.initializeBackend(r).success;case 10:if(!e.sent){e.next=15;break}return e.next=14,this.setBackend(r);case 14:return e.abrupt("return");case 15:n++,e.next=6;break;case 18:throw new Error("Could not initialize any backends, all backend initializations failed.");case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backend",get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance}},{key:"backendNames",value:function(){return Object.keys(this.registryFactory)}},{key:"findBackend",value:function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]}},{key:"findBackendFactory",value:function(e){return e in this.registryFactory?this.registryFactory[e].factory:null}},{key:"registerBackend",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(ga("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}},{key:"setBackend",value:function(){var e=J(ne().mark((function e(t){var n,r;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.registryFactory[t]){e.next=2;break}throw new Error("Backend name '".concat(t,"' not found in registry"));case 2:if(this.backendName=t,null!=this.registry[t]){e.next=16;break}if(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,!n.asyncInit){e.next=12;break}return e.next=9,r;case 9:e.t0=e.sent,e.next=13;break;case 12:e.t0=r;case 13:if(e.t0){e.next=16;break}return e.abrupt("return",!1);case 16:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new $a(this.backendInstance),e.abrupt("return",!0);case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setupRegisteredKernels",value:function(){var e=this;Na(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))}},{key:"disposeRegisteredKernels",value:function(e){var t=this;Na(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))}},{key:"initializeBackend",value:function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var r=n.factory();if(!r||r instanceof ae||"function"!==typeof r.then)return this.registry[e]=r,{success:!0,asyncInit:!1};var a=++this.pendingBackendInitId,i=r.then((function(n){return!(a<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)})).catch((function(n){return a<t.pendingBackendInitId||(t.pendingBackendInit=null,ga("Initialization of backend ".concat(e," failed")),ga(n.stack||n.message)),!1}));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}catch(o){return ga("Initialization of backend ".concat(e," failed")),ga(o.stack||o.message),{success:!1,asyncInit:!1}}}},{key:"removeBackend",value:function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}},{key:"getSortedBackends",value:function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))}},{key:"initializeBackendsAndReturnBest",value:function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,i=r.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}},{key:"moveData",value:function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,a,n.shape,n.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}},{key:"tidy",value:function(e,t){var n,r=this,a=null;if(null==t){if("function"!==typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!==typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!==typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((function(){return r.startScope(a)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))}},{key:"scopedRun",value:function(e,t,n){e();try{var r=n();return t(),r}catch(a){throw t(),a}}},{key:"nextTensorId",value:function(){return e.nextTensorId++}},{key:"nextVariableId",value:function(){return e.nextVariableId++}},{key:"clone",value:function(e){var t=Mi.runKernel(Sn,{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){var t={x:e},n={dtype:"float32"};return Mi.runKernel(Dt,t,n)}}}),[],{}),t}},{key:"runKernel",value:function(e,t,n){if(null==this.backendName&&this.backend,!(null!=ka(e,this.backendName)))throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}},{key:"shouldCheckForMemLeaks",value:function(){return this.ENV.getBool("IS_TEST")}},{key:"checkKernelForMemLeak",value:function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach((function(e){a+="complex64"===e.dtype?3:1}));var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-a-i;if(o>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(o," data ids) after running '").concat(e,"'"))}},{key:"runKernelFunc",value:function(e){var t,n,r,a=this,i=[],o=this.isTapeOn(),s=this.state.numBytes,u=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;var c=Ai(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(Ai(e)){var l=e.kernelName,p=e.inputs,f=e.attrs;null==this.backendName&&this.backend;var h=ka(l,this.backendName);me(null!=h,(function(){return"Cannot find registered kernel '".concat(l,"' for backend '").concat(a.backendName,"'")})),n=function(){var e=a.backend.numDataIds();r=h.kernelFunc({inputs:p,attrs:f,backend:a.backend});var t=Array.isArray(r)?r:[r];a.shouldCheckForMemLeaks()&&a.checkKernelForMemLeak(l,e,t);var n=t.map((function(e){if(null!=e.rank)return e;var t=e.dataId,n=e.shape,r=e.dtype;return a.makeTensorFromDataId(t,n,r)}));if(o){var s=a.getTensorsForGradient(l,p,n);i=a.saveTensorsForBackwardMode(s)}return n}}else{var d=e.forwardFunc,m=function(e){o&&(i=e.map((function(e){return a.keep(a.clone(e))})))};n=function(){var e=a.backend.numDataIds();r=a.tidy((function(){return d(a.backend,m)}));var t=Array.isArray(r)?r:[r];return a.shouldCheckForMemLeaks()&&a.checkKernelForMemLeak(c,e,t),t}}var v,g=e.inputs,y=e.attrs,b=Ai(e)?null:e.backwardsFunc;return this.scopedRun((function(){return a.state.kernelDepth++}),(function(){return a.state.kernelDepth--}),(function(){a.ENV.getBool("DEBUG")||a.state.profiling?(v=a.profiler.profileKernel(c,g,(function(){return n()})),a.ENV.getBool("DEBUG")&&a.profiler.logKernelProfile(v),t=v.outputs):t=n()})),o&&this.addTapeNode(c,g,t,b,i,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-u,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map((function(e){return null!=g[e]?g[e].shape:null})),outputShapes:t.map((function(e){return e.shape})),kernelTimeMs:v.timeMs,extraInfo:v.extraInfo}),Array.isArray(r)?t:t[0]}},{key:"saveTensorsForBackwardMode",value:function(e){var t=this,n=e.map((function(e){return t.keep(t.clone(e))}));return n}},{key:"getTensorsForGradient",value:function(e,t,n){var r=wa(e);if(null!=r){var a,i=r.inputsToSave||[],o=r.outputsToSave||[];r.saveAllInputs?(me(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),a=Object.keys(t).map((function(e){return t[e]}))):a=i.map((function(e){return t[e]}));var s=n.filter((function(e,t){return o[t]}));return a.concat(s)}return[]}},{key:"makeTensor",value:function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var a=e;"string"===n&&Ze(e[0])&&(a=e.map((function(e){return Qa(e)})));var i=r.write(a,t,n),o=new hi(t,n,i,this.nextTensorId());if(this.trackTensor(o,r),"string"===n){var s=this.state.tensorInfo.get(i),u=Pe(a);this.state.numBytes+=u-s.bytes,s.bytes=u}return o}},{key:"makeTensorFromDataId",value:function(e,t,n,r){var a=new hi(t,n=n||"float32",e,this.nextTensorId());return this.trackTensor(a,r),a}},{key:"makeVariable",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));var a=new xi(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}},{key:"trackTensor",value:function(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;var n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*ze(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof xi||this.track(e)}},{key:"incRef",value:function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}},{key:"removeDataId",value:function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}},{key:"disposeTensor",value:function(e){if(this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){var n=e.size*ze(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}}},{key:"disposeVariables",value:function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}}},{key:"disposeVariable",value:function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}},{key:"memory",value:function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}},{key:"profile",value:function(){var e=J(ne().mark((function e(t){var n,r,a,i,o;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],e.next=6,t();case 6:this.state.activeProfile.result=e.sent,this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,Y(this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot})))),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,a=q(this.state.activeProfile.kernels),e.prev=12,a.s();case 14:if((i=a.n()).done){e.next=24;break}return o=i.value,e.next=18,o.kernelTimeMs;case 18:return o.kernelTimeMs=e.sent,e.next=21,o.extraInfo;case 21:o.extraInfo=e.sent;case 22:e.next=14;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(12),a.e(e.t0);case 29:return e.prev=29,a.f(),e.finish(29);case 32:return e.abrupt("return",this.state.activeProfile);case 33:case"end":return e.stop()}}),e,this,[[12,26,29,32]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isTapeOn",value:function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}},{key:"addTapeNode",value:function(e,t,n,r,a,i){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},u=wa(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],a=Xe(r.size,r.dtype);return o.makeTensor(a,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],a,i)}),this.state.activeTape.push(s)}},{key:"keep",value:function(e){return e.kept=!0,e}},{key:"startTape",value:function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}},{key:"endTape",value:function(){this.state.gradientDepth--}},{key:"startScope",value:function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}},{key:"endScope",value:function(e){for(var t=this,n=Ci(e),r=new Set(n.map((function(e){return e.id}))),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];i.kept||r.has(i.id)||i.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==o.id||t.track(e)}))}},{key:"gradients",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(me(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var i=this.scopedRun((function(){return r.startTape()}),(function(){return r.endTape()}),(function(){return r.tidy("forward",e)}));me(i instanceof hi,(function(){return"The result y returned by f() must be a tensor."}));var o=ti(this.state.activeTape,t,i);if(!a&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e={};e[i.id]=null==n?Fi(i.shape):n,ni(e,o,(function(e){return r.tidy(e)}),Li);var a=t.map((function(t){return e[t.id]}));return 0===r.state.gradientDepth&&(r.state.activeTape.forEach((function(e){var t,n=q(e.saved);try{for(n.s();!(t=n.n()).done;){t.value.dispose()}}catch(r){n.e(r)}finally{n.f()}})),r.state.activeTape=null),{value:i,grads:a}}))}},{key:"customGrad",value:function(e){var t=this;return me(Ve(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i;me(r.every((function(e){return e instanceof hi})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var o={};r.forEach((function(e,t){o[t]=e}));var s=function(t,n){return me((i=e.apply(void 0,[].concat(r,[n]))).value instanceof hi,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),me(Ve(i.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),i.value},u=function(e,t){var n=i.gradFunc(e,t),a=Array.isArray(n)?n:[n];me(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),me(a.every((function(e){return e instanceof hi})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}}},{key:"readSync",value:function(e){return this.state.tensorInfo.get(e).backend.readSync(e)}},{key:"read",value:function(e){return this.state.tensorInfo.get(e).backend.read(e)}},{key:"readToGPU",value:function(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}},{key:"time",value:function(){var e=J(ne().mark((function e(t){var n,r;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Xa(),e.next=3,this.backend.time(t);case 3:return(r=e.sent).wallMs=Xa()-n,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"track",value:function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}},{key:"registeredVariables",get:function(){return this.state.registeredVariables}},{key:"reset",value:function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Ri,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}]),e}();function Fi(e){var t=Ke(be(e),"float32");return Mi.makeTensor(t,e,"float32")}function Di(){var e=ut();if(null==e._tfengine){var t=new nt(e);e._tfengine=new _i(t)}return function(e){st=e}(e._tfengine.ENV),pi=function(){return e._tfengine},e._tfengine}_i.nextTensorId=0,_i.nextVariableId=0;var Oi,Mi=Di();function Li(e,t){var n={a:e,b:t};return Mi.runKernel(ht,n)}function zi(e){Oi=e}function Pi(e){if(void 0!==Oi)return Oi;if(e||"undefined"!==typeof navigator&&null!=navigator){if(e||(e=navigator),"ReactNative"===e.product)return!0;var t=e.userAgent||e.vendor||("undefined"!==typeof window?window.opera:"");if(!t){var n=e;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function Zi(){return"undefined"!==typeof window&&null!=window.document||"undefined"!==typeof WorkerGlobalScope}var Bi=it();function Wi(e,t){var n=e;if(Le(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||Le(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&it().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Ui(e,r,[]),r}function Ui(e,t,n){if(n=n||[],Array.isArray(e)||Le(e)){me(t.length>0,(function(){return"Element arr[".concat(n.join("]["),"] should be a primitive, ")+"but is an array of ".concat(e.length," elements")})),me(e.length===t[0],(function(){return"Element arr[".concat(n.join("]["),"] should have ").concat(t[0]," ")+"elements, but has ".concat(e.length," elements")}));for(var r=t.slice(1),a=0;a<e.length;++a)Ui(e[a],r,n.concat(a))}else me(0===t.length,(function(){return"Element arr[".concat(n.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(t[0]," elements")}))}function Vi(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must ")+"be ".concat(e," tensor, but got ").concat(t," tensor"))}}function Gi(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof hi)return Vi(r,e.dtype,t,n),e;var a=Ue(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),Vi(r,a,t,n),null==e||!Le(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e){var i=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=Wi(e,a);Le(e)||Array.isArray(e)||(e=[e]);var s=!0,u="string"!==a?Ka(e,a):ye(e,[],s);return Mi.makeTensor(u,o,a)}function Hi(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=e;return a.map((function(e,a){return Gi(e,"".concat(t,"[").concat(a,"]"),n,r)}))}Bi.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Bi.registerFlag("IS_BROWSER",(function(){return Zi()})),Bi.registerFlag("IS_NODE",(function(){return"undefined"!==typeof process&&"undefined"!==typeof process.versions&&"undefined"!==typeof process.versions.node})),Bi.registerFlag("IS_CHROME",(function(){return"undefined"!==typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),Bi.registerFlag("PROD",(function(){return!1})),Bi.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return Bi.getBool("DEBUG")})),Bi.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),Bi.registerFlag("IS_TEST",(function(){return!1})),Bi.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(function(){return!0})),Bi.registerFlag("WRAP_TO_IMAGEBITMAP",(function(){return!1})),Bi.registerFlag("ENGINE_COMPILE_ONLY",(function(){return!1}));var ji="__op";function qi(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(t.length," keys."));var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+=ji;var a=function(){Mi.startScope(n);try{var e=r.apply(void 0,arguments);return et(e)&&console.error("Cannot return a Promise inside of tidy."),Mi.endScope(e),e}catch(t){throw Mi.endScope(null),t}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}var Ki=qi({complex_:function(e,t){var n=Gi(e,"real","complex"),r=Gi(t,"imag","complex");ve(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", ")+"must match in call to tf.complex().");var a={real:n,imag:r};return Mi.runKernel(Lt,a)}});function Xi(e,t,n,r){if(null==r&&(r=Ue(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Le(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){Qe(t);var a=be(t),i=be(n);me(a===i,(function(){return"Based on the provided shape, [".concat(t,"], the tensor should have ")+"".concat(a," values but has ").concat(i)}));for(var o=0;o<n.length;++o){var s=n[o],u=o!==n.length-1||s!==be(t.slice(o));me(n[o]===t[o]||!u,(function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(n,") does not match the provided ")+"shape (".concat(t,"). ")}))}}return Le(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?Ka(e,r):ye(e,[],!0),Mi.makeTensor(e,t,r)}function Yi(e,t,n){return Xi(e,t,Wi(e,n),n)}var Qi={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};function Ji(e,t){return $i.apply(this,arguments)}function $i(){return $i=J(ne().mark((function e(t,n){var r,a,i,o,s,u;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=[],a=[],i=Array.isArray(t)?t.map((function(e){return e.name})):Object.keys(t),o=function(e){var o=i[e],s=Array.isArray(t)?t[e].tensor:t[o];if("float32"!==s.dtype&&"int32"!==s.dtype&&"bool"!==s.dtype&&"string"!==s.dtype&&"complex64"!==s.dtype)throw new Error("Unsupported dtype in weight '".concat(o,"': ").concat(s.dtype));var u={name:o,shape:s.shape,dtype:s.dtype};if("string"===s.dtype){var c=new Promise(function(){var e=J(ne().mark((function e(t){var n,r,a,i,o,u,c;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.bytes();case 2:for(n=e.sent,r=n.reduce((function(e,t){return e+t.length}),0)+4*n.length,a=new Uint8Array(r),i=0,o=0;o<n.length;o++)u=n[o],c=new Uint8Array(new Uint32Array([u.length]).buffer),a.set(c,i),i+=4,a.set(u,i),i+=u.length;t(a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());a.push(c)}else a.push(s.data());null!=n&&(u.group=n),r.push(u)},s=0;s<i.length;++s)o(s);return e.next=7,Promise.all(a);case 7:return u=e.sent,e.abrupt("return",{data:to(u),specs:r});case 9:case"end":return e.stop()}}),e)}))),$i.apply(this,arguments)}function eo(e,t){var n,r,a={},i=0,o=q(t);try{for(o.s();!(r=o.n()).done;){var s=r.value,u=s.name,c=s.dtype,l=s.shape,p=be(l),f=void 0;if("quantization"in s){var h=s.quantization;if("uint8"===h.dtype||"uint16"===h.dtype){if(!("min"in h)||!("scale"in h))throw new Error("Weight ".concat(s.name," with quantization ").concat(h.dtype," ")+"doesn't have corresponding metadata min and scale.")}else{if("float16"!==h.dtype)throw new Error("Weight ".concat(s.name," has unknown ")+"quantization dtype ".concat(h.dtype,". ")+"Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.");if("float32"!==c)throw new Error("Weight ".concat(s.name," is quantized with ").concat(h.dtype," ")+"which only supports weights of type float32 not ".concat(c,"."))}var d=Qi[h.dtype],m=e.slice(i,i+p*d),v="uint8"===h.dtype?new Uint8Array(m):new Uint16Array(m);if("float32"===c)if("uint8"===h.dtype||"uint16"===h.dtype){f=new Float32Array(v.length);for(var g=0;g<v.length;g++){var y=v[g];f[g]=y*h.scale+h.min}}else{if("float16"!==h.dtype)throw new Error("Unsupported quantization type ".concat(h.dtype," ")+"for weight type float32.");void 0===n&&(n=fo()),f=n(v)}else{if("int32"!==c)throw new Error("Unsupported dtype in weight '".concat(u,"': ").concat(c));if("uint8"!==h.dtype&&"uint16"!==h.dtype)throw new Error("Unsupported quantization type ".concat(h.dtype," ")+"for weight type int32.");f=new Int32Array(v.length);for(var b=0;b<v.length;b++){var x=v[b];f[b]=Math.round(x*h.scale+h.min)}}i+=p*d}else if("string"===c){var k=be(s.shape);f=[];for(var w=0;w<k;w++){var N=new Uint32Array(e.slice(i,i+4))[0];i+=4;var I=new Uint8Array(e.slice(i,i+N));f.push(I),i+=N}}else{var S=Qi[c],T=e.slice(i,i+p*S);if("float32"===c)f=new Float32Array(T);else if("int32"===c)f=new Int32Array(T);else if("bool"===c)f=new Uint8Array(T);else{if("complex64"!==c)throw new Error("Unsupported dtype in weight '".concat(u,"': ").concat(c));f=new Float32Array(T);for(var C=new Float32Array(f.length/2),E=new Float32Array(f.length/2),A=0;A<C.length;A++)C[A]=f[2*A],E[A]=f[2*A+1];var R=Yi(C,l,"float32"),_=Yi(E,l,"float32");a[u]=Ki(R,_),R.dispose(),_.dispose()}i+=p*S}"complex64"!==c&&(a[u]=Yi(f,l,c))}}catch(F){o.e(F)}finally{o.f()}return a}function to(e){if(null===e)throw new Error("Invalid input value: ".concat(JSON.stringify(e)));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(e.constructor.name))}));var r=new Uint8Array(t),a=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),a),a+=e.byteLength})),r.buffer}var no="undefined"!==typeof Buffer&&("undefined"===typeof Blob||"undefined"===typeof atob||"undefined"===typeof btoa);function ro(e){return no?Buffer.byteLength(e):new Blob([e]).size}function ao(e){if(no)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function io(e){if(no){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}function oo(e){if(1===e.length)return e[0];var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function so(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function uo(e,t){var n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}function co(e,t){return lo.apply(this,arguments)}function lo(){return lo=J(ne().mark((function e(t,n){var r,a,i,o,s;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy},null!=t.trainingConfig&&(r.trainingConfig=t.trainingConfig),null==t.weightsManifest){e.next=11;break}return e.next=5,n(t.weightsManifest);case 5:a=e.sent,i=(0,oe.Z)(a,2),o=i[0],s=i[1],r.weightSpecs=o,r.weightData=s;case 11:return null!=t.signature&&(r.signature=t.signature),null!=t.userDefinedMetadata&&(r.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(r.modelInitializer=t.modelInitializer),e.abrupt("return",r);case 15:case"end":return e.stop()}}),e)}))),lo.apply(this,arguments)}function po(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:ro(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:ro(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}function fo(){var e=function(){var e=function(e){for(var t=e<<13,n=0;0===(8388608&t);)n-=8388608,t<<=1;return(t&=-8388609)|n+947912704},t=new Uint32Array(2048);t[0]=0;for(var n=1;n<1024;n++)t[n]=e(n);for(var r=1024;r<2048;r++)t[r]=939524096+(r-1024<<13);return t}(),t=function(){var e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(var t=1;t<31;t++)e[t]=t<<23;for(var n=33;n<63;n++)e[n]=2147483648+(n-32<<23);return e}(),n=function(){for(var e=new Uint32Array(64),t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return function(r){for(var a=new ArrayBuffer(4*r.length),i=new Uint32Array(a),o=0;o<r.length;o++){var s=r[o],u=e[n[s>>10]+(1023&s)]+t[s>>10];i[o]=u}return new Float32Array(a)}}var ho=function(){function e(){(0,$.Z)(this,e),this.saveRouters=[],this.loadRouters=[]}return(0,ee.Z)(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerSaveRouter",value:function(t){e.getInstance().saveRouters.push(t)}},{key:"registerLoadRouter",value:function(t){e.getInstance().loadRouters.push(t)}},{key:"getSaveHandlers",value:function(t){return e.getHandlers(t,"save")}},{key:"getLoadHandlers",value:function(t,n){return e.getHandlers(t,"load",n)}},{key:"getHandlers",value:function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&a.push(n)})),a}}]),e}(),mo=function(e){return ho.registerSaveRouter(e)},vo=function(e){return ho.registerLoadRouter(e)},go=function(e){return ho.getSaveHandlers(e)},yo=function(e,t){return ho.getLoadHandlers(e,t)},bo="tensorflowjs",xo="models_store",ko="model_info_store";function wo(){if(!it().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e="undefined"===typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function No(e){var t=e.result;t.createObjectStore(xo,{keyPath:"modelPath"}),t.createObjectStore(ko,{keyPath:"modelPath"})}var Io=function(){function e(t){if((0,$.Z)(this,e),this.indexedDB=wo(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return(0,ee.Z)(e,[{key:"save",value:function(){var e=J(ne().mark((function e(t){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return e.abrupt("return",this.databaseAction(this.modelPath,t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=J(ne().mark((function e(){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.databaseAction(this.modelPath));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"databaseAction",value:function(e,t){var n=this;return new Promise((function(e,r){var a=n.indexedDB.open(bo,1);a.onupgradeneeded=function(){return No(a)},a.onsuccess=function(){var i=a.result;if(null==t){var o=i.transaction(xo,"readonly"),s=o.objectStore(xo).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '".concat(n.modelPath,"' ")+"in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),r(s.error)},o.oncomplete=function(){return i.close()}}else{var u,c=po(t),l=i.transaction(ko,"readwrite"),p=l.objectStore(ko),f=p.put({modelPath:n.modelPath,modelArtifactsInfo:c});f.onsuccess=function(){var a=(u=i.transaction(xo,"readwrite")).objectStore(xo).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c});a.onsuccess=function(){return e({modelArtifactsInfo:c})},a.onerror=function(e){var t=(p=l.objectStore(ko)).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(a.error)},t.onerror=function(e){return i.close(),r(a.error)}}},f.onerror=function(e){return i.close(),r(f.error)},l.oncomplete=function(){null==u?i.close():u.oncomplete=function(){return i.close()}}}},a.onerror=function(e){return r(a.error)}}))}}]),e}();Io.URL_SCHEME="indexeddb://";var So=function(e){return it().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Io.URL_SCHEME)?(t=e.slice(Io.URL_SCHEME.length),new Io(t)):null;var t};ho.registerSaveRouter(So),ho.registerLoadRouter(So);var To=function(){function e(){(0,$.Z)(this,e),this.indexedDB=wo()}return(0,ee.Z)(e,[{key:"listModels",value:function(){var e=J(ne().mark((function e(){var t=this;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.indexedDB.open(bo,1);r.onupgradeneeded=function(){return No(r)},r.onsuccess=function(){var t=r.result,a=t.transaction(ko,"readonly"),i=a.objectStore(ko).getAll();i.onsuccess=function(){var t,n={},r=q(i.result);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[a.modelPath]=a.modelArtifactsInfo}}catch(o){r.e(o)}finally{r.f()}e(n)},i.onerror=function(e){return t.close(),n(i.error)},a.oncomplete=function(){return t.close()}},r.onerror=function(e){return n(r.error)}})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=J(ne().mark((function e(t){var n=this;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(r=t).startsWith(Io.URL_SCHEME)?r.slice(Io.URL_SCHEME.length):r,e.abrupt("return",new Promise((function(e,r){var a=n.indexedDB.open(bo,1);a.onupgradeneeded=function(){return No(a)},a.onsuccess=function(){var n,i=a.result,o=i.transaction(ko,"readwrite"),s=o.objectStore(ko),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),r(new Error("Cannot find model with path '".concat(t,"' ")+"in IndexedDB."));var a=s.delete(t),o=function(){var a=(n=i.transaction(xo,"readwrite")).objectStore(xo).delete(t);a.onsuccess=function(){return e(u.result.modelArtifactsInfo)},a.onerror=function(e){return r(u.error)}};a.onsuccess=o,a.onerror=function(e){return o(),i.close(),r(u.error)}},u.onerror=function(e){return i.close(),r(u.error)},o.oncomplete=function(){null==n?i.close():n.oncomplete=function(){return i.close()}}},a.onerror=function(e){return r(a.error)}})));case 2:case"end":return e.stop()}var r}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Co="/",Eo="tensorflowjs_models",Ao="info",Ro="model_topology",_o="weight_specs",Fo="weight_data",Do="model_metadata";function Oo(e){return{info:[Eo,e,Ao].join(Co),topology:[Eo,e,Ro].join(Co),weightSpecs:[Eo,e,_o].join(Co),weightData:[Eo,e,Fo].join(Co),modelMetadata:[Eo,e,Do].join(Co)}}function Mo(e){for(var t=0,n=Object.values(e);t<n.length;t++){var r=n[t];window.localStorage.removeItem(r)}}function Lo(e){var t=e.split(Co);if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join(Co)}var zo=function(){function e(t){if((0,$.Z)(this,e),!it().getBool("IS_BROWSER")||"undefined"===typeof window||"undefined"===typeof window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=Oo(this.modelPath)}return(0,ee.Z)(e,[{key:"save",value:function(){var e=J(ne().mark((function e(t){var n,r,a,i;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=4;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 4:return n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),a=po(t),e.prev=7,this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,ao(t.weightData)),i={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),e.abrupt("return",{modelArtifactsInfo:a});case 17:throw e.prev=17,e.t0=e.catch(7),Mo(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."));case 21:case"end":return e.stop()}}),e,this,[[7,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=J(ne().mark((function e(){var t,n,r,a,i,o,s;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=JSON.parse(this.LS.getItem(this.keys.info)))){e.next=3;break}throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));case 3:if("JSON"===t.modelTopologyType){e.next=5;break}throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");case 5:if(n={},null!=(r=JSON.parse(this.LS.getItem(this.keys.topology)))){e.next=9;break}throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");case 9:if(n.modelTopology=r,null!=(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))){e.next=13;break}throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");case 13:if(n.weightSpecs=a,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(i),n.format=o.format,n.generatedBy=o.generatedBy,n.convertedBy=o.convertedBy,null!=o.signature&&(n.signature=o.signature),null!=o.userDefinedMetadata&&(n.userDefinedMetadata=o.userDefinedMetadata),null!=o.modelInitializer&&(n.modelInitializer=o.modelInitializer),null!=o.trainingConfig&&(n.trainingConfig=o.trainingConfig)),null!=(s=this.LS.getItem(this.keys.weightData))){e.next=19;break}throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));case 19:return n.weightData=io(s),e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();zo.URL_SCHEME="localstorage://";var Po=function(e){return it().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(zo.URL_SCHEME)?(t=e.slice(zo.URL_SCHEME.length),new zo(t)):null;var t};ho.registerSaveRouter(Po),ho.registerLoadRouter(Po);var Zo=function(){function e(){(0,$.Z)(this,e),me(it().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),me("undefined"===typeof window||"undefined"!==typeof window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return(0,ee.Z)(e,[{key:"listModels",value:function(){var e=J(ne().mark((function e(){var t,n,r,a,i,o;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t={},n=Eo+Co,r=Co+Ao,a=0;a<this.LS.length;++a)(i=this.LS.key(a)).startsWith(n)&&i.endsWith(r)&&(o=Lo(i),t[o]=JSON.parse(this.LS.getItem(i)));return e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=J(ne().mark((function e(t){var n,r;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(a=t).startsWith(zo.URL_SCHEME)?a.slice(zo.URL_SCHEME.length):a,n=Oo(t),null!=this.LS.getItem(n.info)){e.next=4;break}throw new Error("Cannot find model at path '".concat(t,"'"));case 4:return r=JSON.parse(this.LS.getItem(n.info)),Mo(n),e.abrupt("return",r);case 7:case"end":return e.stop()}var a}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Bo="://",Wo=function(){function e(){(0,$.Z)(this,e),this.managers={}}return(0,ee.Z)(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerManager",value:function(t,n){me(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(Bo)&&(t=t.slice(0,t.indexOf(Bo))),me(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();me(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '".concat(t,"'.")})),r.managers[t]=n}},{key:"getManager",value:function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '".concat(e,"'"));return t}},{key:"getSchemes",value:function(){return Object.keys(this.getInstance().managers)}}]),e}();function Uo(e){if(-1===e.indexOf(Bo))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+"".concat(Wo.getSchemes().join(",")));return{scheme:e.split(Bo)[0],path:e.split(Bo)[1]}}function Vo(e,t){return Go.apply(this,arguments)}function Go(){return Go=J(ne().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,f,h=arguments;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=h.length>2&&void 0!==h[2]&&h[2],me(t!==n,(function(){return"Old path and new path are the same: '".concat(t,"'")})),me((a=ho.getLoadHandlers(t)).length>0,(function(){return"Copying failed because no load handler is found for source URL ".concat(t,".")})),me(a.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") ")+"load handlers for source URL ".concat(t,".")})),i=a[0],me((o=ho.getSaveHandlers(n)).length>0,(function(){return"Copying failed because no save handler is found for destination "+"URL ".concat(n,".")})),me(o.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") ")+"save handlers for destination URL ".concat(n,".")})),s=o[0],u=Uo(t).scheme,c=Uo(t).path,l=u===Uo(t).scheme,e.next=15,i.load();case 15:if(p=e.sent,!r||!l){e.next=19;break}return e.next=19,Wo.getManager(u).removeModel(c);case 19:return e.next=21,s.save(p);case 21:if(f=e.sent,!r||l){e.next=25;break}return e.next=25,Wo.getManager(u).removeModel(c);case 25:return e.abrupt("return",f.modelArtifactsInfo);case 26:case"end":return e.stop()}}),e)}))),Go.apply(this,arguments)}function Ho(){return jo.apply(this,arguments)}function jo(){return(jo=J(ne().mark((function e(){var t,n,r,a,i,o,s;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Wo.getSchemes(),n={},r=q(t),e.prev=3,r.s();case 5:if((a=r.n()).done){e.next=13;break}return i=a.value,e.next=9,Wo.getManager(i).listModels();case 9:for(s in o=e.sent)n[i+Bo+s]=o[s];case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return e.abrupt("return",n);case 22:case"end":return e.stop()}}),e,null,[[3,15,18,21]])})))).apply(this,arguments)}function qo(e){return Ko.apply(this,arguments)}function Ko(){return(Ko=J(ne().mark((function e(t){var n,r;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Uo(t),r=Wo.getManager(n.scheme),e.abrupt("return",r.removeModel(n.path));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xo(e,t){return Yo.apply(this,arguments)}function Yo(){return(Yo=J(ne().mark((function e(t,n){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!1,e.abrupt("return",Vo(t,n,false));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qo(e,t){return Jo.apply(this,arguments)}function Jo(){return(Jo=J(ne().mark((function e(t,n){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!0,e.abrupt("return",Vo(t,n,true));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var $o=function(){function e(){(0,$.Z)(this,e)}return(0,ee.Z)(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return fetch(e,t)}))},{key:"now",value:function(){return performance.now()}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return new TextDecoder(t).decode(e)}}]),e}();if(it().get("IS_BROWSER")){it().setPlatform("browser",new $o);try{Wo.registerManager(zo.URL_SCHEME,new Zo)}catch($V){}try{Wo.registerManager(Io.URL_SCHEME,new To)}catch($V){}}var es,ts=function(){return n(410)};var ns=function(){function e(){(0,$.Z)(this,e),this.util=n(628),this.textEncoder=new this.util.TextEncoder}return(0,ee.Z)(e,[{key:"fetch",value:function(e,t){return null!=it().global.fetch?it().global.fetch(e,t):(null==es&&(es=ts()),es(e,t))}},{key:"now",value:function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}}]),e}();function rs(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",Qe(e),new li(e,t,n)}it().get("IS_NODE")&&!it().get("IS_BROWSER")&&it().setPlatform("node",new ns);var as=qi({cast_:function(e,t){var n=Gi(e,"x","cast");if(!Oe(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={x:n},a={dtype:t};return Mi.runKernel(Dt,r,a)}});var is=qi({clone_:function(e){var t={x:Gi(e,"x","clone","string_or_numeric")};return Mi.runKernel(Sn,t)}});function os(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}Di(),fi={buffer:rs,cast:as,clone:is,print:os};function ss(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var us=function(){function e(t){if((0,$.Z)(this,e),!it().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelJsonFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return(0,ee.Z)(e,[{key:"save",value:function(){var e=J(ne().mark((function e(t){var n,r,a,i,o,s;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof document){e.next=2;break}throw new Error("Browser downloads are not supported in this environment since `document` is not present");case 2:if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer)){e.next=7;break}throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 7:return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],a=uo(t,r),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),(o=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor).download=this.modelJsonFileName,o.href=i,e.next=15,ss((function(){return o.dispatchEvent(new MouseEvent("click"))}));case 15:if(null==t.weightData){e.next=21;break}return(s=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=n,e.next=21,ss((function(){return s.dispatchEvent(new MouseEvent("click"))}));case 21:return e.abrupt("return",{modelArtifactsInfo:po(t)});case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();us.URL_SCHEME="downloads://";var cs=function(){function e(t){if((0,$.Z)(this,e),null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, "+"but received ".concat(t));this.jsonFile=t[0],this.weightsFiles=t.slice(1)}return(0,ee.Z)(e,[{key:"load",value:function(){var e=J(ne().mark((function e(){var t=this;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=new FileReader;r.onload=function(r){var a=JSON.parse(r.target.result),i=a.modelTopology;if(null!=i)if(null!=a.weightsManifest)if(0!==t.weightsFiles.length){var o=co(a,(function(e){return t.loadWeights(e)}));e(o)}else e({modelTopology:i});else n(new Error("weightManifest field is missing from file ".concat(t.jsonFile.name)));else n(new Error("modelTopology field is missing from file ".concat(t.jsonFile.name)))},r.onerror=function(e){return n("Failed to read model topology and weights manifest JSON "+"from file '".concat(t.jsonFile.name,"'. BrowserFiles supports loading ")+"Keras-style tf.Model artifacts only.")},r.readAsText(t.jsonFile)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(e){var t,n=this,r=[],a=[],i=q(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;r.push.apply(r,Y(o.weights)),a.push.apply(a,Y(o.paths))}}catch($V){i.e($V)}finally{i.f()}var s=this.checkManifestAndWeightFiles(e),u=a.map((function(e){return n.loadWeightsFile(e,s[e])}));return Promise.all(u).then((function(e){return[r,oo(e)]}))}},{key:"loadWeightsFile",value:function(e,t){return new Promise((function(n,r){var a=new FileReader;a.onload=function(e){var t=e.target.result;n(t)},a.onerror=function(t){return r("Failed to weights data from file of path '".concat(e,"'."))},a.readAsArrayBuffer(t)}))}},{key:"checkManifestAndWeightFiles",value:function(e){var t,n=this,r=[],a=this.weightsFiles.map((function(e){return so(e.name)})),i={},o=q(e);try{for(o.s();!(t=o.n()).done;){t.value.paths.forEach((function(e){var t=so(e);if(-1!==r.indexOf(t))throw new Error("Duplicate file basename found in weights manifest: "+"'".concat(t,"'"));if(r.push(t),-1===a.indexOf(t))throw new Error("Weight file with basename '".concat(t,"' is not provided."));i[e]=n.weightsFiles[a.indexOf(t)]}))}}catch($V){o.e($V)}finally{o.f()}if(r.length!==this.weightsFiles.length)throw new Error("Mismatch in the number of files in weights manifest "+"(".concat(r.length,") and the number of weight files provided ")+"(".concat(this.weightsFiles.length,")."));return i}}]),e}();function ls(e){return new cs(e)}function ps(e,t,n,r){!function(e){me(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){me(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(e)})),me(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(t)})),me(t>=e,(function(){return"startFraction must be no more than endFraction, but "+"got startFraction ".concat(e," and endFraction ")+"".concat(t)}))}(n=null==n?0:n,r=null==r?1:r);var a=0;return Promise.all(e.map((function(i){return i.then((function(i){var o=n+ ++a/e.length*(r-n);return t(o),i})),i})))}function fs(e,t){return hs.apply(this,arguments)}function hs(){return(hs=J(ne().mark((function e(t,n){var r,a,i,o,s,u,c,l,p;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),r=null==n.fetchFunc?it().platform.fetch:n.fetchFunc,a=t.map((function(e){return r(e,n.requestInit,{isBinary:!0})})),i=0,o=.5,null!=n.onProgress){e.next=11;break}return e.next=8,Promise.all(a);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,ps(a,n.onProgress,i,o);case 13:e.t0=e.sent;case 14:if(s=e.t0,u=s.map((function(e){return e.arrayBuffer()})),c=.5,l=1,null!=n.onProgress){e.next=24;break}return e.next=21,Promise.all(u);case 21:e.t1=e.sent,e.next=27;break;case 24:return e.next=26,ps(u,n.onProgress,c,l);case 26:e.t1=e.sent;case 27:return p=e.t1,e.abrupt("return",p);case 29:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ds(e){return ms.apply(this,arguments)}function ms(){return ms=J(ne().mark((function e(t){var n,r,a,i,o=arguments;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:"",r=o.length>2?o[2]:void 0,a=o.length>3?o[3]:void 0,i=vs((function(e){return fs(e,{requestInit:a})})),e.abrupt("return",i(t,n,r));case 6:case"end":return e.stop()}}),e)}))),ms.apply(this,arguments)}function vs(e){return function(){var t=J(ne().mark((function t(n){var r,a,i,o,s,u,c,l,p,f,h,d,m=arguments;return ne().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=m.length>1&&void 0!==m[1]?m[1]:"",a=m.length>2?m[2]:void 0,i=n.map((function(){return!1})),o={},s=null!=a?a.map((function(){return!1})):[],u=[],n.forEach((function(e,t){var n=0;e.weights.forEach((function(e){var r="quantization"in e?e.quantization.dtype:e.dtype,c=Qi[r]*be(e.shape),l=function(){i[t]=!0,null==o[t]&&(o[t]=[]),o[t].push({manifestEntry:e,groupOffset:n,sizeBytes:c})};null!=a?a.forEach((function(t,n){t===e.name&&(l(),s[n]=!0)})):l(),u.push(e.name),n+=c}))})),s.every((function(e){return e}))){t.next=10;break}throw c=a.filter((function(e,t){return!s[t]})),new Error("Could not find weights in manifest with names: "+"".concat(c.join(", "),". \n")+"Manifest JSON has weights with names: "+"".concat(u.join(", "),"."));case 10:return l=i.reduce((function(e,t,n){return t&&e.push(n),e}),[]),p=[],l.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;p.push(t)}))})),t.next=15,e(p);case 15:return f=t.sent,h={},d=0,l.forEach((function(e){for(var t=n[e].paths.length,r=0,a=0;a<t;a++)r+=f[d+a].byteLength;for(var i=new ArrayBuffer(r),s=new Uint8Array(i),u=0,c=0;c<t;c++){var l=new Uint8Array(f[d+c]);s.set(l,u),u+=l.byteLength}o[e].forEach((function(e){var t=eo(i.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)h[n]=t[n]})),d+=t})),t.abrupt("return",h);case 20:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}ho.registerSaveRouter((function(e){return it().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(us.URL_SCHEME)?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new us(e)}(e.slice(us.URL_SCHEME.length)):null}));var gs=function(){function e(t,n){if((0,$.Z)(this,e),this.DEFAULT_METHOD="POST",null==n&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,null!=n.fetchFunc?(me("function"===typeof n.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=n.fetchFunc):this.fetch=it().platform.fetch,me(null!=t&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&me(2===t.length,(function(){return"URL paths for http must have a length of 2, "+"(actual length is ".concat(t.length,").")})),this.path=t,null!=n.requestInit&&null!=n.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return(0,ee.Z)(e,[{key:"save",value:function(){var e=J(ne().mark((function e(t){var n,r,a,i;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");case 2:return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],a=uo(t,r),n.body.append("model.json",new Blob([JSON.stringify(a)],{type:"application/json"}),"model.json"),null!=t.weightData&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),e.next=10,this.fetch(this.path,n);case 10:if(!(i=e.sent).ok){e.next=15;break}return e.abrupt("return",{modelArtifactsInfo:po(t),responses:[i]});case 15:throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(i.status,"."));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=J(ne().mark((function e(){var t,n,r,a,i,o=this;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(this.path,this.requestInit);case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(t.status,". Please verify this URL points to ")+"the model JSON of the model to load.");case 5:return e.prev=5,e.next=8,t.json();case 8:n=e.sent,e.next=16;break;case 11:throw e.prev=11,e.t0=e.catch(5),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 16:if(a=n.modelTopology,i=n.weightsManifest,null!=a||null!=i){e.next=20;break}throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");case 20:return e.abrupt("return",co(n,(function(e){return o.loadWeights(e)})));case 21:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(){var e=J(ne().mark((function e(t){var n,r,a,i,o,s,u,c,l,p,f,h,d,m,v,g,y,b,x;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Array.isArray(this.path)?this.path[1]:this.path,r=ys(n),a=(0,oe.Z)(r,2),i=a[0],o=a[1],s=this.weightPathPrefix||i,u=[],c=q(t);try{for(c.s();!(l=c.n()).done;)p=l.value,u.push.apply(u,Y(p.weights))}catch($V){c.e($V)}finally{c.f()}f=[],h=[],d=q(t);try{for(d.s();!(m=d.n()).done;){v=m.value,g=q(v.paths);try{for(g.s();!(y=g.n()).done;)b=y.value,null!=this.weightUrlConverter?h.push(this.weightUrlConverter(b)):f.push(s+b+o)}catch($V){g.e($V)}finally{g.f()}}}catch($V){d.e($V)}finally{d.f()}if(!this.weightUrlConverter){e.next=19;break}return e.t0=f.push,e.t1=f,e.t2=Y,e.next=16,Promise.all(h);case 16:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4);case 19:return e.next=21,fs(f,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});case 21:return x=e.sent,e.abrupt("return",[u,oo(x)]);case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function ys(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}function bs(e){return null!=e.match(gs.URL_SCHEME_REGEX)}gs.URL_SCHEME_REGEX=/^https?:\/\//;var xs=function(e,t){if("undefined"===typeof fetch&&(null==t||null==t.fetchFunc))return null;return(Array.isArray(e)?e.every((function(e){return bs(e)})):bs(e))?ks(e,t):null};function ks(e,t){return new gs(e,t)}function ws(e,t){return ks(e,t)}ho.registerSaveRouter(xs),ho.registerLoadRouter(xs);var Ns=function(){function e(t){(0,$.Z)(this,e),this.modelArtifacts=t}return(0,ee.Z)(e,[{key:"load",value:function(){var e=J(ne().mark((function e(){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.modelArtifacts);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),Is=function(){function e(t){(0,$.Z)(this,e),this.saveHandler=t}return(0,ee.Z)(e,[{key:"save",value:function(){var e=J(ne().mark((function e(t){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.saveHandler(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function Ss(e,t,n,r){if(1===arguments.length){var a=null!=e.modelTopology||null!=e.weightSpecs;return a?new Ns(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Ns({modelTopology:e}))}return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Ns({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r})}function Ts(e){return new Is(e)}var Cs=qi({matMul_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Gi(e,"a","matMul"),i=Gi(t,"b","matMul"),o=Ii(a,i),s=(0,oe.Z)(o,2),u={a:a=s[0],b:i=s[1]},c={transposeA:n,transposeB:r};return Mi.runKernel(Et,u,c)}});var Es=qi({oneHot_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(t));var a=Gi(e,"indices","oneHot","int32"),i={indices:a},o={depth:t,onValue:n,offValue:r};return Mi.runKernel(cr,i,o)}});var As=qi({transpose_:function(e,t){var n=Gi(e,"x","transpose");if(null==t&&(t=n.shape.map((function(e,t){return t})).reverse()),me(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of perm ".concat(t,".")})),t.forEach((function(e){me(e>=0&&e<n.rank,(function(){return"All entries in 'perm' must be between 0 and ".concat(n.rank-1)+" but got ".concat(t)}))})),n.rank<=1)return n.clone();var r={x:n},a={perm:t};return Mi.runKernel(oa,r,a)}});var Rs,_s=qi({confusionMatrix_:function(e,t,n){var r=Gi(e,"labels","confusionMatrix"),a=Gi(t,"predictions","confusionMatrix");me(null==n||n>0&&Number.isInteger(n),(function(){return"If provided, numClasses must be a positive integer, "+"but got ".concat(n)})),me(1===r.rank,(function(){return"Expected the rank of labels to be 1, but got ".concat(r.rank)})),me(1===a.rank,(function(){return"Expected the rank of predictions to be 1, "+"but got ".concat(a.rank)})),me(r.shape[0]===a.shape[0],(function(){return"Mismatch in the number of examples: "+"".concat(r.shape[0]," vs. ").concat(a.shape[0],". ")+"Labels and predictions should have the same number of elements."})),me(n>0&&Number.isInteger(n),(function(){return"numClasses is required to be a positive integer, but got "+"".concat(n)}));var i=Es(as(r,"int32"),n),o=Es(as(a,"int32"),n),s=As(i),u=Cs(s,o);return as(u,"int32")}});function Fs(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var i=n-1-a,o=e[i]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(i)}return r}function Ds(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],i=t.length-r-1,o=t[i];(null==a||1===a&&o>1)&&n.unshift(i)}return n}function Os(e,t){for(var n=[],r=Math.max(e.length,t.length),a=0;a<r;a++){var i=e[e.length-a-1];null==i&&(i=1);var o=t[t.length-a-1];if(null==o&&(o=1),1===i)n.unshift(o);else if(1===o)n.unshift(i);else{if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(e," and ").concat(t,".");throw Error(s)}n.unshift(i)}}return n}function Ms(e,t,n){if(ge(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=Wi(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Xi(e,t,r,n)}function Ls(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,a=!1,i=!1,o=!1,s=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!==typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!==typeof HTMLVideoElement&&e instanceof HTMLVideoElement)a=!0;else if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement)i=!0;else if(null!=e.getContext)o=!0;else{if(!("undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, "+"but was ".concat(e.constructor.name));s=!0}if(a){var u=2;if(a&&e.readyState<u)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}var c=ka(fa,Mi.backendName);if(null!=c){var l={pixels:e},p={numChannels:t};return Mi.runKernel(fa,l,p)}var f,h,d=a?[e.videoWidth,e.videoHeight]:[e.width,e.height],m=(0,oe.Z)(d,2),v=m[0],g=m[1];if(o)f=e.getContext("2d").getImageData(0,0,v,g).data;else if(r||n)f=e.data;else if(i||a||s){if(null==Rs)if("undefined"===typeof document){if("undefined"===typeof OffscreenCanvas||"undefined"===typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");Rs=new OffscreenCanvas(1,1).getContext("2d")}else Rs=document.createElement("canvas").getContext("2d");Rs.canvas.width=v,Rs.canvas.height=g,Rs.drawImage(e,0,0,v,g),f=Rs.getImageData(0,0,v,g).data}if(4===t)h=new Int32Array(f);else{var y=v*g;h=new Int32Array(y*t);for(var b=0;b<y;b++)for(var x=0;x<t;++x)h[b*t+x]=f[4*b+x]}var k=[g,v,t];return Ms(h,k,"int32")}function zs(e){return"undefined"!==typeof window&&"undefined"!==typeof ImageBitmap&&window.hasOwnProperty("createImageBitmap")&&!(e instanceof ImageBitmap)&&function(e){return null!=e&&0!==e.width&&0!==e.height}(e)&&!function(e){return null!=e&&e.data instanceof Uint8Array}(e)}function Ps(e){return Zs.apply(this,arguments)}function Zs(){return Zs=J(ne().mark((function e(t){var n,r,a,i=arguments;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:3,r=null,!it().getBool("WRAP_TO_IMAGEBITMAP")||!zs(t)){e.next=15;break}return e.prev=3,e.next=6,createImageBitmap(t,{premultiplyAlpha:"none"});case 6:a=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),a=null;case 12:r=null!=a&&a.width===t.width&&a.height===t.height?a:t,e.next=16;break;case 15:r=t;case 16:return e.abrupt("return",Ls(r,n));case 17:case"end":return e.stop()}}),e,null,[[3,9]])}))),Zs.apply(this,arguments)}function Bs(e,t){return Ws.apply(this,arguments)}function Ws(){return(Ws=J(ne().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,f,h,d,m,v,g,y,b;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Gi(t,"img","toPixels"),t instanceof hi||(r=as(a=r,"int32"),a.dispose()),2===r.rank||3===r.rank){e.next=4;break}throw new Error("toPixels only supports rank 2 or 3 tensors, got rank ".concat(r.rank,"."));case 4:if(i=r.shape.slice(0,2),o=(0,oe.Z)(i,2),s=o[0],u=o[1],!((c=2===r.rank?1:r.shape[2])>4||2===c)){e.next=8;break}throw new Error("toPixels only supports depth of size "+"1, 3 or 4 but got ".concat(c));case 8:if("float32"===r.dtype||"int32"===r.dtype){e.next=10;break}throw new Error("Unsupported type for toPixels: ".concat(r.dtype,".")+" Please use float32 or int32 tensors.");case 10:return e.next=12,r.data();case 12:l=e.sent,p="float32"===r.dtype?255:1,f=new Uint8ClampedArray(u*s*4),h=0;case 16:if(!(h<s*u)){e.next=41;break}d=[0,0,0,255],m=0;case 19:if(!(m<c)){e.next=33;break}if(v=l[h*c+m],"float32"!==r.dtype){e.next=26;break}if(!(v<0||v>1)){e.next=24;break}throw new Error("Tensor values for a float32 Tensor must be in the "+"range [0 - 1] but encountered ".concat(v,"."));case 24:e.next=29;break;case 26:if("int32"!==r.dtype){e.next=29;break}if(!(v<0||v>255)){e.next=29;break}throw new Error("Tensor values for a int32 Tensor must be in the "+"range [0 - 255] but encountered ".concat(v,"."));case 29:1===c?(d[0]=v*p,d[1]=v*p,d[2]=v*p):d[m]=v*p;case 30:m++,e.next=19;break;case 33:f[(g=4*h)+0]=Math.round(d[0]),f[g+1]=Math.round(d[1]),f[g+2]=Math.round(d[2]),f[g+3]=Math.round(d[3]);case 38:++h,e.next=16;break;case 41:return null!=n&&(n.width=u,n.height=s,y=n.getContext("2d"),b=new ImageData(f,u,s),y.putImageData(b,0,0)),r!==t&&r.dispose(),e.abrupt("return",f);case 44:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Us=qi({fromPixels_:Ls});function Vs(e,t){var n=e.shape.length,r=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+" but the rank was ".concat(n,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(r,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type,"+" but the dtype was ".concat(t.dtype,"."));if(t.shape[r-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+"".concat(t.shape[r-1]," vs. ").concat(n));if(0===be(e.shape))throw new Error("Requested more than 0 entries, but input is empty."+" Input shape: ".concat(e.shape,"."));for(var a=t.shape,i=a[a.length-1],o=1,s=0;s<a.length-1;++s)o*=a[s];var u=e.shape,c=a.slice();c.pop();for(var l=1,p=i;p<n;++p)l*=u[p],c.push(u[p]);var f=[].concat(Y(He(e.shape).map((function(e){return e/l}))),[1]).slice(0,i);return[c,o,l,f]}function Gs(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(n.shape)+", indices.shape: ".concat(t.shape,", shape: ").concat(e)+", sliceDim: ".concat(r,", and batchDim: ").concat(a,".");if(n.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(e.length<r+(n.rank-a))throw new Error(i+" Output shape length < ".concat(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(i+" update.rank != ".concat(a+e.length-r));for(var o=0;o<a;++o)if(n.shape[o]!==t.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(n.shape[o],") != indices.shape[").concat(o,"] (").concat(t.shape[o],")."));for(var s=0;s<n.rank-a;++s)if(n.shape[s+a]!==e[s+r])throw new Error(i+" updates.shape[".concat(s+a,"] (").concat(n.shape[s+a],") != shape[").concat(s+a,"] (").concat(e[s+a],")"))}function Hs(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(t.rank,"."));if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(t.dtype));if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(n));if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: ".concat(t.shape));if(0===e.size)throw new Error("Updates specified for empty output. updates shape: ".concat(e.shape))}Gs(n,t,e)}function js(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length,o=1,s=a;s<i;++s)o*=n[s];var u=a<1?1:a;return{sliceRank:a,numUpdates:be(t.shape)/u,sliceSize:o,strides:[].concat(Y(He(n.slice(0,a))),[1]),outputSize:be(n)}}function qs(e,t,n){var r=e.shape.length;me(r===t.length,(function(){return"Error in slice".concat(r,"D: Length of begin ").concat(t," must ")+"match the rank of the array (".concat(r,").")})),me(r===n.length,(function(){return"Error in slice".concat(r,"D: Length of size ").concat(n," must ")+"match the rank of the array (".concat(r,").")}));for(var a=function(a){me(t[a]+n[a]<=e.shape[a],(function(){return"Error in slice".concat(r,"D: begin[").concat(a,"] + size[").concat(a,"] ")+"(".concat(t[a]+n[a],") would overflow input.shape[").concat(a,"] (").concat(e.shape[a],")")}))},i=0;i<r;++i)a(i)}function Ks(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function Xs(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function Ys(e,t,n,r){for(var a=Y(e),i=a.length;i<r.length;i++)a.push(1);for(var o=0;o<n;o++)0===o?a[t]=1:(a.splice(t,0,1),a.pop());return a}function Qs(e,t,n){return n<=e?n:n-(t-1)}function Js(e,t){for(var n=[],r=0;r<e;r++)n.push(t+r);return n}function $s(e,t,n,r,a,i,o,s,u){var c=e.length,l=new Array(c),p=new Array(c),f=new Array(c);if(t.length&&n>0){var h=t[0],d=n+1;l=eu(o,h,d,r,e),p=tu(s,h,d,a,e),f=Ys(i,h,d,e)}else for(var m=0;m<c;m++)l[m]=ru(o,r,i,e,m,u),p[m]=au(s,a,i,e,m,u),f[m]=nu(i,m,u);return{begin:l,end:p,strides:f}}function eu(e,t,n,r,a){for(var i=Y(a),o=Js(n,t),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=0;else{var u=Qs(t,n,s),c=r[u];e&1<<u&&(c=0),i[s]=c}return i}function tu(e,t,n,r,a){for(var i=Y(a),o=Js(n,t),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=Number.MAX_SAFE_INTEGER;else{var u=Qs(t,n,s),c=r[u];e&1<<u&&(c=Number.MAX_SAFE_INTEGER),i[s]=c}for(var l=0;l<i.length;l++){var p=a[l];i[l]<0&&(i[l]+=p),i[l]=ce(0,i[l],a[l])}return i}function nu(e,t,n){var r=e[t];return(n&1<<t||null==r)&&(r=1),r}function ru(e,t,n,r,a,i){var o=t[a],s=n[a]||1;(e&1<<a||i&1<<a||null==o)&&(o=s>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),o=ce(0,o,u-1)}function au(e,t,n,r,a,i){var o=t[a],s=n[a]||1;(e&1<<a||i&1<<a||null==o)&&(o=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),o=s>0?ce(0,o,u):ce(-1,o,u-1)}function iu(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(var i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function ou(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function su(e,t,n){var r,a,i=e.shape.length;return(r="number"===typeof t?[t].concat(Y(new Array(i-1).fill(0))):t.length<i?t.concat(new Array(i-t.length).fill(0)):t.slice()).forEach((function(e){me(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),a=(a=null==n?new Array(i).fill(-1):"number"===typeof n?[n].concat(Y(new Array(i-1).fill(-1))):n.length<i?n.concat(new Array(i-n.length).fill(-1)):n).map((function(t,n){return t>=0?t:(me(-1===t,(function(){return"Negative size values should be exactly -1 but got "+"".concat(t," for the slice() size at index ").concat(n,".")})),e.shape[n]-r[n])})),[r,a]}function uu(e,t,n,r,a,i,o,s,u){var c;if(null==r?(c=new Array(t.length)).fill(1):c=r,null!=o&&0!==(o&o-1))throw new Error("Multiple ellipses in slice is not allowed.");for(var l=!1,p={dims:c.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:c.slice(),beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u},f=0;f<p.dims;f++)l&&0!==(1<<f&s)&&p.numAddAxisAfterEllipsis++,1<<f&o&&(l=!0);l||(p.ellipsisMask|=1<<p.dims,p.dims++);var h={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;var n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(var r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask)for(var a=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);n<a;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r;else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(-2),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error("Index out of range using input dim ".concat(n,"; input ")+"has only ".concat(t.dims," dims, ").concat(t.begin.length,"."));null!=e.begin&&(t.begin[n]=e.begin[r]),null!=e.end&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(-1),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}(p,h);for(var d=!0,m=!0,v=!0,g=[],y=[],b=0;b<e.length;++b){if(0===h.strides[b])throw Error("strides[".concat(b,"] must be non-zero"));var x=!!(h.shrinkAxisMask&1<<b),k=e[b];if(-1!==k){var w=[h.beginMask&1<<b,h.endMask&1<<b],N=[h.strides[b]>0?0:-1,h.strides[b]>0?k:k-1];if(x&&h.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");v=v&&1===h.strides[b];var I=!!(h.beginMask&1<<b&&h.endMask&1<<b);if(h.beginValid&&h.endValid){if(x){var S=h.begin[b]<0?k+h.begin[b]:h.begin[b];if(h.begin[b]=S,h.end[b]=h.begin[b]+1,S<0||S>=k)throw Error("slice index ".concat(h.begin[b]," of dimension ").concat(b," out of bounds."))}else h.begin[b]=cu(h.begin[b],0,h.strides[b],k,w,N),h.end[b]=cu(h.end[b],1,h.strides[b],k,w,N);var T=1===h.strides[b]&&0===h.begin[b]&&h.end[b]===k;d=d&&T,m=m&&(0===b&&1===h.strides[b]||T)}else d=d&&1===h.strides[b]&&I,m=m&&(0===b&&1===h.strides[b]||I);var C=void 0,E=!1;if(h.beginValid&&h.endValid?(C=h.end[b]-h.begin[b],E=!0):x?(C=1,E=!0):I&&k>=0&&(C=h.strides[b]<0?-k:k,E=!0),E){var A=void 0;A=0===C||C<0!==h.strides[b]<0?0:Math.trunc(C/h.strides[b])+(C%h.strides[b]!==0?1:0),g.push(A)}else g.push(-1)}else g.push(x?1:-1)}for(var R=0;R<h.finalShapeGatherIndices.length;++R){var _=h.finalShapeGatherIndices[R];_>=0?y.push(g[_]):-2===_&&y.push(1)}var F=y.filter((function(e,t){return-2!==h.finalShapeGatherIndices[t]}));return{finalShapeSparse:F,finalShape:y,isIdentity:d,sliceDim0:m,isSimpleSlice:v,begin:h.begin,end:h.end,strides:h.strides}}function cu(e,t,n,r,a,i){if(a[t])return n>0?i[t]:i[t+1&1];var o=e<0?r+e:e;return o<i[0]?i[0]:o>i[1]?i[1]:o}var lu=function(){function e(){(0,$.Z)(this,e)}return(0,ee.Z)(e,[{key:"getClassName",value:function(){return this.constructor.className}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),e}(),pu=function(){function e(){(0,$.Z)(this,e),this.classNameMap={}}return(0,ee.Z)(e,null,[{key:"getMap",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"register",value:function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]}}]),e}();function fu(e){me(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),me("string"===typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),me(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),pu.register(e)}var hu=.1;function du(e,t,n){return null==n&&(n=mu()),vu(e,t,(function(e,t){return xu(e,t,n)}))}function mu(){return 32===Mi.backend.floatPrecision()?.001:hu}function vu(e,t,n){var r=!0;if((Le(e)||Le(t))&&(r=!1),Le(e)&&Le(t)&&(r=!0),r){var a=e.constructor.name,i=t.constructor.name;if(a!==i)throw new Error("Arrays are of different type. Actual: ".concat(a,". ")+"Expected: ".concat(i))}if(Array.isArray(e)&&Array.isArray(t)){var o=Wi(e),s=Wi(t);if(!ke(o,s))throw new Error("Arrays have different shapes. "+"Actual: [".concat(o,"]. Expected: [").concat(s,"]"))}var u=Le(e)?e:ye(e),c=Le(t)?t:ye(t);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: ".concat(u.length," vs ")+"expected: ".concat(c.length,".\n")+"Actual:   ".concat(u,".\n")+"Expected: ".concat(c,"."));for(var l=0;l<c.length;++l){var p=u[l],f=c[l];if(!n(p,f))throw new Error("Arrays differ: actual[".concat(l,"] = ").concat(p,", expected[").concat(l,"] = ").concat(f,".\n")+"Actual:   ".concat(u,".\n")+"Expected: ".concat(c,"."))}}function gu(e,t){e().then((function(){return t.fail()}),(function(){return t()}))}function yu(e,t){var n="string"===typeof t||"number"===typeof t||"boolean"===typeof t?[t]:t;return Ze(e)||Ze(e[0])||Ze(t)||Ze(t[0])?vu(e,n,(function(e,t){return e==t})):vu(e,t,(function(e,t){return xu(e,t,0)}))}function bu(e,t,n){if(null==n&&(n=mu()),!xu(e,t,n))throw new Error("Numbers differ: actual === ".concat(e,", expected === ").concat(t))}function xu(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}function ku(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:".concat(e[r]," low: ").concat(t,", high: ").concat(n))}function wu(e,t){var n=new Float32Array(e),r=new Float32Array(t);if(n.length!==r.length)throw new Error("Expected ArrayBuffer to be of length "+"".concat(r.length,", but it was ").concat(n.length));for(var a=0;a<r.length;a++)if(n[a]!==r[a])throw new Error("Expected ArrayBuffer value at ".concat(a," to be ")+"".concat(r[a]," but got ").concat(n[a]," instead"))}function Nu(e){for(var t=0;t<e.length;t++){var n=e[t];Array.isArray(n)?Nu(n):e[t]=Qa(n)}return e}var Iu="3.15.0";function Su(){it().set("PROD",!0)}function Tu(){it().set("DEBUG",!0)}function Cu(){it().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function Eu(e){it().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Au(){Mi.disposeVariables()}function Ru(){return Mi}function _u(){return Mi.memory()}function Fu(e){return Mi.profile(e)}function Du(e,t){return Mi.tidy(e,t)}function Ou(e){Ci(e).forEach((function(e){return e.dispose()}))}function Mu(e){return Mi.keep(e)}function Lu(e){return Mi.time(e)}function zu(e){return Mi.setBackend(e)}function Pu(){return Mi.ready()}function Zu(){return Mi.backendName}function Bu(e){Mi.removeBackend(e)}function Wu(e){return Mi.findBackend(e)}function Uu(e){return Mi.findBackendFactory(e)}function Vu(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Mi.registerBackend(e,t,n)}function Gu(){return Mi.backend}function Hu(e,t){it().setPlatform(e,t)}var ju=qi({add_:function(e,t){var n=Gi(e,"a","add"),r=Gi(t,"b","add"),a=Ii(n,r),i=(0,oe.Z)(a,2),o={a:n=i[0],b:r=i[1]};return Mi.runKernel(ht,o)}});var qu=qi({floorDiv_:function(e,t){var n=Gi(e,"a","floorDiv"),r=Gi(t,"b","floorDiv"),a=Ii(n,r),i=(0,oe.Z)(a,2),o={a:n=i[0],b:r=i[1]};return Mi.runKernel(bn,o)}});var Ku=qi({div_:function(e,t){var n=Gi(e,"a","div"),r=Gi(t,"b","div"),a=Ii(n,r),i=(0,oe.Z)(a,2);if(n=i[0],r=i[1],"int32"===n.dtype&&"int32"===r.dtype)return qu(n,r);var o={a:n,b:r};return Mi.runKernel(on,o,{})}});var Xu=qi({mul_:function(e,t){var n=Gi(e,"a","mul"),r=Gi(t,"b","mul"),a=Ii(n,r),i=(0,oe.Z)(a,2),o={a:n=i[0],b:r=i[1]};return Mi.runKernel(nr,o)}});var Yu=qi({sqrt_:function(e){var t={x:Gi(e,"x","sqrt","float32")};return Mi.runKernel(Pr,t)}});var Qu=qi({square_:function(e){var t=Gi(e,"x","square");return Mi.runKernel("Square",{x:t},{})}});var Ju=qi({zerosLike_:function(e){var t={x:Gi(e,"x","zerosLike")};return Mi.runKernel(la,t)}});function $u(e){return me(Ve(e),(function(){return"The f passed in grad(f) must be a function"})),function(t,n){var r=Gi(t,"x","tf.grad","string_or_numeric"),a=null!=n?Gi(n,"dy","tf.grad"):null;return Mi.tidy((function(){var t=Mi.gradients((function(){return e(r)}),[r],a),n=t.value,i=t.grads;return null!=a&&ve(n.shape,a.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),ic(i),i[0]}))}}function ec(e){return me(Ve(e),(function(){return"The f passed in grads(f) must be a function"})),function(t,n){me(Array.isArray(t),(function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"}));var r=Hi(t,"args","tf.grads","string_or_numeric"),a=null!=n?Gi(n,"dy","tf.grads"):null;return Mi.tidy((function(){var t=Mi.gradients((function(){return e.apply(void 0,Y(r))}),r,a),n=t.value,i=t.grads;return null!=a&&ve(n.shape,a.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),ic(i),i}))}}function tc(e){return me(Ve(e),(function(){return"The f passed in valueAndGrad(f) must be a function"})),function(t,n){me(t instanceof hi,(function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"})),me(null==n||n instanceof hi,(function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"}));var r=Mi.gradients((function(){return e(t)}),[t],n),a=r.grads,i=r.value;return ic(a),{grad:a[0],value:i}}}function nc(e){return me(Ve(e),(function(){return"The f passed in valueAndGrads(f) must be a function"})),function(t,n){me(Array.isArray(t)&&t.every((function(e){return e instanceof hi})),(function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"})),me(null==n||n instanceof hi,(function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"}));var r=Mi.gradients((function(){return e.apply(void 0,Y(t))}),t,n);return null!=n&&ve(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),ic(r.grads),r}}function rc(e,t){me(Ve(e),(function(){return"The f passed in variableGrads(f) must be a function"})),me(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof xi})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],Mi.registeredVariables)t.push(Mi.registeredVariables[r]);var a=n?t.filter((function(e){return!e.trainable})):null,i=t.length;t=t.filter((function(e){return e.trainable})),me(t.length>0,(function(){return"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(i," variables is ")+"trainable."}));var o=Mi.gradients(e,t,null,!0),s=o.value,u=o.grads;me(u.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),me(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(s.rank," tensor")}));var c={};return t.forEach((function(e,t){null!=u[t]&&(c[e.name]=u[t])})),null!=a&&a.forEach((function(e){return c[e.name]=null})),{value:s,grads:c}}function ac(e){return Mi.customGrad(e)}function ic(e){if(e.filter((function(e){return null==e})).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}function oc(e,t){if((Le(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&Le(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Xi(e,[],[],t)}var sc=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"minimize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this.computeGradients(e,n),a=r.value,i=r.grads;if(null!=n){var o=n.map((function(e){return{name:e.name,tensor:i[e.name]}}));this.applyGradients(o)}else this.applyGradients(i);return Ou(i),t?a:(a.dispose(),null)}},{key:"iterations",get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}},{key:"incrementIterations",value:function(){this.iterations_=this.iterations+1}},{key:"computeGradients",value:function(e,t){return rc(e,t)}},{key:"dispose",value:function(){null!=this.iterations_&&Ou(this.iterations_)}},{key:"saveIterations",value:function(){var e=J(ne().mark((function e(){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null==this.iterations_&&(this.iterations_=0),e.abrupt("return",{name:"iter",tensor:oc(this.iterations_,"int32")});case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWeights",value:function(){var e=J(ne().mark((function e(){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for this optimizer yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=J(ne().mark((function e(t){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"extractIterations",value:function(){var e=J(ne().mark((function e(t){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t[0].tensor.data();case 2:return this.iterations_=e.sent[0],e.abrupt("return",t.slice(1));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(lu);Object.defineProperty(sc,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var uc=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(0,$.Z)(this,n),(a=t.call(this)).learningRate=e,a.rho=r,a.epsilon=i,a.accumulatedGrads=[],a.accumulatedUpdates=[],null==i&&(a.epsilon=Mi.backend.epsilon()),a}return(0,ee.Z)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Mi.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:"".concat(n,"/accum_grad"),variable:Du((function(){return Ju(a).variable(false)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:"".concat(n,"/accum_var"),variable:Du((function(){return Ju(a).variable(false)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;Du((function(){var e=ju(Xu(o,t.rho),Xu(Qu(i),1-t.rho)),n=Xu(Ku(Yu(ju(s,t.epsilon)),Yu(ju(o,t.epsilon))),i),r=ju(Xu(s,t.rho),Xu(Qu(n),1-t.rho));o.assign(e),s.assign(r);var u=ju(Xu(n,-t.learningRate),a);a.assign(u)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedUpdates&&(Ou(this.accumulatedGrads.map((function(e){return e.variable}))),Ou(this.accumulatedUpdates.map((function(e){return e.variable}))))}},{key:"getWeights",value:function(){var e=J(ne().mark((function e(){var t;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(Y(this.accumulatedGrads),Y(this.accumulatedUpdates)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=J(ne().mark((function e(t){var n;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=t.length/2,!1,this.accumulatedGrads=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}})),this.accumulatedUpdates=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}]),n}(sc);function cc(e,t,n){var r={shape:e,value:t,dtype:n};return Mi.runKernel(vn,{},r)}uc.className="Adadelta",fu(uc);var lc=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return(0,$.Z)(this,n),(r=t.call(this)).learningRate=e,r.initialAccumulatorValue=a,r.accumulatedGrads=[],r}return(0,ee.Z)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Mi.registeredVariables[n];if(null==t.accumulatedGrads[r]){t.accumulatedGrads[r]={originalName:"".concat(n,"/accumulator"),variable:Du((function(){return cc(a.shape,t.initialAccumulatorValue).variable(false)}))}}var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable;Du((function(){var e=ju(o,Qu(i));o.assign(e);var n=ju(Xu(Ku(i,Yu(ju(e,Mi.backend.epsilon()))),-t.learningRate),a);a.assign(n)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedGrads&&Ou(this.accumulatedGrads.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=J(ne().mark((function e(){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=J(ne().mark((function e(t){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulatedGrads=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}]),n}(sc);lc.className="Adagrad",fu(lc);var pc=qi({pow_:function(e,t){var n=Gi(e,"base","pow"),r=Gi(t,"exp","pow"),a=Ii(n,r),i=(0,oe.Z)(a,2),o={a:n=i[0],b:r=i[1]};return Mi.runKernel(hr,o)}});var fc=qi({sub_:function(e,t){var n=Gi(e,"a","sub"),r=Gi(t,"b","sub"),a=Ii(n,r),i=(0,oe.Z)(a,2),o={a:n=i[0],b:r=i[1]};return Mi.runKernel(ea,o)}}),hc=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return(0,$.Z)(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],Du((function(){i.accBeta1=oc(r).variable(),i.accBeta2=oc(a).variable()})),null==o&&(i.epsilon=Mi.backend.epsilon()),i}return(0,ee.Z)(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);Du((function(){var r=fc(1,t.accBeta1),a=fc(1,t.accBeta2);n.forEach((function(n,i){var o=Mi.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:Du((function(){return Ju(o).variable(false)}))}),null==t.accumulatedSecondMoment[i]&&(t.accumulatedSecondMoment[i]={originalName:"".concat(n,"/v"),variable:Du((function(){return Ju(o).variable(false)}))});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedSecondMoment[i].variable,l=ju(Xu(u,t.beta1),Xu(s,1-t.beta1)),p=ju(Xu(c,t.beta2),Xu(Qu(s),1-t.beta2)),f=Ku(l,r),h=Ku(p,a);u.assign(l),c.assign(p);var d=ju(Xu(Ku(f,ju(Yu(h),t.epsilon)),-t.learningRate),o);o.assign(d)}})),t.accBeta1.assign(Xu(t.accBeta1,t.beta1)),t.accBeta2.assign(Xu(t.accBeta2,t.beta2))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Ou(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&Ou(this.accumulatedSecondMoment.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=J(ne().mark((function e(){var t;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(Y(this.accumulatedFirstMoment),Y(this.accumulatedSecondMoment)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=J(ne().mark((function e(t){var n,r=this;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,Du((function(){r.accBeta1.assign(pc(r.beta1,r.iterations_+1)),r.accBeta2.assign(pc(r.beta2,r.iterations_+1))})),n=t.length/2,!1,this.accumulatedFirstMoment=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}})),this.accumulatedSecondMoment=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}]),n}(sc);hc.className="Adam",fu(hc);var dc=qi({abs_:function(e){var t=Gi(e,"x","abs");if("complex64"===t.dtype){var n={x:t};return Mi.runKernel(zt,n)}var r={x:t};return Mi.runKernel(lt,r)}});var mc=qi({maximum_:function(e,t){var n=Gi(e,"a","maximum"),r=Gi(t,"b","maximum"),a=Ii(n,r),i=(0,oe.Z)(a,2);n=i[0],r=i[1],"bool"===n.dtype&&(n=as(n,"int32"),r=as(r,"int32")),Os(n.shape,r.shape);var o={a:n,b:r};return Mi.runKernel(Gn,o)}}),vc=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return(0,$.Z)(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.decay=s,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],Du((function(){i.iteration=oc(0).variable(),i.accBeta1=oc(r).variable()})),null==o&&(i.epsilon=Mi.backend.epsilon()),i}return(0,ee.Z)(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);Du((function(){var r=fc(1,t.accBeta1),a=Ku(-t.learningRate,ju(Xu(t.iteration,t.decay),1));n.forEach((function(n,i){var o=Mi.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:Ju(o).variable(false)}),null==t.accumulatedWeightedInfNorm[i]&&(t.accumulatedWeightedInfNorm[i]={originalName:"".concat(n,"/v"),variable:Ju(o).variable(false)});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedWeightedInfNorm[i].variable,l=ju(Xu(u,t.beta1),Xu(s,1-t.beta1)),p=Xu(c,t.beta2),f=dc(s),h=mc(p,f);u.assign(l),c.assign(h);var d=ju(Xu(Ku(a,r),Ku(l,ju(h,t.epsilon))),o);o.assign(d)}})),t.iteration.assign(ju(t.iteration,1)),t.accBeta1.assign(Xu(t.accBeta1,t.beta1))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Ou(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&Ou(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=J(ne().mark((function e(){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=J(ne().mark((function e(t){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}]),n}(sc);vc.className="Adamax",fu(vc);var gc=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this)).learningRate=e,r.setLearningRate(e),r}return(0,ee.Z)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=Mi.registeredVariables[n];Du((function(){var e=ju(Xu(t.c,a),i);i.assign(e)}))}})),this.incrementIterations()}},{key:"setLearningRate",value:function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=Mu(oc(-e))}},{key:"dispose",value:function(){this.c.dispose()}},{key:"getWeights",value:function(){var e=J(ne().mark((function e(){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=J(ne().mark((function e(t){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:if(0===(t=e.sent).length){e.next=5;break}throw new Error("SGD optimizer does not have settable weights.");case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate)}}]),n}(sc);gc.className="SGD",fu(gc);var yc=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,$.Z)(this,n),(a=t.call(this,e)).learningRate=e,a.momentum=r,a.useNesterov=i,a.accumulations=[],a.m=oc(a.momentum),a}return(0,ee.Z)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Mi.registeredVariables[n];if(null==t.accumulations[r]){t.accumulations[r]={originalName:"".concat(n,"/momentum"),variable:Du((function(){return Ju(a).variable(false)}))}}var i=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&Du((function(){var e,n=ju(Xu(t.m,i),o);e=t.useNesterov?ju(Xu(t.c,ju(o,Xu(n,t.m))),a):ju(Xu(t.c,n),a),i.assign(n),a.assign(e)}))})),this.incrementIterations()}},{key:"dispose",value:function(){this.m.dispose(),null!=this.accumulations&&Ou(this.accumulations.map((function(e){return e.variable})))}},{key:"setMomentum",value:function(e){this.momentum=e}},{key:"getWeights",value:function(){var e=J(ne().mark((function e(){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=J(ne().mark((function e(t){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulations=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}]),n}(gc);yc.className="Momentum",fu(yc);var bc=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if((0,$.Z)(this,n),(r=t.call(this)).learningRate=e,r.decay=a,r.momentum=i,r.epsilon=o,r.accumulatedMeanSquares=[],r.accumulatedMoments=[],r.accumulatedMeanGrads=[],r.centered=s,null==o&&(r.epsilon=Mi.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return r}return(0,ee.Z)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Mi.registeredVariables[n],i=!1;null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:"".concat(n,"/rms"),variable:Du((function(){return Ju(a).variable(i)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:"".concat(n,"/momentum"),variable:Du((function(){return Ju(a).variable(i)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:"".concat(n,"/mg"),variable:Du((function(){return Ju(a).variable(i)}))});var o=Array.isArray(e)?e[r].tensor:e[n];if(null!=o){var s=t.accumulatedMeanSquares[r].variable,u=t.accumulatedMoments[r].variable;Du((function(){var e=ju(Xu(s,t.decay),Xu(Qu(o),1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,i=ju(Xu(n,t.decay),Xu(o,1-t.decay)),c=Ku(Xu(o,t.learningRate),Yu(fc(e,ju(Qu(i),t.epsilon)))),l=ju(Xu(u,t.momentum),c);s.assign(e),n.assign(i),u.assign(l);var p=fc(a,l);a.assign(p)}else{var f=ju(Xu(s,t.decay),Xu(Qu(o),1-t.decay)),h=ju(Xu(u,t.momentum),Ku(Xu(o,t.learningRate),Yu(ju(f,t.epsilon))));s.assign(f),u.assign(h);var d=fc(a,h);a.assign(d)}}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedMeanSquares&&Ou(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&Ou(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&Ou(this.accumulatedMoments.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=J(ne().mark((function e(){var t;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(Y(this.accumulatedMeanSquares),Y(this.accumulatedMoments)),this.centered&&t.push.apply(t,Y(this.accumulatedMeanGrads)),e.next=4,this.saveIterations();case 4:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=J(ne().mark((function e(t){var n,r;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=this.centered?t.length/3:t.length/2,r=!1,this.accumulatedMeanSquares=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})),this.accumulatedMoments=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*n,3*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}]),n}(sc);bc.className="RMSProp",fu(bc);var xc=function(){function e(){(0,$.Z)(this,e)}return(0,ee.Z)(e,null,[{key:"sgd",value:function(e){return new gc(e)}},{key:"momentum",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new yc(e,t,n)}},{key:"rmsprop",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return new bc(e,t,n,r,a)}},{key:"adam",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new hc(e,t,n,r)}},{key:"adadelta",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new uc(e,t,n)}},{key:"adamax",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.002,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return new vc(e,t,n,r,a)}},{key:"adagrad",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return new lc(e,t)}}]),e}();var kc=qi({acos_:function(e){var t={x:Gi(e,"x","acos")};return Mi.runKernel(pt,t)}});var wc=qi({acosh_:function(e){var t={x:Gi(e,"x","acosh")};return Mi.runKernel(ft,t)}});var Nc=qi({addN_:function(e){me(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),me(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+"".concat(e.length)}));var t=e.map((function(e,t){return Gi(e,"tensors".concat(t),"addN")})),n=t[0];t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!ke(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=t;return Mi.runKernel(dt,r)}});var Ic=qi({all_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Gi(e,"x","all","bool"),a={x:r},i={axis:t,keepDims:n};return Mi.runKernel(mt,a,i)}});var Sc=qi({any_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Gi(e,"x","any","bool"),a={x:r},i={axis:t,keepDims:n};return Mi.runKernel(vt,a,i)}});var Tc=qi({argMax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Gi(e,"x","argMax"),r={x:n},a={axis:t};return Mi.runKernel(gt,r,a)}});var Cc=qi({argMin_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Gi(e,"x","argMin"),r={x:n},a={axis:t};return Mi.runKernel(yt,r,a)}});var Ec=qi({asin_:function(e){var t={x:Gi(e,"x","asin")};return Mi.runKernel(bt,t)}});var Ac=qi({asinh_:function(e){var t={x:Gi(e,"x","asinh")};return Mi.runKernel(xt,t)}});var Rc=qi({atan_:function(e){var t={x:Gi(e,"x","atan")};return Mi.runKernel(kt,t)}});var _c=qi({atan2_:function(e,t){var n=Gi(e,"a","atan2"),r=Gi(t,"b","atan2"),a=Ii(n,r),i=(0,oe.Z)(a,2),o={a:n=i[0],b:r=i[1]};return Mi.runKernel(Nt,o)}});var Fc=qi({atanh_:function(e){var t={x:Gi(e,"x","atanh")};return Mi.runKernel(wt,t)}});function Dc(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5?arguments[5]:void 0,o=e[3],s=[].concat(Y(t),[o]),u=qc(a);return Lc(e,s,n,i,r,null,null,u)}function Oc(e,t,n,r,a,i){var o,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",u=Zc(t),c=(0,oe.Z)(u,2),l=c[0],p=c[1];if("channelsLast"===s)o=[l,p,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));o=[l,p,e[1],e[1]]}return Lc(e,o,n,r,a,i,!1,s)}function Mc(e,t,n,r,a,i){var o,s,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC",c=Bc(t),l=(0,oe.Z)(c,3),p=l[0],f=l[1],h=l[2];if("NDHWC"===u)s="channelsLast",o=[p,f,h,e[4],e[4]];else{if("NCDHW"!==u)throw new Error("Unknown dataFormat ".concat(u));s="channelsFirst",o=[p,f,h,e[1],e[1]]}return zc(e,o,n,r,a,!1,s,i)}function Lc(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",u=-1,c=-1,l=-1,p=-1;if("channelsLast"===s){var f=(0,oe.Z)(e,4);u=f[0],c=f[1],l=f[2],p=f[3]}else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));var h=(0,oe.Z)(e,4);u=h[0],p=h[1],c=h[2],l=h[3]}var d,m=(0,oe.Z)(t,4),v=m[0],g=m[1],y=m[3],b=Zc(n),x=(0,oe.Z)(b,2),k=x[0],w=x[1],N=Zc(r),I=(0,oe.Z)(N,2),S=I[0],T=I[1],C=Wc(v,S),E=Wc(g,T),A=Uc(a,c,l,k,w,C,E,i,s),R=A.padInfo,_=A.outHeight,F=A.outWidth,D=o?y*p:y;return"channelsFirst"===s?d=[u,D,_,F]:"channelsLast"===s&&(d=[u,_,F,D]),{batchSize:u,dataFormat:s,inHeight:c,inWidth:l,inChannels:p,outHeight:_,outWidth:F,outChannels:D,padInfo:R,strideHeight:k,strideWidth:w,filterHeight:v,filterWidth:g,effectiveFilterHeight:C,effectiveFilterWidth:E,dilationHeight:S,dilationWidth:T,inShape:e,outShape:d,filterShape:t}}function zc(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",s=arguments.length>7?arguments[7]:void 0,u=-1,c=-1,l=-1,p=-1,f=-1;if("channelsLast"===o){var h=(0,oe.Z)(e,5);u=h[0],c=h[1],l=h[2],p=h[3],f=h[4]}else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat ".concat(o));var d=(0,oe.Z)(e,5);u=d[0],f=d[1],c=d[2],l=d[3],p=d[4]}var m,v=(0,oe.Z)(t,5),g=v[0],y=v[1],b=v[2],x=v[4],k=Bc(n),w=(0,oe.Z)(k,3),N=w[0],I=w[1],S=w[2],T=Bc(r),C=(0,oe.Z)(T,3),E=C[0],A=C[1],R=C[2],_=Wc(g,E),F=Wc(y,A),D=Wc(b,R),O=Vc(a,c,l,p,N,I,S,_,F,D,s),M=O.padInfo,L=O.outDepth,z=O.outHeight,P=O.outWidth,Z=i?x*f:x;return"channelsFirst"===o?m=[u,Z,L,z,P]:"channelsLast"===o&&(m=[u,L,z,P,Z]),{batchSize:u,dataFormat:o,inDepth:c,inHeight:l,inWidth:p,inChannels:f,outDepth:L,outHeight:z,outWidth:P,outChannels:Z,padInfo:M,strideDepth:N,strideHeight:I,strideWidth:S,filterDepth:g,filterHeight:y,filterWidth:b,effectiveFilterDepth:_,effectiveFilterHeight:F,effectiveFilterWidth:D,dilationDepth:E,dilationHeight:A,dilationWidth:R,inShape:e,outShape:m,filterShape:t}}function Pc(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=Wc(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function Zc(e){return"number"===typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function Bc(e){return"number"===typeof e?[e,e,e]:e}function Wc(e,t){return t<=1?e:e+(e-1)*(t-1)}function Uc(e,t,n,r,a,i,o,s,u){var c,l,p;if("number"===typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var f=function(e,t,n,r,a){null==r&&(r=Pc(e,t,n));var i=e[0],o=e[1];return[Gc((i-t+2*r)/n+1,a),Gc((o-t+2*r)/n+1,a)]}([t,n],i,r,e,s);l=f[0],p=f[1]}else if("same"===e){l=Math.ceil(t/r),p=Math.ceil(n/a);var h=Math.max(0,(l-1)*r+i-t),d=Math.max(0,(p-1)*a+o-n),m=Math.floor(h/2),v=h-m,g=Math.floor(d/2);c={top:m,bottom:v,left:g,right:d-g,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-i+1)/r),p=Math.ceil((n-o+1)/a);else{if("object"!==typeof e)throw Error("Unknown padding parameter: ".concat(e));var y="channelsLast"===u?e[1][0]:e[2][0],b="channelsLast"===u?e[1][1]:e[2][1],x="channelsLast"===u?e[2][0]:e[3][0],k="channelsLast"===u?e[2][1]:e[3][1];c={top:y,bottom:b,left:x,right:k,type:0===y&&0===b&&0===x&&0===k?"VALID":"EXPLICIT"},l=Gc((t-i+y+b)/r+1,s),p=Gc((n-o+x+k)/a+1,s)}return{padInfo:c,outHeight:l,outWidth:p}}function Vc(e,t,n,r,a,i,o,s,u,c,l){var p,f,h,d;if("number"===typeof e){p={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var m=function(e,t,n,r,a,i){null==a&&(a=Pc(e,t,r));var o=e[0],s=e[1],u=e[2];return[Gc((o-t+2*a)/r+1,i),Gc((s-t+2*a)/r+1,i),Gc((u-t+2*a)/r+1,i),n]}([t,n,r,1],s,1,a,e,l);f=m[0],h=m[1],d=m[2]}else if("same"===e){var v=((f=Math.ceil(t/a))-1)*a+s-t,g=((h=Math.ceil(n/i))-1)*i+u-n,y=((d=Math.ceil(r/o))-1)*o+c-r,b=Math.floor(v/2),x=v-b,k=Math.floor(g/2),w=g-k,N=Math.floor(y/2);p={top:k,bottom:w,left:N,right:y-N,front:b,back:x,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: ".concat(e));p={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},f=Math.ceil((t-s+1)/a),h=Math.ceil((n-u+1)/i),d=Math.ceil((r-c+1)/o)}return{padInfo:p,outDepth:f,outHeight:h,outWidth:d}}function Gc(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function Hc(e){var t=Zc(e),n=(0,oe.Z)(t,3),r=n[0],a=n[1],i=n[2];return 1===r&&1===a&&1===i}function jc(e,t){return Hc(e)||Hc(t)}function qc(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}function Kc(e,t,n){if(null!=n){if("string"===typeof t)throw Error("Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,"."));if("number"===typeof t)me(we(t),(function(){return"Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,".")}));else{if("object"!==typeof t)throw Error("Error in ".concat(e,": Unknown padding parameter: ").concat(t));t.forEach((function(t){t.forEach((function(t){me(we(t),(function(){return"Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,".")}))}))}))}}}var Xc=qi({reshape_:function(e,t){var n={x:Gi(e,"x","reshape","string_or_numeric")},r={shape:t};return Mi.runKernel(xr,n,r)}});var Yc=qi({avgPool_:function(e,t,n,r,a){var i=Gi(e,"x","avgPool","float32");me(jc(n,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'")}));var o=i,s=!1;3===i.rank&&(s=!0,o=Xc(i,[1,i.shape[0],i.shape[1],i.shape[2]])),me(4===o.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(o.rank,".")})),Kc("avgPool",r,a);var u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=Mi.runKernel(It,u,c);return l=as(l,i.dtype),s?Xc(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var Qc=qi({avgPool3d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=Gi(e,"x","avgPool3d","float32"),s=o,u=!1;4===o.rank&&(u=!0,s=Xc(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),me(5===s.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")})),me("NDHWC"===i,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)})),Kc("avgPool3d",r,a);var c={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},p=Mi.runKernel(Tt,c,l);return p=as(p,s.dtype),u?Xc(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}});var Jc=qi({concat_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;me(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=Hi(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))})),1===n.length)return is(n[0]);var r=n,a={axis:t};return Mi.runKernel(Pt,r,a)}});var $c=qi({sigmoid_:function(e){var t={x:Gi(e,"x","sigmoid","float32")};return Mi.runKernel(Lr,t)}});var el=qi({slice_:function(e,t,n){var r=Gi(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");var a={x:r},i={begin:t,size:n};return Mi.runKernel(Fr,a,i)}});var tl=qi({tanh_:function(e){var t={x:Gi(e,"x","tanh","float32")};return Mi.runKernel(na,t)}});var nl=qi({basicLSTMCell_:function(e,t,n,r,a,i){var o=Gi(e,"forgetBias","basicLSTMCell"),s=Gi(t,"lstmKernel","basicLSTMCell"),u=Gi(n,"lstmBias","basicLSTMCell"),c=Gi(r,"data","basicLSTMCell"),l=Gi(a,"c","basicLSTMCell"),p=Gi(i,"h","basicLSTMCell"),f=Jc([c,p],1),h=Cs(f,s),d=ju(h,u),m=d.shape[0],v=d.shape[1]/4,g=[m,v],y=el(d,[0,0],g),b=el(d,[0,v],g),x=el(d,[0,2*v],g),k=el(d,[0,3*v],g),w=ju(Xu($c(y),tl(b)),Xu(l,$c(ju(o,x))));return[w,Xu(tl(w),$c(k))]}});var rl=qi({batchToSpaceND_:function(e,t,n){var r=Gi(e,"x","batchToSpaceND"),a=t.reduce((function(e,t){return e*t}));me(r.rank>=1+t.length,(function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(t.length)})),me(n.length===t.length,(function(){return"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length)})),me(r.shape[0]%a===0,(function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(t.join(" * ")," === ").concat(a)}));var i={x:r},o={blockShape:t,crops:n};return Mi.runKernel(At,i,o)}});var al=qi({batchNorm_:function(e,t,n,r,a,i){null==i&&(i=.001);var o,s,u=Gi(e,"x","batchNorm"),c=Gi(t,"mean","batchNorm"),l=Gi(n,"variance","batchNorm");null!=a&&(o=Gi(a,"scale","batchNorm")),null!=r&&(s=Gi(r,"offset","batchNorm")),me(c.rank===l.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),me(null==s||c.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),me(null==o||c.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var p=function(e){return 0===e.rank||1===e.rank?Xc(e,[1,1,1,e.size]):2===e.rank?Xc(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?Xc(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}(u),f={x:p,scale:o,offset:s,mean:c,variance:l},h={varianceEpsilon:i},d=Mi.runKernel(xn,f,h);return Xc(d,u.shape)}});var il=qi({batchNorm2d_:function(e,t,n,r,a,i){var o,s,u=Gi(e,"x","batchNorm"),c=Gi(t,"mean","batchNorm"),l=Gi(n,"variance","batchNorm");return null!=a&&(o=Gi(a,"scale","batchNorm")),null!=r&&(s=Gi(r,"offset","batchNorm")),me(2===u.rank,(function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(u.rank,".")})),me(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(c.rank,".")})),me(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(l.rank,".")})),null!=o&&me(2===o.rank||1===o.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&me(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(s.rank,".")})),al(u,c,l,s,o,i)}});var ol=qi({batchNorm3d_:function(e,t,n,r,a,i){var o,s,u=Gi(e,"x","batchNorm"),c=Gi(t,"mean","batchNorm"),l=Gi(n,"variance","batchNorm");return null!=a&&(o=Gi(a,"scale","batchNorm")),null!=r&&(s=Gi(r,"offset","batchNorm")),me(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(u.rank,".")})),me(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(c.rank,".")})),me(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(l.rank,".")})),null!=o&&me(3===o.rank||1===o.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&me(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(s.rank,".")})),al(u,c,l,s,o,i)}});var sl=qi({batchNorm4d_:function(e,t,n,r,a,i){var o,s,u=Gi(e,"x","batchNorm"),c=Gi(t,"mean","batchNorm"),l=Gi(n,"variance","batchNorm");return null!=a&&(o=Gi(a,"scale","batchNorm")),null!=r&&(s=Gi(r,"offset","batchNorm")),me(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(u.rank,".")})),me(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(c.rank,".")})),me(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(l.rank,".")})),null!=o&&me(4===o.rank||1===o.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&me(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(s.rank,".")})),al(u,c,l,s,o,i)}});var ul=qi({bincount_:function(e,t,n){var r=Gi(e,"x","bincount"),a=Gi(t,"weights","bincount");me("int32"===r.dtype,(function(){return"Error in bincount: input "+"dtype must be int32, but got ".concat(r.dtype)})),me(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),me(a.size===r.size||0===a.size,(function(){return"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(r.shape,", weights shape: ")+"".concat(a.shape,".")}));var i={x:r,weights:a},o={size:n};return Mi.runKernel(Rt,i,o)}});var cl=qi({broadcastArgs_:function(e,t){var n=Gi(e,"s0","broadcastArgs","int32"),r=Gi(t,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error("broadcastArgs(): first input must be a vector (rank=1). "+"Has rank ".concat(n.rank));if(1!==r.rank)throw new Error("broadcastArgs(): second input must be a vector (rank=1). "+"Has rank ".concat(r.rank));var a={s0:n,s1:r};return Mi.runKernel(Ft,a)}});var ll=qi({broadcastTo_:function(e,t){var n=Gi(e,"broadcastTo","x"),r=n.shape;if(t.some((function(e){return!(e>0)||e%1!==0})))throw new Error("broadcastTo(): Invalid broadcast shape [".concat(t,"]."));if(t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=Xc(n,a)}for(var i=n.shape,o=Array.from(t),s=t.length-1;s>=0;s--)if(i[s]===t[s])o[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));var u=o.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0}));if(0===u.length)return is(n);var c={x:n},l={reps:o};return Mi.runKernel(ra,c,l)}});var pl=qi({ceil_:function(e){var t={x:Gi(e,"x","ceil","float32")};return Mi.runKernel(Ot,t)}});var fl=qi({clipByValue_:function(e,t,n){var r=Gi(e,"x","clipByValue");me(t<=n,(function(){return"Error in clip: min (".concat(t,") must be ")+"less than or equal to max (".concat(n,").")}));var a={x:r},i={clipValueMin:t,clipValueMax:n};return Mi.runKernel(Mt,a,i)}});var hl=qi({concat1d_:function(e){return Jc(e,0)}});var dl=qi({concat2d_:function(e,t){return Jc(e,t)}});var ml=qi({concat3d_:function(e,t){return Jc(e,t)}});var vl=qi({concat4d_:function(e,t){return Jc(e,t)}});var gl=qi({conv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=Gi(e,"x","conv2d","float32"),u=Gi(t,"filter","conv2d","float32"),c=s,l=!1;3===s.rank&&(l=!0,c=Xc(s,[1,s.shape[0],s.shape[1],s.shape[2]])),me(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")})),me(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")})),Kc("conv2d",r,o);var p="NHWC"===a?c.shape[3]:c.shape[1];me(p===u.shape[2],(function(){return"Error in conv2d: depth of input (".concat(p,") must match ")+"input depth for filter ".concat(u.shape[2],".")})),me(jc(n,i),(function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(i,"'")}));var f={x:c,filter:u},h={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},d=Mi.runKernel(Zt,f,h);return l?Xc(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});var yl=qi({conv1d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6?arguments[6]:void 0,s=Gi(e,"x","conv1d"),u=Gi(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=Xc(s,[1,s.shape[0],s.shape[1]])),me(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")})),me(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+"".concat(u.rank,".")})),Kc("conv1d",r,o),me(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match ")+"input depth for filter ".concat(u.shape[1],".")})),me(jc(n,i),(function(){return"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(n," and dilation '").concat(i,"'")})),me("NWC"===a,(function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")}));var p=Xc(u,[1,u.shape[0],u.shape[1],u.shape[2]]),f=Xc(c,[c.shape[0],1,c.shape[1],c.shape[2]]),h=[1,n],d=[1,i],m="NHWC",v=gl(f,p,h,r,m,d,o);return Xc(v,l?[v.shape[2],v.shape[3]]:[v.shape[0],v.shape[2],v.shape[3]])}});var bl=qi({conv2DBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0;me(e.length===t.rank,(function(){return"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var s=e,u=t,c=!1;3===t.rank&&(c=!0,u=Xc(t,[1,t.shape[0],t.shape[1],t.shape[2]]),s=[1,e[0],e[1],e[2]]),me(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")})),me(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)})),me(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(n.rank)}));var l="NHWC"===i?s[3]:s[1],p="NHWC"===i?u.shape[3]:u.shape[1];me(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(n.shape[2],".")})),me(p===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output (".concat(p,") must ")+"match output depth for filter ".concat(n.shape[3],".")})),Kc("conv2dDerInput",a,o);var f={dy:u,filter:n},h={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=Mi.runKernel(Wt,f,h);return c?Xc(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});var xl=qi({conv2dTranspose_:function(e,t,n,r,a,i){var o=Gi(e,"x","conv2dTranspose"),s=Gi(t,"filter","conv2dTranspose");return bl(n,o,s,r,a,"NHWC",i)}});var kl=qi({conv3d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=Gi(e,"x","conv3d"),s=Gi(t,"filter","conv3d"),u=o,c=!1;4===o.rank&&(c=!0,u=Xc(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),me(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")})),me(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+"".concat(s.rank,".")})),me(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match ")+"input depth for filter ".concat(s.shape[3],".")})),me(jc(n,i),(function(){return"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(i,"'")})),me("NDHWC"===a,(function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")}));var l={x:u,filter:s},p={strides:n,pad:r,dataFormat:a,dilations:i},f=Mi.runKernel(Ut,l,p);return c?Xc(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});var wl=qi({conv3DBackpropInput_:function(e,t,n,r,a){me(e.length===t.rank,(function(){return"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var i=e,o=t,s=!1;4===t.rank&&(s=!0,o=Xc(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,e[0],e[1],e[2],e[3]]);var u=i[4],c=o.shape[4];me(5===i.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")})),me(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)})),me(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(n.rank)})),me(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(n.shape[3],".")})),me(c===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(n.shape[4],".")}));var l={dy:o,filter:n},p={pad:a,strides:r,inputShape:i},f=Mi.runKernel(Gt,l,p);return s?Xc(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});var Nl=qi({conv3dTranspose_:function(e,t,n,r,a){var i=Gi(e,"x","conv3dTranspose"),o=Gi(t,"filter","conv3dTranspose");return wl(n,i,o,r,a)}});var Il=qi({cos_:function(e){var t={x:Gi(e,"x","cos","float32")};return Mi.runKernel(Ht,t)}});var Sl=qi({cosh_:function(e){var t={x:Gi(e,"x","cosh","float32")};return Mi.runKernel(jt,t)}});var Tl=qi({cumprod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Gi(e,"x","cumprod"),i={x:a},o={axis:t,exclusive:n,reverse:r};return Mi.runKernel(qt,i,o)}});var Cl=qi({cumsum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Gi(e,"x","cumsum"),i={x:a},o={axis:t,exclusive:n,reverse:r};return Mi.runKernel(Kt,i,o)}});var El=qi({denseBincount_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Gi(e,"x","denseBincount"),i=Gi(t,"weights","denseBincount");me("int32"===a.dtype,(function(){return"Error in denseBincount: input "+"dtype must be int32, but got ".concat(a.dtype)})),me(a.rank<=2,(function(){return"Error in denseBincount: input must be at most rank 2, but got "+"rank ".concat(a.rank,".")})),me(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),me(i.size===a.size||0===i.size,(function(){return"Error in denseBincount: weights must have the same shape as x or "+"0-length, but got x shape: ".concat(a.shape,", weights shape: ")+"".concat(i.shape,".")}));var o={x:a,weights:i},s={size:n,binaryOutput:r};return Mi.runKernel(Yt,o,s)}});var Al=qi({depthToSpace_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC",r=Gi(e,"x","depthToSpace","float32"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];me(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(t)})),me(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(a," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(r.shape)})),me(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(i," and ").concat(t," for depthToSpace with input shape\n        ").concat(r.shape)})),me(o%(t*t)===0,(function(){return"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape)}));var s={x:r},u={blockSize:t,dataFormat:n};return Mi.runKernel(Qt,s,u)}});var Rl=qi({depthwiseConv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=Gi(e,"x","depthwiseConv2d","float32"),u=Gi(t,"filter","depthwiseConv2d","float32"),c=s,l=!1;3===s.rank&&(l=!0,c=Xc(s,[1,s.shape[0],s.shape[1],s.shape[2]])),me(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(c.rank,".")})),me(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")})),me(c.shape[3]===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels "+"(".concat(c.shape[3],") must match the inChannels dimension in ")+"filter ".concat(u.shape[2],".")})),Kc("depthwiseConv2d",r,o);var p={x:c,filter:u},f={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},h=Mi.runKernel(Jt,p,f);return l?Xc(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});var _l=qi({diag_:function(e){var t={x:Gi(e,"x","diag")};return Mi.runKernel(tn,t)}});var Fl=qi({dilation2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=Gi(e,"x","dilation2d"),s=Gi(t,"filter","dilation2d");me(3===o.rank||4===o.rank,(function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(o.rank,".")})),me(3===s.rank,(function(){return"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(s.rank,".")})),me("NHWC"===i,(function(){return"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(i)}));var u=o,c=!1;3===o.rank&&(u=Xc(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0);var l={x:u,filter:s},p={strides:n,pad:r,dilations:a},f=Mi.runKernel(nn,l,p);return c?Xc(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});var Dl=qi({equal_:function(e,t){var n=Gi(e,"a","equal","string_or_numeric"),r=Gi(t,"b","equal","string_or_numeric"),a=Ii(n,r),i=(0,oe.Z)(a,2);n=i[0],r=i[1],Os(n.shape,r.shape);var o={a:n,b:r};return Mi.runKernel(pn,o)}});var Ol=qi({where_:function(e,t,n){var r=Gi(t,"a","where"),a=Gi(n,"b","where"),i=Gi(e,"condition","where","bool"),o=Os(Os(i.shape,r.shape),a.shape),s={condition:ll(i,o),t:ll(r,o),e:ll(a,o)};return Mi.runKernel(Rr,s)}});var Ml=qi({divNoNan_:function(e,t){var n=Gi(e,"a","div"),r=Gi(t,"b","div"),a=Ii(n,r),i=(0,oe.Z)(a,2);n=i[0],r=i[1];var o=Ku(n,r),s=Ju(o),u=Dl(r,s);return Ol(u,s,o)}});var Ll=qi({dot_:function(e,t){var n=Gi(e,"t1","dot"),r=Gi(t,"t2","dot");me((1===n.rank||2===n.rank)&&(1===r.rank||2===r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(n.rank," and ").concat(r.rank,".")}));var a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];if(me(a===i,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+"".concat(a," and ").concat(i,".")})),1===n.rank&&1===r.rank){var o=Xc(n,[1,-1]),s=Xc(r,[-1,1]),u=Cs(o,s);return Xc(u,[])}if(1===n.rank&&2===r.rank){var c=Xc(n,[1,-1]),l=Xc(r,[r.shape[0],r.shape[1]]),p=Cs(c,l);return Xc(p,[p.size])}if(2===n.rank&&1===r.rank){var f=Xc(r,[-1,1]),h=Cs(n,f);return Xc(h,[h.size])}var d=Xc(r,[r.shape[0],r.shape[1]]);return Cs(n,d)}});var zl=qi({einsum_:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n.map((function(e,t){return Gi(e,"tensors".concat(t),"einsum")})),i={equation:e};return Mi.runKernel(sn,a,i)}});var Pl=qi({elu_:function(e){var t={x:Gi(e,"x","elu","float32")};return Mi.runKernel(un,t)}});var Zl=qi({erf_:function(e){var t=Gi(e,"x","erf");me("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=as(t,"float32"));var n={x:t};return Mi.runKernel(ln,n)}});var Bl=qi({exp_:function(e){var t={x:Gi(e,"x","exp")};return Mi.runKernel(fn,t)}});var Wl=qi({expandDims_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Gi(e,"x","expandDims","string_or_numeric");me(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r={input:n},a={dim:t};return Mi.runKernel(hn,r,a)}});var Ul=qi({expm1_:function(e){var t={x:Gi(e,"x","expm1")};return Mi.runKernel(dn,t)}});var Vl=qi({tile_:function(e,t){var n=Gi(e,"x","tile","string_or_numeric");me(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of reps ".concat(t,".")}));var r={x:n},a={reps:t};return Mi.runKernel(ra,r,a)}});var Gl=qi({eye_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";null==t&&(t=e);for(var a=rs([e,t],r),i=e<=t?e:t,o=0;o<i;++o)a.set(1,o,o);var s=Xc(a.toTensor(),[e,t]);if(null==n)return s;if(1===n.length)return Vl(Wl(s,0),[n[0],1,1]);if(2===n.length)return Vl(Wl(Wl(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return Vl(Wl(Wl(Wl(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(n.length,"D."))}});var Hl=qi({floor_:function(e){var t={x:Gi(e,"x","floor","float32")};return Mi.runKernel(yn,t)}});var jl=qi({gather_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=Gi(e,"x","gather"),i=Gi(t,"indices","gather","int32"),o={x:a,indices:i},s={axis:n,batchDims:r};return Mi.runKernel(kn,o,s)}});var ql=qi({greater_:function(e,t){var n=Gi(e,"a","greater","string_or_numeric"),r=Gi(t,"b","greater","string_or_numeric"),a=Ii(n,r),i=(0,oe.Z)(a,2);n=i[0],r=i[1],Os(n.shape,r.shape);var o={a:n,b:r};return Mi.runKernel(Nn,o)}});var Kl=qi({greaterEqual_:function(e,t){var n=Gi(e,"a","greaterEqual","string_or_numeric"),r=Gi(t,"b","greaterEqual","string_or_numeric"),a=Ii(n,r),i=(0,oe.Z)(a,2);n=i[0],r=i[1],Os(n.shape,r.shape);var o={a:n,b:r};return Mi.runKernel(In,o)}});var Xl=qi({imag_:function(e){var t={input:Gi(e,"input","imag")};return Mi.runKernel(Cn,t)}});var Yl=qi({isFinite_:function(e){var t={x:Gi(e,"x","isFinite")};return Mi.runKernel(En,t)}});var Ql=qi({isInf_:function(e){var t={x:Gi(e,"x","isInf")};return Mi.runKernel(An,t)}});var Jl=qi({isNaN_:function(e){var t={x:Gi(e,"x","isNaN")};return Mi.runKernel(Rn,t)}});var $l=qi({leakyRelu_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n=Gi(e,"x","leakyRelu"),r={x:n},a={alpha:t};return Mi.runKernel(_n,r,a)}});var ep=qi({less_:function(e,t){var n=Gi(e,"a","less","string_or_numeric"),r=Gi(t,"b","less","string_or_numeric"),a=Ii(n,r),i=(0,oe.Z)(a,2);n=i[0],r=i[1],Os(n.shape,r.shape);var o={a:n,b:r};return Mi.runKernel(Fn,o)}});var tp=qi({lessEqual_:function(e,t){var n=Gi(e,"a","lessEqual","string_or_numeric"),r=Gi(t,"b","lessEqual","string_or_numeric"),a=Ii(n,r),i=(0,oe.Z)(a,2);n=i[0],r=i[1],Os(n.shape,r.shape);var o={a:n,b:r};return Mi.runKernel(Dn,o)}});function np(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");var r={start:e,stop:t,num:n};return Mi.runKernel(On,{},r)}var rp=qi({localResponseNormalization_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,i=Gi(e,"x","localResponseNormalization");me(4===i.rank||3===i.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(i.rank,".")})),me(we(t),(function(){return"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(t,".")}));var o=i,s=!1;3===i.rank&&(s=!0,o=Xc(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:t,bias:n,alpha:r,beta:a},l=Mi.runKernel(Wn,u,c);return s?Xc(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var ap=qi({log_:function(e){var t={x:Gi(e,"x","log","float32")};return Mi.runKernel(Mn,t)}});var ip=qi({log1p_:function(e){var t={x:Gi(e,"x","log1p")};return Mi.runKernel(Ln,t)}});var op=qi({neg_:function(e){var t={x:Gi(e,"x","neg")};return Mi.runKernel(rr,t)}});var sp=qi({softplus_:function(e){var t={x:Gi(e,"x","softplus")};return Mi.runKernel(zr,t)}});var up=qi({logSigmoid_:function(e){var t=Gi(e,"x","logSigmoid"),n=ac((function(e){return{value:op(sp(op(e))),gradFunc:function(t){return Xu(t,$c(op(e)))}}}));return n(t)}});var cp=qi({max_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Gi(e,"x","max"),a={x:r},i={reductionIndices:t,keepDims:n};return Mi.runKernel(Vn,a,i)}});var lp=qi({sum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Gi(e,"x","sum");"bool"===r.dtype&&(r=as(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return Mi.runKernel(Zr,a,i)}});var pp=qi({logSoftmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=Gi(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and axis was ").concat(t));var r=ac((function(e,n){var r=cp(e,t,!0),a=fc(e,r),i=fc(as(a,"float32"),ap(lp(Bl(a),t,!0)));n([i]);return{value:i,gradFunc:function(e,n){var r=(0,oe.Z)(n,1)[0],a=Bl(r);return fc(e,Xu(lp(e,t,!0),a))}}}));return r(n)}});function fp(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function hp(e,t,n){for(var r=e.length+t.length,a=[],i=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}function dp(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);var i=t.map((function(t){return e[t]}));return[n,i]}function mp(e,t){return hp(e,t.map((function(e){return 1})),t)}function vp(e,t,n){me(fp(t,n),(function(){return"".concat(e," supports only inner-most axes for now. ")+"Got axes ".concat(t," and rank-").concat(n," input.")}))}function gp(e,t){if(fp(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function yp(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function bp(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}var xp=qi({logSumExp_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Gi(e,"x","logSumExp"),a=Ae(t,r.shape),i=cp(r,a,!0),o=fc(r,i),s=Bl(o),u=lp(s,a),c=ap(u),l=ju(Xc(i,c.shape),c);if(n){var p=mp(l.shape,a);return Xc(l,p)}return l}});var kp=qi({logicalAnd_:function(e,t){var n=Gi(e,"a","logicalAnd","bool"),r=Gi(t,"b","logicalAnd","bool");Os(n.shape,r.shape);var a={a:n,b:r};return Mi.runKernel(zn,a)}});var wp=qi({logicalNot_:function(e){var t={x:Gi(e,"x","logicalNot","bool")};return Mi.runKernel(Pn,t)}});var Np=qi({logicalOr_:function(e,t){var n=Gi(e,"a","logicalOr","bool"),r=Gi(t,"b","logicalOr","bool");Os(n.shape,r.shape);var a={a:n,b:r};return Mi.runKernel(Zn,a)}});var Ip=qi({logicalXor_:function(e,t){var n=Gi(e,"a","logicalXor","bool"),r=Gi(t,"b","logicalXor","bool");return Os(n.shape,r.shape),kp(Np(e,t),wp(kp(e,t)))}});var Sp=qi({maxPool_:function(e,t,n,r,a){var i=Gi(e,"x","maxPool"),o=i,s=!1;3===i.rank&&(s=!0,o=Xc(i,[1,i.shape[0],i.shape[1],i.shape[2]])),me(4===o.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(o.rank,".")})),me(jc(n,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'")})),Kc("maxPool",r,a);var u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=Mi.runKernel(Hn,u,c);return s?Xc(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var Tp=qi({maxPool3d_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=Gi(e,"x","maxPool3d"),s=o,u=!1;4===o.rank&&(u=!0,s=Xc(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),me(5===s.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")})),me("NDHWC"===i,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)})),Kc("maxPool3d",r,a);var c={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},p=Mi.runKernel(qn,c,l);return u?Xc(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}});var Cp=qi({maxPoolWithArgmax_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=Gi(e,"x","maxPoolWithArgmax"),o={x:i},s={filterSize:t,strides:n,pad:r,includeBatchInIndex:a},u=Mi.runKernel(Xn,o,s);return{result:u[0],indexes:u[1]}}});var Ep=qi({mean_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Gi(e,"x","mean"),a={x:r},i={axis:t,keepDims:n};return Mi.runKernel(Yn,a,i)}});function Ap(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=Ap(e,"float32"),r=Ap(e,"float32");return Ki(n,r)}var a=Xe(be(e),t);return Mi.makeTensor(a,e,t)}function Rp(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=Rp(e,"float32"),r=Ap(e,"float32");return Ki(n,r)}var a=Ke(be(e),t);return Mi.makeTensor(a,e,t)}function _p(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.indexing,a=void 0===r?"xy":r;if("xy"!==a&&"ij"!==a)throw new TypeError("".concat(a," is not a valid third argument to meshgrid"));if(void 0===e)return[];var i=Gi(e,"x","meshgrid",e instanceof hi?e.dtype:"float32");if(void 0===t)return[i];var o=Gi(t,"y","meshgrid",t instanceof hi?t.dtype:"float32"),s=be(i.shape),u=be(o.shape);return"xy"===a?(i=Xc(i,[1,-1]),o=Xc(o,[-1,1]),[Cs(Rp([u,1],i.dtype),i),Cs(o,Rp([1,s],o.dtype))]):(i=Xc(i,[-1,1]),o=Xc(o,[1,-1]),[Cs(i,Rp([1,u],i.dtype)),Cs(Rp([s,1],o.dtype),o)])}var Fp=qi({min_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Gi(e,"x","min"),a={x:r},i={axis:t,keepDims:n};return Mi.runKernel(Qn,a,i)}});var Dp=qi({minimum_:function(e,t){var n=Gi(e,"a","minimum"),r=Gi(t,"b","minimum"),a=Ii(n,r),i=(0,oe.Z)(a,2);n=i[0],r=i[1],"bool"===n.dtype&&(n=as(n,"int32"),r=as(r,"int32")),Os(n.shape,r.shape);var o={a:n,b:r};return Mi.runKernel(Jn,o)}});var Op=qi({mirrorPad_:function(e,t,n){me("reflect"===n||"symmetric"===n,(function(){return"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(n,".")}));var r=Gi(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");me(t.length===r.rank,(function(){return"Padding doesn't match input. Must be ".concat(r.rank,". ")+"Got ".concat(t.length,".")}));for(var a="reflect"===n?1:0,i=function(e){me(2===t[e].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),me(t[e][0]>=0&&t[e][0]<=r.shape[e]-a&&t[e][1]>=0&&t[e][1]<=r.shape[e]-a,(function(){return"Padding in dimension ".concat(e," cannot be greater than or equal ")+"to ".concat(r.shape[e]-a," or less than 0 for input of ")+"shape ".concat(r.shape)}))},o=0;o<r.rank;o++)i(o);var s={paddings:t,mode:n},u={x:r};return Mi.runKernel($n,u,s)}});var Mp=qi({mod_:function(e,t){var n=Gi(e,"a","mod"),r=Gi(t,"b","mod"),a=Ii(n,r),i=(0,oe.Z)(a,2),o={a:n=i[0],b:r=i[1]};return Mi.runKernel(er,o)}});var Lp=qi({moments_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Ae(t,(e=Gi(e,"x","moments")).shape),a=Ep(e,r,n),i=a.shape;n||(i=mp(a.shape,r));var o=Qu(fc(as(e,"float32"),Xc(a,i))),s=Ep(o,r,n);return{mean:a,variance:s}}});var zp=qi({multiRNNCell_:function(e,t,n,r){for(var a=Gi(t,"data","multiRNNCell"),i=Hi(n,"c","multiRNNCell"),o=Hi(r,"h","multiRNNCell"),s=a,u=[],c=0;c<e.length;c++){var l=e[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}for(var p=[],f=[],h=0;h<u.length;h+=2)p.push(u[h]),f.push(u[h+1]);return[p,f]}});var Pp=qi({multinomial_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Gi(e,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+"".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));n=n||Math.random();var s=1===o?Xc(a,[1,-1]):a,u={logits:s},c={numSamples:t,seed:n,normalized:r},l=Mi.runKernel(tr,u,c);return 1===o?Xc(l,[l.size]):l}});var Zp=qi({notEqual_:function(e,t){var n=Gi(e,"a","notEqual","string_or_numeric"),r=Gi(t,"b","notEqual","string_or_numeric"),a=Ii(n,r),i=(0,oe.Z)(a,2);n=i[0],r=i[1],Os(n.shape,r.shape);var o={a:n,b:r};return Mi.runKernel(ar,o)}});var Bp=qi({onesLike_:function(e){var t={x:Gi(e,"x","onesLike")};return Mi.runKernel(ur,t)}});var Wp=qi({outerProduct_:function(e,t){var n=Gi(e,"v1","outerProduct"),r=Gi(t,"v2","outerProduct");me(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+"".concat(n.rank," and ").concat(r.rank,".")}));var a=Xc(n,[-1,1]),i=Xc(r,[1,-1]);return Cs(a,i)}});var Up=qi({pad_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Gi(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:t,constantValue:n},i={x:r};return Mi.runKernel(pr,i,a)}});var Vp=qi({pad1d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return me(2===t.length,(function(){return"Invalid number of paddings. Must be length of 2."})),Up(e,[t],n)}});var Gp=qi({pad2d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return me(2===t.length&&2===t[0].length&&2===t[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Up(e,t,n)}});var Hp=qi({pad3d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return me(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Up(e,t,n)}});var jp=qi({pad4d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return me(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Up(e,t,n)}});var qp=qi({spaceToBatchND_:function(e,t,n){var r=Gi(e,"x","spaceToBatchND");me(r.rank>=1+t.length,(function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(t.length)})),me(n.length===t.length,(function(){return"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length)})),me(r.shape.reduce((function(e,r,a){return a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]===0:e}),!0),(function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString())}));var a={x:r},i={blockShape:t,paddings:n};return Mi.runKernel(Br,a,i)}});var Kp=qi({pool_:function(e,t,n,r,a,i,o){null==a&&(a=[1,1]),null==i&&(i=1),0===r&&(r="valid");var s=Gi(e,"x","maxPool"),u=s,c=!1;3===s.rank&&(c=!0,u=Xc(s,[1,s.shape[0],s.shape[1],s.shape[2]])),me(jc(i,a),(function(){return"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'")}));var l,p=Oc(u.shape,t,i,a,r),f=[p.dilationHeight,p.dilationWidth];l="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})).map((function(e){return e-1})),r=n.map((function(e){return Math.floor(e/2)})),a=n.map((function(e,t){return e-r[t]}));return n.map((function(e,t){return[r[t],a[t]]}))}([p.filterHeight,p.filterWidth],f):[[0,0],[0,0]];var h=1===f[0]&&1===f[1],d=function(e,t,n){var r=n.map((function(e){return e[0]})),a=n.map((function(e){return e[1]})),i=e.concat(r,a),o=t.map((function(e,t){return(e-i[t]%e)%e})),s=a.map((function(e,t){return e+o[t]})),u=t.map((function(e,t){return[r[t],s[t]]})),c=t.map((function(e,t){return[0,o[t]]}));return[u,c]}([p.inHeight,p.inWidth],f,l),m=(0,oe.Z)(d,2),v=m[0],g=m[1],y=h?r:"valid",b=h?u:qp(u,f,v),x=("avg"===n?function(){return Yc(b,t,i,y,o)}:function(){return Sp(b,t,i,y,o)})(),k=h?x:rl(x,f,g);return c?Xc(k,[k.shape[1],k.shape[2],k.shape[3]]):k}});var Xp=qi({prelu_:function(e,t){var n={x:Gi(e,"x","prelu"),alpha:Gi(t,"alpha","prelu")};return Mi.runKernel(dr,n)}});var Yp=qi({prod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Gi(e,"x","prod");"bool"===r.dtype&&(r=as(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return Mi.runKernel(mr,a,i)}});var Qp=qi({rand_:function(e,t,n){var r=be(e),a=null;if(null==n||"float32"===n)a=new Float32Array(r);else if("int32"===n)a=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type ".concat(n));a=new Uint8Array(r)}for(var i=0;i<r;i++)a[i]=t();return Mi.makeTensor(a,e,n)}}),Jp=n(699),$p=function(){function e(t,n,r,a,i){(0,$.Z)(this,e),this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=Jp.alea(o.toString())}return(0,ee.Z)(e,[{key:"nextValue",value:function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var a=void 0,i=void 0,o=void 0;do{o=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*a*s,n=this.mean+this.stdDev*i*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)}},{key:"convertValue",value:function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}},{key:"isValidTruncated",value:function(e){return e<=this.upper&&e>=this.lower}}]),e}(),ef=function(){function e(t,n,r,a){(0,$.Z)(this,e),this.alpha=t,this.beta=1/n,this.dtype=r;var i=a||Math.random();this.randu=Jp.alea(i.toString()),this.randn=new $p(0,1,r,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return(0,ee.Z)(e,[{key:"nextValue",value:function(){for(var e,t,n,r,a,i;;){do{r=this.randn.nextValue(),i=1+this.c*r}while(i<=0);if(i*=i*i,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-i+Math.log(i)),(a=this.randu())<t||Math.log(a)<n)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)}},{key:"convertValue",value:function(e){return"float32"===this.dtype?e:Math.round(e)}}]),e}(),tf=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if((0,$.Z)(this,e),this.canReturnFloat=function(){return null==t.dtype||"float32"===t.dtype},this.min=n,this.range=r-n,this.dtype=a,null==i&&(i=Math.random()),"number"===typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(n," - ").concat(r," <= 1 and dtype is not float"));this.random=Jp.alea(i)}return(0,ee.Z)(e,[{key:"convertValue",value:function(e){return this.canReturnFloat()?e:Math.round(e)}},{key:"nextValue",value:function(){return this.convertValue(this.min+this.range*this.random())}}]),e}();var nf=qi({randomGamma_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0;if(null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type ".concat(r));for(var i=new ef(t,n,r,a),o=rs(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var rf=qi({randomNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(null!=r&&"bool"===r)throw new Error("Unsupported data type ".concat(r));for(var i=new $p(t,n,r,!1,a),o=rs(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var af=qi({randomUniform_:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0,i=rs(e,r),o=new tf(t,n,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}});function of(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");var a={start:e,stop:t,step:n,dtype:r};return Mi.runKernel(vr,{},a)}var sf=qi({real_:function(e){var t={input:Gi(e,"input","real")};return Mi.runKernel(gr,t)}});var uf=qi({reciprocal_:function(e){var t={x:Gi(e,"x","reciprocal")};return Mi.runKernel(yr,t)}});var cf=qi({relu_:function(e){var t={x:Gi(e,"x","relu")};return Mi.runKernel(br,t)}});var lf=qi({relu6_:function(e){var t={x:Gi(e,"x","relu6")};return Mi.runKernel(Sr,t)}});var pf=qi({reverse_:function(e,t){var n={x:Gi(e,"x","reverse")},r={dims:t};return Mi.runKernel(Tr,n,r)}});var ff=qi({reverse1d_:function(e){var t=Gi(e,"x","reverse");return me(1===t.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(t.rank,".")})),pf(t,0)}});var hf=qi({reverse2d_:function(e,t){var n=Gi(e,"x","reverse");return me(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(n.rank,".")})),pf(n,t)}});var df=qi({reverse3d_:function(e,t){var n=Gi(e,"x","reverse");return me(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(n.rank,".")})),pf(n,t)}});var mf=qi({reverse4d_:function(e,t){var n=Gi(e,"x","reverse");return me(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(n.rank,".")})),pf(n,t)}});var vf=qi({round_:function(e){var t={x:Gi(e,"x","round")};return Mi.runKernel(Cr,t)}});var gf=qi({rsqrt_:function(e){var t={x:Gi(e,"x","rsqrt","float32")};return Mi.runKernel(Er,t)}});var yf=qi({selu_:function(e){var t={x:Gi(e,"x","selu")};return Mi.runKernel(_r,t)}});var bf=qi({separableConv2d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC",s=Gi(e,"x","separableConv2d"),u=Gi(t,"depthwiseFilter","separableConv2d"),c=Gi(n,"pointwiseFilter","separableConv2d"),l=s,p=!1;if(3===s.rank&&(p=!0,l=Xc(s,[1,s.shape[0],s.shape[1],s.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");me(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(l.rank,".")})),me(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")})),me(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")})),me(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(c.shape[0],".")})),me(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(c.shape[1],".")}));var f=u.shape[2],h=u.shape[3];me(c.shape[2]===f*h,(function(){return"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(f*h,", ")+"but got ".concat(c.shape[2],".")}));var d=Rl(l,u,r,a,o,i),m=1,v=gl(d,c,m,"valid",o);return p?Xc(v,[v.shape[1],v.shape[2],v.shape[3]]):v}});function xf(){return xf=J(ne().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,f,h;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Gi(t,"x","setdiff1d"),a=Gi(n,"y","setdiff1d"),me(r.dtype===a.dtype,(function(){return"x and y should have the same dtype, but got x (".concat(r.dtype,") and y (").concat(a.dtype,").")})),me(1===r.rank,(function(){return"x should be 1D tensor, but got x (".concat(r.shape,").")})),me(1===a.rank,(function(){return"y should be 1D tensor, but got y (".concat(a.shape,").")})),e.next=7,r.data();case 7:return i=e.sent,e.next=10,a.data();case 10:for(o=e.sent,s=new Set(o),u=0,c=0;c<i.length;c++)s.has(i[c])||u++;for(l=new li([u],r.dtype),p=new li([u],"int32"),f=0,h=0;f<i.length;f++)s.has(i[f])||(l.values[h]=i[f],p.values[h]=f,h++);return e.abrupt("return",[l.toTensor(),p.toTensor()]);case 18:case"end":return e.stop()}}),e)}))),xf.apply(this,arguments)}var kf=function(e,t){return xf.apply(this,arguments)};var wf=qi({sign_:function(e){var t={x:Gi(e,"x","sign")};return Mi.runKernel(Mr,t)}});var Nf=qi({sin_:function(e){var t={x:Gi(e,"x","sin","float32")};return Mi.runKernel(Dr,t)}});var If=qi({sinh_:function(e){var t={x:Gi(e,"x","sinh")};return Mi.runKernel(Or,t)}});var Sf=qi({slice1d_:function(e,t,n){var r=Gi(e,"x","slice1d");return me(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")})),el(r,[t],[n])}});var Tf=qi({slice2d_:function(e,t,n){var r=Gi(e,"x","slice2d");return me(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")})),el(r,t,n)}});var Cf=qi({slice3d_:function(e,t,n){var r=Gi(e,"x","slice3d");return me(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")})),el(r,t,n)}});var Ef=qi({slice4d_:function(e,t,n){var r=Gi(e,"x","slice4d");return me(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")})),el(r,t,n)}});var Af=qi({softmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=Gi(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and dim was ").concat(t));var r={logits:n},a={dim:t};return Mi.runKernel(Ur,r,a)}});var Rf=qi({fft_:function(e){me("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(e.dtype,".")}));var t={input:e};return Mi.runKernel(mn,t)}});var _f=qi({ifft_:function(e){me("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(e.dtype,".")}));var t={input:e};return Mi.runKernel(Tn,t)}});var Ff=qi({irfft_:function(e){var t,n=e.shape[e.shape.length-1],r=e.size/n;if(n<=2){var a=Xc(e,[r,n]);t=_f(a)}else{var i=[r,2*(n-1)],o=Xc(sf(e),[r,n]),s=Xc(Xl(e),[r,n]),u=pf(el(o,[0,1],[r,n-2]),1),c=Xu(pf(el(s,[0,1],[r,n-2]),1),oc(-1)),l=Jc([o,u],1),p=Jc([s,c],1),f=Xc(Ki(l,p),[i[0],i[1]]);t=_f(f)}if(t=sf(t),3===e.rank&&0!==e.shape[0]){var h=t,d=e.shape[0];t=Xc(t,[d,t.shape[0]/d,t.shape[1]]),h.dispose()}return t}});var Df=qi({split_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Gi(e,"x","split"),a={x:r},i={numOrSizeSplits:t,axis:n};return Mi.runKernel(Wr,a,i)}});var Of=qi({rfft_:function(e,t){me("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got ".concat(e.dtype)}));var n,r=e.shape[e.shape.length-1],a=e.size/r;if(null!=t&&t<r){var i=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=el(e,i,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=Jc([e,Ap(s)],e.shape.length-1),r=t}else n=e;var u=Ju(n),c=Xc(Ki(n,u),[a,r]),l=Rf(c),p=Math.floor(r/2)+1,f=sf(l),h=Xl(l),d=Df(f,[p,r-p],f.shape.length-1),m=Df(h,[p,r-p],h.shape.length-1),v=n.shape.slice();return v[n.shape.length-1]=p,Xc(Ki(d[0],m[0]),v)}});var Mf=qi({squaredDifference_:function(e,t){var n=Gi(e,"a","squaredDifference"),r=Gi(t,"b","squaredDifference"),a=Ii(n,r),i=(0,oe.Z)(a,2);n=i[0],r=i[1],Os(n.shape,r.shape);var o={a:n,b:r};return Mi.runKernel(Kr,o,{})}});var Lf=qi({squeeze_:function(e,t){var n=Gi(e,"x","squeeze");return Xc(n,Re(n.shape,t).newShape)}});var zf=qi({stack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Hi(e,"tensors","stack","string_or_numeric");me(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),n.length>0&&me(t<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n,a={axis:t};return Mi.runKernel(lr,r,a)}});var Pf=qi({step_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Gi(e,"x","step"),r={x:n},a={alpha:t};return Mi.runKernel(pa,r,a)}});var Zf=qi({stridedSlice_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c=Gi(e,"x","stridedSlice","string_or_numeric"),l={x:c},p={begin:t,end:n,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return Mi.runKernel(Yr,l,p)}});var Bf=qi({tan_:function(e){var t={x:Gi(e,"x","tan","float32")};return Mi.runKernel(ta,t)}});function Wf(e,t){ge(e);var n=Wi(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Xi(e,null,n,t)}function Uf(e,t,n){if(ge(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Wi(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Xi(e,t,r,n)}function Vf(e,t,n){if(ge(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=Wi(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Xi(e,t,r,n)}function Gf(e,t,n){if(ge(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=Wi(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Xi(e,t,r,n)}function Hf(e,t,n){if(ge(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=Wi(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Xi(e,t=t||r,r,n)}var jf=qi({topk_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=Gi(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(t<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(t));if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") ")+"but got ".concat(t));var i={x:r},o={k:t,sorted:n},s=Mi.runKernel(aa,i,o),u=(0,oe.Z)(s,2),c=u[0],l=u[1];return{values:c,indices:l}}});var qf=qi({truncatedNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var i=new $p(t,n,r,!0,a),o=rs(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var Kf=qi({unique_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Gi(e,"x","unique","string_or_numeric");me(n.rank>0,(function(){return"The input tensor must be at least 1D"}));var r={x:n},a={axis:t},i=Mi.runKernel(sa,r,a),o=(0,oe.Z)(i,2),s=o[0],u=o[1];return{values:s,indices:u}}});var Xf=qi({unsortedSegmentSum_:function(e,t,n){var r=Gi(e,"x","unsortedSegmentSum"),a=Gi(t,"segmentIds","unsortedSegmentSum","int32");me(we(n),(function(){return"numSegments must be of dtype int"}));var i={x:r,segmentIds:a},o={numSegments:n};return Mi.runKernel(ca,i,o)}});var Yf=qi({unstack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Gi(e,"x","unstack","string_or_numeric");me(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")}));var r={value:n},a={axis:t};return Mi.runKernel(ua,r,a)}});function Qf(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return Mi.makeVariable(e,t,n,r)}function Jf(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);for(var a=rs(e,"int32"),i=rs([n.length,e.length],"int32"),o=0;o<n.length;o++){var s=a.indexToLoc(n[o]),u=o*e.length;i.values.set(s,u)}return i.toTensor()}function $f(){return($f=J(ne().mark((function e(t){var n,r,a;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Gi(t,"condition","whereAsync","bool"),e.next=3,n.data();case 3:return r=e.sent,a=Jf(n.shape,r),t!==n&&n.dispose(),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var eh=function(e){return $f.apply(this,arguments)};function th(){return th=J(ne().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,f,h,d,m,v;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=Gi(t,"tensor","boolMask"),i=Gi(n,"mask","boolMask","bool"),o=null==r?0:r,s=i.rank,u=a.shape,me(s>0,(function(){return"mask cannot be scalar"})),ve(u.slice(o,o+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,l=o;l<o+s;l++)c*=u[l];return p=u.slice(0,o).concat([c],u.slice(o+s)),f=Xc(a,p),h=Xc(i,[-1]),e.next=14,eh(h);case 14:return d=e.sent,m=Lf(d,[1]),v=jl(f,m,o),t!==a&&a.dispose(),n!==i&&i.dispose(),m.dispose(),f.dispose(),h.dispose(),d.dispose(),e.abrupt("return",v);case 24:case"end":return e.stop()}}),e)}))),th.apply(this,arguments)}var nh=function(e,t,n){return th.apply(this,arguments)};function rh(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===e.rank)return dc(e);if(1!==e.rank&&null===n)return rh(Xc(e,[-1]),t,n);if(1===e.rank||"number"===typeof n||Array.isArray(n)&&1===n.length){if(1===t)return lp(dc(e),n);if(t===1/0)return cp(dc(e),n);if(t===-1/0)return Fp(dc(e),n);if("euclidean"===t||2===t)return Yu(lp(pc(dc(e),oc(2,"int32")),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}if(Array.isArray(n)&&2===n.length){if(1===t)return cp(lp(dc(e),n[0]),n[1]-1);if(t===1/0)return cp(lp(dc(e),n[1]),n[0]);if(t===-1/0)return Fp(lp(dc(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return Yu(lp(Qu(e),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}throw new Error("Error in norm: invalid axis: ".concat(n))}var ah=qi({norm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=rh(e=Gi(e,"x","norm"),t,n),i=a.shape;if(r){var o=Ae(n,e.shape);i=mp(a.shape,o)}return Xc(a,i)}});var ih=qi({movingAverage_:function(e,t,n,r){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=Gi(e,"v","movingAverage"),o=Gi(t,"x","movingAverage"),s=Gi(n,"decay","movingAverage");Si(i,o),me(ke(i.shape,o.shape),(function(){return"Shape mismatch in v and x"}));var u=oc(1),c=fc(u,s),l=Xu(fc(o,i),c);if(a){me(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var p=Gi(r,"step","movingAverage");l=Ku(l,fc(u,pc(s,p)))}return ju(i,l)}});var oh=qi({scatterND_:function(e,t,n){var r=Gi(e,"indices","scatterND","int32"),a=Gi(t,"updates","scatterND");Hs(a,r,n);var i={indices:r,updates:a},o={shape:n};return Mi.runKernel(Ar,i,o)}});function sh(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+" but the dtype was ".concat(e.dtype,"."));if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+" but got shape ".concat(e.shape,"."));var a=e.rank>0?e.shape[0]:1,i=e.rank>1?e.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:,"+" ".concat(n.length,", should be: ").concat(i,"."));var o=t.size;if(0!==t.rank&&(1!==t.rank||o!==a))throw new Error("sparseValues has incorrect shape "+"".concat(t.shape,", should be [] or [").concat(a,"]"));if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}var uh=qi({sparseToDense_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=Gi(e,"sparseIndices","sparseToDense","int32"),i=Gi(t,"sparseValues","sparseToDense"),o=Gi(r,"defaultValue","sparseToDense",i.dtype);sh(a,i,n,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:n};return Mi.runKernel(qr,s,u)}});var ch=qi({gatherND_:function(e,t){var n=Gi(t,"indices","gatherND","int32"),r={params:Gi(e,"x","gatherND","string_or_numeric"),indices:n};return Mi.runKernel(wn,r)}});var lh=qi({dropout_:function(e,t,n,r){var a=Gi(e,"x","dropout");if(me("float32"===a.dtype,(function(){return"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(a.dtype," tensor instead.")})),me(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got ".concat(t,".")})),0===t)return e instanceof hi?a.clone():a;var i=function(e,t){if(null==t)return e.shape.slice();if(ke(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(a,n),o=1-t,s=Ku(Hl(ju(af(i,0,1,"float32",r),o)),o);return Xu(a,s)}});function ph(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function fh(e,t,n){for(var r=1-e%2,a=new Float32Array(e),i=0;i<e;++i){var o=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(o)}return Wf(a,"float32")}function hh(){return hh=J(ne().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,f,h,d,m,v,g,y=arguments;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=y.length>2&&void 0!==y[2]?y[2]:1,a=Gi(t,"predictions","inTopK"),i=Gi(n,"targets","inTopK"),me(a.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, "+"but got ".concat(a.rank)})),me(a.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+"".concat(a.rank," and targets rank ").concat(i.rank)})),ve(a.shape.slice(0,a.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=a.shape[a.shape.length-1],me(r>0&&r<=o,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last "+"dimension (".concat(o,"), but got ").concat(r)})),e.next=10,a.data();case 10:return s=e.sent,e.next=13,i.data();case 13:u=e.sent,c=s.length/o,l=o,p=_e("bool",c),f=0;case 17:if(!(f<c)){e.next=35;break}for(h=f*l,d=s.subarray(h,h+l),m=[],v=0;v<d.length;v++)m.push({value:d[v],index:v});m.sort((function(e,t){return t.value-e.value})),p[f]=0,g=0;case 25:if(!(g<r)){e.next=32;break}if(m[g].index!==u[f]){e.next=29;break}return p[f]=1,e.abrupt("break",32);case 29:g++,e.next=25;break;case 32:f++,e.next=17;break;case 35:return t!==a&&a.dispose(),n!==i&&i.dispose(),e.abrupt("return",Yi(p,i.shape,"bool"));case 38:case"end":return e.stop()}}),e)}))),hh.apply(this,arguments)}var dh=function(e,t){return hh.apply(this,arguments)};var mh=qi({conv2DBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=Xc(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=Xc(t,[1,t.shape[0],t.shape[1],t.shape[2]])),me(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")})),me(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")})),me(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(n,".")}));var c="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?u.shape[3]:u.shape[1];me(c===n[2],(function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(n[2],".")})),me(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(n[3],").")})),Kc("conv2dDerFilter",a,o);var p={x:s,dy:u},f={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:n};return Mi.runKernel(Bt,p,f)}});function vh(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return Xu(e,Pf(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function gh(e,t){var n=t,r=Ds(e.shape,t.shape);return r.length>0&&(n=lp(n,r)),Xc(n,e.shape)}function yh(e,t,n,r){if("linear"===t)return e;if("relu"===t)return cf(e);if("elu"===t)return Pl(e);if("relu6"===t)return lf(e);if("prelu"===t)return Xp(e,n);if("leakyrelu"===t)return $l(e,r);if("sigmoid"===t)return $c(e);throw new Error("Unknown fused activation ".concat(t,"."))}var bh=function(e,t){return!(e>0)||"linear"===t};var xh=qi({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,i=e.dataFormat,o=void 0===i?"NHWC":i,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,l=e.bias,p=e.activation,f=void 0===p?"linear":p,h=e.preluActivationWeights,d=e.leakyreluAlpha;if(f=f||"linear",!1===bh(Mi.state.gradientDepth,f)){var m=gl(t,n,r,a,o,u,c);return null!=l&&(m=ju(m,l)),yh(m,f,h,d)}var v=Gi(t,"x","conv2d","float32"),g=Gi(n,"filter","conv2d","float32"),y=v,b=!1;3===v.rank&&(b=!0,y=Xc(v,[1,v.shape[0],v.shape[1],v.shape[2]])),me(4===y.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(y.rank,".")})),me(4===g.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(g.rank,".")})),Kc("fused conv2d",a,c),me(y.shape[3]===g.shape[2],(function(){return"Error in conv2d: depth of input (".concat(y.shape[3],") must match ")+"input depth for filter ".concat(g.shape[2],".")})),me(jc(r,u),(function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(r," and dilations '").concat(u,"'")})),me("NHWC"===o,(function(){return"Error in conv2d: got dataFormat of ".concat(o," but only NHWC is currently supported.")}));var x,k,w=Lc(y.shape,g.shape,r,u,a,c);if(null!=l){var N=Ii(x=Gi(l,"bias","fused conv2d"),v);x=(0,oe.Z)(N,1)[0],Os(w.outShape,x.shape)}null!=h&&(k=Gi(h,"prelu weights","fused conv2d"));var I=function(e,t){var n=(0,oe.Z)(t,4),i=n[0],o=n[1],s=n[2],c=n[3],l=vh(e,s,f);me(Hc(u),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(u,"'")}));var p=[bl(o.shape,l,i,r,a),mh(o,l,i.shape,r,a)];if(null!=c){var h=gh(c,l);p.push(h)}return p},S={x:y,filter:g,bias:x,preluActivationWeights:k},T={strides:r,pad:a,dataFormat:o,dilations:u,dimRoundingMode:c,activation:f,leakyreluAlpha:d};if(null==l){var C=ac((function(e,t,n){var r=Mi.runKernel(ma,S,T);return n([t,e,r]),b&&(r=Xc(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:I}}));return C(y,g)}var E=ac((function(e,t,n,r){var a=Mi.runKernel(ma,S,T);return r([t,e,a,n]),b&&(a=Xc(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:I}}));return E(y,g,x)}});var kh=qi({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=Xc(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=Xc(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={x:s,dy:u},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:n};return Mi.runKernel($t,c,l)}});var wh=qi({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=t,u=!1;3===t.rank&&(u=!0,s=Xc(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={dy:s,filter:n},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:e},p=Mi.runKernel(en,c,l);return u?Xc(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});var Nh=qi({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,i=e.dataFormat,o=void 0===i?"NHWC":i,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,l=e.bias,p=e.activation,f=void 0===p?"linear":p,h=e.preluActivationWeights,d=e.leakyreluAlpha;if(!1===bh(Mi.state.gradientDepth,f)){var m=Rl(t,n,r,a,o,u,c);return null!=l&&(m=ju(m,l)),yh(m,f,h,d)}var v=Gi(t,"x","depthwiseConv2d","float32"),g=Gi(n,"filter","depthwiseConv2d","float32"),y=v,b=!1;3===v.rank&&(b=!0,y=Xc(v,[1,v.shape[0],v.shape[1],v.shape[2]])),me(4===y.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(y.rank,".")})),me(4===g.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+"but got rank ".concat(g.rank,".")})),me(y.shape[3]===g.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels "+"(".concat(y.shape[3],") must match the inChannels dimension in ")+"filter ".concat(g.shape[2],".")})),null==u&&(u=[1,1]),me(jc(r,u),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+"be 1. Got strides ".concat(r," and dilations '").concat(u,"'")})),Kc("fused depthwiseConv2d",a,c);var x,k,w=Lc(y.shape,g.shape,r,u,a,c,!0);if(null!=l){var N=Ii(x=Gi(l,"bias","fused conv2d"),v),I=(0,oe.Z)(N,1);x=I[0],Os(w.outShape,x.shape)}null!=h&&(k=Gi(h,"prelu weights","fused depthwiseConv2d"));var S=function(e,t){me(Hc(u),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(u,"'")}));var n=(0,oe.Z)(t,4),i=n[0],o=n[1],s=n[2],l=n[3],p=vh(e,s,f),h=wh(o.shape,p,i,r,a,u,c),d=kh(o,p,i.shape,r,a,u,c);return null!=l?[h,d,gh(x,p)]:[h,d]},T={x:y,filter:g,bias:x,preluActivationWeights:k},C={strides:r,pad:a,dataFormat:o,dilations:u,dimRoundingMode:c,activation:f,leakyreluAlpha:d};if(null==l){var E=ac((function(e,t,n){var r=Mi.runKernel(va,T,C);return n([t,e,r]),b&&(r=Xc(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:S}}));return E(y,g)}var A=ac((function(e,t,n,r){var a=Mi.runKernel(va,T,C);return r([t,e,a,n]),b&&(a=Xc(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:S}}));return A(y,g,x)}});var Ih=qi({fusedMatMul_:function(e){var t=e.a,n=e.b,r=e.transposeA,a=void 0!==r&&r,i=e.transposeB,o=void 0!==i&&i,s=e.bias,u=e.activation,c=void 0===u?"linear":u,l=e.preluActivationWeights,p=e.leakyreluAlpha;if(!1===bh(Mi.state.gradientDepth,c)){var f=Cs(t,n,a,o);return null!=s&&(f=ju(f,s)),yh(f,c,l,p)}var h=Gi(t,"a","fused matMul"),d=Gi(n,"b","fused matMul"),m=Ii(h,d),v=(0,oe.Z)(m,2);h=v[0],d=v[1];var g=a?h.shape[h.rank-2]:h.shape[h.rank-1],y=o?d.shape[d.rank-1]:d.shape[d.rank-2],b=a?h.shape[h.rank-1]:h.shape[h.rank-2],x=o?d.shape[d.rank-2]:d.shape[d.rank-1],k=h.shape.slice(0,-2),w=d.shape.slice(0,-2),N=be(k),I=be(w);me(g===y,(function(){return"Error in fused matMul: inner shapes (".concat(g,") and (")+"".concat(y,") of Tensors with shapes ").concat(h.shape," and ")+"".concat(d.shape," and transposeA=").concat(a)+" and transposeB=".concat(o," must match.")}));var S,T,C=Os(h.shape.slice(0,-2),d.shape.slice(0,-2)).concat([b,x]),E=Xc(h,a?[N,g,b]:[N,b,g]),A=Xc(d,o?[I,x,y]:[I,y,x]);if(null!=s){var R=Ii(S=Gi(s,"bias","fused matMul"),h);S=(0,oe.Z)(R,1)[0],Os(C,S.shape)}null!=l&&(T=Gi(l,"prelu weights","fused matMul"));var _=function(e,t){var n,r,i=(0,oe.Z)(t,4),u=i[0],l=i[1],p=i[2],f=i[3],h=vh(Xc(e,p.shape),p,c);return a||o?!a&&o?(n=Cs(h,l,!1,!1),r=Cs(h,u,!0,!1)):a&&!o?(n=Cs(l,h,!1,!0),r=Cs(u,h,!1,!1)):(n=Cs(l,h,!0,!0),r=Cs(h,u,!0,!0)):(n=Cs(h,l,!1,!0),r=Cs(u,h,!0,!1)),null!=s?[n,r,gh(f,h)]:[n,r]},F={a:E,b:A,bias:S,preluActivationWeights:T},D={transposeA:a,transposeB:o,activation:c,leakyreluAlpha:p};if(null==s){var O=ac((function(e,t,n){var r=Mi.runKernel(da,F,D);return n([e,t,r]),{value:Xc(r,C),gradFunc:_}}));return O(E,A)}var M=ac((function(e,t,n,r){var a=Mi.runKernel(da,F,D);return r([e,t,a,n]),{value:Xc(a,C),gradFunc:_}}));return M(E,A,S)}});var Sh=qi({hammingWindow_:function(e){return fh(e,.54,.46)}});var Th=qi({hannWindow_:function(e){return fh(e,.5,.5)}});var Ch=qi({frame_:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=0,o=[];i+t<=e.size;)o.push(el(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,u=Jc([el(e,i,t-s),cc([s],a)]);o.push(u),i+=n}return 0===o.length?Uf([],[0,t]):Xc(Jc(o),[o.length,t])}});var Eh=qi({stft_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Th;null==r&&(r=ph(t));var i=Ch(e,t,n),o=Xu(i,a(t));return Of(o,r)}});var Ah=qi({cropAndResize_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=Gi(e,"image","cropAndResize"),s=Gi(t,"boxes","cropAndResize","float32"),u=Gi(n,"boxInd","cropAndResize","int32"),c=s.shape[0];me(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")})),me(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] ")+"but had shape ".concat(s.shape,".")})),me(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] ")+"but had shape ".concat(s.shape,".")})),me(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(r.length,".")})),me(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was ".concat(r)})),me("bilinear"===a||"nearest"===a,(function(){return"method must be bilinear or nearest, but was ".concat(a)}));var l={image:o,boxes:s,boxInd:u},p={method:a,extrapolationValue:i,cropSize:r},f=Mi.runKernel(Xt,l,p);return f}});var Rh=qi({flipLeftRight_:function(e){var t=Gi(e,"image","flipLeftRight","float32");me(4===t.rank,(function(){return"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(t.rank,".")}));var n={image:t};return Mi.runKernel(gn,n,{})}});var _h=qi({grayscaleToRGB_:function(e){var t=Gi(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];me(t.rank>=2,(function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(t.rank,".")})),me(1===r,(function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(r,".")}));var a=new Array(t.rank);return a.fill(1,0,n),a[n]=3,Vl(t,a)}});var Fh=qi({rotateWithOffset_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=Gi(e,"image","rotateWithOffset","float32");me(4===a.rank,(function(){return"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,".")}));var i={image:a},o={radians:t,fillValue:n,center:r},s=Mi.runKernel(ha,i,o);return s}});function Dh(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);var o=e.shape[0];return n=Math.min(n,o),me(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")})),me(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")})),me(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1])})),me(1===t.rank,(function(){return"scores must be a 1D tensor"})),me(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(t.shape[0])})),me(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}var Oh=qi({nonMaxSuppression_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=Gi(e,"boxes","nonMaxSuppression","float32"),o=Gi(t,"scores","nonMaxSuppression","float32"),s=Dh(i,o,n,r,a),u={maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:a=s.scoreThreshold};return Mi.runKernel(ir,{boxes:i,scores:o},u)}});function Mh(e,t,n){var r=function(e,t,n){return function(e,t,n){var r=0,a=e.length,i=0,o=!1;for(;r<a;){var s=n(t,e[i=r+(a-r>>>1)]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||Lh)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function Lh(e,t){return e>t?1:e<t?-1:0}function zh(e,t,n,r,a){return Bh(e,t,n,r,a,0)}function Ph(e,t,n,r,a,i){return Bh(e,t,n,r,a,0,!1,i,!0)}function Zh(e,t,n,r,a,i){return Bh(e,t,n,r,a,i,!0)}function Bh(e,t,n,r,a,i){for(var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=[],l=0;l<t.length;l++)t[l]>a&&c.push({score:t[l],boxIndex:l,suppressBeginIndex:0});c.sort(Vh);for(var p=i>0?-.5/i:0,f=[],h=[];f.length<n&&c.length>0;){var d=c.pop(),m=d.score,v=d.boxIndex,g=d.suppressBeginIndex;if(m<a)break;for(var y=!1,b=f.length-1;b>=g;--b){var x=Wh(e,v,f[b]);if(x>=r){y=!0;break}if(d.score=d.score*Uh(r,p,x),d.score<=a)break}d.suppressBeginIndex=f.length,y||(d.score===m?(f.push(v),h.push(d.score)):d.score>a&&Mh(c,d,Vh))}var k=f.length,w=n-k;s&&w>0&&(f.push.apply(f,Y(new Array(w).fill(0))),h.push.apply(h,Y(new Array(w).fill(0))));var N={selectedIndices:f};return o&&(N.selectedScores=h),u&&(N.validOutputs=k),N}function Wh(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),p=Math.max(a[0],a[2]),f=Math.max(a[1],a[3]),h=(s-i)*(u-o),d=(p-c)*(f-l);if(h<=0||d<=0)return 0;var m=Math.max(i,c),v=Math.max(o,l),g=Math.min(s,p),y=Math.min(u,f),b=Math.max(g-m,0)*Math.max(y-v,0);return b/(h+d-b)}function Uh(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function Vh(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function Gh(){return Gh=J(ne().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,f,h,d=arguments;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=d.length>3&&void 0!==d[3]?d[3]:.5,i=d.length>4&&void 0!==d[4]?d[4]:Number.NEGATIVE_INFINITY,o=Gi(t,"boxes","nonMaxSuppressionAsync"),s=Gi(n,"scores","nonMaxSuppressionAsync"),u=Dh(o,s,r,a,i),r=u.maxOutputSize,a=u.iouThreshold,i=u.scoreThreshold,e.next=10,Promise.all([o.data(),s.data()]);case 10:return c=e.sent,l=c[0],p=c[1],f=zh(l,p,r,a,i),h=f.selectedIndices,o!==t&&o.dispose(),s!==n&&s.dispose(),e.abrupt("return",Wf(h,"int32"));case 17:case"end":return e.stop()}}),e)}))),Gh.apply(this,arguments)}var Hh=function(e,t,n){return Gh.apply(this,arguments)};var jh=qi({nonMaxSuppressionWithScore_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=Gi(e,"boxes","nonMaxSuppression"),s=Gi(t,"scores","nonMaxSuppression"),u=Dh(o,s,n,r,a,i),c={boxes:o,scores:s},l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:a=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},p=Mi.runKernel(sr,c,l);return{selectedIndices:p[0],selectedScores:p[1]}}});function qh(){return qh=J(ne().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,f,h,d,m,v=arguments;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=v.length>3&&void 0!==v[3]?v[3]:.5,i=v.length>4&&void 0!==v[4]?v[4]:Number.NEGATIVE_INFINITY,o=v.length>5&&void 0!==v[5]?v[5]:0,s=Gi(t,"boxes","nonMaxSuppressionAsync"),u=Gi(n,"scores","nonMaxSuppressionAsync"),c=Dh(s,u,r,a,i,o),r=c.maxOutputSize,a=c.iouThreshold,i=c.scoreThreshold,o=c.softNmsSigma,e.next=12,Promise.all([s.data(),u.data()]);case 12:return l=e.sent,p=l[0],f=l[1],h=Zh(p,f,r,a,i,o),d=h.selectedIndices,m=h.selectedScores,s!==t&&s.dispose(),u!==n&&u.dispose(),e.abrupt("return",{selectedIndices:Wf(d,"int32"),selectedScores:Wf(m)});case 19:case"end":return e.stop()}}),e)}))),qh.apply(this,arguments)}var Kh=function(e,t,n){return qh.apply(this,arguments)};var Xh=qi({nonMaxSuppressionPadded_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=Gi(e,"boxes","nonMaxSuppression"),s=Gi(t,"scores","nonMaxSuppression"),u=Dh(o,s,n,r,a,null),c=u.maxOutputSize,l=u.iouThreshold,p=u.scoreThreshold,f={boxes:o,scores:s},h={maxOutputSize:c,iouThreshold:l,scoreThreshold:p,padToMaxOutputSize:i},d=Mi.runKernel(or,f,h);return{selectedIndices:d[0],validOutputs:d[1]}}});function Yh(){return Yh=J(ne().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,f,h,d,m,v,g,y,b,x=arguments;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=x.length>3&&void 0!==x[3]?x[3]:.5,i=x.length>4&&void 0!==x[4]?x[4]:Number.NEGATIVE_INFINITY,o=x.length>5&&void 0!==x[5]&&x[5],s=Gi(t,"boxes","nonMaxSuppressionAsync"),u=Gi(n,"scores","nonMaxSuppressionAsync"),c=Dh(s,u,r,a,i,null),l=c.maxOutputSize,p=c.iouThreshold,f=c.scoreThreshold,e.next=11,Promise.all([s.data(),u.data()]);case 11:return h=e.sent,d=(0,oe.Z)(h,2),m=d[0],v=d[1],g=Ph(m,v,l,p,f,o),y=g.selectedIndices,b=g.validOutputs,s!==t&&s.dispose(),u!==n&&u.dispose(),e.abrupt("return",{selectedIndices:Wf(y,"int32"),validOutputs:oc(b,"int32")});case 19:case"end":return e.stop()}}),e)}))),Yh.apply(this,arguments)}var Qh=function(e,t,n){return Yh.apply(this,arguments)},Jh=n(878),$h=n(267);function ed(e){return(0,Jh.Z)(e)||X(e)||(0,j.Z)(e)||(0,$h.Z)()}var td=qi({resizeBilinear_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Gi(e,"images","resizeBilinear");me(3===a.rank||4===a.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")})),me(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(t,".")})),me(!1===r||!1===n,(function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=Xc(a,[1,a.shape[0],a.shape[1],a.shape[2]])),ed(t);var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},c=Mi.runKernel(Nr,s,u);return o?Xc(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});var nd=qi({resizeNearestNeighbor_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Gi(e,"images","resizeNearestNeighbor");me(3===a.rank||4===a.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")})),me(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(t,".")})),me("float32"===a.dtype||"int32"===a.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"})),me(!1===r||!1===n,(function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=Xc(a,[1,a.shape[0],a.shape[1],a.shape[2]])),ed(t);var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},c=Mi.runKernel(kr,s,u);return o?Xc(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});function rd(e,t){for(var n,r,a,i,o,s,u=Wf([-1]),c=Wf([0]),l=Wf([0]),p=0;p<e.size-1;p++){n=el(e,0,p+1),r=el(e,p+1),o=Ku(lp(n),t),s=Ku(lp(r),t);var f=lp(Xu(n,of(0,n.size)));a=Ku(f,lp(n));var h=cc(r.shape,n.size),d=ju(of(0,r.size),h),m=Xu(r,d);i=Ku(lp(m),lp(r));var v=fc(a,i),g=fc(a,i),y=Xu(o,s);l=Xu(Xu(y,v),g);var b=ql(l,c);c=Ol(b,l,c),u=Ol(b,Wf([p]),u)}return u}var ad=qi({threshold_:function(e){var t,n,r,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"binary",o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,u=Gi(e,"image","threshold"),c=.2989,l=.587,p=.114,f=u.shape[0]*u.shape[1],h=Xu(Wf([s]),255);if(me(3===u.rank,(function(){return"Error in threshold: image must be rank 3,"+"but got rank ".concat(u.rank,".")})),me(3===u.shape[2]||1===u.shape[2],(function(){return"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(u.shape[2],".")})),me("int32"===u.dtype||"float32"===u.dtype,(function(){return"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(u.dtype,".")})),me("otsu"===i||"binary"===i,(function(){return"Method must be binary or otsu, but was ".concat(i)})),3===u.shape[2]){var d=Df(u,[1,1,1],-1),m=(0,oe.Z)(d,3);t=m[0],n=m[1],r=m[2];var v=Xu(t,c),g=Xu(n,l),y=Xu(r,p);a=ju(ju(v,g),y)}else a=e;if("otsu"===i){var b=ul(as(vf(a),"int32"),Yi([]),256);h=rd(b,f)}var x=o?tp(a,h):ql(a,h),k=as(Xu(x,255),"int32");return k}});var id=qi({transform_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"constant",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5?arguments[5]:void 0,o=Gi(e,"image","transform","float32"),s=Gi(t,"transforms","transform","float32");me(4===o.rank,(function(){return"Error in transform: image must be rank 4,"+"but got rank ".concat(o.rank,".")})),me(2===s.rank&&(s.shape[0]===o.shape[0]||1===s.shape[0])&&8===s.shape[1],(function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"})),me(null==i||2===i.length,(function(){return"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(i,".")}));var u={image:o,transforms:s},c={interpolation:n,fillMode:r,fillValue:a,outputShape:i};return Mi.runKernel(ia,u,c)}});var od=qi({bandPart_:function(e,t,n){me(t%1===0,(function(){return"bandPart(): numLower must be an integer, got ".concat(t,".")})),me(n%1===0,(function(){return"bandPart(): numUpper must be an integer, got ".concat(n,".")}));var r=Gi(e,"a","bandPart");me(r.rank>=2,(function(){return"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")}));var a=r.shape,i=r.shape.slice(-2),o=(0,oe.Z)(i,2),s=o[0],u=o[1];if(!(t<=s))throw new Error("bandPart(): numLower (".concat(t,")")+" must not be greater than the number of rows (".concat(s,")."));if(!(n<=u))throw new Error("bandPart(): numUpper (".concat(n,")")+" must not be greater than the number of columns (".concat(u,")."));t<0&&(t=s),n<0&&(n=u);var c=Xc(of(0,s,1,"int32"),[-1,1]),l=of(0,u,1,"int32"),p=fc(c,l),f=kp(tp(p,oc(+t,"int32")),Kl(p,oc(-n,"int32"))),h=Ap([s,u],r.dtype);return Xc(zf(Yf(Xc(r,[-1,s,u])).map((function(e){return Ol(f,e,h)}))),a)}});var sd=qi({gramSchmidt_:function(e){var t;Array.isArray(e)?function(){t=!1,me(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){me(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(e[t].shape[0]," vs. ").concat(n,")")}))},a=1;a<e.length;++a)r(a)}():(t=!0,e=Df(e,e.shape[0],0).map((function(e){return Lf(e,[0])}))),me(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds ")+"number of dimensions (".concat(e[0].shape[0],").")}));for(var n=[],r=e,a=function(e){n.push(Mi.tidy((function(){var t=r[e];if(e>0)for(var a=0;a<e;++a){var i=Xu(lp(Xu(n[a],t)),n[a]);t=fc(t,i)}return Ku(t,ah(t,"euclidean"))})))},i=0;i<e.length;++i)a(i);return t?zf(n,0):n}});function ud(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Mi.tidy((function(){me(2===e.shape.length,(function(){return"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor.")}));for(var n=e.shape[0],r=e.shape[1],a=Gl(n),i=is(e),o=Uf([[1]],[1,1]),s=is(o),u=n>=r?r:n,c=function(e){var t=i,u=s,c=a,l=Mi.tidy((function(){var t=el(i,[e,e],[n-e,1]),u=ah(t),c=el(i,[e,e],[1,1]),l=Ol(ql(c,0),Uf([[-1]]),Uf([[1]])),p=fc(c,Xu(l,u)),f=Ku(t,p);s=1===f.shape[0]?is(o):Jc([o,el(f,[1,0],[f.shape[0]-1,f.shape[1]])],0);var h=op(Ku(Cs(l,p),u)),d=el(i,[e,0],[n-e,r]),m=Xu(h,s),v=As(s);if(0===e)i=fc(d,Cs(m,Cs(v,d)));else{var g=fc(d,Cs(m,Cs(v,d)));i=Jc([el(i,[0,0],[e,r]),g],0)}var y=As(m),b=el(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=fc(b,Cs(Cs(b,s),y));else{var x=fc(b,Cs(Cs(b,s),y));a=Jc([el(a,[0,0],[n,e]),x],1)}return[s,i,a]})),p=(0,oe.Z)(l,3);s=p[0],i=p[1],a=p[2],Ou([t,u,c])},l=0;l<u;++l)c(l);return!t&&n>r&&(a=el(a,[0,0],[n,r]),i=el(i,[0,0],[r,r])),[a,i]}))}var cd,ld=qi({qr_:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(me(e.rank>=2,(function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(e.rank)})),2===e.rank)return ud(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=Yf(Xc(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];r.forEach((function(e){var n=ud(e,t),r=(0,oe.Z)(n,2),o=r[0],s=r[1];a.push(o),i.push(s)}));var o=Xc(zf(a,0),e.shape),s=Xc(zf(i,0),e.shape);return[o,s]}});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(cd||(cd={}));var pd=qi({computeWeightedLoss_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:cd.SUM_BY_NONZERO_WEIGHTS,r=Gi(e,"losses","computeWeightedLoss"),a=null;null!=t&&(a=Gi(t,"weights","computeWeightedLoss"));var i=null==a?r:Xu(r,a);if(n===cd.NONE)return i;if(n===cd.SUM)return lp(i);if(n===cd.MEAN){if(null==a)return Ep(i);var o=r.size/a.size,s=Ku(lp(i),lp(a));return o>1?Ku(s,oc(o)):s}if(n===cd.SUM_BY_NONZERO_WEIGHTS){if(null==a)return Ku(lp(i),oc(r.size));var u=Xu(a,Rp(r.shape)),c=as(lp(Zp(u,oc(0))),"float32");return Ku(lp(i),c)}throw Error("Unknown reduction: ".concat(n))}});var fd=qi({absoluteDifference_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:cd.SUM_BY_NONZERO_WEIGHTS,a=Gi(e,"labels","absoluteDifference"),i=Gi(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=Gi(n,"weights","absoluteDifference")),ve(a.shape,i.shape,"Error in absoluteDifference: ");var s=dc(fc(a,i));return pd(s,o,r)}});var hd=qi({cosineDistance_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:cd.SUM_BY_NONZERO_WEIGHTS,i=Gi(e,"labels","cosineDistance"),o=Gi(t,"predictions","cosineDistance"),s=null;null!=r&&(s=Gi(r,"weights","cosineDistance")),ve(i.shape,o.shape,"Error in cosineDistance: ");var u=oc(1),c=fc(u,lp(Xu(i,o),n,!0));return pd(c,s,a)}});var dd=qi({hingeLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:cd.SUM_BY_NONZERO_WEIGHTS,a=Gi(e,"labels","hingeLoss"),i=Gi(t,"predictions","hingeLoss"),o=null;null!=n&&(o=Gi(n,"weights","hingeLoss")),ve(a.shape,i.shape,"Error in hingeLoss: ");var s=oc(1);a=fc(Xu(oc(2),a),s);var u=cf(fc(s,Xu(a,i)));return pd(u,o,r)}});var md=qi({huberLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:cd.SUM_BY_NONZERO_WEIGHTS,i=Gi(e,"labels","huberLoss"),o=Gi(t,"predictions","huberLoss"),s=null;null!=n&&(s=Gi(n,"weights","huberLoss")),ve(i.shape,o.shape,"Error in huberLoss: ");var u=oc(r),c=dc(fc(o,i)),l=Dp(c,u),p=fc(c,l),f=ju(Xu(oc(.5),Qu(l)),Xu(u,p));return pd(f,s,a)}});var vd=qi({logLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-7,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:cd.SUM_BY_NONZERO_WEIGHTS,i=Gi(e,"labels","logLoss"),o=Gi(t,"predictions","logLoss"),s=null;null!=n&&(s=Gi(n,"weights","logLoss")),ve(i.shape,o.shape,"Error in logLoss: ");var u=oc(1),c=oc(r),l=op(Xu(i,ap(ju(o,c)))),p=Xu(fc(u,i),ap(ju(fc(u,o),c))),f=fc(l,p);return pd(f,s,a)}});var gd=qi({meanSquaredError_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:cd.SUM_BY_NONZERO_WEIGHTS,a=Gi(e,"labels","meanSquaredError"),i=Gi(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=Gi(n,"weights","meanSquaredError")),ve(a.shape,i.shape,"Error in meanSquaredError: ");var s=Mf(a,i);return pd(s,o,r)}});function yd(e,t){var n=Gi(e,"labels","sigmoidCrossEntropyWithLogits"),r=Gi(t,"logits","sigmoidCrossEntropyWithLogits");ve(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=cf(r),i=Xu(r,n),o=ip(Bl(op(dc(r))));return ju(fc(a,i),o)}var bd=qi({sigmoidCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:cd.SUM_BY_NONZERO_WEIGHTS,i=Gi(e,"multiClassLabels","sigmoidCrossEntropy"),o=Gi(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=Gi(n,"weights","sigmoidCrossEntropy")),ve(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=oc(r),c=oc(1),l=oc(.5);i=ju(Xu(i,fc(c,u)),Xu(l,u))}var p=yd(i,o);return pd(p,s,a)}});function xd(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(t.rank," ")+"and dim was ".concat(n));var r=ac((function(e,t,r){var a=xp(t,[n],!0),i=fc(as(t,"float32"),a);r([e,i]);var o=op(Xu(i,e));return{value:lp(o,[n]),gradFunc:function(e,t){var r=(0,oe.Z)(t,2),a=r[0],i=r[1],o=mp(e.shape,[n]);return[Xu(Xc(e,o),fc(as(a,"float32"),Bl(i))),Xu(Xc(e,o),fc(Bl(i),as(a,"float32")))]}}}));return r(e,t)}var kd=qi({softmaxCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:cd.SUM_BY_NONZERO_WEIGHTS,i=Gi(e,"onehotLabels","softmaxCrossEntropy"),o=Gi(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=Gi(n,"weights","softmaxCrossEntropy")),ve(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=oc(r),c=oc(1),l=oc(i.shape[1]);i=ju(Xu(i,fc(c,u)),Ku(u,l))}var p=xd(i,o);return pd(p,s,a)}});var wd=qi({sparseFillEmptyRows_:function(e,t,n,r){var a=Gi(e,"indices","sparseFillEmptyRows","int32"),i=Gi(t,"values","sparseFillEmptyRows"),o=Gi(n,"denseShape","sparseFillEmptyRows","int32"),s=Gi(r,"defaultValue","sparseFillEmptyRows",i.dtype);if(2!==a.rank)throw new Error("Indices should be Tensor2D but received shape\n        ".concat(a.shape));if(1!==i.rank)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(1!==o.rank)throw new Error("Dense shape should be Tensor1D but received shape ".concat(o.shape));if(0!==s.rank)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));var u={indices:a,values:i,denseShape:o,defaultValue:s},c=Mi.runKernel(Vr,u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}});var Nd=qi({sparseReshape_:function(e,t,n){var r=Gi(e,"inputIndices","sparseReshape","int32"),a=Gi(t,"inputShape","sparseReshape","int32"),i=Gi(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error("Input indices should be Tensor2D but received shape\n        ".concat(r.shape));if(1!==a.rank)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(1!==i.rank)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));var o={inputIndices:r,inputShape:a,newShape:i},s=Mi.runKernel(Gr,o);return{outputIndices:s[0],outputShape:s[1]}}});var Id=qi({sparseSegmentMean_:function(e,t,n){var r=Gi(e,"data","sparseSegmentMean"),a=Gi(t,"indices","sparseSegmentMean","int32"),i=Gi(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error("Indices should be Tensor1D but received shape\n          ".concat(a.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n          ".concat(i.shape));var o={data:r,indices:a,segmentIds:i};return Mi.runKernel(Hr,o)}});var Sd=qi({sparseSegmentSum_:function(e,t,n){var r=Gi(e,"data","sparseSegmentSum"),a=Gi(t,"indices","sparseSegmentSum","int32"),i=Gi(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error("Indices should be Tensor1D but received shape\n         ".concat(a.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n         ".concat(i.shape));var o={data:r,indices:a,segmentIds:i};return Mi.runKernel(jr,o)}});var Td=qi({stringNGrams_:function(e,t,n,r,a,i,o,s){var u=Gi(e,"data","stringNGrams","string");if("string"!==u.dtype)throw new Error("Data must be of datatype string");if(1!==u.shape.length)throw new Error("Data must be a vector, saw: ".concat(u.shape));var c=Gi(t,"dataSplits","stringNGrams");if("int32"!==c.dtype)throw new Error("Data splits must be of datatype int32");var l={separator:n,nGramWidths:r,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},p={data:u,dataSplits:c},f=Mi.runKernel(Qr,p,l);return{nGrams:f[0],nGramsSplits:f[1]}}});var Cd=qi({stringSplit_:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=Gi(e,"input","stringSplit","string"),a=Gi(t,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error("Input should be Tensor1D but received shape ".concat(r.shape));if(0!==a.rank)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));var i={skipEmpty:n},o={input:r,delimiter:a},s=Mi.runKernel(Jr,o,i);return{indices:s[0],values:s[1],shape:s[2]}}});var Ed=qi({stringToHashBucketFast_:function(e,t){var n=Gi(e,"input","stringToHashBucketFast","string"),r={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");var a={input:n};return Mi.runKernel($r,a,r)}}),Ad={fft:Rf,ifft:_f,rfft:Of,irfft:Ff},Rd={hammingWindow:Sh,hannWindow:Th,frame:Ch,stft:Eh},_d={flipLeftRight:Rh,grayscaleToRGB:_h,resizeNearestNeighbor:nd,resizeBilinear:td,rotateWithOffset:Fh,cropAndResize:Ah,nonMaxSuppression:Oh,nonMaxSuppressionAsync:Hh,nonMaxSuppressionWithScore:jh,nonMaxSuppressionWithScoreAsync:Kh,nonMaxSuppressionPadded:Xh,nonMaxSuppressionPaddedAsync:Qh,threshold:ad,transform:id},Fd={bandPart:od,gramSchmidt:sd,qr:ld},Dd={absoluteDifference:fd,computeWeightedLoss:pd,cosineDistance:hd,hingeLoss:dd,huberLoss:md,logLoss:vd,meanSquaredError:gd,sigmoidCrossEntropy:bd,softmaxCrossEntropy:kd},Od={sparseFillEmptyRows:wd,sparseReshape:Nd,sparseSegmentMean:Id,sparseSegmentSum:Sd},Md={stringNGrams:Td,stringSplit:Cd,stringToHashBucketFast:Ed},Ld={sgd:xc.sgd,momentum:xc.momentum,adadelta:xc.adadelta,adagrad:xc.adagrad,rmsprop:xc.rmsprop,adamax:xc.adamax,adam:xc.adam},zd="undefined"!==typeof requestAnimationFrame?requestAnimationFrame:"undefined"!==typeof setImmediate?setImmediate:function(e){return e()};function Pd(){return new Promise((function(e){return zd((function(){return e()}))}))}function Zd(e,t){var n=e[0].length;e.forEach((function(e,t){me(e.length===n,(function(){return"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same ")+"as the rank of the rest (".concat(n,")")}))})),me(t>=0&&t<n,(function(){return"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")}));var r=e[0];e.forEach((function(e,a){for(var i=0;i<n;i++)me(i===t||e[i]===r[i],(function(){return"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") ")+"does not match the shape of the rest (".concat(r,") ")+"along the non-concatenated axis ".concat(a,".")}))}))}function Bd(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}var Wd=30;function Ud(e){return e<=Wd?e:Ge(e,Math.floor(Math.sqrt(e)))}function Vd(e,t,n){return[n*("number"===typeof e?e:e[0]),t*("number"===typeof e?e:e[1])]}function Gd(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];if(r)(a=a.concat(t.slice(0))).push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);for(var i=t.length,o=0;o<i;++o)a=a.concat([e[o+1]/t[o],t[o]]);a=a.concat(e.slice(i+1))}return a}function Hd(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=[];if(n){r.push(t);for(var a=t+1;a<e;++a)a<=2*t?(r.push(a),r.push(a-(t+1))):r.push(a)}else{for(var i=[],o=[],s=1;s<e;++s)s>=2*t+1||s%2===1?o.push(s):i.push(s);r.push.apply(r,i),r.push(0),r.push.apply(r,o)}return r}function jd(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(var i=1;i<e.length;++i)i<=t.length?r?a.push(t[i-1]*e[i]):a.push(e[i]/t[i-1]):a.push(e[i]);return a}function qd(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function Kd(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}var Xd=1.7580993408473768,Yd=1.0507009873554805,Qd=.3275911,Jd=.254829592,$d=-.284496736,em=1.421413741,tm=-1.453152027,nm=1.061405429;function rm(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+"".concat(e.length,", imag: ").concat(t.length,"."));for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function am(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function im(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function om(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function sm(e,t){return{real:e[2*t],imag:e[2*t+1]}}function um(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function cm(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),a=0;a<Math.ceil(e/2);a++){var i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}function lm(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}var pm="->",fm=/->/g;function hm(e,t){var n=((e=e.replace(/\s/g,"")).length-e.replace(fm,"").length)/pm.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("'.concat(pm,'").'));var r=e.split(pm),a=(0,oe.Z)(r,2),i=a[0],o=a[1];me(-1===i.indexOf("..."),(function(){return'The ellipsis notation ("'.concat("...",'") is not supported yet.')}));var s=i.split(","),u=s.length;if(t!==u)throw new Error("Expected ".concat(u," input tensors, received ").concat(t));if(u>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");for(var c=[],l=function(e){var t=o[e];if(!s.some((function(e){return-1!==e.indexOf(t)})))throw new Error("Output subscripts contain the label ".concat(t," ")+"not present in the input subscripts.");-1===c.indexOf(t)&&c.push(t)},p=0;p<o.length;++p)l(p);for(var f=0;f<i.length;++f){var h=i[f];-1===c.indexOf(h)&&","!==h&&c.push(h)}for(var d=new Array(s.length),m=0;m<u;++m){if(new Set(s[m].split("")).size!==s[m].length)throw new Error("Found duplicate axes in input component ".concat(s[m],". ")+"Support for duplicate axes in input is not implemented yet.");d[m]=[];for(var v=0;v<s[m].length;++v)d[m].push(c.indexOf(s[m][v]))}for(var g=c.length,y=[],b=o.length;b<g;++b)y.push(b);return{allDims:c,summedDims:y,idDims:d}}function dm(e,t){var n=new Array(e);n.fill(-1);for(var r=0;r<t.length;++r)n[t[r]]=r;for(var a=[],i=0;i<e;++i)-1===n[i]&&a.push(i);return{permutationIndices:n=n.filter((function(e){return-1!==e})),expandDims:a}}function mm(e,t,n){for(var r=new Array(e),a=function(e){for(var a=n[e].shape,i=function(n){void 0===r[t[e][n]]?r[t[e][n]]=a[n]:me(r[t[e][n]]===a[n],(function(){return"Expected dimension ".concat(r[t[e][n]]," at axis ").concat(n," ")+"of input shaped ".concat(JSON.stringify(a),", ")+"but got dimension ".concat(a[n])}))},o=0;o<t[e].length;++o)i(o)},i=0;i<n.length;++i)a(i)}function vm(e,t){var n,r=e,a=[];0===e.length&&r.push(-1),n=e.length+1;for(var i=0;i<n;++i)a.push([]);for(var o=[],s=0;s<r.length;++s){var u,c=q(ym(t,r[s]));try{for(c.s();!(u=c.n()).done;){var l=u.value;-1===o.indexOf(l)&&(a[s].push(l),o.push(l))}}catch($V){c.e($V)}finally{c.f()}}return{path:r,steps:a}}function gm(e){return e.every((function(e,t){return e===t}))}function ym(e,t){for(var n=[],r=0;r<e.length;++r)0!==e[r].length&&-1===e[r].indexOf(t)&&-1!==t||n.push(r);return n}function bm(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"===typeof t)me(e.shape[n]%t===0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(e.shape[n]/t);else{var a=t.reduce((function(e,t){return-1===t&&(e+=1),e}),0);me(a<=1,(function(){return"There should be only one negative value in split array."}));var i=t.indexOf(-1);if(-1!==i){var o=t.reduce((function(e,t){return t>0?e+t:e}));t[i]=e.shape[n]-o}me(e.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t}return r}function xm(e){return"Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ".concat(e)}function km(e,t){return"indices(".concat(e,", 0) is invalid: ").concat(t," < 0")}function wm(e,t,n){return"indices(".concat(e,", 0) is invalid: ").concat(t," >= ").concat(n)}function Nm(e,t){return"only one output dimension may be -1, not both ".concat(e," and ").concat(t)}function Im(e,t){return"size ".concat(e," must be non-negative, not ").concat(t)}function Sm(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function Tm(e,t){var n=be(e),r=be(t);return"Input to reshape is a SparseTensor with ".concat(n,"\n  dense values, but the requested shape requires a multiple of ").concat(r,". inputShape=").concat(e," outputShape= ").concat(t)}function Cm(e,t){var n=be(e),r=be(t);return"Input to reshape is a tensor with ".concat(n," dense values, but the requested shape has ").concat(r,". inputShape=").concat(e," outputShape=").concat(t)}function Em(){return"segment ids must be >= 0"}function Am(){return"segment ids are not increasing"}function Rm(e,t){return"Segment id ".concat(e," out of range [0, ").concat(t,"), possibly because segmentIds input is not sorted.")}function _m(e,t,n){return"Bad: indices[".concat(e,"] == ").concat(t," out of range [0, ").concat(n,")")}function Fm(e,t){var n,r=!1;for(e<=Wd?(n=e,r=!0):n=Ge(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Ge(e,n+1);return n}function Dm(e,t,n){for(var r=[],a=e.length,i=0;i<a;i++)i!==t?r.push(e[i]):r.push(n);return r}function Om(e,t,n,r){var a=t.shape.length,i=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>i)throw new Error("batchDims (".concat(r,") must be less than rank(x) (\n    ").concat(i,")."));if(n<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(n,")."));for(var o=0;o<r;++o)if(e.shape[o]!==t.shape[o])throw new Error("x.shape[".concat(o,"]: ").concat(e.shape[o]," should be equal to indices.shape[").concat(o,"]: ").concat(t.shape[o],"."));for(var s=e.shape[n],u=[],c=1,l=1,p=1,f=0;f<r;++f)u.push(e.shape[f]),c*=e.shape[f];for(var h=r;h<n;h++)u.push(e.shape[h]),l*=e.shape[h];for(var d=r;d<a;d++)u.push(t.shape[d]);for(var m=n+1;m<i;m++)u.push(e.shape[m]),p*=e.shape[m];return{batchSize:c,sliceSize:p,outerSize:l,dimSize:s,outputShape:u}}function Mm(e){try{return e.map((function(e){return Ja(e)}))}catch($V){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat($V))}}function Lm(e){return e.map((function(e){return Qa(e)}))}var zm={kernelName:lt,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){return Xu(e,Pf(as(n,"float32"),-1))}}}},Pm={kernelName:pt,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){var t=Qu(as(n,"float32")),r=Yu(fc(oc(1),t));return op(Ku(e,r))}}}},Zm={kernelName:ft,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){var t=Yu(fc(Qu(as(n,"float32")),1));return Ku(e,t)}}}},Bm={kernelName:ht,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,oe.Z)(t,2),r=n[0],a=n[1],i=Os(r.shape,a.shape);return{a:function(){var t=e,n=Ds(r.shape,i);return n.length>0&&(t=lp(t,n)),Xc(t,r.shape)},b:function(){var t=e,n=Ds(a.shape,i);return n.length>0&&(t=lp(t,n)),Xc(t,a.shape)}}}},Wm={kernelName:dt,saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}},Um={kernelName:gt,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){return Ju(n)}}}},Vm={kernelName:yt,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){return Ju(n)}}}},Gm={kernelName:bt,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){return Ku(e,Yu(fc(oc(1),Qu(as(n,"float32")))))}}}},Hm={kernelName:xt,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){var t=Yu(ju(oc(1),Qu(as(n,"float32"))));return Ku(e,t)}}}},jm={kernelName:Nt,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,oe.Z)(t,2),r=n[0],a=n[1],i=Os(r.shape,a.shape);return{a:function(){var t=ju(Qu(r),Qu(a)),n=Xu(e,Ku(a,t)),o=Ds(r.shape,i);return o.length>0&&(n=lp(n,o)),Xc(n,r.shape)},b:function(){var t=ju(Qu(r),Qu(a)),n=op(Xu(e,Ku(r,t))),o=Ds(a.shape,i);return o.length>0&&(n=lp(n,o)),Xc(n,a.shape)}}}},qm={kernelName:kt,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){return Ku(e,ju(Qu(as(n,"float32")),1))}}}},Km={kernelName:wt,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){return Ku(e,fc(oc(1),Qu(as(n,"float32"))))}}}};var Xm=qi({avgPool3dGrad_:function(e,t,n,r,a,i){var o=Gi(e,"dy","avgPool3dGrad"),s=Gi(t,"input","avgPool3dGrad"),u=o,c=s,l=!1;4===s.rank&&(l=!0,u=Xc(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=Xc(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),me(5===u.rank,(function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank "+"".concat(u.rank,".")})),me(5===c.rank,(function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank "+"".concat(c.rank,".")})),Kc("avgPool3dGrad",a,i);var p={dy:u,input:c},f={filterSize:n,strides:r,pad:a,dimRoundingMode:i},h=Mi.runKernel(Ct,p,f);return l?Xc(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}}),Ym={kernelName:Tt,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,oe.Z)(t,1)[0],a=n.filterSize,i=n.strides,o=n.pad,s=n.dimRoundingMode;return{x:function(){return Xm(e,r,a,i,o,s)}}}};var Qm=qi({avgPoolGrad_:function(e,t,n,r,a){var i=Gi(e,"dy","avgPoolGrad"),o=Gi(t,"input","avgPoolGrad");me(o.rank===i.rank,(function(){return"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")}));var s=o,u=i,c=!1;3===o.rank&&(c=!0,s=Xc(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=Xc(i,[1,i.shape[0],i.shape[1],i.shape[2]])),me(4===u.rank,(function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank "+"".concat(u.rank,".")})),me(4===s.rank,(function(){return"Error in avgPoolGrad: input must be rank 4 but got rank "+"".concat(s.rank,".")}));var l={dy:u,input:s},p={filterSize:n,strides:r,pad:a},f=Mi.runKernel(St,l,p);return c?Xc(f,[f.shape[1],f.shape[2],f.shape[3]]):f}}),Jm={kernelName:It,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,oe.Z)(t,1)[0],a=n.filterSize,i=n.strides,o=n.pad;return{x:function(){return Qm(e,r,a,i,o)}}}},$m={kernelName:Et,inputsToSave:["a","b"],gradFunc:function(e,t,n){var r=(0,oe.Z)(t,2),a=r[0],i=r[1],o=n.transposeA,s=n.transposeB;return o||s?!o&&s?{a:function(){return Cs(e,i,!1,!1)},b:function(){return Cs(e,a,!0,!1)}}:o&&!s?{a:function(){return Cs(i,e,!1,!0)},b:function(){return Cs(a,e,!1,!1)}}:{a:function(){return Cs(i,e,!0,!0)},b:function(){return Cs(e,a,!0,!0)}}:{a:function(){return Cs(e,i,!1,!0)},b:function(){return Cs(a,e,!0,!1)}}}},ev={kernelName:At,gradFunc:function(e,t,n){var r=n.blockShape,a=n.crops;return{x:function(){return qp(e,r,a)}}}},tv={kernelName:_t,gradFunc:function(e,t,n){for(var r=n,a=r.inputShape,i=r.shape,o=Array.from(i),s=a.length-1;s>=0;s--)if(a[s]===i[s])o[s]=1;else if(1!==a[s])throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(i,"]."));for(var u=[],c=0;c<o.length;c++)o[c]>1&&u.push(c);return{x:function(){return lp(e,u,!0)}}}},nv={kernelName:Dt,gradFunc:function(e){return{x:function(){return e.clone()}}}},rv={kernelName:Ot,gradFunc:function(e){return{x:function(){return Ju(e)}}}},av={kernelName:Mt,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,oe.Z)(t,1)[0],a=n.clipValueMin,i=n.clipValueMax;return{x:function(){return Ol(kp(Kl(r,a),tp(r,i)),e,Ju(e))}}}},iv={kernelName:zt,inputsToSave:["x"],gradFunc:zm.gradFunc},ov={kernelName:Pt,saveAllInputs:!0,gradFunc:function(e,t,n){var r=t.map((function(e){return e.shape})),a=Ae(n.axis,t[0].shape)[0],i=r.map((function(e){return e[a]}));return Df(e,i,a).map((function(e){return function(){return e}}))}},sv={kernelName:Zt,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=(0,oe.Z)(t,2),a=r[0],i=r[1],o=n.dilations,s=n.strides,u=n.pad,c=n.dataFormat;return me(Hc(o),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(o,"'")})),{x:function(){return bl(a.shape,e,i,s,u,c)},filter:function(){return mh(a,e,i.shape,s,u,c)}}}},uv={kernelName:Wt,inputsToSave:["dy","filter"],gradFunc:function(e,t,n){var r=(0,oe.Z)(t,2),a=r[0],i=r[1],o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode;return{dy:function(){return gl(e,i,o,s,u,1,c)},filter:function(){return mh(e,a,i.shape,o,s,u,c)}}}};var cv=qi({conv3DBackpropFilter_:function(e,t,n,r,a){var i=e;4===e.rank&&(i=Xc(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));var o=t;4===o.rank&&(o=Xc(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),me(5===i.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+"".concat(i.shape,".")})),me(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+"".concat(o.shape,".")})),me(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+"".concat(n,".")})),me(i.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must ")+"match input depth in filter (".concat(n[3],".")})),me(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must ")+"match output depth for filter (".concat(n[4],").")}));var s={x:i,dy:o},u={strides:r,pad:a,filterShape:n};return Mi.runKernel(Vt,s,u)}}),lv={kernelName:Ut,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad;me(Hc(r),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are "+"not yet supported in gradients. Got dilations '".concat(r,"'")}));var o=(0,oe.Z)(t,2),s=o[0],u=o[1];return{x:function(){return wl(s.shape,e,u,a,i)},filter:function(){return cv(s,e,u.shape,a,i)}}}},pv={kernelName:Ht,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){return Xu(op(Nf(as(n,"float32"))),e)}}}},fv={kernelName:jt,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){return Xu(If(as(n,"float32")),e)}}}},hv={kernelName:Kt,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,oe.Z)(t,1)[0],a=n.axis,i=n.exclusive,o=n.reverse;return{x:function(){var t=gp([a],r.rank),n=Cl(e,a,i,!o);return null!=t&&(n=As(n,t)),n}}}},dv={kernelName:Jt,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad,o=n.dimRoundingMode,s=null==r?[1,1]:r;me(Hc(s),(function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(s,"'")}));var u=(0,oe.Z)(t,2),c=u[0],l=u[1];return me(4===c.rank,(function(){return"Error in gradient of depthwiseConv2dNative: input must be "+"rank 4, but got rank ".concat(c.rank,".")})),me(4===l.rank,(function(){return"Error in gradient of depthwiseConv2dNative: filter must be "+"rank 4, but got rank ".concat(l.rank,".")})),me(c.shape[3]===l.shape[2],(function(){return"Error in gradient of depthwiseConv2d: number of input "+"channels (".concat(c.shape[3],") must match the inChannels dimension ")+"in filter ".concat(l.shape[2],".")})),me(jc(a,s),(function(){return"Error in gradient of depthwiseConv2d: Either strides or "+"dilations must be  1. Got strides ".concat(a," and dilations ")+"'".concat(s,"'.")})),Kc("depthwiseConv2d",i,o),{x:function(){return wh(c.shape,e,l,a,i,s,o)},filter:function(){return kh(c,e,l.shape,a,i,s,o)}}}},mv={kernelName:nn,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=(0,oe.Z)(t,2),a=r[0],i=r[1],o={x:a,filter:i,dy:e},s={x:a,filter:i,dy:e};return{x:function(){return Mi.runKernel(rn,o,n)},filter:function(){return Mi.runKernel(an,s,n)}}}},vv={kernelName:un,outputsToSave:[!0],gradFunc:function(e,t){var n={dy:e,y:(0,oe.Z)(t,1)[0]};return{x:function(){return Mi.runKernel(cn,n)}}}},gv={kernelName:ln,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0],r=Xu(Bl(op(Qu(n))),2/Math.sqrt(Math.PI));return{x:function(){return Xu(e,r)}}}},yv={kernelName:fn,outputsToSave:[!0],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){return Xu(e,n)}}}},bv={kernelName:hn,inputsToSave:["input"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{input:function(){return Xc(e,n.shape)}}}},xv={kernelName:dn,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){return Xu(e,Bl(n))}}}},kv={kernelName:yn,gradFunc:function(e){return{x:function(){return Ju(e)}}}},wv={kernelName:bn,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,oe.Z)(t,2),r=n[0],a=n[1],i=Os(r.shape,a.shape);return{a:function(){var t=Ku(e,as(a,"float32")),n=Ds(r.shape,i);return n.length>0?Xc(lp(t,n),r.shape):t},b:function(){var t=Xu(e,as(r,"float32")),n=Ds(a.shape,i);n.length>0&&(t=Xc(lp(t,n),a.shape));var o=Qu(a);return op(Ku(t,as(o,"float32")))}}}},Nv={kernelName:xn,inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,n){var r=n.varianceEpsilon,a=(0,oe.Z)(t,4),i=a[0],o=a[1],s=a[2],u=a[3],c=null==u?oc(1):u,l=Ds(o.shape,i.shape),p=[];if(1===o.rank){for(var f=0;f<i.shape.length-1;++f)p.push(i.shape[f]);p.push(1)}var h=fc(i,o),d=Xu(e,c),m=gf(ju(s,oc(r))),v=Xu(Xu(Xu(m,m),m),oc(-.5));return{x:function(){return 1===o.rank?Xc(Xu(Xu(e,Vl(Xc(m,[1,1,1,o.shape[0]]),p)),c),i.shape):Xc(Xu(Xu(e,m),c),i.shape)},mean:function(){var e=Xu(Xu(m,oc(-1)),d);return 1===o.rank&&(e=lp(e,l)),Xc(e,o.shape)},variance:function(){var e=Xu(Xu(v,h),d);return 1===o.rank&&(e=lp(e,l)),Xc(e,o.shape)},scale:function(){var t=Xu(h,m),n=Xu(e,t);return 1===o.rank&&(n=lp(n,l)),Xc(n,o.shape)},offset:function(){var t=e;return 1===o.rank&&(t=lp(t,l)),Xc(t,o.shape)}}}},Iv={kernelName:kn,inputsToSave:["x","indices"],gradFunc:function(e,t,n){var r=(0,oe.Z)(t,2),a=r[0],i=r[1],o=n.axis,s=Ae(o,a.shape)[0];return{x:function(){var t=a.shape,n=i.size,r=t.slice(0,s),u=r.length,c=t.slice(o,t.length).slice(1),l=c.length,p=Sv(0,u),f=Sv(u+1,u+1+l),h=Tv([r,[n],c]),d=Xc(e,h),m=Xc(i,[n]),v=Tv([[u],p,f]),g=As(d,v),y=Xf(g,m,a.shape[s]),b=yp(v);return y=As(y,b)},indices:function(){return i}}}};function Sv(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function Tv(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var Cv={kernelName:In,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,oe.Z)(t,2),r=n[0],a=n[1];return{a:function(){return Ju(r)},b:function(){return Ju(a)}}}},Ev={kernelName:Sn,gradFunc:function(e){return{x:function(){return as(e,"float32")}}}},Av={kernelName:En,gradFunc:function(e){return{x:function(){return Ju(e)}}}},Rv={kernelName:An,gradFunc:function(e){return{x:function(){return Ju(e)}}}},_v={kernelName:Rn,gradFunc:function(e){return{x:function(){return Ju(e)}}}},Fv={kernelName:_n,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,oe.Z)(t,1)[0],a=n.alpha,i=ql(r,0);return{x:function(){return Ol(i,e,Xu(e,a))}}}},Dv={kernelName:Ln,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){return Ku(e,ju(n,1))}}}},Ov={kernelName:Mn,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){return Ku(e,as(n,"float32"))}}}},Mv={kernelName:Bn,inputsToSave:[],outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,oe.Z)(t,1)[0],a=n.axis;return{logits:function(){var t=Bl(r);return fc(e,Xu(lp(e,a,!0),t))}}}};var Lv=qi({localResponseNormalizationBackprop_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5,s={x:e,y:t,dy:n},u={depthRadius:r,bias:a,alpha:i,beta:o};return Mi.runKernel(Un,s,u)}}),zv={kernelName:Wn,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,oe.Z)(t,2),a=r[0],i=r[1],o=n.depthRadius,s=n.bias,u=n.alpha,c=n.beta;return{x:function(){return Lv(a,i,e,o,s,u,c)}}}};function Pv(e,t,n,r){return t.rank<n.rank&&(t=Xc(t,mp(t.shape,r))),e.rank<n.rank&&(e=Xc(e,mp(e.shape,r))),{x:function(){return Xu(e,as(Dl(n,t),e.dtype))}}}var Zv={kernelName:Vn,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.reductionIndices,a=t[0],i=Pv(e,t[1],a,Ae(r,a.shape));return{x:function(){return i.x()}}}},Bv={kernelName:Gn,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,oe.Z)(t,2),r=n[0],a=n[1];return{a:function(){return Xu(e,as(Kl(r,a),"float32"))},b:function(){return Xu(e,as(ep(r,a),"float32"))}}}};var Wv=qi({maxPool3dGrad_:function(e,t,n,r,a,i,o){var s=Gi(e,"dy","maxPool3dGrad"),u=Gi(t,"input","maxPool3dGrad"),c=Gi(n,"output","maxPool3dGrad"),l=s,p=u,f=c,h=!1;4===u.rank&&(h=!0,l=Xc(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),p=Xc(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),f=Xc(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),me(5===l.rank,(function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank "+"".concat(l.rank,".")})),me(5===p.rank,(function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank "+"".concat(p.rank,".")})),me(5===f.rank,(function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank "+"".concat(f.rank,".")})),Kc("maxPool3dGrad",i,o);var d={dy:l,input:p,output:f},m={filterSize:r,strides:a,pad:i,dimRoundingMode:o},v=Mi.runKernel(Kn,d,m);return h?Xc(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}}),Uv={kernelName:qn,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,oe.Z)(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode;return{x:function(){return Wv(e,a,i,o,s,u,c)}}}};var Vv=qi({maxPoolGrad_:function(e,t,n,r,a,i,o){var s=Gi(e,"dy","maxPoolGrad"),u=Gi(t,"input","maxPoolGrad"),c=Gi(n,"output","maxPoolGrad");me(u.rank===s.rank,(function(){return"Rank of input (".concat(u.rank,") does not match rank of dy ")+"(".concat(s.rank,")")})),me(4===s.rank,(function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank "+"".concat(s.rank,".")})),me(4===u.rank,(function(){return"Error in maxPoolGrad: input must be rank 4 but got rank "+"".concat(u.rank,".")})),Kc("maxPoolGrad",i,o);var l={dy:s,input:u,output:c},p={filterSize:r,strides:a,pad:i,dimRoundingMode:o};return Mi.runKernel(jn,l,p)}}),Gv={kernelName:Hn,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,oe.Z)(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.pad;return{x:function(){return Vv(e,a,i,o,s,u)}}}},Hv={kernelName:$n,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return el(e,a,r.shape)}}}},jv={kernelName:pr,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return el(e,a,r.shape)}}}},qv={kernelName:hr,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(e,t){var n=(0,oe.Z)(t,3),r=n[0],a=n[1],i=n[2],o=r,s=a,u=Os(o.shape,s.shape);return{a:function(){var t=as(s,"float32"),n=Xu(e,Xu(t,pc(o,fc(t,oc(1))))),r=Ds(o.shape,u);return r.length>0&&(n=lp(n,r)),Xc(n,o.shape)},b:function(){var t=ql(o,0),n=Ol(t,ap(o),Ju(o)),r=Xu(e,Xu(i,n)),a=Ds(s.shape,u);return a.length>0&&(r=lp(r,a)),Xc(r,s.shape)}}}},Kv={kernelName:_r,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){var t=ql(n,oc(0)),r=oc(Xd),a=oc(Yd),i=Xu(e,a),o=Xu(Xu(e,r),Bl(as(n,"float32")));return Ol(t,i,o)}}}},Xv={kernelName:Br,gradFunc:function(e,t,n){var r=n.blockShape,a=n.paddings;return{x:function(){return rl(e,r,a)}}}},Yv={kernelName:Wr,gradFunc:function(e,t,n){var r=n.axis;return{x:function(){return Jc(e,r)}}}},Qv={kernelName:ra,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,oe.Z)(t,1)[0],a=n.reps;return{x:function(){var t=Ju(r);if(1===r.rank)for(var n=0;n<a[0];++n)t=ju(t,el(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(var i=0;i<a[0];++i)for(var o=0;o<a[1];++o)t=ju(t,el(e,[i*r.shape[0],o*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(var s=0;s<a[0];++s)for(var u=0;u<a[1];++u)for(var c=0;c<a[2];++c)t=ju(t,el(e,[s*r.shape[0],u*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+"".concat(r.rank," tensors yet."));for(var l=0;l<a[0];++l)for(var p=0;p<a[1];++p)for(var f=0;f<a[2];++f)for(var h=0;h<a[3];++h)t=ju(t,el(e,[l*r.shape[0],p*r.shape[1],f*r.shape[2],h*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}};for(var Jv,$v=0,eg=[zm,Pm,Zm,Bm,Wm,Um,Vm,Gm,Hm,jm,qm,Km,Ym,Jm,$m,ev,tv,nv,rv,av,iv,ov,uv,sv,lv,pv,fv,hv,dv,mv,{kernelName:on,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,oe.Z)(t,2),r=n[0],a=n[1],i=Os(r.shape,a.shape);return{a:function(){var t=Ku(e,as(a,"float32")),n=Ds(r.shape,i);return n.length>0?Xc(lp(t,n),r.shape):t},b:function(){var t=Xu(e,as(r,"float32")),n=Ds(a.shape,i);n.length>0&&(t=Xc(lp(t,n),a.shape));var o=Qu(a);return op(Ku(t,as(o,"float32")))}}}},vv,gv,yv,bv,xv,wv,kv,Nv,Iv,Cv,Ev,Av,Rv,_v,Fv,Dv,Ov,Mv,zv,Zv,Zv,Bv,Uv,Gv,{kernelName:Yn,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,oe.Z)(t,1)[0],a=Ae(n.axis,r.shape),i=be(dp(r.shape,a)[1]);return{x:function(){var t=r.shape.slice();a.forEach((function(e){t[e]=1}));var n=Xc(e,t);return Ku(Xu(n,Rp(r.shape,"float32")),i)}}}},{kernelName:Qn,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.axis,a=(0,oe.Z)(t,2),i=a[0],o=Pv(e,a[1],i,Ae(r,i.shape));return{x:function(){return o.x()}}}},{kernelName:Jn,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,oe.Z)(t,2),r=n[0],a=n[1];return{a:function(){return Xu(e,as(tp(r,a),"float32"))},b:function(){return Xu(e,as(ql(r,a),"float32"))}}}},Hv,{kernelName:er,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,oe.Z)(t,2),r=n[0],a=n[1],i=Os(r.shape,a.shape);return{a:function(){var t=Ds(r.shape,i);return t.length>0?Xc(lp(e,t),r.shape):e},b:function(){var t=Xu(e,op(Hl(Ku(r,a)))),n=Ds(a.shape,i);return n.length>0?Xc(lp(t,n),a.shape):t}}}},{kernelName:nr,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,oe.Z)(t,2),r=n[0],a=n[1],i=Os(r.shape,a.shape);return{a:function(){var t=Xu(e,as(a,"float32")),n=Ds(r.shape,i);return n.length>0?Xc(lp(t,n),r.shape):t},b:function(){var t=Xu(e,as(r,"float32")),n=Ds(a.shape,i);return n.length>0?Xc(lp(t,n),a.shape):t}}}},{kernelName:rr,gradFunc:function(e){return{x:function(){return op(e)}}}},{kernelName:cr,inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return Ap(n.shape,"float32")}}}},{kernelName:ur,gradFunc:function(e){return{x:function(){return Ju(e)}}}},{kernelName:lr,saveAllInputs:!0,gradFunc:function(e,t,n){var r=n.axis;return Yf(e,r).map((function(e){return function(){return e}}))}},jv,jv,qv,{kernelName:dr,inputsToSave:["x","alpha"],gradFunc:function(e,t){var n=(0,oe.Z)(t,2),r=n[0],a=n[1],i=ql(r,0);return{x:function(){return Ol(i,e,Xu(e,a))},alpha:function(){var t=Ol(i,Ju(e),Xu(e,r)),n=Ds(a.shape,e.shape);return n.length>0&&(t=lp(t,n)),Xc(t,a.shape)}}}},{kernelName:yr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){return Ku(e,op(Qu(n)))}}}},{kernelName:Sr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0],r=Xu(tp(n,6),Pf(n));return{x:function(){return Xu(e,as(r,"float32"))}}}},{kernelName:br,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){return Xu(e,as(Pf(n),"float32"))}}}},{kernelName:xr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){return Xc(e,n.shape)}}}},{kernelName:Nr,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:(0,oe.Z)(t,1)[0]};return{images:function(){return Mi.runKernel(Ir,r,n)}}}},{kernelName:kr,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:(0,oe.Z)(t,1)[0]};return{images:function(){return Mi.runKernel(wr,r,n)}}}},{kernelName:Tr,gradFunc:function(e,t,n){var r=Ae(n.dims,e.shape);return{x:function(){return pf(e,r)}}}},{kernelName:Cr,gradFunc:function(e){return{x:function(){return Ju(e)}}}},{kernelName:Er,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){return op(Ku(e,Xu(pc(n,1.5),2)))}}}},{kernelName:Rr,inputsToSave:["condition"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{condition:function(){return as(Ju(n),"float32")},t:function(){return Xu(e,as(n,e.dtype))},e:function(){return Xu(e,as(wp(n),e.dtype))}}}},Kv,{kernelName:Lr,outputsToSave:[!0],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){return Xu(e,Xu(n,fc(oc(1),n)))}}}},{kernelName:Mr,gradFunc:function(e){return{x:function(){return Ju(e)}}}},{kernelName:Dr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){return Xu(Il(as(n,"float32")),e)}}}},{kernelName:Or,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){return Xu(Sl(as(n,"float32")),e)}}}},{kernelName:Fr,inputsToSave:["x"],gradFunc:function(e,t,n){for(var r=(0,oe.Z)(t,1)[0],a=n.begin,i=n.size,o=r.shape,s=su(r,a,i),u=(0,oe.Z)(s,2),c=u[0],l=u[1],p=[],f=0;f<e.rank;f++)p.push([c[f],o[f]-c[f]-l[f]]);return{x:function(){return Up(e,p)}}}},{kernelName:Ur,outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,oe.Z)(t,1)[0],a=n.dim,i=Xu(e,r);return{logits:function(){return fc(i,Xu(lp(i,[a],true),r))}}}},{kernelName:zr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){return Xu(e,$c(n))}}}},Xv,Xv,Yv,Yv,{kernelName:Pr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){return Ku(e,Xu(Yu(as(n,"float32")),2))}}}},{kernelName:Kr,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,oe.Z)(t,2),r=n[0],a=n[1],i=oc(2);return{a:function(){return Xu(e,Xu(i,fc(r,a)))},b:function(){return Xu(e,Xu(i,fc(a,r)))}}}},{kernelName:Xr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){return Xu(e,Xu(as(n,"float32"),2))}}}},{kernelName:pa,gradFunc:function(e){return{x:function(){return Ju(e)}}}},{kernelName:ea,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,oe.Z)(t,2),r=n[0],a=n[1],i=Os(r.shape,a.shape);return{a:function(){var t=e,n=Ds(r.shape,i);return n.length>0&&(t=lp(t,n)),Xc(t,r.shape)},b:function(){var t=e,n=Ds(a.shape,i);return n.length>0&&(t=lp(t,n)),Xc(op(t),a.shape)}}}},{kernelName:Zr,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,oe.Z)(t,1)[0],a=r.shape.slice();Ae(n.axis,r.shape).forEach((function(e){a[e]=1}));var i=Xc(e,a),o=Xu(i,Rp(r.shape,"float32"));return{x:function(){return o}}}},{kernelName:ta,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){return Ku(e,Qu(Il(n)))}}}},{kernelName:na,outputsToSave:[!0],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){return Xu(fc(oc(1),Qu(n)),e)}}}},Qv,{kernelName:oa,gradFunc:function(e,t,n){var r=yp(n.perm);return{x:function(){return As(e,r)}}}},{kernelName:ua,gradFunc:function(e,t,n){var r=n.axis;return{value:function(){return zf(e,r)}}}},{kernelName:ca,inputsToSave:["segmentIds"],gradFunc:function(e,t){var n=(0,oe.Z)(t,1)[0];return{x:function(){return function(e,t){for(var n=mc(t,Ju(t)),r=jl(e,n),a=Kl(t,oc(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=Wl(a,o+1);a=kp(a,Rp(r.shape,"bool"));var s=Ju(r);return Ol(a,r,s)}(e,n)}}}},{kernelName:la,gradFunc:function(e){return{x:function(){return Ju(e)}}}}];$v<eg.length;$v++){Sa(eg[$v])}function tg(){return null==Jv&&(Jv=Gu().epsilon()),Jv}di().prototype.abs=function(){return this.throwIfDisposed(),dc(this)},di().prototype.acos=function(){return this.throwIfDisposed(),kc(this)},di().prototype.acosh=function(){return this.throwIfDisposed(),wc(this)},di().prototype.add=function(e){return this.throwIfDisposed(),ju(this,e)},di().prototype.all=function(e,t){return this.throwIfDisposed(),Ic(this,e,t)},di().prototype.any=function(e,t){return this.throwIfDisposed(),Sc(this,e,t)},di().prototype.argMax=function(e){return this.throwIfDisposed(),Tc(this,e)},di().prototype.argMin=function(e){return this.throwIfDisposed(),Cc(this,e)},di().prototype.asScalar=function(){return this.throwIfDisposed(),me(1===this.size,(function(){return"The array must have only 1 element."})),Xc(this,[])},di().prototype.asType=function(e){return this.throwIfDisposed(),as(this,e)},di().prototype.as1D=function(){return this.throwIfDisposed(),Xc(this,[this.size])},di().prototype.as2D=function(e,t){return this.throwIfDisposed(),Xc(this,[e,t])},di().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),Xc(this,[e,t,n])},di().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),Xc(this,[e,t,n,r])},di().prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),Xc(this,[e,t,n,r,a])},di().prototype.asin=function(){return this.throwIfDisposed(),Ec(this)},di().prototype.asinh=function(){return this.throwIfDisposed(),Ac(this)},di().prototype.atan=function(){return this.throwIfDisposed(),Rc(this)},di().prototype.atan2=function(e){return this.throwIfDisposed(),_c(this,e)},di().prototype.atanh=function(){return this.throwIfDisposed(),Fc(this)},di().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),Yc(this,e,t,n,r)},di().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),rl(this,e,t)},di().prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),al(this,e,t,n,r,a)},di().prototype.broadcastTo=function(e){return this.throwIfDisposed(),ll(this,e)},di().prototype.cast=function(e){return this.throwIfDisposed(),as(this,e)},di().prototype.ceil=function(){return this.throwIfDisposed(),pl(this)},di().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),fl(this,e,t)},di().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof hi&&(e=[e]),Jc([this].concat(Y(e)),t)},di().prototype.conv1d=function(e,t,n,r,a,i){return this.throwIfDisposed(),yl(this,e,t,n,r,a,i)},di().prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),xl(this,e,t,n,r,a)},di().prototype.conv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),gl(this,e,t,n,r,a,i)},di().prototype.cos=function(){return this.throwIfDisposed(),Il(this)},di().prototype.cosh=function(){return this.throwIfDisposed(),Sl(this)},di().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),Tl(this,e,t,n)},di().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),Cl(this,e,t,n)},di().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),Al(this,e,t)},di().prototype.depthwiseConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Rl(this,e,t,n,r,a,i)},di().prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),Fl(this,e,t,n,r,a)},di().prototype.divNoNan=function(e){return this.throwIfDisposed(),Ml(this,e)},di().prototype.div=function(e){return this.throwIfDisposed(),Ku(this,e)},di().prototype.dot=function(e){return this.throwIfDisposed(),Ll(this,e)},di().prototype.elu=function(){return this.throwIfDisposed(),Pl(this)},di().prototype.equal=function(e){return this.throwIfDisposed(),Dl(this,e)},di().prototype.erf=function(){return this.throwIfDisposed(),Zl(this)},di().prototype.exp=function(){return this.throwIfDisposed(),Bl(this)},di().prototype.expandDims=function(e){return this.throwIfDisposed(),Wl(this,e)},di().prototype.expm1=function(){return this.throwIfDisposed(),Ul(this)},di().prototype.fft=function(){return this.throwIfDisposed(),Rf(this)},di().prototype.flatten=function(){return this.throwIfDisposed(),Xc(this,[this.size])},di().prototype.floor=function(){return this.throwIfDisposed(),Hl(this)},di().prototype.floorDiv=function(e){return this.throwIfDisposed(),qu(this,e)},di().prototype.gather=function(e,t){return this.throwIfDisposed(),jl(this,e,t)},di().prototype.greaterEqual=function(e){return this.throwIfDisposed(),Kl(this,e)},di().prototype.greater=function(e){return this.throwIfDisposed(),ql(this,e)},di().prototype.ifft=function(){return this.throwIfDisposed(),_f(this)},di().prototype.irfft=function(){return this.throwIfDisposed(),Ff(this)},di().prototype.isFinite=function(){return this.throwIfDisposed(),Yl(this)},di().prototype.isInf=function(){return this.throwIfDisposed(),Ql(this)},di().prototype.isNaN=function(){return this.throwIfDisposed(),Jl(this)},di().prototype.leakyRelu=function(e){return this.throwIfDisposed(),$l(this,e)},di().prototype.lessEqual=function(e){return this.throwIfDisposed(),tp(this,e)},di().prototype.less=function(e){return this.throwIfDisposed(),ep(this,e)},di().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),rp(this,e,t,n,r)},di().prototype.logSigmoid=function(){return this.throwIfDisposed(),up(this)},di().prototype.logSoftmax=function(e){return this.throwIfDisposed(),pp(this,e)},di().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),xp(this,e,t)},di().prototype.log=function(){return this.throwIfDisposed(),ap(this)},di().prototype.log1p=function(){return this.throwIfDisposed(),ip(this)},di().prototype.logicalAnd=function(e){return this.throwIfDisposed(),kp(this,e)},di().prototype.logicalNot=function(){return this.throwIfDisposed(),wp(this)},di().prototype.logicalOr=function(e){return this.throwIfDisposed(),Np(this,e)},di().prototype.logicalXor=function(e){return this.throwIfDisposed(),Ip(this,e)},di().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),Cs(this,e,t,n)},di().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),Sp(this,e,t,n,r)},di().prototype.max=function(e,t){return this.throwIfDisposed(),cp(this,e,t)},di().prototype.maximum=function(e){return this.throwIfDisposed(),mc(this,e)},di().prototype.mean=function(e,t){return this.throwIfDisposed(),Ep(this,e,t)},di().prototype.min=function(e,t){return this.throwIfDisposed(),Fp(this,e,t)},di().prototype.minimum=function(e){return this.throwIfDisposed(),Dp(this,e)},di().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),Op(this,e,t)},di().prototype.mod=function(e){return this.throwIfDisposed(),Mp(this,e)},di().prototype.mul=function(e){return this.throwIfDisposed(),Xu(this,e)},di().prototype.neg=function(){return this.throwIfDisposed(),op(this)},di().prototype.norm=function(e,t,n){return this.throwIfDisposed(),ah(this,e,t,n)},di().prototype.notEqual=function(e){return this.throwIfDisposed(),Zp(this,e)},di().prototype.oneHot=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),Es(this,e,t,n)},di().prototype.onesLike=function(){return this.throwIfDisposed(),Bp(this)},di().prototype.pad=function(e,t){return this.throwIfDisposed(),Up(this,e,t)},di().prototype.pool=function(e,t,n,r,a,i){return this.throwIfDisposed(),Kp(this,e,t,n,r,a,i)},di().prototype.pow=function(e){return this.throwIfDisposed(),pc(this,e)},di().prototype.prelu=function(e){return this.throwIfDisposed(),Xp(this,e)},di().prototype.prod=function(e,t){return this.throwIfDisposed(),Yp(this,e,t)},di().prototype.reciprocal=function(){return this.throwIfDisposed(),uf(this)},di().prototype.relu=function(){return this.throwIfDisposed(),cf(this)},di().prototype.relu6=function(){return this.throwIfDisposed(),lf(this)},di().prototype.reshapeAs=function(e){return this.throwIfDisposed(),Xc(this,e.shape)},di().prototype.reshape=function(e){return this.throwIfDisposed(),Xc(this,e)},di().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),td(this,e,t,n)},di().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),nd(this,e,t,n)},di().prototype.reverse=function(e){return this.throwIfDisposed(),pf(this,e)},di().prototype.rfft=function(){return this.throwIfDisposed(),Of(this)},di().prototype.round=function(){return this.throwIfDisposed(),vf(this)},di().prototype.rsqrt=function(){return this.throwIfDisposed(),gf(this)},di().prototype.selu=function(){return this.throwIfDisposed(),yf(this)},di().prototype.separableConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),bf(this,e,t,n,r,a,i)},di().prototype.sigmoid=function(){return this.throwIfDisposed(),$c(this)},di().prototype.sign=function(){return this.throwIfDisposed(),wf(this)},di().prototype.sin=function(){return this.throwIfDisposed(),Nf(this)},di().prototype.sinh=function(){return this.throwIfDisposed(),If(this)},di().prototype.slice=function(e,t){return this.throwIfDisposed(),el(this,e,t)},di().prototype.softmax=function(e){return this.throwIfDisposed(),Af(this,e)},di().prototype.softplus=function(){return this.throwIfDisposed(),sp(this)},di().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),qp(this,e,t)},di().prototype.split=function(e,t){return this.throwIfDisposed(),Df(this,e,t)},di().prototype.sqrt=function(){return this.throwIfDisposed(),Yu(this)},di().prototype.square=function(){return this.throwIfDisposed(),Qu(this)},di().prototype.squaredDifference=function(e){return this.throwIfDisposed(),Mf(this,e)},di().prototype.squeeze=function(e){return this.throwIfDisposed(),Lf(this,e)},di().prototype.stack=function(e,t){this.throwIfDisposed();var n=e instanceof hi?[this,e]:[this].concat(Y(e));return zf(n,t)},di().prototype.step=function(e){return this.throwIfDisposed(),Pf(this,e)},di().prototype.stridedSlice=function(e,t,n,r,a,i,o,s){return this.throwIfDisposed(),Zf(this,e,t,n,r,a,i,o,s)},di().prototype.sub=function(e){return this.throwIfDisposed(),fc(this,e)},di().prototype.sum=function(e,t){return this.throwIfDisposed(),lp(this,e,t)},di().prototype.tan=function(){return this.throwIfDisposed(),Bf(this)},di().prototype.tanh=function(){return this.throwIfDisposed(),tl(this)},di().prototype.tile=function(e){return this.throwIfDisposed(),Vl(this,e)},di().prototype.toBool=function(){return this.throwIfDisposed(),as(this,"bool")},di().prototype.toFloat=function(){return this.throwIfDisposed(),as(this,"float32")},di().prototype.toInt=function(){return this.throwIfDisposed(),as(this,"int32")},di().prototype.topk=function(e,t){return this.throwIfDisposed(),jf(this,e,t)},di().prototype.transpose=function(e){return this.throwIfDisposed(),As(this,e)},di().prototype.unique=function(e){return this.throwIfDisposed(),Kf(this,e)},di().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),Xf(this,e,t)},di().prototype.unstack=function(e){return this.throwIfDisposed(),Yf(this,e)},di().prototype.where=function(e,t){return this.throwIfDisposed(),Ol(e,this,t)},di().prototype.zerosLike=function(){return this.throwIfDisposed(),Ju(this)};var ng=n(326),rg=n(120),ag=n(611);var ig=n(814);function og(e,t,n){return og=(0,ig.Z)()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&(0,ag.Z)(a,n.prototype),a},og.apply(null,arguments)}function sg(e){var t="function"===typeof Map?new Map:void 0;return sg=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return og(e,arguments,(0,rg.Z)(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),(0,ag.Z)(n,e)},sg(e)}var ug=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),r=t.call(this,e),Object.setPrototypeOf((0,ng.Z)(r),n.prototype),r}return(0,ee.Z)(n)}(sg(Error)),cg=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),r=t.call(this,e),Object.setPrototypeOf((0,ng.Z)(r),n.prototype),r}return(0,ee.Z)(n)}(sg(Error)),lg=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),r=t.call(this,e),Object.setPrototypeOf((0,ng.Z)(r),n.prototype),r}return(0,ee.Z)(n)}(sg(Error)),pg=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),r=t.call(this,e),Object.setPrototypeOf((0,ng.Z)(r),n.prototype),r}return(0,ee.Z)(n)}(sg(Error)),fg=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),r=t.call(this,e),Object.setPrototypeOf((0,ng.Z)(r),n.prototype),r}return(0,ee.Z)(n)}(sg(Error));Error;function hg(e,t){if(Array.isArray(e)){for(var n=[],r=0;r<t;r++)n=n.concat(e);return n}var a=new Array(t);return a.fill(e),a}function dg(e,t){if(!e)throw new fg(t)}function mg(e,t){var n,r=0,a=q(e);try{for(a.s();!(n=a.n()).done;){n.value===t&&r++}}catch($V){a.e($V)}finally{a.f()}return r}function vg(e){return 1===e.length?e[0]:e}function gg(e){return Array.isArray(e)?e:[e]}function yg(e){var t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function bg(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(function(e,t){return t.toUpperCase()}))}var xg={};function kg(e){if(null===e||void 0===e)return null;var t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function wg(e){if(null!=e&&"object"===typeof e)if(Array.isArray(e))e.forEach((function(e){return wg(e)}));else for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],a=e[r];null!=a&&"object"===typeof a&&(Array.isArray(a)||"ndarray"!==a.type||"number"!==typeof a.value?wg(a):e[r]=a.value)}}function Ng(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"object",a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("string"===typeof e){var i,o=e;if(o in n)i=n[o];else if(o in xg)i=xg[o];else if(null==(i=t[o]))throw new lg("Unknown ".concat(r,": ").concat(e,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");return i}var s=e;if(null==s.className||null==s.config)throw new lg("".concat(r,": Improper config format: ")+"".concat(JSON.stringify(s),".\n")+"'className' and 'config' must set.");var u,c,l=s.className;if(l in n){var p=(0,oe.Z)(n[l],2);u=p[0],c=p[1]}else if(l in xg){var f=(0,oe.Z)(xg.className,2);u=f[0],c=f[1]}else if(l in t){var h=(0,oe.Z)(t[l],2);u=h[0],c=h[1]}if(null==u)throw new lg("Unknown ".concat(r,": ").concat(l,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");if(null!=c){for(var d={},m=0,v=Object.keys(xg);m<v.length;m++){var g=v[m];d[g]=xg[g]}for(var y=0,b=Object.keys(n);y<b.length;y++){var x=b[y];d[x]=n[x]}var k=s.config;k.customObjects=d;for(var w=Object.assign({},xg),N=0,I=Object.keys(n);N<I.length;N++){var S=I[N];xg[S]=n[S]}wg(s.config);var T=c(u,s.config,n,a);return xg=Object.assign({},w),T}for(var C=Object.assign({},xg),E=0,A=Object.keys(n);E<A.length;E++){var R=A[E];xg[R]=n[R]}var _=new u(s.config);return xg=Object.assign({},C),_}function Ig(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function Sg(e){if(null==e)return e;var t,n=[],r=q(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;-1===n.indexOf(a)&&n.push(a)}}catch($V){r.e($V)}finally{r.f()}return n}function Tg(e){if(null==e)throw new lg("Invalid value in obj: ".concat(JSON.stringify(e)));for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function Cg(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new lg("".concat(n," is not a valid ").concat(t,".  Valid values are ").concat(e," or null/undefined."))}function Eg(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return dg(n>=0),dg(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every((function(e){return typeof e===t}))}function Ag(e,t){Array.isArray(e)?(me(e.length>0,(function(){return"".concat(t," is unexpectedly an empty array.")})),e.forEach((function(e,n){return Ag(e,"element ".concat(n+1," of ").concat(t))}))):me(Number.isInteger(e)&&e>0,(function(){return"Expected ".concat(t," to be a positive integer, but got ")+"".concat(Rg(e),".")}))}function Rg(e){return null===e?"null":Array.isArray(e)?"["+e.map((function(e){return Rg(e)})).join(",")+"]":"string"===typeof e?'"'.concat(e,'"'):"".concat(e)}function _g(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}function Fg(e,t){return Du((function(){return Yu(lp(Xu(e,e),t,!0))}))}var Dg=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"getConfig",value:function(){return{}}}]),n}(lu),Og=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this)).defaultMaxValue=2,r.defaultAxis=0,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return(0,ee.Z)(n,[{key:"apply",value:function(e){var t=this;return Du((function(){var n=Fg(e,t.axis),r=fl(n,0,t.maxValue);return Xu(e,Ku(r,ju(tg(),n)))}))}},{key:"getConfig",value:function(){return{maxValue:this.maxValue,axis:this.axis}}}]),n}(Dg);Og.className="MaxNorm",fu(Og);var Mg=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this)).defaultAxis=0,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return(0,ee.Z)(n,[{key:"apply",value:function(e){var t=this;return Du((function(){return Ku(e,ju(tg(),Fg(e,t.axis)))}))}},{key:"getConfig",value:function(){return{axis:this.axis}}}]),n}(Dg);Mg.className="UnitNorm",fu(Mg);var Lg=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"apply",value:function(e){return cf(e)}}]),n}(Dg);Lg.className="NonNeg",fu(Lg);var zg=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this)).defaultMinValue=0,r.defaultMaxValue=1,r.defaultRate=1,r.defaultAxis=0,r.minValue=null!=e.minValue?e.minValue:r.defaultMinValue,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.rate=null!=e.rate?e.rate:r.defaultRate,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return(0,ee.Z)(n,[{key:"apply",value:function(e){var t=this;return Du((function(){var n=Fg(e,t.axis),r=ju(Xu(t.rate,fl(n,t.minValue,t.maxValue)),Xu(1-t.rate,n));return Xu(e,Ku(r,ju(tg(),n)))}))}},{key:"getConfig",value:function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}]),n}(Dg);zg.className="MinMaxNorm",fu(zg);var Pg={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Zg(e){return kg(e)}function Bg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ng(e,pu.getMap().classNameMap,t,"constraint")}function Wg(e){return null==e?null:"string"===typeof e?Bg({className:e in Pg?Pg[e]:e,config:{}}):e instanceof Dg?e:Bg(e)}function Ug(e){return new Og(e)}function Vg(e){return new Mg(e)}function Gg(){return new Lg}function Hg(e){return new zg(e)}var jg=["channelsFirst","channelsLast"],qg=["nearest","bilinear"],Kg=["valid","same","causal"],Xg=["max","avg"],Yg=["sum","mul","concat","ave"],Qg=new Map;function Jg(e){Cg(jg,"DataFormat",e)}function $g(e){Cg(Kg,"PaddingMode",e)}function ey(e){Cg(Xg,"PoolMode",e)}var ty=[];function ny(e,t){ty.push(e);try{var n=t();return ty.pop(),n}catch(r){throw ty.pop(),r}}function ry(e){if(!oy(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===ty.length?"":ty.join("/")+"/")+e}function ay(e){if(!oy(e))throw new Error("Not a valid tensor name: '"+e+"'");Qg.has(e)||Qg.set(e,0);var t=Qg.get(e);if(Qg.set(e,Qg.get(e)+1),t>0){var n="".concat(e,"_").concat(t);return Qg.set(n,1),n}return e}var iy=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function oy(e){return!!e.match(iy)}function sy(e,t,n){null==t&&(t=0),null==n&&(n=e.length);for(var r=1,a=t;a<n;++a)r*=e[a];return r}function uy(e){if(0===e.length)return Number.NaN;for(var t=Number.POSITIVE_INFINITY,n=0;n<e.length;n++){var r=e[n];r<t&&(t=r)}return t}function cy(e){if(0===e.length)return Number.NaN;for(var t=Number.NEGATIVE_INFINITY,n=0;n<e.length;n++){var r=e[n];r>t&&(t=r)}return t}function ly(e,t){if(t<e)throw new lg("end (".concat(t,") < begin (").concat(e,") is forbidden."));for(var n=[],r=e;r<t;++r)n.push(r);return n}function py(e,t){return as(e,t)}function fy(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),Xc(e,n)}function hy(e){var t=[sy(e.shape)];return Xc(e,t)}function dy(e,t,n){return Du((function(){switch(e.rank){case 1:return Sf(e,t,n);case 2:return Tf(e,[t,0],[n,e.shape[1]]);case 3:return Cf(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return Ef(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return el(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return el(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new lg("sliceAlongFirstAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function my(e,t,n){return Du((function(){switch(e.rank){case 1:return Sf(e,t,n);case 2:return Tf(e,[0,t],[e.shape[0],n]);case 3:return Cf(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return Ef(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new lg("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function vy(e,t,n,r){return Du((function(){switch(e.rank){case 1:return Sf(e,t,n);case 2:switch(r){case 1:return dy(e,t,n);case 2:return my(e,t,n);default:throw new lg("The axis is not within the rank of the tensor "+"".concat(r))}case 3:switch(r){case 1:return dy(e,t,n);case 2:return Cf(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return my(e,t,n);default:throw new lg("The axis is not within the rank of the tensor "+"".concat(r))}case 4:switch(r){case 1:return dy(e,t,n);case 2:return Ef(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return Ef(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return my(e,t,n);default:throw new lg("The axis is not within the rank of the tensor "+"".concat(r))}default:throw new lg("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function gy(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n<0&&(n=0!==(t=e[0].rank)?t:0),n===e[0].rank&&(n=-1),Jc(e,n)}function yy(e,t){switch(e.rank){case 1:return hl([e,t]);case 2:return dl([e,t],0);case 3:return ml([e,t],0);case 4:return vl([e,t],0);default:throw new lg("concatAlongFirstAxis() received an unsupported "+"tensor rank: ".concat(e.rank))}}function by(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new lg("The length of input n (".concat(t.length,") does not match ")+"the number of dimensions in input x (".concat(e.rank,")"));return Vl(e,t)}function xy(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return rf(e,t,n,r,a)}function ky(e,t,n,r){if(e.rank<2||t.rank<2)throw new pg("dot requires both inputs to be rank >= 2"+" but got x shape = ".concat(e.shape," and y shape = ").concat(t.shape));if(t.rank>=3&&e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new pg("If rank y >= 3, then the second last dim"+" of y must equal the last dim of x but got x shape = ".concat(e.shape," and ")+" y shape = ".concat(t.shape));if(2===e.rank&&2===t.rank){return Ih({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?Iy(e.rank,r,"channelsLast"):null,activation:n})}var a=e.shape.slice(),i=a.pop();e=Xc(e,[-1,i]);var o=t.shape.slice(),s=o.pop(),u=o.pop(),c=[].concat(Y(o),[s]),l=Array.from({length:t.rank},(function(e,n){return 0===n?t.rank-2:n<=t.rank-2?n-1:n}));t=Xc(As(t,l),[u,-1]);var p=[].concat(Y(a),Y(c));return Xc(Ih({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?Iy(e.rank,r,"channelsLast"):null,activation:n}),p)}function wy(e,t,n){return Du((function(){return t=Array.isArray(t)?Wf(t,"int32"):as(t,"int32"),jl(e,t,n)}))}function Ny(e){return Xu(e,e)}function Iy(e,t,n){var r=t.shape;if(1!==t.rank&&t.rank!==e)throw new lg("Unexpected bias dimensions: ".concat(t.rank)+"; expected it to be 1 or ".concat(e));if(5===e){if("channelsFirst"===n)return 1===r.length?Xc(t,[1,r[0],1,1,1]):Xc(t,[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?Xc(t,[1,1,1,1,r[0]]):Xc(t,[1].concat(r))}else if(4===e){if("channelsFirst"===n)return 1===r.length?Xc(t,[1,r[0],1,1]):Xc(t,[1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?Xc(t,[1,1,1,r[0]]):Xc(t,[1].concat(r))}else if(3===e){if("channelsFirst"===n)return 1===r.length?Xc(t,[1,r[0],1]):Xc(t,[1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?Xc(t,[1,1,r[0]]):Xc(t,[1].concat(r))}else if(e<3)return t;throw new lg("Unsupported input rank by biasAdd: ".concat(t.rank))}function Sy(e,t,n){return Du((function(){return null==n&&(n="channelsLast"),Jg(n),ju(e,Iy(e.rank,t,n))}))}function Ty(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(1!==t)throw new pg("Support for alpha values other than 1 (".concat(t,") is not implemented ")+"yet.");return Pl(e)}function Cy(e,t,n,r){return Du((function(){return lh(e,t,n,r)}))}function Ey(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n?e():t()}var Ay=["fanIn","fanOut","fanAvg"],Ry=["normal","uniform","truncatedNormal"];var _y=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"fromConfigUsesCustomObjects",value:function(){return!1}},{key:"getConfig",value:function(){return{}}}]),n}(lu),Fy=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"apply",value:function(e,t){return Ap(e,t)}}]),n}(_y);Fy.className="Zeros",fu(Fy);var Dy=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"apply",value:function(e,t){return Rp(e,t)}}]),n}(_y);Dy.className="Ones",fu(Dy);var Oy=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;if((0,$.Z)(this,n),r=t.call(this),"object"!==typeof e)throw new lg("Expected argument of type ConstantConfig but got ".concat(e));if(void 0===e.value)throw new lg("config must have value set but got ".concat(e));return r.value=e.value,r}return(0,ee.Z)(n,[{key:"apply",value:function(e,t){var n=this;return Du((function(){return Xu(oc(n.value),Rp(e,t))}))}},{key:"getConfig",value:function(){return{value:this.value}}}]),n}(_y);Oy.className="Constant",fu(Oy);var My=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this)).DEFAULT_MINVAL=-.05,r.DEFAULT_MAXVAL=.05,r.minval=e.minval||r.DEFAULT_MINVAL,r.maxval=e.maxval||r.DEFAULT_MAXVAL,r.seed=e.seed,r}return(0,ee.Z)(n,[{key:"apply",value:function(e,t){return af(e,this.minval,this.maxval,t)}},{key:"getConfig",value:function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}]),n}(_y);My.className="RandomUniform",fu(My);var Ly=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return(0,ee.Z)(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new pg("randomNormal does not support dType ".concat(t,"."));return xy(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(_y);Ly.className="RandomNormal",fu(Ly);var zy=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return(0,ee.Z)(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new pg("truncatedNormal does not support dType ".concat(t,"."));return qf(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(_y);zy.className="TruncatedNormal",fu(zy);var Py=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this)).gain=null!=e.gain?e.gain:1,r}return(0,ee.Z)(n,[{key:"apply",value:function(e,t){var n=this;return Du((function(){if(2!==e.length||e[0]!==e[1])throw new lg("Identity matrix initializer can only be used for 2D square matrices.");return Xu(n.gain,Gl(e[0]))}))}},{key:"getConfig",value:function(){return{gain:this.gain}}}]),n}(_y);Py.className="Identity",fu(Py);var Zy=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r,a;if((0,$.Z)(this,n),r=t.call(this),e.scale<0)throw new lg("scale must be a positive float. Got: ".concat(e.scale));return r.scale=null==e.scale?1:e.scale,r.mode=null==e.mode?"fanIn":e.mode,a=r.mode,Cg(Ay,"FanMode",a),r.distribution=null==e.distribution?"normal":e.distribution,function(e){Cg(Ry,"Distribution",e)}(r.distribution),r.seed=e.seed,r}return(0,ee.Z)(n,[{key:"apply",value:function(e,t){var n=function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"channelsLast";if(Jg(r),2===e.length)t=e[0],n=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===r){var a=sy(e,2);t=e[1]*a,n=e[0]*a}else if("channelsLast"===r){var i=sy(e,0,e.length-2);t=e[e.length-2]*i,n=e[e.length-1]*i}}else{var o=sy(e);t=Math.sqrt(o),n=Math.sqrt(o)}return[t,n]}(e),r=n[0],a=n[1],i=this.scale;if("fanIn"===this.mode?i/=Math.max(1,r):"fanOut"===this.mode?i/=Math.max(1,a):i/=Math.max(1,(r+a)/2),"normal"===this.distribution){var o=Math.sqrt(i);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new pg("".concat(this.getClassName()," does not support dType ").concat(t,"."));return qf(e,0,o,t,this.seed)}var s=Math.sqrt(3*i);return af(e,-s,s,t)}},{key:"getConfig",value:function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}]),n}(_y);Zy.className="VarianceScaling",fu(Zy);var By=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){return(0,$.Z)(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}return(0,ee.Z)(n,[{key:"getClassName",value:function(){return Zy.className}}]),n}(Zy);By.className="GlorotUniform",fu(By);var Wy=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){return(0,$.Z)(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}return(0,ee.Z)(n,[{key:"getClassName",value:function(){return Zy.className}}]),n}(Zy);Wy.className="GlorotNormal",fu(Wy);var Uy=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){return(0,$.Z)(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return(0,ee.Z)(n,[{key:"getClassName",value:function(){return Zy.className}}]),n}(Zy);Uy.className="HeNormal",fu(Uy);var Vy=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){return(0,$.Z)(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return(0,ee.Z)(n,[{key:"getClassName",value:function(){return Zy.className}}]),n}(Zy);Vy.className="HeUniform",fu(Vy);var Gy=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){return(0,$.Z)(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return(0,ee.Z)(n,[{key:"getClassName",value:function(){return Zy.className}}]),n}(Zy);Gy.className="LeCunNormal",fu(Gy);var Hy=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){return(0,$.Z)(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return(0,ee.Z)(n,[{key:"getClassName",value:function(){return Zy.className}}]),n}(Zy);Hy.className="LeCunNormal",fu(Hy);var jy=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;if((0,$.Z)(this,n),(r=t.call(this)).DEFAULT_GAIN=1,r.gain=null==e.gain?r.DEFAULT_GAIN:e.gain,r.seed=e.seed,null!=r.seed)throw new pg("Random seed is not implemented for Orthogonal Initializer yet.");return r}return(0,ee.Z)(n,[{key:"apply",value:function(e,t){var n=this;return Du((function(){if(e.length<2)throw new pg("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more "+"than 2000 (".concat(e[0]*e[1],") elements: ")+"Slowness may result.");var t=xy(e[0]>e[1]?[e[1],e[0]]:e,0,1,"float32"),r=Fd.gramSchmidt(t);return e[0]>e[1]&&(r=As(r)),Xu(n.gain,r)}))}},{key:"getConfig",value:function(){return{gain:this.gain,seed:this.seed}}}]),n}(_y);jy.className="Orthogonal",fu(jy);var qy={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function Ky(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ng(e,pu.getMap().classNameMap,t,"initializer")}function Xy(e){return kg(e)}function Yy(e){if("string"===typeof e){var t=e in qy?qy[e]:e;if("GlorotNormal"===t)return new Wy;if("GlorotUniform"===t)return new By;if("HeNormal"===t)return new Uy;if("HeUniform"===t)return new Vy;if("LeCunNormal"===t)return new Gy;if("LeCunUniform"===t)return new Hy;var n={};return n.className=t,n.config={},Ky(n)}return e instanceof _y?e:Ky(e)}function Qy(){return new Fy}function Jy(){return new Dy}function $y(e){return new Oy(e)}function eb(e){return new My(e)}function tb(e){return new Ly(e)}function nb(e){return new zy(e)}function rb(e){return new Py(e)}function ab(e){return new Zy(e)}function ib(e){return new By(e)}function ob(e){return new Wy(e)}function sb(e){return new Uy(e)}function ub(e){return new Vy(e)}function cb(e){return new Gy(e)}function lb(e){return new Hy(e)}function pb(e){return new jy(e)}var fb=0;function hb(){return fb++}var db={};function mb(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e in db||(db[e]=0),db[e]+=1,e+db[e].toString()}function vb(e){return Array.isArray(e)&&Array.isArray(e[0])}function gb(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function yb(e){var t;if(Array.isArray(e)){if(1!==e.length)throw new lg("Expected Tensor length to be 1; got ".concat(e.length));t=e[0]}else t=e;return t}function bb(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return(e=e)[0];throw new lg("Expected exactly 1 Shape; got ".concat(e.length))}return e}function xb(e){var t,n=0,r=q(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;0===a.shape.length?n+=1:n+=a.shape.reduce((function(e,t){return e*t}))}}catch($V){r.e($V)}finally{r.f()}return n}var kb="Variable",wb=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:kb,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;(0,$.Z)(this,e),this.dtype=null==n?"float32":n,this.shape=t.shape,this.id=hb(),r=null==r?kb:r,this.originalName=ry(r),this.name=ay(this.originalName),this.trainable_=a,this.constraint=i,this.val=Qf(t,this.trainable_,this.name,this.dtype)}return(0,ee.Z)(e,[{key:"read",value:function(){return this.assertNotDisposed(),this.val}},{key:"write",value:function(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}},{key:"dispose",value:function(){this.assertNotDisposed(),this.val.dispose()}},{key:"assertNotDisposed",value:function(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e}}]),e}();function Nb(e){return e.map((function(e){return e.read()}))}function Ib(e){e.forEach((function(e){e[0].write(e[1])}))}var Sb=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.dtype=t.dtype,this.shape=t.shape,null!=t.shape?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}})),Tb=(0,ee.Z)((function e(t,n,r,a,i,o,s){(0,$.Z)(this,e),this.dtype=t,this.shape=n,this.sourceLayer=r,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=hb(),null!=o&&(this.originalName=ry(o),this.name=ay(this.originalName)),this.rank=n.length})),Cb=0,Eb=function(){function e(t,n){(0,$.Z)(this,e),this.callArgs=n,this.id=Cb++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;var r,a=q(t.inboundLayers);try{for(a.s();!(r=a.n()).done;){var i=r.value;null!=i&&i.outboundNodes.push(this)}}catch($V){a.e($V)}finally{a.f()}t.outboundLayer.inboundNodes.push(this)}return(0,ee.Z)(e,[{key:"getConfig",value:function(){var e,t=[],n=q(this.inboundLayers);try{for(n.s();!(e=n.n()).done;){var r=e.value;null!=r?t.push(r.name):t.push(null)}}catch($V){n.e($V)}finally{n.f()}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}]),e}(),Ab=0,Rb=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,$.Z)(this,n),(e=t.call(this))._callHook=null,e._addedWeightNames=[],e._stateful=!1,e.id=Ab++,e.activityRegularizer=null,e.inputSpec=null,e.supportsMasking=!1,e._trainableWeights=[],e._nonTrainableWeights=[],e._losses=[],e._updates=[],e._built=!1,e.inboundNodes=[],e.outboundNodes=[];var a=r.name;if(!a){var i=e.getClassName();a=yg(i)+"_"+mb(i)}if(e.name=a,e.trainable_=null==r.trainable||r.trainable,null!=r.inputShape||null!=r.batchInputShape){var o;if(null!=r.batchInputShape)o=r.batchInputShape;else if(null!=r.inputShape){var s=null;null!=r.batchSize&&(s=r.batchSize),o=[s].concat(r.inputShape)}e.batchInputShape=o;var u=r.dtype;null==u&&(u=r.inputDType),null==u&&(u="float32"),e.dtype=u}return null!=r.weights?e.initialWeights=r.weights:e.initialWeights=null,e._refCount=null,e.fastWeightInitDuringBuild=!1,e}return(0,ee.Z)(n,[{key:"getNodeAtIndex",value:function(e,t){if(0===this.inboundNodes.length)throw new cg("The layer has never been called "+"and thus has no defined ".concat(t,"."));if(this.inboundNodes.length<=e)throw new lg("Asked to get ".concat(t," at node ").concat(e,", ")+"but the layer has only ".concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[e]}},{key:"getInputAt",value:function(e){return vg(this.getNodeAtIndex(e,"input").inputTensors)}},{key:"getOutputAt",value:function(e){return vg(this.getNodeAtIndex(e,"output").outputTensors)}},{key:"input",get:function(){if(this.inboundNodes.length>1)throw new ug("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new ug("Layer ".concat(this.name)+" is not connected, no input to return.");return vg(this.getNodeAtIndex(0,"input").inputTensors)}},{key:"output",get:function(){if(0===this.inboundNodes.length)throw new ug("Layer ".concat(this.name)+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new ug("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return vg(this.getNodeAtIndex(0,"output").outputTensors)}},{key:"losses",get:function(){return this._losses}},{key:"calculateLosses",value:function(){return this.losses.map((function(e){return e()}))}},{key:"updates",get:function(){return this._updates}},{key:"built",get:function(){return this._built},set:function(e){this._built=e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this._trainableWeights.forEach((function(t){return t.trainable=e})),this.trainable_=e}},{key:"trainableWeights",get:function(){return this.trainable_?this._trainableWeights.filter((function(e){return e.trainable})):[]},set:function(e){this._trainableWeights=e}},{key:"nonTrainableWeights",get:function(){return this.trainable?this._trainableWeights.filter((function(e){return!e.trainable})).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(e){this._nonTrainableWeights=e}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"stateful",get:function(){return this._stateful}},{key:"resetStates",value:function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}},{key:"assertInputCompatibility",value:function(e){if(e=gg(e),null!=this.inputSpec&&0!==this.inputSpec.length){var t=gg(this.inputSpec);if(e.length!==t.length)throw new lg("Layer ".concat(this.name," expects ").concat(t.length," inputs, ")+"but it received ".concat(e.length," input tensors. ")+"Input received: ".concat(e));for(var n=0;n<e.length;n++){var r=e[n],a=t[n];if(null!=a){var i=r.rank;if(null!=a.ndim&&i!==a.ndim)throw new lg("Input ".concat(n," is incompatible with layer ").concat(this.name,": ")+"expected ndim=".concat(a.ndim,", found ndim=").concat(i));if(null!=a.maxNDim&&i>a.maxNDim)throw new lg("Input ".concat(n," is incompatible with layer ").concat(this.name)+": expected max_ndim=".concat(a.maxNDim,", found ndim=").concat(i));if(null!=a.minNDim&&i<a.minNDim)throw new lg("Input ".concat(n," is incompatible with layer ").concat(this.name)+": expected min_ndim=".concat(a.minNDim,", found ndim=").concat(i,"."));if(null!=a.dtype&&r.dtype!==a.dtype)throw new lg("Input ".concat(n," is incompatible with layer ").concat(this.name," ")+": expected dtype=".concat(a.dtype,", found dtype=").concat(r.dtype,"."));if(a.axes){var o=r.shape;for(var s in a.axes){var u=Number(s),c=a.axes[s],l=u>=0?o[u]:o[o.length+u];if(null!=c&&-1===[c,null].indexOf(l))throw new lg("Input ".concat(n," is incompatible with layer ")+"".concat(this.name,": expected axis ").concat(u," of input shape to ")+"have value ".concat(c," but got shape ").concat(o,"."))}}if(null!=a.shape)for(var p=0;p<a.shape.length;++p){var f=a.shape[p],h=r.shape[p];if(null!=f&&null!=h&&f!==h)throw new lg("Input ".concat(n," is incompatible with layer ")+"".concat(this.name,": expected shape=").concat(a.shape,", ")+"found shape=".concat(r.shape,"."))}}}}}},{key:"call",value:function(e,t){return e}},{key:"invokeCallHook",value:function(e,t){null!=this._callHook&&this._callHook(e,t)}},{key:"setCallHook",value:function(e){this._callHook=e}},{key:"clearCallHook",value:function(){this._callHook=null}},{key:"apply",value:function(e,t){var n=this;t=t||{},this.assertNotDisposed();var r,a=gg(e),i=!0,o=q(a);try{for(o.s();!(r=o.n()).done;){if(!(r.value instanceof Tb)){i=!1;break}}}catch($V){o.e($V)}finally{o.f()}var s,u=!0,c=q(a);try{for(c.s();!(s=c.n()).done;){if(s.value instanceof Tb){u=!1;break}}}catch($V){c.e($V)}finally{c.f()}if(i===u)throw new lg("Arguments to apply() must be all SymbolicTensors or all Tensors");return ny(this.name,(function(){if(!n.built){n.assertInputCompatibility(e);var r,i=[],o=q(gg(e));try{for(o.s();!(r=o.n()).done;){var s=r.value;i.push(s.shape)}}catch($V){o.e($V)}finally{o.f()}n.build(vg(i)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights),null===n._refCount&&u&&(n._refCount=1)}if(n.assertInputCompatibility(e),u){var c,l=n.call(e,t),p=[],f=q(gg(l));try{for(f.s();!(c=f.n()).done;){var h=c.value;-1!==a.indexOf(h)&&(h=h.clone()),p.push(h)}}catch($V){f.e($V)}finally{f.f()}if(l=vg(p),null!=n.activityRegularizer)throw new pg("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}var d,m=function(e){e=gg(e);var t,n=[],r=q(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push(a.shape)}}catch($V){r.e($V)}finally{r.f()}return vg(n)}(e),v=n.computeOutputShape(m),g="float32";if(n.warnOnIncompatibleInputShape(Array.isArray(e)?m[0]:m),d=null!=v&&v.length>0&&Array.isArray(v[0])?v.map((function(r,a){return new Tb(g,r,n,gg(e),t,n.name,a)})):new Tb(g,v,n,gg(e),t,n.name),n.addInboundNode(e,d,null,null,m,v,t),n._refCount++,null!=n.activityRegularizer)throw new pg("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return d}))}},{key:"warnOnIncompatibleInputShape",value:function(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+"".concat(JSON.stringify(e),") does not match that of the ")+"batchInputShape (".concat(JSON.stringify(this.batchInputShape),") ")+"of the layer ".concat(this.name));else{var t=!1;this.batchInputShape.forEach((function(n,r){null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)})),t&&console.warn("The shape of the input tensor "+"(".concat(JSON.stringify(e),") does not ")+"match the expectation of layer ".concat(this.name,": ")+"".concat(JSON.stringify(this.batchInputShape)))}}},{key:"outputShape",get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new ug("The layer ".concat(this.name," has never been called and thus has no ")+"defined output shape.");var e,t=[],n=q(this.inboundNodes);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=JSON.stringify(r.outputShapes);-1===t.indexOf(a)&&t.push(a)}}catch($V){n.e($V)}finally{n.f()}if(1===t.length){var i=this.inboundNodes[0].outputShapes;return Array.isArray(i)&&Array.isArray(i[0])&&1===i.length?i[0]:i}throw new ug("The layer ".concat(this.name," has multiple inbound nodes with different ")+'output shapes. Hence the notion of "output shape" is ill-defined for the layer.')}},{key:"countParams",value:function(){if(!this.built)throw new cg("You tried to call countParams() on ".concat(this.name,", ")+"but the layer is not built yet. Build it first by calling build(batchInputShape).");return xb(this.weights)}},{key:"build",value:function(e){this.built=!0}},{key:"getWeights",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Nb(e?this.trainableWeights:this.weights)}},{key:"setWeights",value:function(e){var t=this;Du((function(){var n=t.weights;if(n.length!==e.length)throw new lg('You called setWeights(weights) on layer "'.concat(t.name,'" ')+"with a weight list of length ".concat(e.length,", ")+"but the layer was expecting ".concat(n.length," weights. ")+"Provided weights: ".concat(e,"..."));if(0!==n.length){for(var r=[],a=Nb(n),i=0;i<a.length;++i){var o=a[i],s=n[i],u=e[i];if(!ke(o.shape,u.shape))throw new lg("Layer weight shape ".concat(o.shape," ")+"not compatible with provided weight shape ".concat(u.shape));r.push([s,u])}Ib(r)}}))}},{key:"addWeight",value:function(e,t,n,r,a,i,o,s){if(-1!==this._addedWeightNames.indexOf(e))throw new lg("Duplicate weight name ".concat(e," for layer ").concat(this.name));this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=null!=s?s():Yy("zeros"));var u=r.apply(t,n),c=new wb(u,n,e,i,o);return u.dispose(),null!=a&&this.addLoss((function(){return a.apply(c.read())})),null==i&&(i=!0),i?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}},{key:"setFastWeightInitDuringBuild",value:function(e){this.fastWeightInitDuringBuild=e}},{key:"addLoss",value:function(e){var t;null==e||Array.isArray(e)&&0===e.length||(e=gg(e),void 0!==this._losses&&null!==this._losses&&(t=this.losses).push.apply(t,Y(e)))}},{key:"computeOutputShape",value:function(e){return e}},{key:"computeMask",value:function(e,t){var n=this;if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.");t.forEach((function(e){if(null!=e)throw new TypeError("Layer ".concat(n.name," does not support masking, ")+"but was passed an inputMask.")}))}return null}return t}},{key:"addInboundNode",value:function(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=gg(e);t=gg(t),n=gg(n),r=gg(r),a=gb(a),i=gb(i);var u,c=[],l=[],p=[],f=q(s);try{for(f.s();!(u=f.n()).done;){var h=u.value;c.push(h.sourceLayer),l.push(h.nodeIndex),p.push(h.tensorIndex)}}catch($V){f.e($V)}finally{f.f()}new Eb({outboundLayer:this,inboundLayers:c,nodeIndices:l,tensorIndices:p,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:a,outputShapes:i},o);for(var d=0;d<t.length;d++)t[d].sourceLayer=this,t[d].nodeIndex=this.inboundNodes.length-1,t[d].tensorIndex=d}},{key:"getConfig",value:function(){var e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}},{key:"disposeWeights",value:function(){return this.weights.forEach((function(e){return e.dispose()})),this.weights.length}},{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Layer '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been ")+"built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used ")+"yet.");this.assertNotDisposed();var e=0;return 0===--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}],[{key:"nodeKey",value:function(e,t){return e.name+"_ib-"+t.toString()}}]),n}(lu);function _b(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];var r=t.inboundNodes[n];if(0===r.inboundLayers.length)return r.inputTensors;for(var a=[],i=0;i<r.inboundLayers.length;i++){var o,s=q(_b(r.inputTensors[i],r.inboundLayers[i],r.nodeIndices[i]));try{for(s.s();!(o=s.n()).done;){var u=o.value;-1===a.indexOf(u)&&a.push(u)}}catch($V){s.e($V)}finally{s.f()}}return a}var Fb,Db=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;if((0,$.Z)(this,n),r=t.call(this,{dtype:e.dtype,name:null!=e.name?e.name:mb("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),r.trainable=!1,r.built=!0,r.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new lg("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=e.batchInputShape;if(null==a){if(null==e.inputShape)throw new lg("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new lg("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=e.dtype||"float32";r.batchInputShape=a,r.dtype=i,r.inputSpec=[{shape:a}];var o=new Tb(r.dtype,r.batchInputShape,(0,ng.Z)(r),[],{},r.name);return o.nodeIndex=0,o.tensorIndex=0,new Eb({outboundLayer:(0,ng.Z)(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),r}return(0,ee.Z)(n,[{key:"apply",value:function(e,t){throw new lg("Cannot pass any input to an "+"InputLayer's apply() method. InputLayer name: ".concat(this.name))}},{key:"dispose",value:function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}},{key:"getConfig",value:function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}]),n}(Rb);function Ob(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new lg("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));var n=e.dtype;return null==n&&(n="float32"),new Db({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}function Mb(e){return Lb.apply(this,arguments)}function Lb(){return(Lb=J(ne().mark((function e(t){var n,r,a,i,o,s,u,c;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}return e.abrupt("return");case 2:for(i in n=[],r=[],a=[],t)"number"!==typeof(o=t[i])&&(s=o,n.push(s.data()),r.push(i),a.push(s));if(!(n.length>0)){e.next=12;break}return e.next=9,Promise.all(n);case 9:for(u=e.sent,c=0;c<u.length;++c)t[r[c]]=u[c][0];Ou(a);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function zb(e){if(null!=e)for(var t in e){var n=e[t];"number"!==typeof n&&n.dispose()}}Db.className="InputLayer",fu(Db),function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(Fb||(Fb={}));var Pb=function(){function e(){(0,$.Z)(this,e),this.validationData=null}return(0,ee.Z)(e,[{key:"setParams",value:function(e){this.params=e}},{key:"onEpochBegin",value:function(){var e=J(ne().mark((function e(t,n){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=J(ne().mark((function e(t,n){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=J(ne().mark((function e(t,n){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=J(ne().mark((function e(t,n){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=J(ne().mark((function e(t){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=J(ne().mark((function e(t){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setModel",value:function(e){}}]),e}(),Zb=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;(0,$.Z)(this,e),null==t&&(t=[]),this.callbacks=t,this.queueLength=n}return(0,ee.Z)(e,[{key:"append",value:function(e){this.callbacks.push(e)}},{key:"setParams",value:function(e){var t,n=q(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setParams(e)}}catch($V){n.e($V)}finally{n.f()}}},{key:"setModel",value:function(e){var t,n=q(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setModel(e)}}catch($V){n.e($V)}finally{n.f()}}},{key:"onEpochBegin",value:function(){var e=J(ne().mark((function e(t,n){var r,a,i;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=q(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=J(ne().mark((function e(t,n){var r,a,i;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=q(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=J(ne().mark((function e(t,n){var r,a,i;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=q(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=J(ne().mark((function e(t,n){var r,a,i;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=q(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=J(ne().mark((function e(t){var n,r,a;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=q(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainBegin(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=J(ne().mark((function e(t){var n,r,a;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=q(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainEnd(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Bb=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.call(this)}return(0,ee.Z)(n,[{key:"onEpochBegin",value:function(){var e=J(ne().mark((function e(t){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.seen=0,this.totals={};case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=J(ne().mark((function e(t,n){var r,a,i,o=this;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i in null==n&&(n={}),r=null==n.size?0:n.size,this.seen+=r,a=function(e){var t=n[e];if("number"===typeof t)o.totals.hasOwnProperty(e)||(o.totals[e]=0),o.totals[e]=o.totals[e]+t*r;else{var a;e in o.totals?a=o.totals[e]:o.totals[e]=0;var i=Du((function(){return ju(o.totals[e],Xu(t,r))}));o.totals[e]=i,null!=a&&a.dispose()}},n)a(i);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=J(ne().mark((function e(t,n){var r,a,i,o=this;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n){e.next=19;break}r=q(this.params.metrics),e.prev=2,i=function(){var e=a.value;if(null==o.totals[e])return"continue";"number"===typeof o.totals[e]?n[e]=o.totals[e]/o.seen:Du((function(){var t=Xu(Ku(1,o.seen),o.totals[e]);n[e]=t,o.totals[e].dispose(),Mu(n[e])}))},r.s();case 5:if((a=r.n()).done){e.next=11;break}if("continue"!==i()){e.next=9;break}return e.abrupt("continue",9);case 9:e.next=5;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),r.e(e.t0);case 16:return e.prev=16,r.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[2,13,16,19]])})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(Pb),Wb=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"onTrainBegin",value:function(){var e=J(ne().mark((function e(t){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.epoch=[],this.history={};case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=J(ne().mark((function e(t,n){var r;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r in null==n&&(n={}),this.epoch.push(t),n)null==this.history[r]&&(this.history[r]=[]),this.history[r].push(n[r]);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"syncData",value:function(){var e=J(ne().mark((function e(){var t,n,r,a,i,o,s,u,c;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a in t=[],n=[],r=[],this.history)for(i=this.history[a],o=0;o<i.length;++o)"number"!==typeof i[o]&&(s=i[o],t.push(s.data()),n.push(a),r.push(o));return e.next=6,Promise.all(t);case 6:for(u=e.sent,c=0;c<u.length;++c)this.history[n[c]][r[c]].dispose(),this.history[n[c]][r[c]]=u[c][0];case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Pb),Ub=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e,r){var a;if((0,$.Z)(this,n),(a=t.call(this)).currentEpoch=0,a.nowFunc=e.nowFunc,a.nextFrameFunc=e.nextFrameFunc||Pd,a.yieldEvery=r||"auto","auto"===a.yieldEvery&&(a.yieldEvery=125),"never"===a.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return We(a.yieldEvery)&&(a.maybeWait=function(e,t,n){var r,a=null!=n?n():Xa();return function(){var i=null!=n?n():Xa();return i-a<t?r:(a=i,r=e.apply(void 0,arguments))}}(a.maybeWait.bind((0,ng.Z)(a)),a.yieldEvery,a.nowFunc)),a.trainBegin=e.onTrainBegin,a.trainEnd=e.onTrainEnd,a.epochBegin=e.onEpochBegin,a.epochEnd=e.onEpochEnd,a.batchBegin=e.onBatchBegin,a.batchEnd=e.onBatchEnd,a.yield=e.onYield,a}return(0,ee.Z)(n,[{key:"maybeWait",value:function(){var e=J(ne().mark((function e(t,n,r){var a;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],null==this.yield){e.next=5;break}return e.next=4,Mb(r);case 4:a.push(this.yield(t,n,r));case 5:return a.push(this.nextFrameFunc()),e.next=8,Promise.all(a);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"onEpochBegin",value:function(){var e=J(ne().mark((function e(t,n){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentEpoch=t,null==this.epochBegin){e.next=6;break}return e.next=4,Mb(n);case 4:return e.next=6,this.epochBegin(t,n);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=J(ne().mark((function e(t,n){var r;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],null==this.epochEnd){e.next=5;break}return e.next=4,Mb(n);case 4:r.push(this.epochEnd(t,n));case 5:return"epoch"===this.yieldEvery&&r.push(this.nextFrameFunc()),e.next=8,Promise.all(r);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=J(ne().mark((function e(t,n){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.batchBegin){e.next=5;break}return e.next=3,Mb(n);case 3:return e.next=5,this.batchBegin(t,n);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=J(ne().mark((function e(t,n){var r;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],null==this.batchEnd){e.next=5;break}return e.next=4,Mb(n);case 4:r.push(this.batchEnd(t,n));case 5:return"batch"===this.yieldEvery?r.push(this.nextFrameFunc()):We(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,t,n)),e.next=8,Promise.all(r);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=J(ne().mark((function e(t){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.trainBegin){e.next=5;break}return e.next=3,Mb(t);case 3:return e.next=5,this.trainBegin(t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=J(ne().mark((function e(t){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.trainEnd){e.next=5;break}return e.next=3,Mb(t);case 3:return e.next=5,this.trainEnd(t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(Pb);function Vb(e,t){return null==e&&(e={}),e instanceof Pb?[e]:Array.isArray(e)&&e[0]instanceof Pb?e:gg(e).map((function(e){return new Ub(e,t)}))}var Gb=function(){function e(){(0,$.Z)(this,e)}return(0,ee.Z)(e,null,[{key:"registerCallbackConstructor",value:function(t,n){me(t>=0&&Number.isInteger(t),(function(){return"Verbosity level is expected to be an integer >= 0, "+"but got ".concat(t)})),e.checkForDuplicate(n),null==e.constructors[t]&&(e.constructors[t]=[]),e.constructors[t].push(n)}},{key:"checkForDuplicate",value:function(t){for(var n in e.constructors){e.constructors[+n].forEach((function(e){if(e===t)throw new lg("Duplicate callback constructor.")}))}}},{key:"clear",value:function(){e.constructors={}}},{key:"createCallbacks",value:function(t){var n=[];for(var r in e.constructors){var a=+r;t>=a&&n.push.apply(n,Y(e.constructors[a]))}return n.map((function(e){return new e}))}}]),e}();function Hb(e,t,n,r,a,i,o,s,u){var c=new Wb,l=[new Bb].concat(Y(Gb.createCallbacks(t)));null!=e&&l.push.apply(l,Y(e)),l.push(c);var p=new Zb(l);return p.setParams({epochs:n,initialEpoch:r,samples:a,steps:i,batchSize:o,verbose:t,doValidation:s,metrics:u}),{callbackList:p,history:c}}function jb(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=(0,rg.Z)(e)););return e}function qb(){return qb="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=jb(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},qb.apply(this,arguments)}function Kb(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Ng(e,pu.getMap().classNameMap,t,"layer",n)}function Xb(e,t){return Du((function(){"float32"!==e.dtype&&(e=as(e,"float32"));var n=lp(Ny(e),t,!0),r=cc(n.shape,tg()),a=Yu(mc(n,r));return Ku(e,a)}))}function Yb(e,t){return Du((function(){return Ep(Ny(fc(t,e)),-1)}))}function Qb(e,t){return Du((function(){return Ep(dc(fc(t,e)),-1)}))}function Jb(e,t){return Du((function(){var n=fc(e,t),r=fl(dc(e),tg(),Number.MAX_VALUE),a=dc(Ku(n,r));return Xu(100,Ep(a,-1))}))}function $b(e,t){return Du((function(){var n=fl(t,tg(),Number.MAX_VALUE),r=ap(ju(1,n)),a=fl(e,tg(),Number.MAX_VALUE),i=ap(ju(1,a));return Ep(Ny(fc(r,i)),-1)}))}function ex(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Du((function(){if(n)t=Af(t);else{var r=lp(t,t.shape.length-1,!0);t=Ku(t,r)}return t=fl(t,tg(),1-tg()),op(lp(Xu(as(e,"float32"),ap(t)),t.shape.length-1))}))}function tx(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Du((function(){var r=as(Hl(hy(e)),"int32"),a=(t=fl(t,tg(),1-tg())).shape;return ex(Xc(Es(r,a[a.length-1]),a),t,n)}))}function nx(e,t){return Du((function(){var n;return n=fl(t,tg(),1-tg()),n=ap(Ku(n,fc(1,n))),Ep(function(e,t){if(!ke(e.shape,t.shape))throw new lg("logits and labels must have the same shape, but got shapes "+"".concat(JSON.stringify(e.shape)," and ").concat(JSON.stringify(t.shape)));return Du((function(){var n=cf(t),r=op(dc(t));return ju(fc(n,Xu(t,e)),ip(Bl(r)))}))}(e,n),-1)}))}function rx(e,t){return Du((function(){var n=fl(e,tg(),1),r=fl(t,tg(),1);return lp(Xu(e,ap(Ku(n,r))),-1)}))}function ax(e,t){return Du((function(){var n=Xb(e,-1),r=Xb(t,-1),a=Xu(n,r);return op(lp(a,-1))}))}Gb.constructors={};var ix={meanSquaredError:Yb,meanAbsoluteError:Qb,meanAbsolutePercentageError:Jb,meanSquaredLogarithmicError:$b,squaredHinge:function(e,t){return Du((function(){var n=mc(0,fc(1,Xu(e,t)));return Ep(Ny(n),-1)}))},hinge:function(e,t){return Du((function(){var n=mc(0,fc(1,Xu(e,t)));return Ep(n,-1)}))},categoricalHinge:function(e,t){return Du((function(){var n=lp(Xu(e,t),-1),r=cp(Xu(fc(1,e),t),-1);return mc(0,ju(1,fc(r,n)))}))},logcosh:function(e,t){return Du((function(){var n=Math.log(2),r=fc(t,e),a=fc(ju(r,sp(Xu(-2,r))),n);return Ep(a,-1)}))},categoricalCrossentropy:ex,sparseCategoricalCrossentropy:tx,binaryCrossentropy:nx,kullbackLeiblerDivergence:rx,poisson:function(e,t){return Du((function(){var n=ap(ju(tg(),t));return Ep(fc(t,Xu(e,n)),-1)}))},cosineProximity:ax};function ox(e){if("string"===typeof e){if(e in ix)return ix[e];var t="Unknown loss ".concat(e);throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss ".concat(e,". ")+'Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new lg(t)}return e}function sx(e,t){return Du((function(){var n=Xu(.5,Bp(t)),r=py(ql(t,n),e.dtype);return Ep(Dl(e,r),-1)}))}function ux(e,t){return Du((function(){return py(Dl(Tc(e,-1),Tc(t,-1)),"float32")}))}function cx(e,t){return Du((function(){return as(lp(kp(Dl(e,1),Dl(t,1))),"float32")}))}function lx(e,t){return Du((function(){var n=cx(e,t),r=function(e,t){return Du((function(){return as(lp(kp(Dl(e,0),Dl(t,1))),"float32")}))}(e,t),a=ju(n,r);return as(Ol(ql(a,0),Ku(n,a),0),"float32")}))}function px(e,t){return Du((function(){var n=cx(e,t),r=function(e,t){return Du((function(){return as(lp(kp(Dl(e,1),Dl(t,0))),"float32")}))}(e,t),a=ju(n,r);return as(Ol(ql(a,0),Ku(n,a),0),"float32")}))}function fx(e,t){return nx(e,t)}function hx(e,t){return e.rank===t.rank&&(e=Lf(e,[e.rank-1])),(t=Tc(t,-1)).dtype!==e.dtype&&(t=as(t,e.dtype)),as(Dl(e,t),"float32")}var dx=ex,mx=tx,vx={binaryAccuracy:sx,categoricalAccuracy:ux,precision:lx,categoricalCrossentropy:dx,sparseCategoricalCrossentropy:mx,mse:Yb,MSE:Yb,mae:Qb,MAE:Qb,mape:Jb,MAPE:Jb,cosine:ax};function gx(e){if("string"===typeof e&&e in vx)return vx[e];if("string"!==typeof e&&null!=e)return e;throw new lg("Unknown metric ".concat(e))}function yx(e){if(dg(null!==e,"Unknown LossOrMetricFn ".concat(e)),"string"===typeof e)return e;for(var t,n=0,r=Object.keys(ix);n<r.length;n++){var a=r[n];if(ix[a]===e){t=a;break}}if(void 0!==t)return t;for(var i=0,o=Object.keys(vx);i<o.length;i++){var s=o[i];if(vx[s]===e){t=s;break}}return void 0!==t?t:e.name}var bx=1048576;function xx(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||"object"!==typeof e||Object.getPrototypeOf(e)!==Object.prototype||!kx(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){var r=JSON.stringify(e);r.length>bx&&console.warn('User-defined metadata of model "'.concat(t,'" is too large in ')+"size (length=".concat(r.length," when serialized). It is not ")+"recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+"".concat(bx,"."))}}function kx(e){if(null===e)return!0;if("object"===typeof e){if(Object.getPrototypeOf(e)===Object.prototype){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];if("string"!==typeof r)return!1;if(!kx(e[r]))return!1}return!0}if(Array.isArray(e)){var a,i=q(e);try{for(i.s();!(a=i.n()).done;){if(!kx(a.value))return!1}}catch($V){i.e($V)}finally{i.f()}return!0}return!1}var o=typeof e;return"string"===o||"number"===o||"boolean"===o}function wx(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.log,i=Ix(e),o=["Layer (type)","Input Shape","Output shape","Param #"];if(i?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map((function(e){return Math.floor(t*e)}))),!i)for(var s in o.push("Receives inputs"),r=[],e.nodesByDepth){var u;(u=r).push.apply(u,Y(e.nodesByDepth[s]))}a("_".repeat(t)),Sx(o,n,a),a("=".repeat(t));for(var c=e.layers,l=0;l<c.length;++l)i?Tx(c[l],n,a):Cx(c[l],n,r,a),a((l===c.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();var p=Nx(e),f=xb(e.nonTrainableWeights);a("Total params: ".concat(p+f)),a("Trainable params: ".concat(p)),a("Non-trainable params: ".concat(f)),a("_".repeat(t))}function Nx(e){return null!=e.collectedTrainableWeights?xb(e.collectedTrainableWeights):xb(e.trainableWeights)}function Ix(e){var t=!0,n=[],r=[];for(var a in e.nodesByDepth)n.push(e.nodesByDepth[a]);for(var i=0,o=n;i<o.length;i++){var s=o[i];if(s.length>1||1===s.length&&s[0].inboundLayers.length>1){t=!1;break}r.push.apply(r,Y(s))}if(t){var u,c=q(e.layers);try{for(c.s();!(u=c.n()).done;){var l,p=u.value,f=!1,h=q(p.inboundNodes);try{for(h.s();!(l=h.n()).done;){var d=l.value;if(-1!==r.indexOf(d)){if(f){t=!1;break}f=!0}}}catch($V){h.e($V)}finally{h.f()}if(!t)break}}catch($V){c.e($V)}finally{c.f()}}return t}function Sx(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log,r="",a=0;a<e.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r=(r+=e[a]).slice(0,t[a]),r+=" ".repeat(t[a]-r.length);n(r)}function Tx(e,t,n){var r,a;try{a=e.inboundNodes.map((function(e){return JSON.stringify(e.inputShapes)})).join(",")}catch($V){a="multiple"}try{r=JSON.stringify(e.outputShape)}catch($V){r="multiple"}var i=e.name,o=e.getClassName();Sx(["".concat(i," (").concat(o,")"),a,r,e.countParams().toString()],t,n)}function Cx(e,t,n,r){var a,i;try{i=e.inboundNodes.map((function(e){return JSON.stringify(e.inputShapes)})).join(",")}catch($V){i="multiple"}try{a=JSON.stringify(e.outputShape)}catch($V){a="multiple"}var o,s=[],u=q(e.inboundNodes);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(!(null!=n&&n.length>0&&-1===n.indexOf(c)))for(var l=0;l<c.inboundLayers.length;++l){var p=c.inboundLayers[l].name,f=c.nodeIndices[l],h=c.tensorIndices[l];s.push("".concat(p,"[").concat(f,"][").concat(h,"]"))}}}catch($V){u.e($V)}finally{u.f()}var d=e.name,m=e.getClassName(),v=0===s.length?"":s[0];Sx(["".concat(d," (").concat(m,")"),i,a,e.countParams().toString(),v],t,r);for(var g=1;g<s.length;++g)Sx(["","","","",s[g]],t,r)}function Ex(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"===typeof n}function Ax(e,t){if(null===e)return null;if("string"===typeof e)return bg(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];Ex(t,a,i)?n.push(i):n.push(Ax(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c];if("name"===c&&"string"===typeof l)o[c]=l;else{var p=bg(c);o[p]=Ax(l,p)}}return o}function Rx(e,t){if(null===e||void 0===e)return null;if("string"===typeof e)return yg(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];Ex(t,a,i)?n.push(i):n.push(Rx(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c],p=yg(c);o[p]="name"!==c&&"className"!==c||"string"!==typeof l?Rx(l,c):l}return o}var _x="3.15.0";var Fx=function(){function e(t){if((0,$.Z)(this,e),this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof e)for(var n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(null==t)return;var r,a=q(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;this.add(i.key,i.value)}}catch($V){a.e($V)}finally{a.f()}}}return(0,ee.Z)(e,[{key:"add",value:function(e,t,n){if(null!=this.id2Value[e.id])throw new lg("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return as(t,e.dtype)}catch($V){throw new lg("The dtype of the feed (".concat(t.dtype,") can not be cast to the dtype ")+"of the key '".concat(e.name,"' (").concat(e.dtype,")."))}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}},{key:"addFeed",value:function(e){this.add(e.key,e.value)}},{key:"hasKey",value:function(e){return null!=this.id2Value[e.id]}},{key:"names",value:function(){return Object.keys(this.name2Id)}},{key:"getValue",value:function(e){if(e instanceof Tb){if(null==this.id2Value[e.id])throw new lg("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}var t=this.name2Id[e];if(null==t)throw new lg("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}},{key:"getMask",value:function(e){if(e instanceof Tb){if(null==this.id2Value[e.id])throw new lg("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}var t=this.name2Id[e];if(null==t)throw new lg("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}},{key:"disposeMasks",value:function(){null!=this.id2Mask&&Ou(this.id2Mask)}}]),e}(),Dx={},Ox={};function Mx(e,t,n,r){var a,i=null!=n&&n.training,o=Array.isArray(e),s=o?e:[e],u=s.map((function(e){return e.name})),c=[],l=t.names(),p=q(u);try{for(p.s();!(a=p.n()).done;){var f=a.value;-1!==l.indexOf(f)?c.push(t.getValue(f)):c.push(null)}}catch($V){p.e($V)}finally{p.f()}null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);var h,d,m=u.join(",")+"|"+t.names().join(",");if(null==Dx[m]){var v=function(e,t){me(null!=e&&e.length>0,(function(){return"Expected at least one fetch, got none"}));var n=[],r={};if(1===e.length){var a=zx(e[0],t);n=a.sorted,r=a.recipientMap}else{var i,o=new Set,s=q(e);try{for(s.s();!(i=s.n()).done;){var u,c=zx(i.value,t),l=c.sorted,p=c.recipientMap,f=q(l);try{for(f.s();!(u=f.n()).done;){var h=u.value;o.has(h.name)||(n.push(h),o.add(h.name))}}catch($V){f.e($V)}finally{f.f()}var d=function(e){null==r[e]&&(r[e]=new Set),p[e].forEach((function(t){return r[e].add(t)}))};for(var m in p)d(m)}}catch($V){s.e($V)}finally{s.f()}}return{sorted:n,recipientCounts:Lx(r)}}(s,t);h=v.sorted,d=v.recipientCounts,Dx[m]=h,Ox[m]=d}h=Dx[m],d={},i||Object.assign(d,Ox[m]);for(var g=new Fx(t),y=0;y<h.length;++y){if(null!=r){var b=_u().numTensors;b>r.maxNumTensors&&(r.maxNumTensors=b),b<r.minNumTensors&&(r.minNumTensors=b)}var x=h[y],k=x.sourceLayer;if(!(k instanceof Db)){var w,N=[],I=[],S=[],T=!1,C=q(x.inputs);try{for(C.s();!(w=C.n()).done;){var E=w.value,A=g.getValue(E),R=g.getMask(E);N.push(A),I.push(R),null!=R&&(T=!0),i||(d[E.name]--,0!==d[E.name]||t.hasKey(E)||-1!==u.indexOf(E.name)||A.isDisposed||!0===E.sourceLayer.stateful||S.push(A))}}catch($V){C.e($V)}finally{C.f()}T&&((n=n||{}).mask=I[0]);var _=gg(k.apply(N,n)),F=null;k.supportsMasking&&(F=k.computeMask(N,I));for(var D=Px(x),O=Array.isArray(D)?D:[D],M=0;M<O.length;++M){g.hasKey(O[M])||g.add(O[M],_[M],Array.isArray(F)?F[0]:F);var L=u.indexOf(O[M].name);-1!==L&&(c[L]=_[M])}i||Ou(S)}}return g.disposeMasks(),o?c:c[0]}function Lx(e){var t={};for(var n in e)t[n]=e[n].size;return t}function zx(e,t){var n,r=new Set,a=[],i={},o=q(t.names());try{for(o.s();!(n=o.n()).done;){var s=n.value;r.add(s)}}catch($V){o.e($V)}finally{o.f()}var u=[],c=[];for(u.push(e);u.length>0;){var l=u[u.length-1];if(r.has(l.name))u.pop();else{var p=c[c.length-1]===u.length-1;if(0===l.inputs.length||p)u.pop(),a.push(l),r.add(l.name),p&&c.pop();else{c.push(u.length-1);var f,h=q(l.inputs);try{for(h.s();!(f=h.n()).done;){var d=f.value;null==i[d.name]&&(i[d.name]=new Set),i[d.name].add(l.name),r.has(d.name)||u.push(d)}}catch($V){h.e($V)}finally{h.f()}}}}return{sorted:a,recipientMap:i}}function Px(e){var t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{for(var n=null,r=0;r<e.sourceLayer.inboundNodes.length;++r){var a,i=q(e.sourceLayer.inboundNodes[r].outputTensors);try{for(i.s();!(a=i.n()).done;){if(a.value.id===e.id){n=r;break}}}catch($V){i.e($V)}finally{i.f()}}t=e.sourceLayer.getOutputAt(n)}return t}var Zx=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;if((0,$.Z)(this,n),(r=t.call(this,{})).containerNodes=new Set,r.name=e.name,null==r.name){var a=r.getClassName().toLowerCase();r.name=mb(a)}if(r.supportsMasking=!1,r.trainable_=!0,Array.isArray(e.inputs)?r.inputs=e.inputs.slice():r.inputs=[e.inputs],Array.isArray(e.outputs)?r.outputs=e.outputs.slice():r.outputs=[e.outputs],Sg(r.inputs).length!==r.inputs.length)throw new lg("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+"".concat(r.inputs.map((function(e){return e.name}))));Sg(r.outputs).length!==r.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+"".concat(r.outputs.map((function(e){return e.name})))),r.inputLayers=[],r.inputLayersNodeIndices=[],r.inputLayersTensorIndices=[],r.outputLayers=[],r.outputLayersNodeIndices=[],r.outputLayersTensorIndices=[],r.layers=[],r.internalContainerRefs=[];var i,o=q(r.outputs);try{for(o.s();!(i=o.n()).done;){var s=i.value,u=s.sourceLayer,c=s.nodeIndex,l=s.tensorIndex;r.outputLayers.push(u),r.outputLayersNodeIndices.push(c),r.outputLayersTensorIndices.push(l)}}catch($V){o.e($V)}finally{o.f()}var p,f=q(r.inputs);try{for(f.s();!(p=f.n()).done;){var h=p.value,d=h.sourceLayer,m=h.nodeIndex,v=h.tensorIndex;dg(0===m,"input layer has >1 nodes"),dg(0===v,"input layer has >1 tensors"),r.inputLayers.push(d),r.inputLayersNodeIndices.push(m),r.inputLayersTensorIndices.push(v)}}catch($V){f.e($V)}finally{f.f()}r.inputNames=[],r.outputNames=[],r.feedInputShapes=[],r.feedInputNames=[],r.feedOutputNames=[];for(var g=0;g<r.inputLayers.length;g++){var y=r.inputLayers[g];if(!(y instanceof Db))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. "+"Received inputs: ".concat(e.inputs,". ")+"Input ".concat(g," (0-based) originates ")+"from layer type ".concat(y.getClassName(),"."));r.inputNames.push(y.name),r.feedInputShapes.push(y.batchInputShape),r.feedInputNames.push(y.name)}var b,x=q(r.outputLayers);try{for(x.s();!(b=x.n()).done;){var k=b.value;r.outputNames.push(k.name)}}catch($V){x.e($V)}finally{x.f()}r.internalInputShapes=r.inputs.map((function(e){return e.shape})),r.internalOutputShapes=r.outputs.map((function(e){return e.shape}));var w,N={},I={},S={},T={},C={},E=[],A=function e(t,a,i,o,s,u){null!=o&&null!=s&&null!=u||(o=t.sourceLayer,s=t.nodeIndex,u=t.tensorIndex);var c=o.inboundNodes[s];if(-1!==i.indexOf(c))throw new cg("The tensor ".concat(t.name,' at layer "').concat(o.name,'" ')+"is part of a cycle.");if(-1===a.indexOf(c)){r.containerNodes.add(n.nodeKey(o,s)),o.id in C||(C[o.id]=Object.keys(C).length),-1===i.indexOf(c)&&i.push(c);for(var l=c.inboundLayers.length,p=0;p<l;p++){e(c.inputTensors[p],a,i,c.inboundLayers[p],c.nodeIndices[p],c.tensorIndices[p])}for(a.push(c);i.indexOf(c)>=0;)i.splice(i.indexOf(c),1);E.push(c)}},R=[],_=[],F=q(r.outputs);try{for(F.s();!(w=F.n()).done;){A(w.value,R,_)}}catch($V){F.e($V)}finally{F.f()}var D,O=q(E.slice().reverse());try{for(O.s();!(D=O.n()).done;){var M=D.value;I[M.id]=M,M.id in N||(N[M.id]=0);var L=N[M.id],z=null==S[M.outboundLayer.id]?0:S[M.outboundLayer.id];L=Math.max(L,z),S[M.outboundLayer.id]=L,T[M.outboundLayer.id]=M.outboundLayer,N[M.id]=L;for(var P=0;P<M.inboundLayers.length;P++){var Z=M.inboundLayers[P],B=M.nodeIndices[P],W=Z.inboundNodes[B],U=null==N[W.id]?0:N[W.id];N[W.id]=Math.max(L+1,U),I[W.id]=W}}}catch($V){O.e($V)}finally{O.f()}var V={};for(var G in N){var H=N[G];H in V||(V[H]=[]),V[H].push(I[G])}var j={};for(var K in S){var X=S[K];X in j||(j[X]=[]),j[X].push(T[K])}var Y=Object.keys(j).map((function(e){return parseInt(e,10)})).sort(Ig);r.layers=[];var Q,J=q(Y);try{for(J.s();!(Q=J.n()).done;){var ee=j[Q.value];ee.sort((function(e,t){var n=C[e.id],r=C[t.id];return n<r?-1:n>r?1:0}));var te,ne=q(ee);try{for(ne.s();!(te=ne.n()).done;){var re=te.value;re instanceof n&&r.internalContainerRefs.push(re),r.layers.push(re)}}catch($V){ne.e($V)}finally{ne.f()}}}catch($V){J.e($V)}finally{J.f()}r.layersByDepth=j,Y=Object.keys(V).map((function(e){return parseInt(e,10)})).sort(Ig);var ae,ie=r.inputs.slice(),oe=[],se=q(Y);try{for(se.s();!(ae=se.n()).done;){var ue,ce=q(V[ae.value]);try{for(ce.s();!(ue=ce.n()).done;){var le=ue.value,pe=le.outboundLayer;if(null!=pe){var fe,he=q(le.inputTensors);try{for(he.s();!(fe=he.n()).done;){var de=fe.value;if(-1===ie.indexOf(de))throw new cg("Graph disconnected: cannot obtain value for tensor ".concat(de)+' at layer "'.concat(pe.name,'". ')+"The following previous layers were accessed without "+"issue: ".concat(oe))}}catch($V){he.e($V)}finally{he.f()}var me,ve=q(le.outputTensors);try{for(ve.s();!(me=ve.n()).done;){var ge=me.value;ie.push(ge)}}catch($V){ve.e($V)}finally{ve.f()}oe.push(pe.name)}}}catch($V){ce.e($V)}finally{ce.f()}}}catch($V){se.e($V)}finally{se.f()}r.nodesByDepth=V;var ye,be=r.layers.map((function(e){return e.name})),xe=q(be);try{var ke=function(){var e=ye.value,t=be.filter((function(t){return t===e})).length;if(1!==t)throw new cg('The name "'.concat(e,'" is used ').concat(t," times ")+"in the model. All layer names should be unique. Layer names: "+JSON.stringify(be))};for(xe.s();!(ye=xe.n()).done;)ke()}catch($V){xe.e($V)}finally{xe.f()}return r.outboundNodes=[],r.inboundNodes=[],new Eb({outboundLayer:(0,ng.Z)(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:r.inputs,outputTensors:r.outputs,inputMasks:r.inputs.map((function(e){return null})),outputMasks:r.outputs.map((function(e){return null})),inputShapes:r.inputs.map((function(e){return e.shape})),outputShapes:r.outputs.map((function(e){return e.shape}))}),r.built=!0,r._refCount=1,r}return(0,ee.Z)(n,[{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Container '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){this.assertNotDisposed();var e={refCountAfterDispose:null,numDisposedVariables:0};if(0===--this._refCount){var t,n=q(this.layers);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.numDisposedVariables+=r.dispose().numDisposedVariables}}catch($V){n.e($V)}finally{n.f()}var a,i=q(this.internalContainerRefs);try{for(i.s();!(a=i.n()).done;){var o=a.value;e.numDisposedVariables+=o.dispose().numDisposedVariables}}catch($V){i.e($V)}finally{i.f()}}return e.refCountAfterDispose=this._refCount,e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.layers.forEach((function(t){t._trainableWeights.forEach((function(t){return t.trainable=e}))})),this.trainable_=e}},{key:"trainableWeights",get:function(){if(this._trainableWeights.length>0)throw new lg("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var e,t=[],n=q(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t=t.concat(r.trainableWeights)}}catch($V){n.e($V)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=q(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Y(r.nonTrainableWeights))}}catch($V){n.e($V)}finally{n.f()}if(!this.trainable){var a,i=[],o=q(this.layers);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,Y(s.trainableWeights))}}catch($V){o.e($V)}finally{o.f()}return i.concat(t)}return t}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"loadWeights",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r={},a=0,i=q(this.layers);try{for(i.s();!(t=i.n()).done;){var o,s=t.value,u=q(s.weights);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(null!=r[c.originalName])throw new lg("Duplicate weight name: ".concat(c.originalName));r[c.originalName]=c,a++}}catch($V){u.e($V)}finally{u.f()}}}catch($V){i.e($V)}finally{i.f()}var l=[];for(var p in e){var f=p;if(null==r[p]){var h=p.split("/"),d=h.slice(0,-2).concat([h[h.length-1]]);f=d.join("/")}if(null!=r[f])l.push([r[f],e[p]]);else if(n)throw new lg("Provided weight data has no target variable: ".concat(p));delete r[f]}if(n){var m=[];for(var v in r)m.push(v);if(m.length>0)throw new lg("".concat(m.length," of ").concat(a," weights are not set: ")+"".concat(m))}Ib(l)}},{key:"updatedConfig",value:function(){var e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers ".concat(_x),t.backend="TensorFlow.js",t}},{key:"toJSON",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Rx(this.updatedConfig());return t?JSON.stringify(n):n}},{key:"call",value:function(e,t){var n=this;return Du((function(){e=gg(e);for(var r=new Fx,a=0;a<n.inputs.length;++a)r.add(n.inputs[a],e[a]);return Mx(n.outputs,r,t)}))}},{key:"computeMask",value:function(e,t){var n=this;return Du((function(){var r;return e=gg(e),r=null==t?hg(null,e.length):gg(t),n.runInternalGraph(e,r)[1]}))}},{key:"computeOutputShape",value:function(e){var t=gb(e);if(t.length!==this.inputLayers.length)throw new lg("Invalid inputShape argument ".concat(e,": ")+"model has ".concat(this.inputLayers.length," tensor inputs."));for(var n={},r=0;r<t.length;r++){var a=this.inputLayers[r],i=t[r];n[a.name+"_0_0"]=i}var o=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(Ig);if(o.length>1){var s,u=q(o);try{for(u.s();!(s=u.n()).done;){var c,l=s.value,p=q(this.nodesByDepth[l]);try{for(p.s();!(c=p.n()).done;){var f=c.value,h=f.outboundLayer;if(-1===this.inputLayers.map((function(e){return e.id})).indexOf(h.id)){for(var d=[],m=0;m<f.inboundLayers.length;m++){var v=f.inboundLayers[m],g=f.nodeIndices[m],y=f.tensorIndices[m],b=n["".concat(v.name,"_").concat(g,"_").concat(y)];d.push(b)}for(var x=gb(h.computeOutputShape(vg(d))),k=h.inboundNodes.indexOf(f),w=0;w<x.length;w++){n["".concat(h.name,"_").concat(k,"_").concat(w)]=x[w]}}}}catch($V){p.e($V)}finally{p.f()}}}catch($V){u.e($V)}finally{u.f()}}for(var N=[],I=[],S=0;S<this.outputLayers.length;S++){var T=this.outputLayers[S],C=this.outputLayersNodeIndices[S],E=this.outputLayersTensorIndices[S],A="".concat(T.name,"_").concat(C,"_").concat(E);I.push(A)}for(var R=0;R<I.length;R++){var _=I[R];dg(_ in n),N.push(n[_])}return vg(N)}},{key:"runInternalGraph",value:function(e,t){null==t&&(t=hg(null,e.length));for(var n={},r=0;r<this.inputs.length;++r){var a=this.inputs[r],i=e[r],o=t[r];n[a.id]=[i,o]}var s,u=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(Ig),c=q(u);try{for(c.s();!(s=c.n()).done;){var l,p=s.value,f=q(this.nodesByDepth[p]);try{for(f.s();!(l=f.n()).done;){var h,d=l.value,m=d.outboundLayer,v=d.inputTensors,g=d.outputTensors,y=new Array,b=q(v);try{for(b.s();!(h=b.n()).done;){var x=h.value;x.id in n&&y.push(n[x.id])}}catch($V){b.e($V)}finally{b.f()}if(y.length===v.length){var k={},w=void 0,N=void 0,I=void 0,S=void 0;if(null!=d.callArgs&&(k=d.callArgs),1===y.length){var T=(0,oe.Z)(y[0],2),C=T[0],E=T[1];null==k.mask&&(k.mask=E),I=gg(m.call(C,k)),S=gg(m.computeMask(C,E)),w=[C],N=[E]}else w=y.map((function(e){return e[0]})),N=y.map((function(e){return e[1]})),null==k.mask&&(k.mask=N),I=gg(m.call(w,k)),S=gg(m.computeMask(w,N));if(m.activityRegularizer)throw new pg("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var A=0;A<g.length;++A){var R=g[A],_=I[A],F=S[A];n[R.id]=[_,F]}}}}catch($V){f.e($V)}finally{f.f()}}}catch($V){c.e($V)}finally{c.f()}var D,O=[],M=[],L=[],z=q(this.outputs);try{for(z.s();!(D=z.n()).done;){var P=D.value;dg(P.id in n,"Could not compute output ".concat(P.name," : ").concat(P.id));var Z=(0,oe.Z)(n[P.id],2),B=Z[0],W=Z[1];L.push(B.shape),O.push(B),M.push(W)}}catch($V){z.e($V)}finally{z.f()}return[O,M,L]}},{key:"buildNodeConversionMap",value:function(e){var t,r,a={},i=q(this.layers);try{for(i.s();!(r=i.n()).done;){var o=r.value;t=o instanceof n?1:0;for(var s=0;s<o.inboundNodes.length;s++){var u=n.nodeKey(o,s);this.containerNodes.has(u)&&(a[u]=t,t+=1)}}}catch($V){i.e($V)}finally{i.f()}return a}},{key:"getLayer",value:function(e,t){if(null!=t){if(this.layers.length<=t)throw new lg("Was asked to retrieve layer at index ".concat(t,", but model only ")+"has ".concat(this.layers.length," layer(s)."));return this.layers[t]}if(null==e)throw new lg("Provide either a layer name or layer index");var n,r=q(this.layers);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.name===e)return a}}catch($V){r.e($V)}finally{r.f()}throw new lg("No such layer: ".concat(e))}},{key:"calculateLosses",value:function(){var e=this;return Du((function(){var t,r=[],a=q(e.layers);try{for(a.s();!(t=a.n()).done;)for(var i=t.value,o=0;o<i.inboundNodes.length;++o){var s=n.nodeKey(i,o);e.containerNodes.has(s)&&r.push.apply(r,Y(i.calculateLosses()))}}catch($V){a.e($V)}finally{a.f()}return r}))}},{key:"getConfig",value:function(){var e,t={name:this.name},r=this.buildNodeConversionMap(this.layers),a=[],i=q(this.layers);try{for(i.s();!(e=i.n()).done;){for(var o=e.value,s=o.getClassName(),u=o.getConfig(),c=[],l=0;l<o.inboundNodes.length;l++){var p=o.inboundNodes[l],f=n.nodeKey(o,l),h={};if(this.containerNodes.has(f)){if(p.callArgs)try{JSON.stringify(p.callArgs),h=p.callArgs}catch($V){console.warn("Layer ".concat(o.name," was passed ")+"non-serializable keyword arguments: "+"".concat(p.callArgs,". They will not be included ")+"in the serialized model (and thus will be missing at deserialization time)."),h={}}if(p.inboundLayers.length>0){for(var d=[],m=0;m<p.inboundLayers.length;m++){var v=p.inboundLayers[m],g=p.nodeIndices[m],y=p.tensorIndices[m],b=r[n.nodeKey(v,g)];null==b&&(b=0),d.push([v.name,b,y,h])}c.push(d)}}}var x={};x.name=o.name,x.className=s,x.config=u,x.inboundNodes=c,a.push(x)}}catch($V){i.e($V)}finally{i.f()}t.layers=a;for(var k=[],w=0;w<this.inputLayers.length;w++){var N=this.inputLayers[w],I=this.inputLayersNodeIndices[w],S=n.nodeKey(N,I);if(this.containerNodes.has(S)){var T=r[S];null!==T&&void 0!==T||(T=0);var C=this.inputLayersTensorIndices[w];k.push([N.name,T,C])}}t.inputLayers=k;for(var E=[],A=0;A<this.outputLayers.length;A++){var R=this.outputLayers[A],_=this.outputLayersNodeIndices[A],F=n.nodeKey(R,_);if(this.containerNodes.has(F)){var D=r[F];null!==D&&void 0!==D||(D=0);var O=this.outputLayersTensorIndices[A];E.push([R.name,D,O])}}return t.outputLayers=E,t}},{key:"stateful",get:function(){if(this._stateful)throw new lg("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");var e,t=q(this.layers);try{for(t.s();!(e=t.n()).done;){if(e.value.stateful)return!0}}catch($V){t.e($V)}finally{t.f()}return!1}},{key:"resetStates",value:function(){var e=this;Du((function(){e.layers.forEach((function(e){e.stateful&&e.resetStates()}))}))}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r={},a={};function i(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function o(e,t){var n,a,o=[],s=q(t);try{for(s.s();!(a=s.n()).done;){var u=a.value,c=u[0],l=u[1],p=u[2];if(n=null==u[3]?{}:u[3],!(c in r))return void i(e,t);var f=r[c];if(f.inboundNodes.length<=l)return void i(e,t);var h=f.inboundNodes[l];o.push(h.outputTensors[p])}}catch($V){s.e($V)}finally{s.f()}o.length>0&&e.apply(vg(o),n)}function s(e){var a=e.name,o=Kb(e,null!=t.customObjects?t.customObjects:{});o.setFastWeightInitDuringBuild(n),r[a]=o,e.inboundNodes.forEach((function(e){if(!(e instanceof Array))throw new lg("Corrupted configuration, expected array for nodeData: ".concat(e));i(o,e)}))}var u,c=t.name,l=t.layers,p=q(l);try{for(p.s();!(u=p.n()).done;){var f=u.value;s(f)}}catch($V){p.e($V)}finally{p.f()}for(;!Tg(a);){var h,d=q(l);try{for(d.s();!(h=d.n()).done;){var m=h.value,v=r[m.name];if(v.name in a){var g=a[v.name];delete a[v.name];var y,b=q(g);try{for(b.s();!(y=b.n()).done;){var x=y.value;o(v,x)}}catch($V){b.e($V)}finally{b.f()}}}}catch($V){d.e($V)}finally{d.f()}}var k,w=[],N=[],I=t.inputLayers,S=q(I);try{for(S.s();!(k=S.n()).done;){var T=k.value,C=T[0],E=T[1],A=T[2];dg(C in r);var R=r[C],_=R.inboundNodes[E].outputTensors;w.push(_[A])}}catch($V){S.e($V)}finally{S.f()}var F,D=t.outputLayers,O=q(D);try{for(O.s();!(F=O.n()).done;){var M=F.value,L=M[0],z=M[1],P=M[2];dg(L in r);var Z=r[L],B=Z.inboundNodes[z].outputTensors;N.push(B[P])}}catch($V){O.e($V)}finally{O.f()}return new e({inputs:w,outputs:N,name:c})}}]),n}(Rb);function Bx(e,t,n){var r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return null}));if(1===r)return Array.isArray(e)&&1===e.length?e:"object"===typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error("Provided ".concat(n," is an array of ").concat(e.length," ")+"element(s), but the model has ".concat(r," outputs. ")+"Make sure a set of weights is provided for each model output.");return e}if("object"===typeof e&&Object.keys(e).length>0&&"object"===typeof e[Object.keys(e)[0]]){var a=[];return t.forEach((function(t){t in e?a.push(e[t]):a.push(null)})),a}throw new Error("The model has multiple (".concat(r,") outputs, ")+"so ".concat(n," must be either an array with ")+"".concat(r," elements or an object with ").concat(t," keys. ")+"Provided ".concat(n," not understood: ").concat(JSON.stringify(e)))}function Wx(e,t){return Bx(e,t,"classWeight")}function Ux(e,t,n,r){return Vx.apply(this,arguments)}function Vx(){return(Vx=J(ne().mark((function e(t,n,r,a){var i,o,s;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&null==a){e.next=2;break}throw new Error("Support sampleWeight is not implemented yet");case 2:if(null==r){e.next=15;break}return i=Du((function(){if(1===t.shape.length)return is(t);if(2===t.shape.length){if(t.shape[1]>1){return Tc(t,1)}if(1===t.shape[1])return Xc(t,[t.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(t.shape[1],") ")+"during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor (".concat(t.rank,") during ")+"handling of class weights. The rank is expected to be 1 or 2.")})),e.t0=Array,e.next=7,i.data();case 7:return e.t1=e.sent,o=e.t0.from.call(e.t0,e.t1),Ou(i),s=[],o.forEach((function(e){if(null==r[e])throw new Error("classWeight must contain all classes in the training data. "+"The class ".concat(e," exists in the data but not in ")+"classWeight");s.push(r[e])})),e.abrupt("return",Wf(s,"float32"));case 15:return e.abrupt("return",null);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Gx(e,t){return Xu(e,t)}function Hx(e,t){var n,r,a=t;n=a.xs,r=a.ys,me(null!=n&&null!=r,(function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+"".concat(t)}));var i=jx("input",e.inputNames,n),o=jx("output",e.outputNames,r),s=i[0].shape[0];me(i.length===e.inputs.length,(function(){return"LayersModel has ".concat(e.inputs.length," inputs, but the dataset ")+"provides ".concat(i.length," inputs.  (Expected input keys: ")+"".concat(JSON.stringify(e.inputNames),")")})),me(o.length===e.outputs.length,(function(){return"LayersModel has ".concat(e.outputs.length," outputs, but the dataset ")+"provides ".concat(o.length," outputs.  (Expected output keys: ")+"".concat(JSON.stringify(e.outputNames),")")}));for(var u=function(t){me(i[t].shape[0]===s,(function(){return"Batch size mismatch: input "+"".concat(e.inputNames[t]," has ").concat(i[t].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(e.inputNames[0],".")}))},c=0;c<i.length;c++)u(c);for(var l=function(t){me(o[t].shape[0]===s,(function(){return"Batch size mismatch: output "+"".concat(e.outputNames[t]," has ").concat(o[t].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(e.inputNames[0],".")}))},p=0;p<o.length;p++)l(p);return{xs:i,ys:o}}function jx(e,t,n){if(n instanceof hi)return[n];if(Array.isArray(n))return me(n.length===t.length,(function(){return"Received an array of ".concat(n.length," Tensors, but expected ").concat(t.length," to match the ").concat(e," keys ").concat(t,".")})),n;var r,a=[],i=q(t);try{for(i.s();!(r=i.n()).done;){var o=r.value;if(null==n[o])throw new lg("The feature data generated by the dataset lacks the required "+"".concat(e," key '").concat(o,"'."));a.push(n[o])}}catch($V){i.e($V)}finally{i.f()}return a}function qx(e){if(3===e.length)throw new pg("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}function Kx(e,t,n){return Xx.apply(this,arguments)}function Xx(){return Xx=J(ne().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,f,h,d,m,v,g,y,b,x,k,w,N,I,S,T,C,E,A,R,_,F,D,O,M,L;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=r.batchesPerEpoch,me(null!=t.optimizer,(function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."})),me(null!=r,(function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."})),me(null!=r.epochs&&r.epochs>0&&Number.isInteger(r.epochs),(function(){return"For fitDataset(), config.epochs is expected to be a positive "+"integer, but got ".concat(r.epochs)})),me(!a||r.batchesPerEpoch>0&&Number.isInteger(r.batchesPerEpoch),(function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a "+"positive integer if specified, but got ".concat(r.batchesPerEpoch)})),me(null==r.validationSplit,(function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."})),!t.isTraining){e.next=8;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 8:return t.isTraining=!0,e.prev=9,(i=null!=r.validationData)&&(Qx(r.validationData)?me(null==r.validationBatches||r.validationBatches>0&&Number.isInteger(r.validationBatches),(function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, "+"but got ".concat(r.validationBatches)})):(u=qx(r.validationData),o=u.xs,s=u.ys)),c=t.makeTrainFunction(),l=t.getDedupedMetricsNames(),p=i?l.slice().concat(l.map((function(e){return"val_"+e}))):l.slice(),f=Vb(r.callbacks,r.yieldEvery),h=null==r.verbose?1:r.verbose,d=Hb(f,h,r.epochs,null,null,Yx(n,r),null,i,p),m=d.callbackList,v=d.history,m.setModel(t),t.history=v,e.next=22,m.onTrainBegin();case 22:return t.stopTraining_=!1,g=null==r.initialEpoch?0:r.initialEpoch,e.next=26,n.iterator();case 26:y=e.sent;case 27:if(!(g<r.epochs)){e.next=98;break}return b={},e.next=31,m.onEpochBegin(g);case 31:if(x=0,k=0,a){e.next=37;break}return e.next=36,n.iterator();case 36:y=e.sent;case 37:if(a&&!(x<r.batchesPerEpoch)){e.next=91;break}return e.next=40,y.next();case 40:if(w=e.sent,!a||!w.done){e.next=44;break}return console.warn("You provided `batchesPerEpoch` as "+"".concat(r.batchesPerEpoch,", ")+"but your dataset iterator ran out of data after "+"".concat(x," batches; ")+"interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+"".concat(r.batchesPerEpoch*r.epochs," batches). ")+"You may need to use the repeat() function when building your dataset."),e.abrupt("break",91);case 44:if(null==w.value){e.next=73;break}return N=Hx(t,w.value),I=N.xs,S=N.ys,(T={}).batch=k,T.size=I[0].shape[0],e.next=51,m.onBatchBegin(k,T);case 51:if(C=[],null==r.classWeight){e.next=64;break}E=Wx(r.classWeight,t.outputNames),A=0;case 55:if(!(A<E.length)){e.next=64;break}return e.t0=C,e.next=59,Ux(S[A],null,E[A]);case 59:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 61:++A,e.next=55;break;case 64:for(R=I.concat(S).concat(C),_=c(R),Ou(R),F=0;F<l.length;++F)D=l[F],O=_[F],T[D]=O,Mu(O);return e.next=70,m.onBatchEnd(k,T);case 70:zb(T),k++,x++;case 73:if(!(a?x>=r.batchesPerEpoch:w.done)){e.next=87;break}if(!i){e.next=86;break}if(M=void 0,!Qx(r.validationData)){e.next=84;break}return e.t2=gg,e.next=80,t.evaluateDataset(r.validationData,{batches:r.validationBatches});case 80:e.t3=e.sent,M=(0,e.t2)(e.t3),e.next=85;break;case 84:M=gg(t.evaluate(o,s,{batchSize:null==r.validationBatchSize?32:r.validationBatchSize,verbose:0}));case 85:for(L=0;L<t.metricsNames.length;++L)b["val_".concat(t.metricsNames[L])]=M[L];case 86:return e.abrupt("break",91);case 87:if(!t.stopTraining_){e.next=89;break}return e.abrupt("break",91);case 89:e.next=37;break;case 91:return e.next=93,m.onEpochEnd(g,b);case 93:if(g++,!t.stopTraining_){e.next=96;break}return e.abrupt("break",98);case 96:e.next=27;break;case 98:return e.next=100,m.onTrainEnd();case 100:return e.next=102,t.history.syncData();case 102:return e.abrupt("return",t.history);case 103:return e.prev=103,t.isTraining=!1,e.finish(103);case 106:case"end":return e.stop()}}),e,null,[[9,,103,106]])}))),Xx.apply(this,arguments)}function Yx(e,t){var n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}function Qx(e){return"function"===typeof e.iterator}function Jx(e){return"function"===typeof e.next}function $x(e,t,n){return ek.apply(this,arguments)}function ek(){return ek=J(ne().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,f;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=(r=r||{}).batches,i=t.testFunction,o=[],!(r.verbose>0)){e.next=6;break}throw new pg("Verbose mode is not implemented yet.");case 6:if(me(!a||r.batches>0&&Number.isInteger(r.batches),(function(){return"Test loop expects `batches` to be a positive integer, but "+"received ".concat(JSON.stringify(r.batches))})),!Jx(n)){e.next=11;break}e.t0=n,e.next=14;break;case 11:return e.next=13,n.iterator();case 13:e.t0=e.sent;case 14:s=e.t0,u=0,c=0,l=ne().mark((function e(){var n;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.next();case 2:if(n=e.sent,o=Du((function(){return n.value&&function(){var e=Hx(t,n.value),r=e.xs,a=e.ys,s=r.concat(a),l=Du((function(){return i(s)}));if(Ou(s),0===c)for(var p=0;p<l.length;++p)o.push(oc(0));for(var f=s[0].shape[0],h=function(e){var t=l[e],n=o[e];o[e]=Du((function(){return ju(o[e],Xu(f,t))})),c>0&&Ou(n)},d=0;d<l.length;++d)h(d);Ou(l),u+=f,++c}(),o})),!n.done){e.next=7;break}return a&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` "+"batches (in this case, ".concat(r.batches," batches). ")+"You may need to use the repeat() function when building your dataset."),e.abrupt("return","break");case 7:case"end":return e.stop()}}),e)}));case 18:if(a&&!(c<r.batches)){e.next=25;break}return e.delegateYield(l(),"t1",20);case 20:if("break"!==e.t1){e.next=23;break}return e.abrupt("break",25);case 23:e.next=18;break;case 25:for(p=0;p<o.length;++p)f=o[p],o[p]=Ku(o[p],u),Ou(f);return e.abrupt("return",vg(o));case 27:case"end":return e.stop()}}),e)}))),ek.apply(this,arguments)}function tk(e){me(e>0&&Number.isInteger(e),(function(){return"batchSize is required to be a positive integer, but got ".concat(e)}))}function nk(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((function(e){return dy(e,t,n-t)})):dy(e,t,n-t)}function rk(e,t){return Du((function(){return null==e?null:Array.isArray(e)?e.map((function(e){return rk(e,t)})):wy(e,"int32"===t.dtype?t:as(t,"int32"))}))}function ak(e,t){for(var n=[],r=0,a=null;r<e;)(a=r+t)>=e&&(a=e),n.push([r,a]),r=a;return n}function ik(e,t,n,r,a,i,o,s,u,c,l,p,f,h,d){return ok.apply(this,arguments)}function ok(){return ok=J(ne().mark((function e(t,n,r,a,i,o,s,u,c,l,p,f,h,d,m){var v,g,y,b,x,k,w,N;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==i&&(i=32),null==o&&(o=1),null==p&&(p=!0),null==h&&(h=0),v=!1,null!=c&&null!=l&&(v=!0),null==m){e.next=10;break}if(v=!0,null!=d){e.next=10;break}throw new lg("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");case 10:return null!=(g=t.checkNumSamples(r,i,d,"steps_per_epoch"))&&(y=ly(0,g)),null==s&&(s=1),b=Hb(u,s,o,h,g,d,i,v,f),x=b.callbackList,k=b.history,x.setModel(t),t.history=k,e.next=18,x.onTrainBegin();case 18:t.stopTraining_=!1,w=ne().mark((function e(o){var s;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.onEpochBegin(o);case 2:if(s={},null==d){e.next=7;break}throw new pg("stepsPerEpoch mode is not implemented yet.");case 7:return e.delegateYield(ne().mark((function e(){var o,u,f,h;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("batch"!==p){e.next=4;break}throw new pg("batch shuffling is not implemneted yet");case 4:p&&se(y);case 5:o=Wf(y),u=ak(g,i),f=ne().mark((function e(p){var f;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f={},e.next=3,x.onBatchBegin(p,f);case 3:return Du((function(){var e=u[p][0],h=u[p][1],d=dy(o,e,h-e);f.batch=p,f.size=h-e;for(var m=rk(r,d),g=n(m),y=0;y<a.length;++y){var b=a[y],x=g[y];f[b]=x,Mu(x)}if(p===u.length-1&&v)for(var k=t.testLoop(c,l,i),w=0;w<a.length;++w){var N=a[w],I=k[w];Mu(I),s["val_"+N]=I}})),e.next=6,x.onBatchEnd(p,f);case 6:if(zb(f),!t.stopTraining_){e.next=9;break}return e.abrupt("return","break");case 9:case"end":return e.stop()}}),e)})),h=0;case 9:if(!(h<u.length)){e.next=17;break}return e.delegateYield(f(h),"t0",11);case 11:if("break"!==e.t0){e.next=14;break}return e.abrupt("break",17);case 14:++h,e.next=9;break;case 17:o.dispose();case 18:case"end":return e.stop()}}),e)}))(),"t0",8);case 8:return e.next=10,x.onEpochEnd(o,s);case 10:if(!t.stopTraining_){e.next=12;break}return e.abrupt("return","break");case 12:case"end":return e.stop()}}),e)})),N=h;case 21:if(!(N<o)){e.next=29;break}return e.delegateYield(w(N),"t0",23);case 23:if("break"!==e.t0){e.next=26;break}return e.abrupt("break",29);case 26:++N,e.next=21;break;case 29:return e.next=31,x.onTrainEnd();case 31:return e.next=33,t.history.syncData();case 33:return e.abrupt("return",t.history);case 34:case"end":return e.stop()}}),e)}))),ok.apply(this,arguments)}function sk(e,t,n){return uk.apply(this,arguments)}function uk(){return uk=J(ne().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,f,h,d,m,v,g,y,b,x,k,w,N,I,S,T,C,E,A,R=arguments;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=R.length>3&&void 0!==R[3]?R[3]:{},!t.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return t.isTraining=!0,e.prev=4,tk(d=null==a.batchSize?32:a.batchSize),m=!1,e.next=10,t.standardizeUserData(n,r,a.sampleWeight,a.classWeight,m,d);case 10:if(v=e.sent,i=v[0],o=v[1],h=v[2],g=!1,!(null!=a.validationData&&a.validationData.length>0)){e.next=36;break}if(g=!0,2!==a.validationData.length){e.next=22;break}c=a.validationData[0],l=a.validationData[1],e.next=27;break;case 22:if(3!==a.validationData.length){e.next=26;break}throw new pg("validationData including sample weights is not supported yet.");case 26:throw new lg("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+"".concat(a.validationData," is invalid."));case 27:return b=!0,e.next=30,t.standardizeUserData(c,l,null,null,b,d);case 30:x=e.sent,p=x[0],f=x[1],y=p.concat(f),e.next=37;break;case 36:null!=a.validationSplit&&a.validationSplit>0&&a.validationSplit<1?(g=!0,k=Math.floor(i[0].shape[0]*(1-a.validationSplit)),w=i[0].shape[0],p=nk(i,k,w),s=i,i=nk(i,0,k),f=nk(o,k,w),u=o,o=nk(o,0,k),y=p.concat(f)):null!=a.validationSteps&&(g=!0);case 37:return N=i.concat(o).concat(h),t.checkTrainableWeightsConsistency(),I=t.makeTrainFunction(),S=t.getDedupedMetricsNames(),g?(t.makeTestFunction(),T=t.testFunction,C=S.slice().concat(S.map((function(e){return"val_"+e})))):(T=null,y=[],C=S.slice()),E=Vb(a.callbacks,a.yieldEvery),e.next=45,ik(t,I,N,S,d,a.epochs,a.verbose,E,T,y,a.shuffle,C,a.initialEpoch,null,null);case 45:return A=e.sent,e.abrupt("return",A);case 47:return e.prev=47,t.isTraining=!1,lk(i,n),lk(o,r),lk(s,n),lk(u,r),lk(p,c),lk(f,l),null!=h&&Ou(h),e.finish(47);case 57:case"end":return e.stop()}}),e,null,[[4,,47,57]])}))),uk.apply(this,arguments)}function ck(e){var t=[];e instanceof hi&&(e=[e]);for(var n=0;n<e.length;++n){var r=e[n];if(1===r.rank)t.push(fy(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function lk(e,t){if(null!=e){var n=[];if(t instanceof hi)n.push(t.id);else if(Array.isArray(t))t.forEach((function(e){return n.push(e.id)}));else if(null!=t)for(var r in t){var a=t[r];n.push(a.id)}var i=[];if(e instanceof hi)-1===n.indexOf(e.id)&&i.push(e);else if(Array.isArray(e))e.forEach((function(e){-1===n.indexOf(e.id)&&i.push(e)}));else if(null!=e)for(var o in e){var s=e[o];-1===n.indexOf(s.id)&&i.push(s)}i.forEach((function(e){e.isDisposed||e.dispose()}))}}function pk(e){return Array.isArray(e)}function fk(e){return!function(e){return e instanceof hi}(e)&&!pk(e)}function hk(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(null==t||0===t.length){if(null!=e){var o=!1;if(pk(e)&&e.length>0)o=!0;else if(fk(e)){for(var s in e)if(e.hasOwnProperty(s)){o=!0;break}}else o=!0;if(o)throw new lg("Error when checking model ".concat(i," expected no data, ")+"but got ".concat(e))}return[]}if(null==e)return t.map((function(e){return null}));if(fk(e)){e=e,r=[];var u,c=q(t);try{for(c.s();!(u=c.n()).done;){var l=u.value;if(null==e[l])throw new lg('No data provided for "'.concat(l,'". Need data for each key in: ')+"".concat(t));r.push(e[l])}}catch($V){c.e($V)}finally{c.f()}}else if(pk(e)){if((e=e).length!==t.length)throw new lg("Error when checking model ".concat(i,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"model expected. Expected to see ".concat(t.length," Tensor(s), but ")+"instead got the following list of Tensor(s): ".concat(e));r=e}else{if(e=e,t.length>1)throw new lg("The model ".concat(i," expects ").concat(t.length," Tensor(s), ")+"but only received one Tensor. Found: Tensor with shape ".concat(e.shape));r=[e]}if(r=ck(r),null!=n)for(var p=0;p<t.length;++p)if(null!=n[p]){var f=r[p];if(f.shape.length!==n[p].length)throw new lg("Error when checking ".concat(i,": expected ").concat(t[p]," ")+"to have ".concat(n[p].length," dimension(s). but got array with ")+"shape ".concat(f.shape));for(var h=0;h<n[p].length;++h)if(0!==h||a){var d=f.shape[h],m=n[p][h];if(null!=m&&m>=0&&d!==m)throw new lg("".concat(i," expected a batch of elements where each ")+"example has shape [".concat(n[p].slice(1,n[p].length),"] ")+"(i.e.,tensor shape [*,".concat(n[p].slice(1,n[p].length),"])")+" but the ".concat(i," received an input with ").concat(f.shape[0])+" examples, each with shape [".concat(f.shape.slice(1,f.shape.length),"]")+" (tensor shape [".concat(f.shape,"])"))}}return r}function dk(e,t,n){var r=Sg(e.map((function(e){return e.shape[0]})));r.sort();var a=Sg(t.map((function(e){return e.shape[0]})));if(a.sort(),r.length>1)throw new lg("All input Tensors (x) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(e.map((function(e){return e.shape})))));if(a.length>1)throw new lg("All target Tensors (y) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(t.map((function(e){return e.shape})))));if(r.length>0&&a.length>0&&!ke(r,a))throw new lg("Input Tensors should have the same number of samples as target "+"Tensors. Found ".concat(r[0]," input sample(s) and ").concat(a[0]," target ")+"sample(s).")}function mk(e,t,n){for(var r=[Yb,nx,ex],a=0;a<e.length;++a){var i=e[a],o=t[a],s=n[a];if(null!=o){if(o===ex&&1===i.shape[i.shape.length-1])throw new lg("You are passing a target array of shape ".concat(i.shape," while using ")+"a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==r.indexOf(o))for(var u=i.shape.slice(1),c=s.slice(1),l=0;l<u.length;++l){var p=u[l],f=c[l];if(null!=f&&p!==f)throw new lg("A target Tensor with shape ".concat(i.shape," was passed for an ")+"output of shape ".concat(s,", while using a loss function that ")+"expects targets to have the same shape as the output.")}}}}function vk(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(Array.isArray(e)){if(e.length!==t.length)throw new lg("Error when checking model ".concat(i,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"the model expected. Expected to see ".concat(t.length," Tensor(s),")+" but instead got ".concat(e.length," Tensors(s)."));r=e}else{if(t.length>1)throw new lg("The model expects ".concat(t.length," ").concat(i," Tensors, ")+"but only received one Tensor. Found: array with shape "+"".concat(JSON.stringify(e.shape),"."));r=[e]}if(null!=n)for(var o=0;o<t.length;++o)if(null!=n[o]){var s=r[o];if(s.shape.length!==n[o].length)throw new lg("Error when checking ".concat(i,": expected ").concat(t[o]," ")+"to have ".concat(n[o].length," dimension(s), but got array with ")+"shape ".concat(JSON.stringify(s.shape)));for(var u=0;u<n[o].length;++u)if(0!==u||a){var c=s.shape[u],l=n[o][u];if(null!=l&&l!==c)throw new lg("Error when checking ".concat(i,": expected ")+"".concat(t[o]," to have shape ").concat(JSON.stringify(n[o])," but ")+"got array with shape ".concat(JSON.stringify(s.shape),"."))}}}var gk=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this,e)).isTraining=!1,r}return(0,ee.Z)(n,[{key:"summary",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;if(!this.built)throw new lg("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");wx(this,e,t,n)}},{key:"compile",value:function(e){var t=this;if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"===typeof e.optimizer)this.optimizer_=function(e){var t={Adagrad:function(){return Ld.adagrad(.01)},Adadelta:function(){return Ld.adadelta(1,.95,tg())},Adam:function(){return Ld.adam(.001,.9,.999,tg())},Adamax:function(){return Ld.adamax(.002,.9,.999,tg(),0)},RMSProp:function(){return Ld.rmsprop(.001,.9,0,tg())},SGD:function(){return Ld.sgd(.01)}};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new lg("Unknown Optimizer ".concat(e))}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof sc))throw new lg("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}var n=[];if(Array.isArray(e.loss)||"string"===typeof e.loss||"function"===typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new lg("When passing an Array as loss, it should have one entry per "+"model output. The model has ".concat(this.outputs.length," output(s), ")+"but you passed loss=".concat(e.loss,"."));var r=e.loss;n=r.map((function(e){return ox(e)}))}else{var a=ox(e.loss);this.outputs.forEach((function(e){n.push(a)}))}else{for(var i in e.loss=e.loss,e.loss)if(-1===this.outputNames.indexOf(i))throw new lg('Unknown entry in loss dictionary: "'.concat(i,'". ')+"Only expected the following keys: ".concat(this.outputNames));var o,s=q(this.outputNames);try{for(s.s();!(o=s.n()).done;){var u=o.value;null==e.loss[u]&&console.warn('Output "'.concat(u,'" is missing from loss dictionary. We assume ')+"this was done on purpose, and we will not be expecting data "+"to be passed to ".concat(u," during training")),n.push(ox(e.loss[u]))}}catch($V){s.e($V)}finally{s.f()}}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var c=0;c<this.outputs.length;++c){var l=this.internalOutputShapes[c],p=this.outputNames[c];this.feedOutputNames.push(p),this.feedOutputShapes.push(l),this.feedLossFns.push(this.lossFunctions[c])}var f=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],ny("loss",(function(){for(var e=0;e<t.outputs.length;++e)if(-1===f.indexOf(e)){var n=t.lossFunctions[e];t.outputs.length>1&&(t.metricsTensors.push([n,e]),t.metricsNames.push(t.outputNames[e]+"_loss"))}}));var h=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return[]}));var n;if("string"===typeof e||"function"===typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!==typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,"+"function, Array, or Object, found: ".concat(e));n=e}if(Array.isArray(n))return t.map((function(e){return n}));var r,a=[],i=q(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,s=n.hasOwnProperty(o)?n[o]:[];Array.isArray(s)||(s=[s]),a.push(s)}}catch($V){i.e($V)}finally{i.f()}return a}(e.metrics,this.outputNames),d=function(e,n,r){t.outputNames.length>1&&(n=t.outputNames[e]+"_"+n),t.metricsNames.push(n),t.metricsTensors.push([r,e])};ny("metric",(function(){for(var e=function(e){if(-1!==f.indexOf(e))return"continue";!function(n){var r,a,i,o,s=q(n);try{for(s.s();!(o=s.n()).done;){var u=o.value;if("string"===typeof u&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(u)){var c=t.internalOutputShapes[e];1===c[c.length-1]||t.lossFunctions[e]===nx?-1!==["accuracy","acc"].indexOf(u)?a=sx:-1!==["crossentropy","ce"].indexOf(u)&&(a=fx):t.lossFunctions[e]===tx?-1!==["accuracy","acc"].indexOf(u)?a=hx:-1!==["crossentropy","ce"].indexOf(u)&&(a=mx):-1!==["accuracy","acc"].indexOf(u)?a=ux:-1!==["crossentropy","ce"].indexOf(u)&&(a=dx);var l=void 0;-1!==["accuracy","acc"].indexOf(u)?l="acc":-1!==["crossentropy","ce"].indexOf(u)&&(l="ce"),i=a,r=""+l}else{var p=gx(u);i=p,r=""+yx(u)}var f=void 0;ny(r,(function(){f=i})),d(e,r,f)}}catch($V){s.e($V)}finally{s.f()}}(h[e])},n=0;n<t.outputs.length;++n)e(n)})),this.collectedTrainableWeights=this.trainableWeights}},{key:"checkTrainableWeightsConsistency",value:function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=null==n.batchSize?32:n.batchSize;tk(r);var a=!0,i=this.standardizeUserDataXY(e,t,a,r);try{var o=i[0].concat(i[1]);this.makeTestFunction();var s=this.testFunction,u=this.testLoop(s,o,r,n.verbose,n.steps);return vg(u)}finally{lk(i[0],e),lk(i[1],t)}}},{key:"evaluateDataset",value:function(){var e=J(ne().mark((function e(t,n){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.makeTestFunction(),e.abrupt("return",$x(this,t,n));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"checkNumSamples",value:function(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(null!=n){if(r=null,null!=t)throw new lg("If ".concat(a," is set, batchSize must be null or undefined.")+"Got batchSize = ".concat(t))}else{if(null==e)throw new lg("Either the input data should have a defined shape, or "+"".concat(a," shoud be specified."));r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r}},{key:"execute",value:function(e,t){if(Array.isArray(t)&&0===t.length)throw new lg("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(t),r=n?t:[t],a=this.retrieveSymbolicTensors(r),i=new Fx;if(e instanceof hi&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new lg("The number of inputs provided (".concat(e.length,") ")+"does not match the number of inputs of this model "+"(".concat(this.inputs.length,")."));for(var o=0;o<this.inputs.length;++o)i.add(this.inputs[o],e[o])}else{var s,u=q(this.inputs);try{for(u.s();!(s=u.n()).done;){var c=s.value,l=e[c.name];if(null==l)throw new lg("No value is provided for the model's input ".concat(c.name));i.add(c,l)}}catch($V){u.e($V)}finally{u.f()}}var p=Mx(a,i);return n?p:p[0]}},{key:"retrieveSymbolicTensors",value:function(e){var t,n=hg(null,e.length),r=e.length,a=q(this.layers);try{for(a.s();!(t=a.n()).done;){for(var i=t.value,o=Array.isArray(i.output)?i.output:[i.output],s=o.map((function(e){return e.name})),u=0;u<e.length;++u){var c=s.indexOf(e[u]);if(-1!==c&&(n[u]=o[c],r--),0===r)break}if(0===r)break}}catch($V){a.e($V)}finally{a.f()}if(r>0){var l=[];throw n.forEach((function(t,n){null==t&&l.push(e[n])})),new lg("Cannot find SymbolicTensors for output name(s): "+"".concat(JSON.stringify(l)))}return n}},{key:"predictLoop",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Du((function(){var a=t.checkNumSamples(e);if(r)throw new pg("Verbose predictLoop() is not implemented yet.");for(var i=ak(a,n),o=t.outputs.map((function(e){return[]})),s=function(n){Du((function(){var r=i[n][0],a=i[n][1],o=nk(e,r,a),s=[];if(Array.isArray(o))for(var u=0;u<o.length;++u)s.push({key:t.inputs[u],value:o[u]});else s.push({key:t.inputs[0],value:o});var c=new Fx(s);return Mx(t.outputs,c)})).forEach((function(e,t){return o[t].push(e)}))},u=0;u<i.length;++u)s(u);return vg(o.map((function(e){return Jc(e,0)})))}))}},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=ck(e);vk(n,this.inputNames,this.feedInputShapes,!1);try{var r=null==t.batchSize?32:t.batchSize;return tk(r),this.predictLoop(n,r)}finally{lk(n,e)}}},{key:"predictOnBatch",value:function(e){vk(e,this.inputNames,this.feedInputShapes,!0);var t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}},{key:"standardizeUserDataXY",value:function(e,t){var n=arguments.length>3?arguments[3]:void 0;if(null==this.optimizer_)throw new cg("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var r=[],a=0;a<this.feedOutputShapes.length;++a){var i=this.feedOutputShapes[a],o=this.feedLossFns[a];o===tx?r.push(i.slice(0,i.length-1).concat([1])):r.push(i)}if(dk(e=hk(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=hk(t,this.feedOutputNames,r,!1,"target")),mk(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=n&&n>0&&e[0].shape[0]%n!==0)throw new lg("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+"".concat(n,". Found: ").concat(e[0].shape[0]," sample(s)."));return[e,t]}},{key:"standardizeUserData",value:function(){var e=J(ne().mark((function e(t,n,r,a){var i,o,s,u,c,l,p,f,h,d=arguments;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!(d.length>4&&void 0!==d[4])||d[4],o=d.length>5?d[5]:void 0,s=this.standardizeUserDataXY(t,n,i,o),u=(0,oe.Z)(s,2),c=u[0],l=u[1],null==r){e.next=5;break}throw new Error("sample weight is not supported yet.");case 5:if(p=null,null==a){e.next=19;break}f=Wx(a,this.outputNames),p=[],h=0;case 10:if(!(h<f.length)){e.next=19;break}return e.t0=p,e.next=14,Ux(l[h],null,f[h]);case 14:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 16:++h,e.next=10;break;case 19:return e.abrupt("return",[c,l,p]);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"testLoop",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0;return Du((function(){var o=r.checkNumSamples(t,n,i,"steps"),s=[];if(a>0)throw new pg("Verbose mode is not implemented yet.");if(null!=i)throw new pg("steps mode in testLoop() is not implemented yet");for(var u=ak(o,n),c=Wf(ly(0,o)),l=0;l<u.length;++l){var p=u[l][0],f=u[l][1],h=dy(c,p,f-p),d=rk(t,h),m=e(d);if(0===l)for(var v=0;v<m.length;++v)s.push(oc(0));for(var g=0;g<m.length;++g){var y=m[g];s[g]=ju(s[g],Xu(f-p,y))}}for(var b=0;b<s.length;++b)s[b]=Ku(s[b],o);return s}))}},{key:"getDedupedMetricsNames",value:function(){for(var e=this.metricsNames,t=[],n=0;n<e.length;++n){var r=e[n],a=r;if(mg(e,r)>1){var i=mg(e.slice(0,n),r);a+="_".concat(i)}t.push(a)}return t}},{key:"makeTrainFunction",value:function(){var e=this;return function(t){var n=[],r=t.slice(0,e.inputs.length),a=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),i=t.slice(e.inputs.length+e.outputs.length,e.inputs.length+2*e.outputs.length),o=[],s=e.collectedTrainableWeights.map((function(e){return e.read()}));return[e.optimizer_.minimize((function(){for(var t=[],s=0;s<e.inputs.length;++s)t.push({key:e.inputs[s],value:r[s]});for(var u,c=new Fx(t),l=Mx(e.outputs,c,{training:!0}),p=0;p<e.lossFunctions.length;++p){var f=(0,e.lossFunctions[p])(a[p],l[p]);null!=i[p]&&(f=Gx(f,i[p]));var h=Ep(f);n.push(h),u=0===p?f:ju(u,f)}for(var d=0;d<e.metricsTensors.length;++d){var m=void 0;if(e.outputs.length>1&&d<e.outputs.length)m=n[d];else{var v=e.metricsTensors[d][0],g=e.metricsTensors[d][1];m=Ep(v(a[g],l[g]))}Mu(m),o.push(m)}return u=Ep(u),e.calculateLosses().forEach((function(e){u=ju(u,e)})),u}),!0,s)].concat(o)}}},{key:"makeTestFunction",value:function(){var e=this;this.testFunction=function(t){return Du((function(){for(var n,r=[],a=t.slice(0,e.inputs.length),i=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),o=[],s=0;s<e.inputs.length;++s)o.push({key:e.inputs[s],value:a[s]});for(var u=new Fx(o),c=Mx(e.outputs,u),l=0;l<e.lossFunctions.length;++l){var p=e.lossFunctions[l],f=Ep(p(i[l],c[l]));n=0===l?f:ju(n,f),r.push(n)}for(var h=0;h<e.metricsTensors.length;++h){var d=e.metricsTensors[h][0],m=e.metricsTensors[h][1],v=Ep(d(i[m],c[m]));r.push(v)}return r}))}}},{key:"fit",value:function(){var e=J(ne().mark((function e(t,n){var r,a=arguments;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:{},e.abrupt("return",sk(this,t,n,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=J(ne().mark((function e(t,n){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Kx(this,t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=J(ne().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,f;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.standardizeUserData(t,n);case 2:r=e.sent,a=r[0],i=r[1],o=this.makeTrainFunction(),s=o(a.concat(i)),u=[],c=q(s),e.prev=9,c.s();case 11:if((l=c.n()).done){e.next=19;break}return p=l.value,e.next=15,p.data();case 15:f=e.sent,u.push(f[0]);case 17:e.next=11;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(9),c.e(e.t0);case 24:return e.prev=24,c.f(),e.finish(24);case 27:return Ou(s),lk(r[0],t),lk(r[1],n),e.abrupt("return",vg(u));case 31:case"end":return e.stop()}}),e,this,[[9,21,24,27]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNamedWeights",value:function(e){for(var t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,a=this.getWeights(n),i=0;i<r.length;++i)n&&!r[i].trainable||t.push({name:r[i].originalName,tensor:a[i]});return t}},{key:"stopTraining",get:function(){return this.stopTraining_},set:function(e){this.stopTraining_=e}},{key:"optimizer",get:function(){return this.optimizer_},set:function(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}},{key:"dispose",value:function(){var e=qb((0,rg.Z)(n.prototype),"dispose",this).call(this);if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){var t=_u().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-_u().numTensors}return e}},{key:"getLossIdentifiers",value:function(){var e;if("string"===typeof this.loss)e=yg(this.loss);else if(Array.isArray(this.loss)){var t,n=q(this.loss);try{for(n.s();!(t=n.n()).done;){if("string"!==typeof t.value)throw new Error("Serialization of non-string loss is not supported.")}}catch($V){n.e($V)}finally{n.f()}e=this.loss.map((function(e){return yg(e)}))}else{var r=Object.keys(this.loss);e={};for(var a=this.loss,i=0,o=r;i<o.length;i++){var s=o[i];if("string"!==typeof a[s])throw new Error("Serialization of non-string loss is not supported.");e[s]=yg(a[s])}}return e}},{key:"getMetricIdentifiers",value:function(){if("string"===typeof this.metrics||"function"===typeof this.metrics)return[yg(yx(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((function(e){return yg(yx(e))}));var e={};for(var t in this.metrics)e[t]=yg(yx(this.metrics[t]));return e}},{key:"getTrainingConfig",value:function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}},{key:"loadTrainingConfig",value:function(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");var t,n,r=Kb(Ax(e.optimizer_config));if("string"===typeof e.loss)t=bg(e.loss);else if(Array.isArray(e.loss))t=e.loss.map((function(e){return bg(e)}));else if(null!=e.loss)for(var a in t={},e.loss)t[a]=bg(e.loss[a]);if(Array.isArray(e.metrics))n=e.metrics.map((function(e){return bg(e)}));else if(null!=e.metrics)for(var i in n={},e.metrics)n[i]=bg(e.metrics[i]);this.compile({loss:t,metrics:n,optimizer:r})}},{key:"save",value:function(){var e=J(ne().mark((function e(t,n){var r,a,i,s,u,c,l,p,f;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=9;break}if(0!==(r=go(t)).length){e.next=6;break}throw new lg("Cannot find any save handlers for URL '".concat(t,"'"));case 6:if(!(r.length>1)){e.next=8;break}throw new lg("Found more than one (".concat(r.length,") save handlers for ")+"URL '".concat(t,"'"));case 8:t=r[0];case 9:if(null!=t.save){e.next=11;break}throw new lg("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 11:return e.next=13,Ji(this.getNamedWeights(n));case 13:if(a=e.sent,!1,null,i=this.toJSON(null,false),s={modelTopology:i,format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v".concat(_x),convertedBy:null},!(null!=n&&n.includeOptimizer)||null==this.optimizer){e.next=34;break}return s.trainingConfig=this.getTrainingConfig(),c="optimizer",e.t0=o,e.next=25,this.optimizer.getWeights();case 25:return e.t1=e.sent,e.t2=c,e.next=29,e.t0.encodeWeights.call(e.t0,e.t1,e.t2);case 29:l=e.sent,p=l.data,f=l.specs,(u=a.specs).push.apply(u,Y(f)),a.data=oo([a.data,p]);case 34:return null!=this.userDefinedMetadata&&(!0,xx(this.userDefinedMetadata,this.name,true),s.userDefinedMetadata=this.userDefinedMetadata),s.weightData=a.data,s.weightSpecs=a.specs,e.abrupt("return",t.save(s));case 38:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setUserDefinedMetadata",value:function(e){xx(e,this.name),this.userDefinedMetadata=e}},{key:"getUserDefinedMetadata",value:function(){return this.userDefinedMetadata}}]),n}(Zx);gk.className="Model",fu(gk);var yk=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n)}(gk);function bk(e,t){return xk.apply(this,arguments)}function xk(){return xk=J(ne().mark((function e(t,n){var r,a,i,o,s,u,c,l;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("modelTopology"in t||(t={modelTopology:t}),null!=(r=(t=t).modelTopology).model_config&&(r=r.model_config),a=Ax(r),i=Kb(a,n),null==t.weightsManifest){e.next=15;break}return e.next=9,ds(t.weightsManifest,t.pathPrefix,i.weights.map((function(e){return e.originalName})));case 9:o=e.sent,s={},u=q(i.weights);try{for(u.s();!(c=u.n()).done;)l=c.value,s[l.originalName]=o[l.originalName]}catch($V){u.e($V)}finally{u.f()}i.loadWeights(s),Ou(o);case 15:return e.abrupt("return",i);case 16:case"end":return e.stop()}}),e)}))),xk.apply(this,arguments)}function kk(){return(kk=J(ne().mark((function e(t,n){var r;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),"string"!==typeof t){e.next=10;break}if(0!==(r=yo(t,n)).length){e.next=7;break}r.push(ws(t,n)),e.next=9;break;case 7:if(!(r.length>1)){e.next=9;break}throw new lg("Found more than one (".concat(r.length,") load handlers for ")+"URL '".concat(t,"'"));case 9:t=r[0];case 10:return e.abrupt("return",wk(t,void 0,n));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function wk(e,t,n){return Nk.apply(this,arguments)}function Nk(){return Nk=J(ne().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,f;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==r&&(r={}),null!=t.load){e.next=3;break}throw new lg("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");case 3:return e.next=5,t.load();case 5:if(a=e.sent,null!=(i=a.modelTopology).model_config&&(i=i.model_config),o=null==r.strict||r.strict,s=null!=a.weightData&&null!=a.weightSpecs&&o,u=Kb(Ax(i),n,s),null!=(c=a.trainingConfig)&&u.loadTrainingConfig(c),null!=a.userDefinedMetadata&&u.setUserDefinedMetadata(a.userDefinedMetadata),null==a.weightData){e.next=24;break}if(null!=a.weightSpecs){e.next=17;break}throw new lg("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");case 17:if(l=Ik(a.weightData,a.weightSpecs),p=l.modelWeights,f=l.optimizerWeights,u.loadWeights(p,o),!(null!=u.optimizer&&f.length>0)){e.next=22;break}return e.next=22,u.optimizer.setWeights(f);case 22:Ou(p),Ou(f.map((function(e){return e.tensor})));case 24:return e.abrupt("return",u);case 25:case"end":return e.stop()}}),e)}))),Nk.apply(this,arguments)}function Ik(e,t){var n=eo(e,t),r={},a=[];return t.forEach((function(e){"optimizer"===e.group?a.push({name:e.name,tensor:n[e.name]}):r[e.name]=n[e.name]})),{modelWeights:r,optimizerWeights:a}}yk.className="Functional",fu(yk);var Sk=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;if((0,$.Z)(this,n),e=e||{},(r=t.call(this,{inputs:[],outputs:[]})).trainable=!0,r.built=!1,r.name=null!=e.name?e.name:mb("sequential_"),null!=e.layers){var a,i=q(e.layers);try{for(i.s();!(a=i.n()).done;){var o=a.value;r.add(o)}}catch($V){i.e($V)}finally{i.f()}}return r}return(0,ee.Z)(n,[{key:"checkShape",value:function(e){if(e.inboundNodes[0].outputTensors[0].shape.some((function(e){return e<0})))throw new lg("Negative dimension size caused by adding layer "+"".concat(e.name," with input shape [")+"".concat(e.inboundNodes[0].inputTensors[0].shape,"]"))}},{key:"add",value:function(e){var t,r=e instanceof n||e instanceof gk;if(r){if(1!==(t=e).outputs.length)throw new lg("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==t.inputs.length)throw new lg("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new lg("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var a=Ob({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(a)}if(r)this.outputs=t.outputs,this.inputs=t.inputs;else{if(1!==e.inboundNodes.length)throw new lg("A layer added to a Sequential model must not already be "+"connected somewhere else. LayersModel received layer ".concat(e.name," ")+"which has ".concat(e.inboundNodes.length," pre-existing inbound ")+"connections.");if(1!==e.inboundNodes[0].outputTensors.length)throw new lg("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=_b(this.outputs[0])}this.inboundNodes=[],new Eb({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:hg(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((function(e){return e.shape})),outputShapes:this.outputs[0].shape})}else{var i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}},{key:"pop",value:function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}},{key:"call",value:function(e,t){return null==this.model&&this.build(),this.model.call(e,t)}},{key:"build",value:function(e){if(bb(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new gk({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}},{key:"countParams",value:function(){return this.built||this.build(),qb((0,rg.Z)(n.prototype),"countParams",this).call(this)}},{key:"summary",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;this.built||this.build(),qb((0,rg.Z)(n.prototype),"summary",this).call(this,e,t,r)}},{key:"setWeights",value:function(e){null==this.model&&this.build(),this.model.setWeights(e)}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new cg("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}},{key:"evaluateDataset",value:function(){var e=J(ne().mark((function e(t,n){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new cg("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.evaluateDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null==this.model&&this.build(),this.model.predict(e,t)}},{key:"predictOnBatch",value:function(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}},{key:"compile",value:function(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}},{key:"optimizer",get:function(){return null==this.model?void 0:this.model.optimizer},set:function(e){this.model.optimizer=e}},{key:"fit",value:function(){var e=J(ne().mark((function e(t,n){var r,a=arguments;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>2&&void 0!==a[2]?a[2]:{},this.built){e.next=3;break}throw new cg("The model needs to be compiled before being used.");case 3:return e.abrupt("return",this.model.fit(t,n,r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=J(ne().mark((function e(t,n){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new cg("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.fitDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=J(ne().mark((function e(t,n){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.model.trainOnBatch(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"stopTraining",get:function(){if(null==this.model)throw new lg("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(e){if(null==this.model)throw new lg("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}},{key:"getConfig",value:function(){var e,t=[],n=q(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value,a={};a.className=r.getClassName(),a.config=r.getConfig(),t.push(a)}}catch($V){n.e($V)}finally{n.f()}return{name:this.name,layers:t}}}],[{key:"fromConfig",value:function(e,t){var r,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new lg("Legacy serialization format not supported yet.");r=t}else me(null!=t.layers,(function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."})),r=t.layers,delete t.layers,i=t;var o=new e(i);if(!(o instanceof n))throw new pg("Sequential.fromConfig called on non-Sequential input: ".concat(o));var s,u=q(r);try{for(u.s();!(s=u.n()).done;){var c=s.value,l=void 0,p=Kb(c,l,a);a&&p.setFastWeightInitDuringBuild(!0),o.add(p)}}catch($V){u.e($V)}finally{u.f()}return o}}]),n}(gk);function Tk(e){return new gk(e)}function Ck(e){return new Sk(e)}function Ek(e,t){return null==t&&(t={}),function(e,t){return kk.apply(this,arguments)}(e,t)}function Ak(e){return Ob(e)}function Rk(e,t){Gb.registerCallbackConstructor(e,t)}Sk.className="Sequential",fu(Sk);var _k=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"getConfig",value:function(){return{}}}]),n}(lu),Fk=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Ty(e,t)}}]),n}(_k);Fk.className="elu",fu(Fk);var Dk=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"apply",value:function(e){return yf(e)}}]),n}(_k);Dk.className="selu",fu(Dk);var Ok=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"apply",value:function(e){return cf(e)}}]),n}(_k);Ok.className="relu",fu(Ok);var Mk=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"apply",value:function(e){return Du((function(){return Dp(6,cf(e))}))}}]),n}(_k);Mk.className="relu6",fu(Mk);var Lk=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"apply",value:function(e){return e}}]),n}(_k);Lk.className="linear",fu(Lk);var zk=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"apply",value:function(e){return $c(e)}}]),n}(_k);zk.className="sigmoid",fu(zk);var Pk=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"apply",value:function(e){return function(e){return Du((function(){var t=ju(.5,Xu(.2,e));return fl(t,0,1)}))}(e)}}]),n}(_k);Pk.className="hardSigmoid",fu(Pk);var Zk=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"apply",value:function(e){return sp(e)}}]),n}(_k);Zk.className="softplus",fu(Zk);var Bk=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"apply",value:function(e){return function(e){return Du((function(){return Ku(e,ju(dc(e),1))}))}(e)}}]),n}(_k);Bk.className="softsign",fu(Bk);var Wk=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"apply",value:function(e){return tl(e)}}]),n}(_k);Wk.className="tanh",fu(Wk);var Uk=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return Af(e,t)}}]),n}(_k);Uk.className="softmax",fu(Uk);var Vk=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return pp(e,t)}}]),n}(_k);Vk.className="logSoftmax",fu(Vk);var Gk=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Du((function(){return Xu($c(Xu(e,t)),e)}))}}]),n}(_k);Gk.className="swish",fu(Gk);var Hk=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"apply",value:function(e){return Du((function(){return Xu(e,tl(sp(e)))}))}}]),n}(_k);function jk(e){return e.getClassName()}function qk(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ng(e,pu.getMap().classNameMap,t,"activation")}function Kk(e){if(null==e){var t={className:"linear",config:{}};return qk(t)}if("string"===typeof e){var n={};return n.className=e,n.config={},qk(n)}return e instanceof _k?e:qk(e)}function Xk(e){if(null!=e&&"object"!==typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an "+"object, but received: ".concat(e))}Hk.className="mish",fu(Hk);var Yk=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n)}(lu),Qk=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),r=t.call(this),Xk(e),r.l1=null==e||null==e.l1?.01:e.l1,r.l2=null==e||null==e.l2?.01:e.l2,r.hasL1=0!==r.l1,r.hasL2=0!==r.l2,r}return(0,ee.Z)(n,[{key:"apply",value:function(e){var t=this;return Du((function(){var n=Ap([1]);return t.hasL1&&(n=ju(n,lp(Xu(t.l1,dc(e))))),t.hasL2&&(n=ju(n,lp(Xu(t.l2,Ny(e))))),Xc(n,[])}))}},{key:"getConfig",value:function(){return{l1:this.l1,l2:this.l2}}}],[{key:"fromConfig",value:function(e,t){return new e({l1:t.l1,l2:t.l2})}}]),n}(Yk);Qk.className="L1L2",fu(Qk);var Jk={l1l2:"L1L2"};function $k(e){return kg(e)}function ew(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ng(e,pu.getMap().classNameMap,t,"regularizer")}function tw(e){return null==e?null:"string"===typeof e?ew({className:e in Jk?Jk[e]:e,config:{}}):e instanceof Yk?e:ew(e)}var nw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,null!=e&&(r.maxValue=e.maxValue),r}return(0,ee.Z)(n,[{key:"call",value:function(e,t){e=yb(e);var n=cf(e);return null!=this.maxValue&&(n=fl(n,0,this.maxValue)),n}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={maxValue:this.maxValue},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Rb);nw.className="ReLU",fu(nw);var rw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=.3,null==e&&(e={}),r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return(0,ee.Z)(n,[{key:"call",value:function(e,t){var n=yb(e);return $l(n,this.alpha)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Rb);rw.className="LeakyReLU",fu(rw);var aw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;if((0,$.Z)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),r.supportsMasking=!0,r.alphaInitializer=Yy(e.alphaInitializer||r.DEFAULT_ALPHA_INITIALIZER),r.alphaRegularizer=tw(e.alphaRegularizer),r.alphaConstraint=Wg(e.alphaConstraint),null==e.sharedAxes)r.sharedAxes=null;else if(Array.isArray(e.sharedAxes))r.sharedAxes=e.sharedAxes;else{if("number"!==typeof e.sharedAxes)throw new lg("Expected sharedAxes to be a number or an array of numbers, "+"but got ".concat(e.sharedAxes));r.sharedAxes=[e.sharedAxes]}return r}return(0,ee.Z)(n,[{key:"build",value:function(e){var t=(e=bb(e)).slice(1);if(null!=this.sharedAxes){var n,r=q(this.sharedAxes);try{for(r.s();!(n=r.n()).done;){t[n.value-1]=1}}catch($V){r.e($V)}finally{r.f()}}this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var a={};if(null!=this.sharedAxes)for(var i=1;i<e.length;++i)a[i]=e[i];this.inputSpec=[new Sb({ndim:e.length,axes:a})],this.built=!0}},{key:"call",value:function(e,t){return e=yb(e),Xp(e,this.alpha.read())}},{key:"getConfig",value:function(){var e={alphaInitializer:Xy(this.alphaInitializer),alphaRegularizer:$k(this.alphaRegularizer),alphaConstraint:Zg(this.alphaConstraint),sharedAxes:this.sharedAxes},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Rb);aw.className="PReLU",fu(aw);var iw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;if((0,$.Z)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==r.DEFAULT_ALPHA)throw new pg("Non-default alpha value (".concat(e.alpha,") is not supported by the ")+"ELU layer yet.");return r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return(0,ee.Z)(n,[{key:"call",value:function(e,t){var n=yb(e);return Pl(n)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Rb);iw.className="ELU",fu(iw);var ow=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_THETA=1,null==e&&(e={}),r.theta=null==e.theta?r.DEFAULT_THETA:e.theta,r}return(0,ee.Z)(n,[{key:"call",value:function(e,t){var n=yb(e);return Xu(n,as(ql(n,this.theta),"float32"))}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={theta:this.theta},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Rb);ow.className="ThresholdedReLU",fu(ow);var sw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_AXIS=1,null==e&&(e={}),r.softmax=(new Uk).apply,r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r}return(0,ee.Z)(n,[{key:"call",value:function(e,t){var n=yb(e);return this.softmax(n,this.axis)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={axis:this.axis},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Rb);function uw(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function cw(e,t,n){if("number"===typeof e)return hg(e,t);if(e.length!==t)throw new lg("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers.")+" Received: ".concat(e.length," elements."));for(var r=0;r<t;++r){var a=e[r];if((i=a)!==parseInt(i.toString(),10))throw new lg("The ".concat(n," argument must be an integer or tuple of ").concat(t)+" integers. Received: ".concat(JSON.stringify(e)," including a")+" non-integer number ".concat(a))}return e;var i}function lw(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(null==e)return e;var i,o=t+(t-1)*(a-1);return i="same"===n?e:e-o+1,Math.floor((i+r-1)/r)}function pw(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+cy([n-t,0]);else{if("same"!==r)throw new lg("Unsupport padding mode: ".concat(r,"."));e*=t}return e}function fw(e,t){return Du((function(){return Jg(t),"channelsFirst"===t?As(e,[0,2,3,1]):e}))}function hw(e,t){return Du((function(){return Jg(t),"channelsFirst"===t?As(e,[0,2,3,4,1]):e}))}function dw(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return Du((function(){if(null==i&&(i="channelsLast"),Jg(i),3!==e.shape.length)throw new lg("The input of a conv1dWithBias operation should be 3, but is "+"".concat(e.shape.length," instead."));if(3!==t.shape.length)throw new lg("The kernel for a conv1dWithBias operation should be 3, but is "+"".concat(t.shape.length," instead"));if(null!=n&&1!==n.shape.length)throw new lg("The bias for a conv1dWithBias operation should be 1, but is "+"".concat(t.shape.length," instead"));if("channelsFirst"===i&&(e=As(e,[0,2,1])),"causal"===a)throw new pg("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=yl(e,t,r,"same"===a?"same":"valid","NWC",o);return null!=n&&(s=Sy(s,n)),s}))}function mw(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return Du((function(){if(null==i&&(i="channelsLast"),Jg(i),3!==e.rank&&4!==e.rank)throw new lg("conv2dWithBiasActivation expects input to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));if(3!==t.rank&&4!==t.rank)throw new lg("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));var u=fw(e,i);if("causal"===a)throw new pg("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=xh({x:u,filter:t,strides:r,pad:"same"===a?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:s}),"channelsFirst"===i&&(u=As(u,[0,3,1,2])),u}))}function vw(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;return Du((function(){if(null==i&&(i="channelsLast"),Jg(i),4!==e.rank&&5!==e.rank)throw new lg("conv3dWithBias expects input to be of rank 4 or 5, but received "+"".concat(e.rank,"."));if(4!==t.rank&&5!==t.rank)throw new lg("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+"".concat(e.rank,"."));var s=hw(e,i);if("causal"===a)throw new pg("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=kl(s,t,r,"same"===a?"same":"valid","NDHWC",o),null!=n&&(s=Sy(s,n)),"channelsFirst"===i&&(s=As(s,[0,4,1,2,3])),s}))}sw.className="Softmax",fu(sw);var gw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e,r){var a;if((0,$.Z)(this,n),(a=t.call(this,r)).bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",n.verifyArgs(r),a.rank=e,Ag(a.rank,"rank"),1!==a.rank&&2!==a.rank&&3!==a.rank)throw new pg("Convolution layer for rank other than 1, 2, or 3 (".concat(a.rank,") is ")+"not implemented yet.");if(a.kernelSize=cw(r.kernelSize,e,"kernelSize"),a.strides=cw(null==r.strides?1:r.strides,e,"strides"),a.padding=null==r.padding?"valid":r.padding,$g(a.padding),a.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,Jg(a.dataFormat),a.activation=Kk(r.activation),a.useBias=null==r.useBias||r.useBias,a.biasInitializer=Yy(r.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=Wg(r.biasConstraint),a.biasRegularizer=tw(r.biasRegularizer),a.activityRegularizer=tw(r.activityRegularizer),a.dilationRate=cw(null==r.dilationRate?1:r.dilationRate,e,"dilationRate"),1===a.rank&&Array.isArray(a.dilationRate)&&1!==a.dilationRate.length)throw new lg("dilationRate must be a number or an array of a single number for 1D convolution, but received "+"".concat(JSON.stringify(a.dilationRate)));if(2===a.rank){if("number"===typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate];else if(2!==a.dilationRate.length)throw new lg("dilationRate must be a number or array of two numbers for 2D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)))}else if(3===a.rank)if("number"===typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(3!==a.dilationRate.length)throw new lg("dilationRate must be a number or array of three numbers for 3D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)));return a}return(0,ee.Z)(n,[{key:"getConfig",value:function(){var e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:jk(this.activation),useBias:this.useBias,biasInitializer:Xy(this.biasInitializer),biasRegularizer:$k(this.biasRegularizer),activityRegularizer:$k(this.activityRegularizer),biasConstraint:Zg(this.biasConstraint)},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(dg("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!==typeof e.kernelSize&&!Eg(e.kernelSize,"number",1,3))throw new lg("BaseConv expects config.kernelSize to be number or number[] with "+"length 1, 2, or 3, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(Rb),yw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e,r){var a;return(0,$.Z)(this,n),(a=t.call(this,e,r)).kernel=null,n.verifyArgs(r),a.filters=r.filters,Ag(a.filters,"filters"),a.kernelInitializer=Yy(r.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=Wg(r.kernelConstraint),a.kernelRegularizer=tw(r.kernelRegularizer),a}return(0,ee.Z)(n,[{key:"build",value:function(e){e=bb(e);var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new lg("The channel dimension of the input should be defined. "+"Found ".concat(e[t]));var n=e[t],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:uw({},t,n)}],this.built=!0}},{key:"call",value:function(e,t){var n=this;return Du((function(){var t;e=yb(e);var r=null==n.bias?null:n.bias.read(),a=_g(n.activation.getClassName());if(null!=a&&2===n.rank)t=mw(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate,a);else{if(1===n.rank)t=dw(e,n.kernel.read(),r,n.strides[0],n.padding,n.dataFormat,n.dilationRate[0]);else if(2===n.rank)t=mw(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate);else{if(3!==n.rank)throw new pg("convolutions greater than 3D are not implemented yet.");t=vw(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate)}null!=n.activation&&(t=n.activation.apply(t))}return t}))}},{key:"computeOutputShape",value:function(e){e=bb(e);for(var t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2),r=0;r<n.length;++r){var a=lw(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"===typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);t.push(a)}var i=[e[0]];return"channelsLast"===this.dataFormat?(i=i.concat(t)).push(this.filters):(i.push(this.filters),i=i.concat(t)),i}},{key:"getConfig",value:function(){var e={filters:this.filters,kernelInitializer:Xy(this.kernelInitializer),kernelRegularizer:$k(this.kernelRegularizer),kernelConstraint:Zg(this.kernelConstraint)},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(!("filters"in e)||"number"!==typeof e.filters||e.filters<1)throw new lg("Convolution layer expected config.filters to be a 'number' > 0 "+"but got ".concat(JSON.stringify(e.filters)))}}]),n}(gw),bw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),r=t.call(this,2,e),n.verifyArgs(e),r}return(0,ee.Z)(n,[{key:"getConfig",value:function(){var e=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!==typeof e.kernelSize&&!Eg(e.kernelSize,"number",1,2))throw new lg("Conv2D expects config.kernelSize to be number or number[] with "+"length 1 or 2, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(yw);bw.className="Conv2D",fu(bw);var xw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),r=t.call(this,3,e),n.verifyArgs(e),r}return(0,ee.Z)(n,[{key:"getConfig",value:function(){var e=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!==typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new lg("Conv3D expects config.kernelSize to be number or"+" [number, number, number], but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(yw);xw.className="Conv3D",fu(xw);var kw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;if((0,$.Z)(this,n),(r=t.call(this,e)).inputSpec=[new Sb({ndim:4})],"same"!==r.padding&&"valid"!==r.padding)throw new lg("Conv2DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(r.padding));return r}return(0,ee.Z)(n,[{key:"build",value:function(e){if(4!==(e=bb(e)).length)throw new lg("Input should have rank 4; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new lg("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Sb({ndim:4,axes:uw({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return Du((function(){var t=yb(e);if(4!==t.shape.length)throw new lg("Conv2DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));var r,a,i=t.shape,o=i[0];"channelsFirst"===n.dataFormat?(r=2,a=3):(r=1,a=2);var s=i[r],u=i[a],c=n.kernelSize[0],l=n.kernelSize[1],p=n.strides[0],f=n.strides[1],h=[o,pw(s,p,c,n.padding),pw(u,f,l,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=As(t,[0,2,3,1]));var d=xl(t,n.kernel.read(),h,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(d=As(d,[0,3,1,2])),null!=n.bias&&(d=Sy(d,n.bias.read(),n.dataFormat)),null!=n.activation&&(d=n.activation.apply(d)),d}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=(e=bb(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3):(t=3,n=1,r=2);var i=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return a[t]=this.filters,a[n]=pw(a[n],s,i,this.padding),a[r]=pw(a[r],u,o,this.padding),a}},{key:"getConfig",value:function(){var e=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(bw);kw.className="Conv2DTranspose",fu(kw);var ww=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;if((0,$.Z)(this,n),(r=t.call(this,e)).inputSpec=[new Sb({ndim:5})],"same"!==r.padding&&"valid"!==r.padding)throw new lg("Conv3DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(r.padding));return r}return(0,ee.Z)(n,[{key:"build",value:function(e){if(5!==(e=bb(e)).length)throw new lg("Input should have rank 5; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new lg("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Sb({ndim:5,axes:uw({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return Du((function(){var t=yb(e);if(5!==t.shape.length)throw new lg("Conv3DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));var r,a,i,o=t.shape,s=o[0];"channelsFirst"===n.dataFormat?(i=2,r=3,a=4):(i=1,r=2,a=3);var u=o[i],c=o[r],l=o[a],p=n.kernelSize[0],f=n.kernelSize[1],h=n.kernelSize[2],d=n.strides[0],m=n.strides[1],v=n.strides[2],g=[s,pw(u,d,p,n.padding),pw(c,m,f,n.padding),pw(l,v,h,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=As(t,[0,2,3,4,1]));var y=Nl(t,n.kernel.read(),g,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(y=As(y,[0,4,1,2,3])),null!==n.bias&&(y=Sy(y,n.bias.read(),n.dataFormat)),null!==n.activation&&(y=n.activation.apply(y)),y}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a,i=(e=bb(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3,a=4):(t=4,n=1,r=2,a=3);var o=this.kernelSize[0],s=this.kernelSize[1],u=this.kernelSize[2],c=this.strides[0],l=this.strides[1],p=this.strides[2];return i[t]=this.filters,i[n]=pw(i[n],c,o,this.padding),i[r]=pw(i[r],l,s,this.padding),i[a]=pw(i[a],p,u,this.padding),i}},{key:"getConfig",value:function(){var e=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(xw);ww.className="Conv3DTranspose",fu(ww);var Nw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e,r){var a;if((0,$.Z)(this,n),(a=t.call(this,e,r)).DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,null==r.filters)throw new lg("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=r.kernelInitializer||null!=r.kernelRegularizer||null!=r.kernelConstraint)throw new lg("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=r.padding&&"same"!==r.padding&&"valid"!==r.padding)throw new lg("SeparableConv".concat(a.rank,"D supports only padding modes: ")+"'same' and 'valid', but received ".concat(JSON.stringify(r.padding)));return a.depthMultiplier=null==r.depthMultiplier?1:r.depthMultiplier,a.depthwiseInitializer=Yy(r.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=tw(r.depthwiseRegularizer),a.depthwiseConstraint=Wg(r.depthwiseConstraint),a.pointwiseInitializer=Yy(r.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=tw(r.pointwiseRegularizer),a.pointwiseConstraint=Wg(r.pointwiseConstraint),a}return(0,ee.Z)(n,[{key:"build",value:function(e){if((e=bb(e)).length<this.rank+2)throw new lg("Inputs to SeparableConv".concat(this.rank,"D should have rank ")+"".concat(this.rank+2,", but received input shape: ")+"".concat(JSON.stringify(e)));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new lg("The channel dimension of the inputs should be defined, "+"but found ".concat(JSON.stringify(e[t])));for(var n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),a=[],i=0;i<this.rank;++i)a.push(1);a.push(n*this.depthMultiplier,this.filters);var o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new Sb({ndim:this.rank+2,axes:uw({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return Du((function(){var t;if(e=yb(e),1===n.rank)throw new pg("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(e=As(e,[0,2,3,1])),t=bf(e,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(t=Sy(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),"channelsFirst"===n.dataFormat&&(t=As(t,[0,3,1,2])),t}))}},{key:"getConfig",value:function(){var e=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Xy(this.depthwiseInitializer),e.pointwiseInitializer=Xy(this.pointwiseInitializer),e.depthwiseRegularizer=$k(this.depthwiseRegularizer),e.pointwiseRegularizer=$k(this.pointwiseRegularizer),e.depthwiseConstraint=Zg(this.depthwiseConstraint),e.pointwiseConstraint=Zg(this.pointwiseConstraint),e}}]),n}(yw);Nw.className="SeparableConv";var Iw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){return(0,$.Z)(this,n),t.call(this,2,e)}return(0,ee.Z)(n)}(Nw);Iw.className="SeparableConv2D",fu(Iw);var Sw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),r=t.call(this,1,e),n.verifyArgs(e),r.inputSpec=[{ndim:3}],r}return(0,ee.Z)(n,[{key:"getConfig",value:function(){var e=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.dataFormat,e}}],[{key:"verifyArgs",value:function(e){if("number"!==typeof e.kernelSize&&!Eg(e.kernelSize,"number",1,1))throw new lg("Conv1D expects config.kernelSize to be number or number[] with "+"length 1, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(yw);Sw.className="Conv1D",fu(Sw);var Tw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),r=t.call(this,e),"number"===typeof e.cropping?r.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"===typeof e.cropping[0]?r.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:r.cropping=e.cropping,r.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,r.inputSpec=[{ndim:4}],r}return(0,ee.Z)(n,[{key:"computeOutputShape",value:function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}},{key:"call",value:function(e,t){var n=this;return Du((function(){if(e=yb(e),"channelsLast"===n.dataFormat){var t=vy(e,n.cropping[0][0],e.shape[1]-n.cropping[0][0]-n.cropping[0][1],2);return vy(t,n.cropping[1][0],e.shape[2]-n.cropping[1][1]-n.cropping[1][0],3)}var r=vy(e,n.cropping[0][0],e.shape[2]-n.cropping[0][0]-n.cropping[0][1],3);return vy(r,n.cropping[1][0],e.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)}))}},{key:"getConfig",value:function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Rb);Tw.className="Cropping2D",fu(Tw);var Cw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r,a;return(0,$.Z)(this,n),(r=t.call(this,e)).DEFAULT_SIZE=[2,2],r.inputSpec=[{ndim:4}],r.size=null==e.size?r.DEFAULT_SIZE:e.size,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Jg(r.dataFormat),r.interpolation=null==e.interpolation?"nearest":e.interpolation,a=r.interpolation,Cg(qg,"InterpolationFormat",a),r}return(0,ee.Z)(n,[{key:"computeOutputShape",value:function(e){if("channelsFirst"===this.dataFormat){var t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}var r=null==e[1]?null:this.size[0]*e[1],a=null==e[2]?null:this.size[1]*e[2];return[e[0],r,a,e[3]]}},{key:"call",value:function(e,t){var n=this;return Du((function(){var t=yb(e),r=t.shape;if("channelsFirst"===n.dataFormat){t=As(t,[0,2,3,1]);var a=n.size[0]*r[2],i=n.size[1]*r[3],o="nearest"===n.interpolation?_d.resizeNearestNeighbor(t,[a,i]):_d.resizeBilinear(t,[a,i]);return As(o,[0,3,1,2])}var s=n.size[0]*r[1],u=n.size[1]*r[2];return"nearest"===n.interpolation?_d.resizeNearestNeighbor(t,[s,u]):_d.resizeBilinear(t,[s,u])}))}},{key:"getConfig",value:function(){var e={size:this.size,dataFormat:this.dataFormat},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Rb);Cw.className="UpSampling2D",fu(Cw);var Ew=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this,2,e)).depthwiseKernel=null,r.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,r.depthwiseInitializer=Yy(e.depthwiseInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.depthwiseConstraint=Wg(e.depthwiseConstraint),r.depthwiseRegularizer=tw(e.depthwiseRegularizer),r}return(0,ee.Z)(n,[{key:"build",value:function(e){if((e=bb(e)).length<4)throw new lg("Inputs to DepthwiseConv2D should have rank 4. "+"Received input shape: ".concat(JSON.stringify(e),"."));var t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new lg("The channel dimension of the inputs to DepthwiseConv2D should "+"be defined, but is not (".concat(e[t],")."));var n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return Du((function(){var t=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"valid",a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;return Du((function(){null==a&&(a="channelsLast"),Jg(a);var o=fw(e,a);if(4!==e.rank)throw new lg("Input for depthwiseConv2d is required to be 4-D, but is instead "+"".concat(e.rank,"-D"));if(4!==t.rank)throw new lg("depthwiseKernel is required to be 4-D, but is instead "+"".concat(t.rank,"-D"));return o=Rl(o,t,n,"same"===r?"same":"valid","NHWC",i),"channelsFirst"===a&&(o=As(o,[0,3,1,2])),o}))}(e=yb(e),n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat,null);return n.useBias&&(t=Sy(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),t}))}},{key:"computeOutputShape",value:function(e){e=bb(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,a=lw(t,this.kernelSize[0],this.padding,this.strides[0]),i=lw(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],r,a,i]:[e[0],a,i,r]}},{key:"getConfig",value:function(){var e=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Xy(this.depthwiseInitializer),e.depthwiseRegularizer=$k(this.depthwiseRegularizer),e.depthwiseConstraint=Zg(this.depthwiseRegularizer),e}}]),n}(gw);function Aw(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new lg("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function a(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=a(t),constants:n=a(n)}}function Rw(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return Du((function(){var u=t.shape.length;if(u<3)throw new lg("Input should be at least 3D, but is ".concat(u,"D."));var c=[1,0].concat(ly(2,u));if(t=As(t,c),null!=i)throw new pg("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=a&&((a=as(as(a,"bool"),"float32")).rank===u-1&&(a=Wl(a,-1)),a=As(a,c)),r&&(t=pf(t,0),null!=a&&(a=pf(a,0)));var l,p,f=[],h=n,d=t.shape[0],m=Yf(t);null!=a&&(p=Yf(a));for(var v,g=function(t){var n=m[t],r=Du((function(){return e(n,h)}));if(null==a)l=r[0],h=r[1];else{var i=Du((function(){var e=p[t],n=fc(Bp(e),e);return{output:ju(Xu(r[0],e),Xu(h[0],n)),newStates:h.map((function(t,a){return ju(Xu(r[1][a],e),Xu(t,n))}))}}));l=i.output,h=i.newStates}s&&f.push(l)},y=0;y<d;++y)g(y);if(s){v=zf(f,1)}return[l,v,h]}))}Ew.className="DepthwiseConv2D",fu(Ew);var _w=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r,a;if((0,$.Z)(this,n),r=t.call(this,e),null==e.cell)throw new lg("cell property is missing for the constructor of RNN.");if(null==(a=Array.isArray(e.cell)?new Zw({cells:e.cell}):e.cell).stateSize)throw new lg("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=a,r.returnSequences=null!=e.returnSequences&&e.returnSequences,r.returnState=null!=e.returnState&&e.returnState,r.goBackwards=null!=e.goBackwards&&e.goBackwards,r._stateful=null!=e.stateful&&e.stateful,r.unroll=null!=e.unroll&&e.unroll,r.supportsMasking=!0,r.inputSpec=[new Sb({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],r}return(0,ee.Z)(n,[{key:"getStates",value:function(){return null==this.states_?ly(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((function(e){return null})):this.states_}},{key:"setStates",value:function(e){this.states_=e}},{key:"computeOutputShape",value:function(e){vb(e)&&(e=e[0]),e=e;var t=this.cell.stateSize;Array.isArray(t)||(t=[t]);var n,r=t[0];if(n=this.returnSequences?[e[0],e[1],r]:[e[0],r],this.returnState){var a,i=[],o=q(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push([e[0],s])}}catch($V){o.e($V)}finally{o.f()}return[n].concat(i)}return n}},{key:"computeMask",value:function(e,t){var n=this;return Du((function(){Array.isArray(t)&&(t=t[0]);var e=n.returnSequences?t:null;if(n.returnState){var r=n.states.map((function(e){return null}));return[e].concat(r)}return e}))}},{key:"states",get:function(){if(null==this.states_){for(var e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[],n=0;n<e;++n)t.push(null);return t}return this.states_},set:function(e){this.states_=e}},{key:"build",value:function(e){if(null!=this.numConstants)throw new pg("Constants support is not implemented in RNN yet.");vb(e)&&(e=e[0]),e=e;var t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new Sb({shape:[t,null].concat(Y(n))});var r,a=[e[0]].concat(e.slice(2));if(this.cell.build(a),r=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!ke(this.stateSpec.map((function(e){return e.shape[e.shape.length-1]})),r))throw new lg("An initialState was passed that is not compatible with "+"cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; ")+"However cell.stateSize is ".concat(this.cell.stateSize))}else this.stateSpec=r.map((function(e){return new Sb({shape:[null,e]})}));this.stateful&&this.resetStates()}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Du((function(){if(!t.stateful)throw new ug("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape[0];if(null==r)throw new lg("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.states_)Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return Ap([r,e])})):t.states_=[Ap([r,t.cell.stateSize])];else if(null==e)Ou(t.states_),null!=t.keptStates&&(Ou(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return Ap([r,e])})):t.states_[0]=Ap([r,t.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new lg("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));!0===n?t.keptStates.push(t.states_.slice()):Ou(t.states_);for(var a=0;a<t.states_.length;++a){var i=e[a],o=Array.isArray(t.cell.stateSize)?t.cell.stateSize[a]:t.cell.stateSize,s=[r,o];if(!ke(i.shape,s))throw new lg("State ".concat(a," is incompatible with layer ").concat(t.name,": ")+"expected shape=".concat(s,", received shape=").concat(i.shape));t.states_[a]=i}}t.states_=t.states_.map((function(e){return Mu(e.clone())}))}))}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=Aw(e,r,a,this.numConstants);e=i.inputs,r=i.initialState,a=i.constants;var o=[],s=[];if(null!=r){t.initialState=r,o=o.concat(r),this.stateSpec=[];var u,c=q(r);try{for(c.s();!(u=c.n()).done;){var l=u.value;this.stateSpec.push(new Sb({shape:l.shape}))}}catch($V){c.e($V)}finally{c.f()}s=s.concat(this.stateSpec)}if(null!=a&&(t.constants=a,o=o.concat(a),this.numConstants=a.length),o[0]instanceof Tb){var p=[e].concat(o),f=this.inputSpec.concat(s),h=this.inputSpec;this.inputSpec=f;var d=qb((0,rg.Z)(n.prototype),"apply",this).call(this,p,t);return this.inputSpec=h,d}return qb((0,rg.Z)(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return Du((function(){var r=null==t?null:t.mask,a=null==t?null:t.training,i=null==t?null:t.initialState;e=yb(e),null==i&&(i=n.stateful?n.states_:n.getInitialState(e));var o=Array.isArray(n.cell.stateSize)?n.cell.stateSize.length:1;if(i.length!==o)throw new lg("RNN Layer has ".concat(o," state(s) but was passed ")+"".concat(i.length," initial state(s)."));n.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:a},u=Rw((function(e,t){var r=n.cell.call([e].concat(t),s);return[r[0],r.slice(1)]}),e,i,n.goBackwards,r,null,n.unroll,n.returnSequences),c=u[0],l=u[1],p=u[2];n.stateful&&n.resetStates(p,a);var f=n.returnSequences?l:c;return n.returnState?[f].concat(p):f}))}},{key:"getInitialState",value:function(e){var t=this;return Du((function(){var n=Ap(e.shape);return n=fy(n=lp(n,[1,2])),Array.isArray(t.cell.stateSize)?t.cell.stateSize.map((function(e){return e>1?by(n,[1,e]):n})):t.cell.stateSize>1?[by(n,[1,t.cell.stateSize])]:[n]}))}},{key:"trainableWeights",get:function(){return this.trainable?this.cell.trainableWeights:[]}},{key:"nonTrainableWeights",get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}},{key:"setFastWeightInitDuringBuild",value:function(e){qb((0,rg.Z)(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);var r=this.cell.getConfig();return this.getClassName()===n.className&&(t.cell={className:this.cell.getClassName(),config:r}),Object.assign({},r,e,t)}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.cell,a=Kb(r,n);return new e(Object.assign(t,{cell:a}))}}]),n}(Rb);_w.className="RNN",fu(_w);var Fw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n)}(Rb),Dw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,Ag(r.units,"units"),r.activation=Kk(null==e.activation?r.DEFAULT_ACTIVATION:e.activation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Yy(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Yy(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Yy(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=tw(e.kernelRegularizer),r.recurrentRegularizer=tw(e.recurrentRegularizer),r.biasRegularizer=tw(e.biasRegularizer),r.kernelConstraint=Wg(e.kernelConstraint),r.recurrentConstraint=Wg(e.recurrentConstraint),r.biasConstraint=Wg(e.biasConstraint),r.dropout=uy([1,cy([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=uy([1,cy([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return(0,ee.Z)(n,[{key:"build",value:function(e){e=bb(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return Du((function(){if(2!==(e=e).length)throw new lg("SimpleRNNCell expects 2 input Tensors, got ".concat(e.length,"."));var r=e[1];e=e[0];var a,i=null!=t.training&&t.training;0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=Bw({ones:function(){return Bp(e)},rate:n.dropout,training:i,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=Bw({ones:function(){return Bp(r)},rate:n.recurrentDropout,training:i,dropoutFunc:n.dropoutFunc}));var o=n.dropoutMask,s=n.recurrentDropoutMask;a=ky(null!=o?Xu(e,o):e,n.kernel.read()),null!=n.bias&&(a=Sy(a,n.bias.read())),null!=s&&(r=Xu(r,s));var u=ju(a,ky(r,n.recurrentKernel.read()));return null!=n.activation&&(u=n.activation.apply(u)),[u,u]}))}},{key:"getConfig",value:function(){var e=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:jk(this.activation),useBias:this.useBias,kernelInitializer:Xy(this.kernelInitializer),recurrentInitializer:Xy(this.recurrentInitializer),biasInitializer:Xy(this.biasInitializer),kernelRegularizer:$k(this.kernelRegularizer),recurrentRegularizer:$k(this.recurrentRegularizer),biasRegularizer:$k(this.biasRegularizer),activityRegularizer:$k(this.activityRegularizer),kernelConstraint:Zg(this.kernelConstraint),recurrentConstraint:Zg(this.recurrentConstraint),biasConstraint:Zg(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},e,t)}}]),n}(Fw);Dw.className="SimpleRNNCell",fu(Dw);var Ow=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){return(0,$.Z)(this,n),e.cell=new Dw(e),t.call(this,e)}return(0,ee.Z)(n,[{key:"call",value:function(e,t){var r=this;return Du((function(){null!=r.cell.dropoutMask&&(Ou(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Ou(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return qb((0,rg.Z)(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(_w);Ow.className="SimpleRNN",fu(Ow);var Mw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;if((0,$.Z)(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new lg("GRUCell does not support reset_after parameter set to true.");return r.units=e.units,Ag(r.units,"units"),r.activation=Kk(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=Kk(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Yy(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Yy(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Yy(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=tw(e.kernelRegularizer),r.recurrentRegularizer=tw(e.recurrentRegularizer),r.biasRegularizer=tw(e.biasRegularizer),r.kernelConstraint=Wg(e.kernelConstraint),r.recurrentConstraint=Wg(e.recurrentConstraint),r.biasConstraint=Wg(e.biasConstraint),r.dropout=uy([1,cy([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=uy([1,cy([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.implementation=e.implementation,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return(0,ee.Z)(n,[{key:"build",value:function(e){var t=(e=bb(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return Du((function(){if(2!==(e=e).length)throw new lg("GRUCell expects 2 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));var r=null!=t.training&&t.training,a=e[1];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=Bw({ones:function(){return Bp(e)},rate:n.dropout,training:r,count:3,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=Bw({ones:function(){return Bp(a)},rate:n.recurrentDropout,training:r,count:3,dropoutFunc:n.dropoutFunc}));var i,o,s,u=n.dropoutMask,c=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=Xu(e,u[0]));var l=ky(e,n.kernel.read());n.useBias&&(l=Sy(l,n.bias.read())),0<n.recurrentDropout&&n.recurrentDropout<1&&(a=Xu(a,c[0]));var p=n.recurrentKernel.read(),f=Df(p,[2*n.units,n.units],p.rank-1),h=(0,oe.Z)(f,2),d=h[0],m=h[1],v=ky(a,d),g=Df(l,3,l.rank-1),y=(0,oe.Z)(g,3),b=y[0],x=y[1],k=y[2],w=Df(v,2,v.rank-1),N=(0,oe.Z)(w,2),I=N[0],S=N[1];i=n.recurrentActivation.apply(ju(b,I)),o=n.recurrentActivation.apply(ju(x,S));var T=ky(Xu(o,a),m);s=n.activation.apply(ju(k,T));var C=ju(Xu(i,a),Xu(ju(1,op(i)),s));return[C,C]}))}},{key:"getConfig",value:function(){var e=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:jk(this.activation),recurrentActivation:jk(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Xy(this.kernelInitializer),recurrentInitializer:Xy(this.recurrentInitializer),biasInitializer:Xy(this.biasInitializer),kernelRegularizer:$k(this.kernelRegularizer),recurrentRegularizer:$k(this.recurrentRegularizer),biasRegularizer:$k(this.biasRegularizer),activityRegularizer:$k(this.activityRegularizer),kernelConstraint:Zg(this.kernelConstraint),recurrentConstraint:Zg(this.recurrentConstraint),biasConstraint:Zg(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},e,t)}}]),n}(Fw);Mw.className="GRUCell",fu(Mw);var Lw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){return(0,$.Z)(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Mw(e),t.call(this,e)}return(0,ee.Z)(n,[{key:"call",value:function(e,t){var r=this;return Du((function(){null!=r.cell.dropoutMask&&(Ou(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Ou(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return qb((0,rg.Z)(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(_w);Lw.className="GRU",fu(Lw);var zw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,Ag(r.units,"units"),r.activation=Kk(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=Kk(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Yy(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Yy(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Yy(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.unitForgetBias=e.unitForgetBias,r.kernelRegularizer=tw(e.kernelRegularizer),r.recurrentRegularizer=tw(e.recurrentRegularizer),r.biasRegularizer=tw(e.biasRegularizer),r.kernelConstraint=Wg(e.kernelConstraint),r.recurrentConstraint=Wg(e.recurrentConstraint),r.biasConstraint=Wg(e.biasConstraint),r.dropout=uy([1,cy([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=uy([1,cy([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.implementation=e.implementation,r.stateSize=[r.units,r.units],r.dropoutMask=null,r.recurrentDropoutMask=null,r}return(0,ee.Z)(n,[{key:"build",value:function(e){var t,n,r=(e=bb(e))[e.length-1];if(this.kernel=this.addWeight("kernel",[r,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var a=this.biasInitializer,i=this.units;n=new(t=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"apply",value:function(e,t){var n=a.apply([i]),r=(new Dy).apply([i]),o=a.apply([2*i]);return yy(yy(n,r),o)}}]),n}(_y),t.className="CustomInit",t)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}},{key:"call",value:function(e,t){var n=this;return Du((function(){var r=null!=t.training&&t.training;if(3!==(e=e).length)throw new lg("LSTMCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));var a=e[1],i=e[2];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=Bw({ones:function(){return Bp(e)},rate:n.dropout,training:r,count:4,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=Bw({ones:function(){return Bp(a)},rate:n.recurrentDropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var o,s,u,c,l=n.dropoutMask,p=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=Xu(e,l[0]));var f=ky(e,n.kernel.read());0<n.recurrentDropout&&n.recurrentDropout<1&&(a=Xu(a,p[0])),f=ju(f,ky(a,n.recurrentKernel.read())),n.useBias&&(f=Sy(f,n.bias.read()));var h=Df(f,4,f.rank-1),d=(0,oe.Z)(h,4),m=d[0],v=d[1],g=d[2],y=d[3];o=n.recurrentActivation.apply(m),s=n.recurrentActivation.apply(v),u=ju(Xu(s,i),Xu(o,n.activation.apply(g))),c=n.recurrentActivation.apply(y);var b=Xu(c,n.activation.apply(u));return[b,b,u]}))}},{key:"getConfig",value:function(){var e=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:jk(this.activation),recurrentActivation:jk(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Xy(this.kernelInitializer),recurrentInitializer:Xy(this.recurrentInitializer),biasInitializer:Xy(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:$k(this.kernelRegularizer),recurrentRegularizer:$k(this.recurrentRegularizer),biasRegularizer:$k(this.biasRegularizer),activityRegularizer:$k(this.activityRegularizer),kernelConstraint:Zg(this.kernelConstraint),recurrentConstraint:Zg(this.recurrentConstraint),biasConstraint:Zg(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},e,t)}}]),n}(Fw);zw.className="LSTMCell",fu(zw);var Pw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){return(0,$.Z)(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new zw(e),t.call(this,e)}return(0,ee.Z)(n,[{key:"call",value:function(e,t){var r=this;return Du((function(){null!=r.cell.dropoutMask&&(Ou(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Ou(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return qb((0,rg.Z)(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(_w);Pw.className="LSTM",fu(Pw);var Zw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this,e)).cells=e.cells,r}return(0,ee.Z)(n,[{key:"stateSize",get:function(){var e,t=[],n=q(this.cells.slice().reverse());try{for(n.s();!(e=n.n()).done;){var r=e.value;Array.isArray(r.stateSize)?t.push.apply(t,Y(r.stateSize)):t.push(r.stateSize)}}catch($V){n.e($V)}finally{n.f()}return t}},{key:"call",value:function(e,t){var n=this;return Du((function(){var r,a=(e=e).slice(1),i=[],o=q(n.cells.slice().reverse());try{for(o.s();!(r=o.n()).done;){var s=r.value;Array.isArray(s.stateSize)?i.push(a.splice(0,s.stateSize.length)):i.push(a.splice(0,1))}}catch($V){o.e($V)}finally{o.f()}i.reverse();for(var u,c=[],l=0;l<n.cells.length;++l){var p=n.cells[l];a=i[l],u=0===l?[e[0]].concat(a):[u[0]].concat(a),u=p.call(u,t),c.push(u.slice(1))}a=[];var f,h=q(c.slice().reverse());try{for(h.s();!(f=h.n()).done;){var d,m=f.value;(d=a).push.apply(d,Y(m))}}catch($V){h.e($V)}finally{h.f()}return[u[0]].concat(a)}))}},{key:"build",value:function(e){var t;vb(e)&&(e=e[0]),e=e,this.cells.forEach((function(n,r){ny("RNNCell_".concat(r),(function(){n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]}))})),this.built=!0}},{key:"getConfig",value:function(){var e=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this),t={cells:this.cells.map((function(e){return{className:e.getClassName(),config:e.getConfig()}}))};return Object.assign({},e,t)}},{key:"trainableWeights",get:function(){if(!this.trainable)return[];var e,t=[],n=q(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Y(r.trainableWeights))}}catch($V){n.e($V)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=q(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Y(r.nonTrainableWeights))}}catch($V){n.e($V)}finally{n.f()}if(!this.trainable){var a,i=[],o=q(this.cells);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,Y(s.trainableWeights))}}catch($V){o.e($V)}finally{o.f()}return i.concat(t)}return t}},{key:"getWeights",value:function(){var e,t=[],n=q(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Y(r.weights))}}catch($V){n.e($V)}finally{n.f()}return Nb(t)}},{key:"setWeights",value:function(e){var t,n=[],r=q(this.cells);try{for(r.s();!(t=r.n()).done;)for(var a=t.value,i=a.weights.length,o=e.splice(i),s=0;s<a.weights.length;++s)n.push([a.weights[s],o[s]])}catch($V){r.e($V)}finally{r.f()}Ib(n)}}],[{key:"fromConfig",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=[],i=q(t.cells);try{for(i.s();!(n=i.n()).done;){var o=n.value;a.push(Kb(o,r))}}catch($V){i.e($V)}finally{i.f()}return new e({cells:a})}}]),n}(Fw);function Bw(e){var t=e.ones,n=e.rate,r=e.training,a=void 0!==r&&r,i=e.count,o=void 0===i?1:i,s=e.dropoutFunc,u=function(){return null!=s?s(t(),n):Cy(t(),n)},c=function(){return Ey(u,t,a)};return!o||o<=1?Mu(c().clone()):Array(o).fill(void 0).map(c).map((function(e){return Mu(e.clone())}))}Zw.className="StackedRNNCells",fu(Zw);var Ww=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},Uw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;if((0,$.Z)(this,n),e.unroll)throw new pg("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new pg("It is not possible at the moment to stack convolutional cells.");return(r=t.call(this,e)).inputSpec=[new Sb({ndim:5})],r}return(0,ee.Z)(n,[{key:"call",value:function(e,t){var r=this;return Du((function(){if(null!=r.cell.dropoutMask&&(Ou(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Ou(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),t&&t.constants)throw new lg("ConvRNN2D cell does not support constants");var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return qb((0,rg.Z)(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}},{key:"computeOutputShape",value:function(e){var t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0]].concat(Y(t.slice(2)))),this.returnState&&(t=[t].concat(Y(Array(2).fill([e[0]].concat(Y(t.slice(-3))))))),t}},{key:"getInitialState",value:function(e){var t=this;return Du((function(){var n=t.cell.stateSize,r=e.shape,a=t.computeSingleOutputShape(r),i=Ap([a[0]].concat(Y(a.slice(2))));return Array.isArray(n)?Array(n.length).fill(i):[i]}))}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Du((function(){if(!t.stateful)throw new ug("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape,a=t.computeSingleOutputShape(r),i=[a[0]].concat(Y(a.slice(2)));if(null==r[0])throw new lg("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.getStates())Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return Ap(i)})):t.states_=[Ap(i)];else if(null==e)Ou(t.states_),null!=t.keptStates&&(Ou(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return Ap(i)})):t.states_[0]=Ap(i);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new lg("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));n?t.keptStates.push(t.states_.slice()):Ou(t.states_);for(var o=0;o<t.states_.length;++o){var s=e[o],u=i;if(!ke(s.shape,u))throw new lg("State ".concat(o," is incompatible with layer ").concat(t.name,": ")+"expected shape=".concat(u,", received shape=").concat(s.shape));t.states_[o]=s}}t.states_=t.states_.map((function(e){return Mu(e.clone())}))}))}},{key:"computeSingleOutputShape",value:function(e){var t=this.cell,n=t.dataFormat,r=t.filters,a=t.kernelSize,i=t.padding,o=t.strides,s=t.dilationRate,u="channelsFirst"===n,c=e[u?3:2],l=e[u?4:3],p=lw(c,a[0],i,o[0],s[0]),f=lw(l,a[1],i,o[1],s[1]);return[].concat(Y(e.slice(0,2)),Y(u?[r,p,f]:[p,f,r]))}}]),n}(_w);Uw.className="ConvRNN2D";var Vw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;(0,$.Z)(this,n);var a=e.filters,i=e.kernelSize,o=e.strides,s=e.padding,u=e.dataFormat,c=e.dilationRate;return(r=t.call(this,Object.assign({},e,{units:a}))).filters=a,Ag(r.filters,"filters"),r.kernelSize=cw(i,2,"kernelSize"),r.kernelSize.forEach((function(e){return Ag(e,"kernelSize")})),r.strides=cw(o||1,2,"strides"),r.strides.forEach((function(e){return Ag(e,"strides")})),r.padding=s||"valid",$g(r.padding),r.dataFormat=u||"channelsLast",Jg(r.dataFormat),r.dilationRate=cw(c||1,2,"dilationRate"),r.dilationRate.forEach((function(e){return Ag(e,"dilationRate")})),r}return(0,ee.Z)(n,[{key:"build",value:function(e){var t;e=bb(e);var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new lg("The channel dimension of the input should be defined. "+"Found ".concat(e[n]));var r=e[n],a=this.kernelSize.concat([r,4*this.filters]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var i=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",i,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var o;if(this.unitForgetBias){var s=this.biasInitializer,u=this.filters;o=new(t=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"apply",value:function(e,t){return gy([s.apply([u]),Rp([u]),s.apply([2*u])])}}]),n}(_y),t.className="CustomInit",t)}else o=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,o,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}},{key:"call",value:function(e,t){var n=this;return Du((function(){if(3!==e.length)throw new lg("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));var r=t.training||!1,a=e[0],i=e[1],o=e[2];0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=Bw({ones:function(){return Bp(a)},rate:n.dropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var s=n.dropoutMask,u=function(e,t,n){return t&&t[n]?Xu(t[n],e):e},c=u(a,s,0),l=u(a,s,1),p=u(a,s,2),f=u(a,s,3);0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=Bw({ones:function(){return Bp(i)},rate:n.recurrentDropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var h=n.recurrentDropoutMask,d=u(i,h,0),m=u(i,h,1),v=u(i,h,2),g=u(i,h,3),y=Df(n.kernel.read(),4,3),b=(0,oe.Z)(y,4),x=b[0],k=b[1],w=b[2],N=b[3],I=n.useBias?Df(n.bias.read(),4):[null,null,null,null],S=(0,oe.Z)(I,4),T=S[0],C=S[1],E=S[2],A=S[3];c=n.inputConv(c,x,T,n.padding),l=n.inputConv(l,k,C,n.padding),p=n.inputConv(p,w,E,n.padding),f=n.inputConv(f,N,A,n.padding);var R=Df(n.recurrentKernel.read(),4,3),_=(0,oe.Z)(R,4),F=_[0],D=_[1],O=_[2],M=_[3];d=n.recurrentConv(d,F),m=n.recurrentConv(m,D),v=n.recurrentConv(v,O),g=n.recurrentConv(g,M);var L=n.recurrentActivation.apply(ju(c,d)),z=n.recurrentActivation.apply(ju(l,m)),P=ju(Xu(z,o),Xu(L,n.activation.apply(ju(p,v)))),Z=Xu(n.recurrentActivation.apply(ju(f,g)),n.activation.apply(P));return[Z,Z,P]}))}},{key:"getConfig",value:function(){var e=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this),t=(e.units,Ww(e,["units"])),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},t,r)}},{key:"inputConv",value:function(e,t,n,r){var a=gl(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?Sy(a,n,this.dataFormat):a}},{key:"recurrentConv",value:function(e,t){return gl(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}]),n}(zw);Vw.className="ConvLSTM2DCell",fu(Vw);var Gw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){(0,$.Z)(this,n);var r=new Vw(e);return t.call(this,Object.assign({},e,{cell:r}))}return(0,ee.Z)(n,null,[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(Uw);Gw.className="ConvLSTM2D",fu(Gw);var Hw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this,e)).rate=Math.max(Math.min(e.rate,1),0),r.noiseShape=e.noiseShape,r.seed=e.seed,r.supportsMasking=!0,r}return(0,ee.Z)(n,[{key:"getNoiseShape",value:function(e){if(null==this.noiseShape)return this.noiseShape;for(var t=e.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n}},{key:"call",value:function(e,t){var n=this;return Du((function(){n.invokeCallHook(e,t);var r=yb(e);if(0<n.rate&&n.rate<1){var a=null!=t.training&&t.training,i=n.getNoiseShape(r);return Ey((function(){return Cy(r,n.rate,i,n.seed)}),(function(){return r}),a)}return e}))}},{key:"getConfig",value:function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"dispose",value:function(){return qb((0,rg.Z)(n.prototype),"dispose",this).call(this)}}]),n}(Rb);Hw.className="Dropout",fu(Hw);var jw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this,e)).inputSpec=[{ndim:3}],r}return(0,ee.Z)(n,[{key:"getNoiseShape",value:function(e){var t=e.shape;return[t[0],1,t[2]]}}]),n}(Hw);jw.className="SpatialDropout1D",fu(jw);var qw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;if((0,$.Z)(this,n),(r=t.call(this,e)).activation=null,r.useBias=!0,r.kernel=null,r.bias=null,r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){var a=null;null!=e.batchSize&&(a=e.batchSize),r.batchInputShape=[a,e.inputDim]}return r.units=e.units,Ag(r.units,"units"),r.activation=Kk(e.activation),null!=e.useBias&&(r.useBias=e.useBias),r.kernelInitializer=Yy(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.biasInitializer=Yy(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelConstraint=Wg(e.kernelConstraint),r.biasConstraint=Wg(e.biasConstraint),r.kernelRegularizer=tw(e.kernelRegularizer),r.biasRegularizer=tw(e.biasRegularizer),r.activityRegularizer=tw(e.activityRegularizer),r.supportsMasking=!0,r.inputSpec=[{minNDim:2}],r}return(0,ee.Z)(n,[{key:"build",value:function(e){var t=(e=bb(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:uw({},-1,t)}],this.built=!0}},{key:"computeOutputShape",value:function(e){var t=(e=bb(e)).slice();return t[t.length-1]=this.units,t}},{key:"call",value:function(e,t){var n=this;return Du((function(){n.invokeCallHook(e,t);var r,a=yb(e),i=_g(n.activation.getClassName());return null!=i?r=ky(a,n.kernel.read(),i,n.bias?n.bias.read():null):(r=ky(a,n.kernel.read()),null!=n.bias&&(r=Sy(r,n.bias.read())),null!=n.activation&&(r=n.activation.apply(r))),r}))}},{key:"getConfig",value:function(){var e={units:this.units,activation:jk(this.activation),useBias:this.useBias,kernelInitializer:Xy(this.kernelInitializer),biasInitializer:Xy(this.biasInitializer),kernelRegularizer:$k(this.kernelRegularizer),biasRegularizer:$k(this.biasRegularizer),activityRegularizer:$k(this.activityRegularizer),kernelConstraint:Zg(this.kernelConstraint),biasConstraint:Zg(this.biasConstraint)},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Rb);qw.className="Dense",fu(qw);var Kw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),e=e||{},(r=t.call(this,e)).inputSpec=[{minNDim:3}],r.dataFormat=e.dataFormat,r}return(0,ee.Z)(n,[{key:"computeOutputShape",value:function(e){var t,n=q((e=bb(e)).slice(1));try{for(n.s();!(t=n.n()).done;){if(null==t.value)throw new lg('The shape of the input to "Flatten" is not fully defined '+"(got ".concat(e.slice(1),"). Make sure to pass a complete ")+'"input_shape" or "batch_input_shape" argument to the first layer in your model.')}}catch($V){n.e($V)}finally{n.f()}return[e[0],sy(e,1)]}},{key:"call",value:function(e,t){var n=this;return Du((function(){n.invokeCallHook(e,t);var r=yb(e);if("channelsFirst"===n.dataFormat&&r.rank>1){for(var a=[0],i=2;i<r.rank;++i)a.push(i);a.push(1),r=As(r,a)}return function(e){if(e.rank<=1)throw new lg("batchFlatten requires a minimum rank of 2. Got rank: ".concat(e.rank,"."));var t=[e.shape[0],sy(e.shape,1)];return Xc(e,t)}(r)}))}},{key:"getConfig",value:function(){var e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);var t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Rb);Kw.className="Flatten",fu(Kw);var Xw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this,e)).supportsMasking=!0,r.activation=Kk(e.activation),r}return(0,ee.Z)(n,[{key:"call",value:function(e,t){var n=this;return Du((function(){n.invokeCallHook(e,t);var r=yb(e);return n.activation.apply(r)}))}},{key:"getConfig",value:function(){var e={activation:jk(this.activation)},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Rb);Xw.className="Activation",fu(Xw);var Yw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this,e)).n=e.n,r.inputSpec=[{ndim:2}],r}return(0,ee.Z)(n,[{key:"computeOutputShape",value:function(e){return[e[0],this.n,e[1]]}},{key:"call",value:function(e,t){var n=this;return Du((function(){return e=yb(e),t=e,r=n.n,Du((function(){if(2!==t.shape.length)throw new lg("repeat() expects a rank-2 tensor, but received a "+"rank-".concat(t.shape.length," tensor."));return by(fy(t,1),[1,r,1])}));var t,r}))}},{key:"getConfig",value:function(){var e={n:this.n},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Rb);Yw.className="RepeatVector",fu(Yw);var Qw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;(0,$.Z)(this,n),(r=t.call(this,e)).targetShape=e.targetShape;for(var a=0;a<r.targetShape.length;++a)r.isUnknown(r.targetShape[a])&&(r.targetShape[a]=null);return r}return(0,ee.Z)(n,[{key:"isUnknown",value:function(e){return e<0||null==e}},{key:"fixUnknownDimension",value:function(e,t){for(var n="Total size of new array must be unchanged.",r=t.slice(),a=1,i=null,o=0;o<r.length;++o){var s=r[o];if(this.isUnknown(s)){if(null!==i)throw new lg("Can only specifiy one unknown dimension.");i=o}else a*=s}var u=sy(e);if(null!==i){if(0===a||u%a!==0)throw new lg(n);r[i]=u/a}else if(u!==a)throw new lg(n);return r}},{key:"computeOutputShape",value:function(e){for(var t=!1,n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}},{key:"call",value:function(e,t){var n=this;return Du((function(){n.invokeCallHook(e,t);var r=yb(e),a=r.shape,i=a.slice(0,1).concat(n.fixUnknownDimension(a.slice(1),n.targetShape));return Xc(r,i)}))}},{key:"getConfig",value:function(){var e={targetShape:this.targetShape},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Rb);Qw.className="Reshape",fu(Qw);var Jw=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;if((0,$.Z)(this,n),r=t.call(this,e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+"".concat(e.dims," instead."));var a=ly(1,e.dims.length+1);if(!ke(e.dims.slice().sort(),a))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");return r.dims=e.dims,r.dimsIncludingBatch=[0].concat(r.dims),r.inputSpec=[new Sb({ndim:r.dims.length+1})],r}return(0,ee.Z)(n,[{key:"computeOutputShape",value:function(e){var t=(e=bb(e)).slice();return this.dims.forEach((function(n,r){t[r+1]=e[n]})),t}},{key:"call",value:function(e,t){return As(yb(e),this.dimsIncludingBatch)}},{key:"getConfig",value:function(){var e={dims:this.dims},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Rb);Jw.className="Permute",fu(Jw);var $w=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,r.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0,r}return(0,ee.Z)(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this),t={maskValue:this.maskValue};return Object.assign(t,e),t}},{key:"computeMask",value:function(e,t){var n=yb(e);return Sc(Zp(n,this.maskValue),-1)}},{key:"call",value:function(e,t){var n=this;return Du((function(){n.invokeCallHook(e,t);var r=yb(e),a=Sc(Zp(r,n.maskValue),-1,!0);return Xu(r,as(a,r.dtype))}))}}]),n}(Rb);$w.className="Masking",fu($w);var eN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;if((0,$.Z)(this,n),(r=t.call(this,e)).embeddings=null,r.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){var a=null;null!=e.batchSize&&(a=e.batchSize),null==e.inputLength?r.batchInputShape=[a,null]:r.batchInputShape=[a].concat(gg(e.inputLength))}return r.inputDim=e.inputDim,Ag(r.inputDim,"inputDim"),r.outputDim=e.outputDim,Ag(r.outputDim,"outputDim"),r.embeddingsInitializer=Yy(e.embeddingsInitializer||r.DEFAULT_EMBEDDINGS_INITIALIZER),r.embeddingsRegularizer=tw(e.embeddingsRegularizer),r.activityRegularizer=tw(e.activityRegularizer),r.embeddingsConstraint=Wg(e.embeddingsConstraint),r.maskZero=e.maskZero,r.supportsMasking=e.maskZero,r.inputLength=e.inputLength,r}return(0,ee.Z)(n,[{key:"build",value:function(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}},{key:"warnOnIncompatibleInputShape",value:function(e){}},{key:"computeMask",value:function(e,t){var n=this;return Du((function(){return n.maskZero?(e=yb(e),Zp(e,Ju(e))):null}))}},{key:"computeOutputShape",value:function(e){if(e=bb(e),null==this.inputLength)return[].concat(Y(e),[this.outputDim]);var t=gg(this.inputLength);if(t.length!==e.length-1)throw new lg('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));for(var n=0,r=0;r<t.length;++r){var a=t[r],i=e[r+1];if(null!=a&&null!=i&&a!==i)throw new lg('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));null==a&&(t[n]=i),n++}return[e[0]].concat(Y(t),[this.outputDim])}},{key:"call",value:function(e,t){var n=this;return Du((function(){n.invokeCallHook(e,t);var r=yb(e);"int32"!==r.dtype&&(r=py(r,"int32"));var a=wy(n.embeddings.read(),Xc(r,[r.size]));return Xc(a,bb(n.computeOutputShape(r.shape)))}))}},{key:"getConfig",value:function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Xy(this.embeddingsInitializer),embeddingsRegularizer:$k(this.embeddingsRegularizer),activityRegularizer:$k(this.activityRegularizer),embeddingsConstraint:Zg(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Rb);eN.className="Embedding",fu(eN);var tN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this,e||{})).supportsMasking=!0,r}return(0,ee.Z)(n,[{key:"mergeFunction",value:function(e){throw new pg}},{key:"computeElementwiseOpOutputShape",value:function(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;for(var n=e.slice(0,e.length-t.length),r=0;r<t.length;++r){var a=e[e.length-t.length+r],i=t[r];if(null==a||null==i||a<0||i<0)n.push(null);else if(1===a)n.push(i);else if(1===i)n.push(a);else{if(a!==i)throw new lg("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(a)}}return n}},{key:"build",value:function(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[bb(e)]),(e=e).length<2)throw new lg("A merge layer should be called on an Array of at least 2 inputs."+" Got ".concat(e.length," input(s)."));var t,n=[],r=q(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;null!=a&&null!==a[0]&&n.push(a[0])}}catch($V){r.e($V)}finally{r.f()}if((n=Sg(n)).length>1)throw new lg("Can not merge tensors with different batch sizes. "+"Got tensors with shapes: ".concat(JSON.stringify(e),"."));for(var i=null==e[0]?null:e[0].slice(1),o=1;o<e.length;++o){var s=null==e[o]?null:e[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}var u=e.map((function(e){return e.length}));-1===e.indexOf(null)&&1===Sg(u).length?this.reshapeRequired=!1:this.reshapeRequired=!0}},{key:"call",value:function(e,t){var n=this;return Du((function(){if(e=e,n.reshapeRequired){var t=[],r=e.map((function(e){return e.rank}));if(-1===r.indexOf(null)){var a,i=cy(r),o=q(e);try{for(o.s();!(a=o.n()).done;){for(var s=a.value,u=s.rank,c=0;c<i-u;++c)s=fy(s,1);t.push(s)}}catch($V){o.e($V)}finally{o.f()}return n.mergeFunction(t)}var l,p=!1,f=q(e);try{for(f.s();!(l=f.n()).done;){var h=l.value,d=h.rank;if(null==d){var m=h.shape,v=m[0],g=m.slice(1).concat([v]),y=Xc(h,[v].concat(sy(m.slice(1))));y=As(y,[1,0]),y=Xc(y,g),t.push(y),p=!0}else if(d>1){var b=ly(1,d).concat([0]);t.push(As(h,b)),p=!0}else t.push(h)}}catch($V){f.e($V)}finally{f.f()}var x=n.mergeFunction(t),k=x.rank;if(p)if(null==k){var w=x.shape,N=w[w.length-1],I=[N].concat(w.slice(0,w.length-1));x=Xc(As(Xc(x,[-1,N]),[1,0]),I)}else if(k>1){var S=[k-1].concat(ly(0,k-1));x=As(x,S)}return x}return n.mergeFunction(e)}))}},{key:"computeOutputShape",value:function(e){var t;t=null==(e=e)[0]?null:e[0].slice(1);for(var n=1;n<e.length;++n){var r=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,r)}var a,i=[],o=q(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;null!=s&&null!==s[0]&&i.push(s[0])}}catch($V){o.e($V)}finally{o.f()}return t=1===(i=Sg(i)).length?i.concat(t):[null].concat(t)}},{key:"computeMask",value:function(e,t){return Du((function(){if(null==t)return null;if(!Array.isArray(t))throw new lg("`mask` should be an Array");if(!Array.isArray(e))throw new lg("`inputs` should be an Array");if(t.length!==e.length)throw new lg("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths "+"(".concat(e.length," vs ").concat(t.length,")"));if(t.every((function(e){return null==e})))return null;for(var n=(t=t.map((function(e){return null==e?e:Wl(e,0)})))[0],r=1;r<t.length-1;++r)n=kp(n,t[r]);return n}))}}]),n}(Rb),nN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){return(0,$.Z)(this,n),t.call(this,e)}return(0,ee.Z)(n,[{key:"mergeFunction",value:function(e){return Du((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=ju(t,e[n]);return t}))}}]),n}(tN);nN.className="Add",fu(nN);var rN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){return(0,$.Z)(this,n),t.call(this,e)}return(0,ee.Z)(n,[{key:"mergeFunction",value:function(e){return Du((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Xu(t,e[n]);return t}))}}]),n}(tN);rN.className="Multiply",fu(rN);var aN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){return(0,$.Z)(this,n),t.call(this,e)}return(0,ee.Z)(n,[{key:"mergeFunction",value:function(e){return Du((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=ju(t,e[n]);return Xu(1/e.length,t)}))}}]),n}(tN);aN.className="Average",fu(aN);var iN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){return(0,$.Z)(this,n),t.call(this,e)}return(0,ee.Z)(n,[{key:"mergeFunction",value:function(e){return Du((function(){for(var t=e[0],n=1;n<e.length;++n)t=mc(t,e[n]);return t}))}}]),n}(tN);iN.className="Maximum",fu(iN);var oN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){return(0,$.Z)(this,n),t.call(this,e)}return(0,ee.Z)(n,[{key:"mergeFunction",value:function(e){return Du((function(){for(var t=e[0],n=1;n<e.length;++n)t=Dp(t,e[n]);return t}))}}]),n}(tN);oN.className="Minimum",fu(oN);var sN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this,e)).DEFAULT_AXIS=-1,null==e&&(e={}),r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r.supportsMasking=!0,r.reshapeRequired=!1,r}return(0,ee.Z)(n,[{key:"build",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new lg("A `Concatenate` layer should be called on a list of at least 2 inputs");var t,n=!0,r=q(e=e);try{for(r.s();!(t=r.n()).done;){if(null!=t.value){n=!1;break}}}catch($V){r.e($V)}finally{r.f()}if(!n){for(var a=[],i=0;i<e.length;++i){var o=e[i].slice();o.splice(this.axis,1);var s,u=!1,c=q(a);try{for(c.s();!(s=c.n()).done;){if(ke(s.value,o)){u=!0;break}}}catch($V){c.e($V)}finally{c.f()}u||a.push(o)}if(a.length>1)throw new lg("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}}},{key:"mergeFunction",value:function(e){var t=this;return Du((function(){return gy(e,t.axis)}))}},{key:"computeOutputShape",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new lg("A `Concatenate` layer should be called on a list of inputs.");var t,n=e,r=n[0].slice(),a=this.axis<0?r.length+this.axis:this.axis,i=q(n.slice(1));try{for(i.s();!(t=i.n()).done;){var o=t.value;if(null==r[a]||null==o[a]){r[a]=null;break}r[a]+=o[a]}}catch($V){i.e($V)}finally{i.f()}return r}},{key:"computeMask",value:function(e,t){var n=this;if(null==t)return null;if(!Array.isArray(t))throw new lg("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new lg("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new lg("Mismatch in the length of mask (".concat(t.length,") ")+"and the legnth of inputs (".concat(e.length,")"));return Du((function(){var r=!0;if(t.forEach((function(e){null==e||(r=!1)})),r)return null;for(var a=[],i=0;i<e.length;++i)null==t[i]?a.push(as(Bp(e[i]),"bool")):t[i].rank<e[i].rank?a.push(Wl(t[i],-1)):a.push(t[i]);var o=Jc(a,n.axis);return Ic(o,-1,!1)}))}},{key:"getConfig",value:function(){var e={axis:this.axis},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(tN);function uN(e,t){for(;e<0;)e+=t;return e}sN.className="Concatenate",fu(sN);var cN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this,e)).axes=e.axes,r.normalize=null!=e.normalize&&e.normalize,r.supportsMasking=!0,r.reshapeRequired=!1,r}return(0,ee.Z)(n,[{key:"build",value:function(e){me(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0],n=e[1];if(t.length>3||n.length>3)throw new pg("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new lg("Dimension incompatibility: "+"".concat(t[r[0]]," !== ").concat(n[r[1]]))}},{key:"mergeFunction",value:function(e){if(2!==e.length)throw new lg("A `Dot` layer must be called on exactly 2 inputs, "+"but received ".concat(e.length," input(s)."));var t,n=e[0],r=e[1];return t=Array.isArray(this.axes)?this.axes.map((function(t,n){return uN(t,e[n].shape.length)})):[uN(this.axes,n.shape.length),uN(this.axes,r.shape.length)],this.normalize&&(n=Xb(n,t[0]),r=Xb(r,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new pg("batchDot is not implemented for tensors of 4D or higher rank yet");if(me(e.shape.length>=2,(function(){return"batchDot requires the rank of x to be >= 2, "+"but got ".concat(e.shape.length)})),me(e.shape.length>=2,(function(){return"batchDot requires the rank of y to be >= 2, "+"but got ".concat(t.shape.length)})),"number"===typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new pg("batchDot is not implemented for complex64-type Tensors yet.");var r=e.shape.length,a=t.shape.length;null==n&&(n=[r-1,a-2]);var i=n;return Du((function(){var n,o;if(r>a){n=r-a;for(var s=[],u=0;u<n;++u)s.push(1);t=Xc(t,t.shape.concat(s))}else if(a>r){n=a-r;for(var c=[],l=0;l<n;++l)c.push(1);e=Xc(e,e.shape.concat(c))}else n=0;if(2===e.shape.length&&2===t.shape.length)o=i[0]===i[1]?lp(Xu(e,t),i[0]):lp(Xu(As(e,[1,0]),t),i[1]);else{var p=i[0]!==e.shape.length-1,f=i[1]===t.shape.length-1;o=Cs(e,t,p,f)}if(n>0){for(var h,d=[],m=h=r>a?r+a-3:r-1;m<h+n;++m)d.push(m);o=Lf(o,d)}return 1===o.shape.length&&(o=Wl(o,1)),o}))}(n,r,t)}},{key:"interpretAxes",value:function(e,t){return Array.isArray(this.axes)?this.axes:[uN(this.axes,e.length),uN(this.axes,t.length)]}},{key:"computeOutputShape",value:function(e){me(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new pg("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);var a=t.concat(n);return 1===a.length&&a.push(1),a}},{key:"computeMask",value:function(e,t){return null}},{key:"getConfig",value:function(){var e={axes:this.axes,normalize:this.normalize},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(tN);cN.className="Dot",fu(cN);var lN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this,e)).supportsMasking=!0,r.stddev=e.stddev,r}return(0,ee.Z)(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this),t={stddev:this.stddev};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return Du((function(){n.invokeCallHook(e,t);var r=yb(e);return Ey((function(){return ju(xy(r.shape,0,n.stddev),r)}),(function(){return r}),t.training||!1)}))}}]),n}(Rb);lN.className="GaussianNoise",fu(lN);var pN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r}return(0,ee.Z)(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return Du((function(){n.invokeCallHook(e,t);var r=yb(e);if(n.rate>0&&n.rate<1){return Ey((function(){var e=Math.sqrt(n.rate/(1-n.rate));return Xu(r,xy(r.shape,1,e))}),(function(){return r}),t.training||!1)}return r}))}}]),n}(Rb);pN.className="GaussianDropout",fu(pN);var fN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r.noiseShape=e.noiseShape,r}return(0,ee.Z)(n,[{key:"_getNoiseShape",value:function(e){return this.noiseShape||yb(e).shape}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return Du((function(){if(n.rate<1&&n.rate>0){var r=n._getNoiseShape(e);return Ey((function(){var t=yb(e),a=-1.7580993408473766,i=Kl(af(r),n.rate);i=py(i,"float32");var o=Math.pow((1-n.rate)*(1+n.rate*Math.pow(a,2)),-.5),s=-o*a*n.rate,u=ju(Xu(t,i),Xu(ju(i,-1),a));return ju(Xu(u,o),s)}),(function(){return yb(e)}),t.training||!1)}return e}))}}]),n}(Rb);function hN(e,t,n,r,a){var i,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.001;if(2===e.rank)i=il(e,t,n,r,a,o);else if(3===e.rank)i=ol(e,t,n,r,a,o);else{if(4!==e.rank)throw new pg("batchNormalization is not implemented for array of rank ".concat(e.rank," ")+"yet");i=sl(e,t,n,r,a,o)}return i}function dN(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return Du((function(){var i=Lp(e,r),o=i.mean,s=i.variance;return[hN(e,o,s,n,t,a),o,s]}))}function mN(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return Du((function(){var i,o=Lp(e,r),s=o.mean,u=o.variance,c=[],l=q(ly(0,e.rank));try{for(l.s();!(i=l.n()).done;){var p=i.value;-1!==r.indexOf(p)?c.push(1):c.push(e.shape[p])}}catch($V){l.e($V)}finally{l.f()}var f=Xc(s,c),h=Xc(u,c),d=null==t?null:Xc(t,c),m=null==n?null:Xc(n,c);return[hN(e,f,h,m,d,a),s,u]}))}fN.className="AlphaDropout",fu(fN);var vN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),null==e&&(e={}),(r=t.call(this,e)).supportsMasking=!0,r.axis=null==e.axis?-1:e.axis,r.momentum=null==e.momentum?.99:e.momentum,r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=Yy(e.betaInitializer||"zeros"),r.gammaInitializer=Yy(e.gammaInitializer||"ones"),r.movingMeanInitializer=Yy(e.movingMeanInitializer||"zeros"),r.movingVarianceInitializer=Yy(e.movingVarianceInitializer||"ones"),r.betaConstraint=Wg(e.betaConstraint),r.gammaConstraint=Wg(e.gammaConstraint),r.betaRegularizer=tw(e.betaRegularizer),r.gammaRegularizer=tw(e.gammaRegularizer),r}return(0,ee.Z)(n,[{key:"build",value:function(e){e=bb(e);var t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new lg("Axis ".concat(t," of input tensor should have a defined dimension but ")+"the layer received an input with shape "+"".concat(JSON.stringify(e),"."));this.inputSpec=[new Sb({ndim:e.length,axes:uw({},t,n)})];var r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}},{key:"call",value:function(e,t){var n=this;return Du((function(){var r=null!=t.training&&t.training,a=yb(e),i=a.shape,o=i.length,s=ly(0,o),u=n.axis>=0?n.axis:n.axis+o;s.splice(u,1);var c=hg(1,o);c[u]=i[u];var l=s.slice();l.sort();var p=!ke(l,ly(0,o).slice(0,o-1));if(!r)return function(){if(p){var e=Xc(n.movingMean.read(),c),t=Xc(n.movingVariance.read(),c),r=n.center?Xc(n.beta.read(),c):null,i=n.scale?Xc(n.gamma.read(),c):null;return hN(a,e,t,r,i,n.epsilon)}return hN(a,n.movingMean.read(),n.movingVariance.read(),null==n.beta?null:n.beta.read(),null==n.gamma?null:n.gamma.read(),n.epsilon)}();var f=function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return ke(r.slice().sort(),ly(0,e.rank-1))?dN(e,t,n,r,a):mN(e,t,n,r,a)}(a,n.gamma.read(),n.beta.read(),s,n.epsilon),h=(0,oe.Z)(f,3),d=h[0],m=h[1],v=h[2],g=function(e,t,n){Du((function(){var r=1-n,a=e.read(),i=Xu(fc(a,t),r);e.write(fc(a,i))}))};return g(n.movingMean,m,n.momentum),g(n.movingVariance,v,n.momentum),d}))}},{key:"getConfig",value:function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Xy(this.betaInitializer),gammaInitializer:Xy(this.gammaInitializer),movingMeanInitializer:Xy(this.movingMeanInitializer),movingVarianceInitializer:Xy(this.movingVarianceInitializer),betaRegularizer:$k(this.betaRegularizer),gammaRegularizer:$k(this.gammaRegularizer),betaConstraint:Zg(this.betaConstraint),gammaConstraint:Zg(this.gammaConstraint)},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Rb);vN.className="BatchNormalization",fu(vN);var gN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;if((0,$.Z)(this,n),null==e&&(e={}),(r=t.call(this,e)).axis=null==e.axis?-1:e.axis,"number"===typeof r.axis){if(!Number.isInteger(r.axis))throw new Error("Expected axis to be an integer, but received ".concat(r.axis))}else{if(!Array.isArray(r.axis))throw new Error("Expected axis to be an integer or an array of integers, "+"but received ".concat(JSON.stringify(r.axis)));var a,i=q(r.axis);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!Number.isInteger(o))throw new Error("Expected axis to be an array of integers, "+"but received ".concat(JSON.stringify(r.axis)))}}catch($V){i.e($V)}finally{i.f()}}return r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=Yy(e.betaInitializer||"zeros"),r.gammaInitializer=Yy(e.gammaInitializer||"ones"),r.betaRegularizer=tw(e.betaRegularizer),r.gammaRegularizer=tw(e.gammaRegularizer),r.supportsMasking=!0,r}return(0,ee.Z)(n,[{key:"build",value:function(e){var t=(e=bb(e)).length;"number"===typeof this.axis&&(this.axis=[this.axis]);for(var n=0;n<this.axis.length;++n)this.axis[n]<0&&(this.axis[n]+=t);var r,a=q(this.axis);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i<0||i>=t)throw new Error("Invalid axis: ".concat(i))}}catch($V){a.e($V)}finally{a.f()}if(this.axis.length!==Sg(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));var o=this.axis.map((function(t){return e[t]}));this.scale?this.gamma=this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,true):this.gamma=null,this.center?this.beta=this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,true):this.beta=null,this.built=!0}},{key:"call",value:function(e,t){var n=this,r=yb(e),a=r.shape,i=a.length;return Du((function(){var e,t=Lp(r,n.axis,!0),o=t.mean,s=t.variance,u=hg(1,i),c=q(n.axis);try{for(c.s();!(e=c.n()).done;){var l=e.value;u[l]=a[l]}}catch($V){c.e($V)}finally{c.f()}for(var p=function(e){return null!=e&&e.shape.length!==i?Xc(e,u):e},f=p(n.gamma.read()),h=p(n.beta.read()),d=[],m=[],v=0;v<i;++v)-1!==n.axis.indexOf(v)?(d.push(a[v]),m.push(1)):(d.push(1),m.push(a[v]));return o=Vl(o,d),s=Vl(s,d),f=Vl(f,m),h=Vl(h,m),hN(r,o,s,h,f,n.epsilon)}))}},{key:"getConfig",value:function(){var e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Xy(this.betaInitializer),gammaInitializer:Xy(this.gammaInitializer),betaRegularizer:$k(this.betaRegularizer),gammaRegularizer:$k(this.gammaRegularizer)},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Rb);gN.className="LayerNormalization",fu(gN);var yN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;if((0,$.Z)(this,n),null==e&&(e={}),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)r.padding=[[1,1],[1,1]];else if("number"===typeof e.padding)r.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new lg("ZeroPadding2D expects padding to be a length-2 array, but "+"received a length-".concat(e.padding.length," array."));var a,i;if("number"===typeof e.padding[0])a=[e.padding[0],e.padding[0]],i=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new lg("ZeroPadding2D expects height padding to be a length-2 array, "+"but received a length-".concat(e.padding[0].length," array."));if(a=e.padding[0],2!==e.padding[1].length)throw new lg("ZeroPadding2D expects width padding to be a length-2 array, "+"but received a length-".concat(e.padding[1].length," array."));i=e.padding[1]}r.padding=[a,i]}return r.inputSpec=[new Sb({ndim:4})],r}return(0,ee.Z)(n,[{key:"computeOutputShape",value:function(e){var t,n;return e=bb(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}},{key:"call",value:function(e,t){var n=this;return Du((function(){return t=yb(e),r=n.padding,a=n.dataFormat,Du((function(){if(4!==t.rank)throw new lg("temporalPadding expects input tensor to be 4-D, but received a "+"".concat(t.rank,"-D tensor."));if(null==r&&(r=[[1,1],[1,1]]),2!==r.length||2!==r[0].length||2!==r[1].length)throw new lg("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==a&&(a="channelsLast"),"channelsLast"!==a&&"channelsFirst"!==a)throw new lg("Unknown data format: ".concat(a,". ")+"Supported data formats are 'channelsLast' and 'channelsFirst.");var e;return e="channelsFirst"===a?[[0,0],[0,0],r[0],r[1]]:[[0,0],r[0],r[1],[0,0]],Up(t,e)}));var t,r,a}))}},{key:"getConfig",value:function(){var e={padding:this.padding,dataFormat:this.dataFormat},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Rb);function bN(e,t,n,r,a,i){return Du((function(){var o;Jg(a),ey(i),$g(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=fw(e,a);var s="same"===r?"same":"valid";return o="max"===i?Sp(e,t,n,s):Yc(e,t,n,s),"channelsFirst"===a&&(o=As(o,[0,3,1,2])),o}))}function xN(e,t,n,r,a,i){return Du((function(){var o;Jg(a),ey(i),$g(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=hw(e,a);var s="same"===r?"same":"valid";return o="max"===i?Tp(e,t,n,s):Qc(e,t,n,s),"channelsFirst"===a&&(o=As(o,[0,4,1,2,3])),o}))}yN.className="ZeroPadding2D",fu(yN);var kN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;if((0,$.Z)(this,n),null==e.poolSize&&(e.poolSize=2),r=t.call(this,e),"number"===typeof e.poolSize)r.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!==typeof e.poolSize[0])throw new lg("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.poolSize)));r.poolSize=e.poolSize}if(Ag(r.poolSize,"poolSize"),null==e.strides)r.strides=r.poolSize;else if("number"===typeof e.strides)r.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!==typeof e.strides[0])throw new lg("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.strides)));r.strides=e.strides}return Ag(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,$g(r.padding),r.inputSpec=[new Sb({ndim:3})],r}return(0,ee.Z)(n,[{key:"computeOutputShape",value:function(e){var t=lw((e=bb(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}},{key:"call",value:function(e,t){var n=this;return Du((function(){n.invokeCallHook(e,t),e=fy(yb(e),2);var r=n.poolingFunction(yb(e),[n.poolSize[0],1],[n.strides[0],1],n.padding,"channelsLast");return Lf(r,[2])}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Rb),wN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){return(0,$.Z)(this,n),t.call(this,e)}return(0,ee.Z)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Jg(a),$g(r),bN(e,t,n,r,a,"max")}}]),n}(kN);wN.className="MaxPooling1D",fu(wN);var NN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){return(0,$.Z)(this,n),t.call(this,e)}return(0,ee.Z)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Jg(a),$g(r),bN(e,t,n,r,a,"avg")}}]),n}(kN);NN.className="AveragePooling1D",fu(NN);var IN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;if((0,$.Z)(this,n),null==e.poolSize&&(e.poolSize=[2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new lg("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+"".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides];return Ag(r.poolSize,"poolSize"),Ag(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Jg(r.dataFormat),$g(r.padding),r.inputSpec=[new Sb({ndim:4})],r}return(0,ee.Z)(n,[{key:"computeOutputShape",value:function(e){e=bb(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=lw(t,this.poolSize[0],this.padding,this.strides[0]),n=lw(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}},{key:"call",value:function(e,t){var n=this;return Du((function(){return n.invokeCallHook(e,t),n.poolingFunction(yb(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Rb),SN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){return(0,$.Z)(this,n),t.call(this,e)}return(0,ee.Z)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Jg(a),$g(r),bN(e,t,n,r,a,"max")}}]),n}(IN);SN.className="MaxPooling2D",fu(SN);var TN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){return(0,$.Z)(this,n),t.call(this,e)}return(0,ee.Z)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Jg(a),$g(r),bN(e,t,n,r,a,"avg")}}]),n}(IN);TN.className="AveragePooling2D",fu(TN);var CN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;if((0,$.Z)(this,n),null==e.poolSize&&(e.poolSize=[2,2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new lg("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+"".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides,e.strides];return Ag(r.poolSize,"poolSize"),Ag(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Jg(r.dataFormat),$g(r.padding),r.inputSpec=[new Sb({ndim:5})],r}return(0,ee.Z)(n,[{key:"computeOutputShape",value:function(e){e=bb(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=lw(t,this.poolSize[0],this.padding,this.strides[0]),n=lw(n,this.poolSize[1],this.padding,this.strides[1]),r=lw(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}},{key:"call",value:function(e,t){var n=this;return Du((function(){return n.invokeCallHook(e,t),n.poolingFunction(yb(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Rb),EN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){return(0,$.Z)(this,n),t.call(this,e)}return(0,ee.Z)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Jg(a),$g(r),xN(e,t,n,r,a,"max")}}]),n}(CN);EN.className="MaxPooling3D",fu(EN);var AN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){return(0,$.Z)(this,n),t.call(this,e)}return(0,ee.Z)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Jg(a),$g(r),xN(e,t,n,r,a,"avg")}}]),n}(CN);AN.className="AveragePooling3D",fu(AN);var RN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this,e)).inputSpec=[new Sb({ndim:3})],r}return(0,ee.Z)(n,[{key:"computeOutputShape",value:function(e){return[e[0],e[2]]}},{key:"call",value:function(e,t){throw new pg}}]),n}(Rb),_N=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){return(0,$.Z)(this,n),t.call(this,e||{})}return(0,ee.Z)(n,[{key:"call",value:function(e,t){return Du((function(){var t=yb(e);return Ep(t,1)}))}}]),n}(RN);_N.className="GlobalAveragePooling1D",fu(_N);var FN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){return(0,$.Z)(this,n),t.call(this,e||{})}return(0,ee.Z)(n,[{key:"call",value:function(e,t){return Du((function(){var t=yb(e);return cp(t,1)}))}}]),n}(RN);FN.className="GlobalMaxPooling1D",fu(FN);var DN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Jg(r.dataFormat),r.inputSpec=[new Sb({ndim:4})],r}return(0,ee.Z)(n,[{key:"computeOutputShape",value:function(e){return e=e,"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}},{key:"call",value:function(e,t){throw new pg}},{key:"getConfig",value:function(){var e={dataFormat:this.dataFormat},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Rb),ON=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"call",value:function(e,t){var n=this;return Du((function(){var t=yb(e);return"channelsLast"===n.dataFormat?Ep(t,[1,2]):Ep(t,[2,3])}))}}]),n}(DN);ON.className="GlobalAveragePooling2D",fu(ON);var MN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"call",value:function(e,t){var n=this;return Du((function(){var t=yb(e);return"channelsLast"===n.dataFormat?cp(t,[1,2]):cp(t,[2,3])}))}}]),n}(DN);MN.className="GlobalMaxPooling2D",fu(MN);var LN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this,e)).layer=e.layer,r}return(0,ee.Z)(n,[{key:"build",value:function(e){this.built=!0}},{key:"trainable",get:function(){return null!=this.layer&&this.layer.trainable},set:function(e){null!=this.layer&&(this.layer.trainable=e)}},{key:"trainableWeights",get:function(){return this.layer.trainableWeights}},{key:"nonTrainableWeights",get:function(){return this.layer.nonTrainableWeights}},{key:"updates",get:function(){return this.layer._updates}},{key:"losses",get:function(){return this.layer.losses}},{key:"getWeights",value:function(){return this.layer.getWeights()}},{key:"setWeights",value:function(e){this.layer.setWeights(e)}},{key:"getConfig",value:function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"setFastWeightInitDuringBuild",value:function(e){qb((0,rg.Z)(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.layer,a=Kb(r,n);delete t.layer;var i={layer:a};return Object.assign(i,t),new e(i)}}]),n}(Rb),zN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this,e)).supportsMasking=!0,r}return(0,ee.Z)(n,[{key:"build",value:function(e){if((e=bb(e)).length<3)throw new lg("TimeDistributed layer expects an input shape >= 3D, but received "+"input shape ".concat(JSON.stringify(e)));this.inputSpec=[{shape:e}];var t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),qb((0,rg.Z)(n.prototype),"build",this).call(this,e)}},{key:"computeOutputShape",value:function(e){var t=[(e=bb(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))}},{key:"call",value:function(e,t){var n=this;return Du((function(){return Rw((function(e,r){return[yb(n.layer.call(e,t)),[]]}),e=yb(e),[],!1,null,null,!1,!0)[1]}))}}]),n}(LN);zN.className="TimeDistributed",fu(zN);var PN=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;(0,$.Z)(this,n),r=t.call(this,e);var a=e.layer.getConfig(),i={};i.className=e.layer.getClassName(),i.config=a,r.forwardLayer=Kb(i),a.goBackwards=!0!==a.goBackwards;var o,s={};if(s.className=e.layer.getClassName(),s.config=a,r.backwardLayer=Kb(s),r.forwardLayer.name="forward_"+r.forwardLayer.name,r.backwardLayer.name="backward_"+r.backwardLayer.name,r.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,o=r.mergeMode,Cg(Yg,"BidirectionalMergeMode",o),e.weights)throw new pg("weights support is not implemented for Bidirectional layer yet.");return r._stateful=e.layer.stateful,r.returnSequences=e.layer.returnSequences,r.returnState=e.layer.returnState,r.supportsMasking=!0,r._trainable=!0,r.inputSpec=e.layer.inputSpec,r.numConstants=null,r}return(0,ee.Z)(n,[{key:"trainable",get:function(){return this._trainable},set:function(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}},{key:"getWeights",value:function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}},{key:"setWeights",value:function(e){var t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=this.forwardLayer.computeOutputShape(e);return Array.isArray(a)&&Array.isArray(a[0])||(a=[a]),a=a,this.returnState?(r=a.slice(1),t=a[0]):t=a[0],t=t,"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):vg(n)}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=Aw(e,r,a,this.numConstants);if(e=i.inputs,r=i.initialState,a=i.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(null==r||0===r.length)&&null==a)return qb((0,rg.Z)(n.prototype),"apply",this).call(this,e,t);var o=[],s=[];if(null!=r){var u=r.length;if(u%2>0)throw new lg("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=r,o.push.apply(o,Y(r));var c=r.map((function(e){return new Sb({shape:e.shape})}));this.forwardLayer.stateSpec=c.slice(0,u/2),this.backwardLayer.stateSpec=c.slice(u/2),s.push.apply(s,Y(c))}if(null!=a)throw new pg("Support for constants in Bidirectional layers is not implemented yet.");for(var l=o[0]instanceof Tb,p=0,f=o;p<f.length;p++){if(f[p]instanceof Tb!==l)throw new lg("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}if(l){var h=[e].concat(o),d=this.inputSpec.concat(s),m=this.inputSpec;this.inputSpec=d;var v=qb((0,rg.Z)(n.prototype),"apply",this).call(this,h,t);return this.inputSpec=m,v}return qb((0,rg.Z)(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return Du((function(){var r,a,i,o,s=t.initialState;if(null==s)r=n.forwardLayer.call(e,t),a=n.backwardLayer.call(e,t);else{var u=s.slice(0,s.length/2),c=s.slice(s.length/2);r=n.forwardLayer.call(e,Object.assign(t,{initialState:u})),a=n.backwardLayer.call(e,Object.assign(t,{initialState:c}))}return n.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(a.slice(1))),r=r[0],a=a[0]),n.returnSequences&&(a=pf(a,1)),"concat"===n.mergeMode?o=gy([r,a]):"sum"===n.mergeMode?o=ju(r,a):"ave"===n.mergeMode?o=Xu(.5,ju(r,a)):"mul"===n.mergeMode?o=Xu(r,a):null==n.mergeMode&&(o=[r,a]),n.returnState?null==n.mergeMode?o.concat(i):[o].concat(i):o}))}},{key:"resetStates",value:function(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}},{key:"build",value:function(e){var t=this;ny(this.forwardLayer.name,(function(){t.forwardLayer.build(e)})),ny(this.backwardLayer.name,(function(){t.backwardLayer.build(e)})),this.built=!0}},{key:"computeMask",value:function(e,t){var n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){var r=this.forwardLayer.states.map((function(e){return null}));return Array.isArray(n)?n.concat(r).concat(r):[n].concat(r).concat(r)}return n}},{key:"trainableWeights",get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}},{key:"nonTrainableWeights",get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}},{key:"setFastWeightInitDuringBuild",value:function(e){qb((0,rg.Z)(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e={mergeMode:this.mergeMode},t=qb((0,rg.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"fromConfig",value:function(e,t){var n=Kb(t.layer);if(delete t.layer,null!=t.numConstants)throw new pg("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=t;return r.layer=n,new e(r)}}]),n}(LN);function ZN(e){return new Db(e)}function BN(e){return new iw(e)}function WN(e){return new nw(e)}function UN(e){return new rw(e)}function VN(e){return new aw(e)}function GN(e){return new sw(e)}function HN(e){return new ow(e)}function jN(e){return new Sw(e)}function qN(e){return new bw(e)}function KN(e){return new kw(e)}function XN(e){return new xw(e)}function YN(e){return new ww(e)}function QN(e){return new Iw(e)}function JN(e){return new Tw(e)}function $N(e){return new Cw(e)}function eI(e){return new Ew(e)}function tI(e){return new Xw(e)}function nI(e){return new qw(e)}function rI(e){return new Hw(e)}function aI(e){return new jw(e)}function iI(e){return new Kw(e)}function oI(e){return new Yw(e)}function sI(e){return new Qw(e)}function uI(e){return new Jw(e)}function cI(e){return new eN(e)}function lI(e){return new nN(e)}function pI(e){return new aN(e)}function fI(e){return new sN(e)}function hI(e){return new iN(e)}function dI(e){return new oN(e)}function mI(e){return new rN(e)}function vI(e){return new cN(e)}function gI(e){return new vN(e)}function yI(e){return new gN(e)}function bI(e){return new yN(e)}function xI(e){return new NN(e)}function kI(e){return xI(e)}function wI(e){return xI(e)}function NI(e){return new TN(e)}function II(e){return NI(e)}function SI(e){return NI(e)}function TI(e){return new AN(e)}function CI(e){return TI(e)}function EI(e){return TI(e)}function AI(e){return new _N(e)}function RI(e){return new ON(e)}function _I(e){return new FN(e)}function FI(e){return new MN(e)}function DI(e){return new wN(e)}function OI(e){return new SN(e)}function MI(e){return new EN(e)}function LI(e){return new Lw(e)}function zI(e){return new Mw(e)}function PI(e){return new Pw(e)}function ZI(e){return new zw(e)}function BI(e){return new Ow(e)}function WI(e){return new Dw(e)}function UI(e){return new Gw(e)}function VI(e){return new Vw(e)}function GI(e){return new _w(e)}function HI(e){return new Zw(e)}function jI(e){return new PN(e)}function qI(e){return new zN(e)}PN.className="Bidirectional",fu(PN);var KI=_I,XI=FI,YI=DI,QI=OI;function JI(e){return new lN(e)}function $I(e){return new pN(e)}function eS(e){return new fN(e)}function tS(e){return new $w(e)}function nS(e,t){return sx(e,t)}function rS(e,t){return fx(e,t)}function aS(e,t){return hx(e,t)}function iS(e,t){return ux(e,t)}function oS(e,t){return dx(e,t)}function sS(e,t){return lx(e,t)}function uS(e,t){return px(e,t)}function cS(e,t){return ax(e,t)}function lS(e,t){return Qb(e,t)}function pS(e,t){return Jb(e,t)}function fS(e,t){return Jb(e,t)}function hS(e,t){return Jb(e,t)}function dS(e,t){return Yb(e,t)}function mS(e,t){return Yb(e,t)}function vS(e,t){return Yb(e,t)}function gS(e){return new Qk(e)}function yS(e){return Xk(t=e),new Qk({l1:null!=t?t.l1:null,l2:0});var t}function bS(e){return Xk(t=e),new Qk({l2:null!=t?t.l2:null,l1:0});var t}var xS=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){var e;return(0,$.Z)(this,n),(e=t.apply(this,arguments)).model=null,e}return(0,ee.Z)(n,[{key:"setModel",value:function(e){if(!(e instanceof gk))throw new Error("model must be a LayersModel, not some other Container");this.model=e}}]),n}(Pb);function kS(e,t){return e<t}function wS(e,t){return e>t}var NS=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;if((0,$.Z)(this,n),r=t.call(this),null==e&&(e={}),e.restoreBestWeights)throw new pg("restoreBestWeights = True is not implemented in EarlyStopping yet.");return r.monitor=e.monitor||"val_loss",r.minDelta=Math.abs(e.minDelta||0),r.patience=e.patience||0,r.verbose=e.verbose||0,r.mode=e.mode||"auto",r.baseline=e.baseline,-1===["auto","min","max"].indexOf(r.mode)&&(console.warn("EarlyStopping mode '".concat(r.mode,"' is invalid. ")+"Falling back to mode 'auto'."),r.mode="auto"),"min"===r.mode?r.monitorFunc=kS:"max"===r.mode||-1!==r.monitor.indexOf("acc")?r.monitorFunc=wS:r.monitorFunc=kS,r.monitorFunc===kS&&(r.minDelta*=-1),r}return(0,ee.Z)(n,[{key:"onTrainBegin",value:function(){var e=J(ne().mark((function e(t){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.wait=0,this.stoppedEpoch=0,null!=this.baseline?this.best=this.baseline:this.best=this.monitorFunc===kS?1/0:-1/0;case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=J(ne().mark((function e(t,n){var r;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Mb(n);case 2:if(null!=(r=this.getMonitorValue(n))){e.next=5;break}return e.abrupt("return");case 5:this.monitorFunc(r-this.minDelta,this.best)?(this.best=r,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=t,this.model.stopTraining=!0));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=J(ne().mark((function e(t){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.stoppedEpoch>0&&this.verbose&&console.log("Epoch ".concat(this.stoppedEpoch,": early stopping."));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMonitorValue",value:function(e){null==e&&(e={});var t=e[this.monitor];return null==t&&console.warn("Metric for EarlyStopping ".concat(this.monitor," is not available. ")+"Available metrics are: ".concat(Object.keys(e))),t}}]),n}(xS);var IS,SS,TS={earlyStopping:function(e){return new NS(e)}};it().registerFlag("KEEP_INTERMEDIATE_TENSORS",(function(){return!1}),(function(e){e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"}(IS||(IS={})),function(e){!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(SS||(SS={}));var CS={};function ES(e,t){var n={tfOpName:e,category:"custom",inputs:[],attrs:[],customExecutor:t};CS[e]=n}function AS(e){return CS[e]}function RS(e){delete CS[e]}function _S(e,t,n,r,a){var i=t.inputParams[e];if(i&&void 0!==i.inputIndexStart){var o=i.inputIndexStart,s=0===i.inputIndexEnd?void 0:void 0===i.inputIndexEnd?o+1:i.inputIndexEnd;if("tensor"===i.type)return FS(t.inputNames[i.inputIndexStart],n,r,a);if("tensors"===i.type)return t.inputNames.slice(o,s).map((function(e){return FS(e,n,r,a)}));var u=FS(t.inputNames.slice(o)[0],n,r,a),c=u.dataSync();return"number"===i.type?c[0]:qe(u.shape,c)}var l=t.attrParams[e];return l&&l.value}function FS(e,t,n,r){var a=MS(e),i=(0,oe.Z)(a,2),o=i[0],s=i[1];if(null!=r){var u=r.getHashTableHandleByName(o);if(null!=u)return u}var c=n.currentContextIds.find((function(e){return!!t[OS(o,e)]}));return void 0!==c?t[OS(o,c)][s]:void 0}function DS(e,t){var n=MS(e),r=(0,oe.Z)(n,3),a=r[0],i=r[1],o=r[2];return[OS(a,t&&t.currentContextId),i,o]}function OS(e,t){return t?"".concat(e,"-").concat(t):e}function MS(e){var t=e.split(":");if(1===t.length)return[e,0,void 0];var n=t[0],r=3===t.length?t[1]:void 0;return[n,Number(t[t.length-1]),r]}function LS(e,t,n){var r=_S("pad",e,t,n);if("explicit"===r){r=_S("explicitPaddings",e,t,n);for(var a=[[0,0],[0,0],[0,0],[0,0]],i=0;i<4;i++)a[i][0]=r[2*i],a[i][1]=r[2*i+1];return a}return r}function zS(e){return e.kept?e:is(e)}var PS=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],ZS=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],BS=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]}],WS=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number"}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],US=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],VS=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],GS=[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],HS=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],jS=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}],qS=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],KS=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],XS=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}],YS=[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}],QS=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],JS=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}],$S=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],eT=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],tT=[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],nT=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],rT=function(){function e(){var t;(0,$.Z)(this,e);var n=[S,T,C,E,A,R,_,F,D,O,M,L,z,P,Z,B,W,U,V],r=(t=[]).concat.apply(t,Y(n.map((function(e){return e.json}))));this.opMappers=r.reduce((function(e,t){return e[t.tfOpName]=t,e}),{})}return(0,ee.Z)(e,[{key:"transformGraph",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.node,a=[],i=[],o=[],s=r.reduce((function(e,n){return e[n.name]=t.mapNode(n),n.op.startsWith("Placeholder")?a.push(e[n.name]):"Const"===n.op?i.push(e[n.name]):null!=n.input&&0!==n.input.length||o.push(e[n.name]),e}),{}),u=[],c=[],l={},p={};null!=n&&(l=this.mapSignatureEntries(n.inputs),p=this.mapSignatureEntries(n.outputs));var f=Object.keys(s);f.forEach((function(e){var t=s[e];t.inputNames.forEach((function(e,n){var r=DS(e),a=(0,oe.Z)(r,3),i=a[0],o=a[2],u=s[i];if(null!=u.outputs){var c=u.outputs.indexOf(o);if(-1!==c){var l="".concat(i,":").concat(c);t.inputNames[n]=l}}t.inputs.push(u),u.children.push(t)}))})),0===Object.keys(p).length?f.forEach((function(e){var t=s[e];0===t.children.length&&c.push(t)})):Object.keys(p).forEach((function(e){var t=DS(e),n=(0,oe.Z)(t,1)[0],r=s[n];null!=r&&(r.signatureKey=p[e],c.push(r))})),Object.keys(l).length>0?Object.keys(l).forEach((function(e){var t=DS(e),n=(0,oe.Z)(t,1)[0],r=s[n];r&&(r.signatureKey=l[e],u.push(r))})):u=a;var h={};null!=e.library&&null!=e.library.function&&(h=e.library.function.reduce((function(e,n){return e[n.signature.name]=t.mapFunction(n),e}),{}));var d={nodes:s,inputs:u,outputs:c,weights:i,placeholders:a,signature:n,functions:h};return o.length>0&&(d.initNodes=o),d}},{key:"mapSignatureEntries",value:function(e){return Object.keys(e||{}).reduce((function(t,n){return t[e[n].name]=n,t}),{})}},{key:"mapNode",value:function(e){var t=AS(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});var n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map((function(e){return e.startsWith("^")?e.substr(1):e})),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return null!=t.inputs&&(n.inputParams=t.inputs.reduce((function(e,t){return e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e}),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce((function(t,n){var r=n.type,a=void 0;switch(n.type){case"string":void 0===(a=iT(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=iT(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":void 0===(a=mT(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=mT(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":void 0===(a=sT(e.attr,n.tfName,n.defaultValue||0))&&n.tfDeprecatedName&&(a=sT(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":void 0===(a=dT(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=dT(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":void 0===(a=oT(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=oT(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":void 0===(a=gT(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=gT(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":void 0===(a=hT(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=hT(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":void 0===(a=vT(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=vT(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":void 0===(a=lT(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=lT(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":void 0===(a=pT(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=pT(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":void 0===(a=cT(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=cT(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: ".concat(n.type," for op: ").concat(e.op))}return t[n.name]={value:a,type:r},t}),{})),n}},{key:"mapFunction",value:function(e){var t=this,n=e.nodeDef,r=[],a={};null!=n&&(a=n.reduce((function(e,n){return e[n.name]=t.mapNode(n),"Const"===n.op&&r.push(e[n.name]),e}),{}));var i=[],o=[];e.signature.inputArg.forEach((function(e){var t=DS(e.name),n=(0,oe.Z)(t,1)[0],r={name:n,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:uT(e.type),type:"dtype"}},children:[]};r.signatureKey=e.name,i.push(r),a[n]=r})),Object.keys(a).forEach((function(e){var t=a[e];t.inputNames.forEach((function(e,n){var r=DS(e),i=(0,oe.Z)(r,3),o=i[0],s=i[2],u=a[o];if(null!=u.outputs){var c=u.outputs.indexOf(s);if(-1!==c){var l="".concat(o,":").concat(c);t.inputNames[n]=l}}t.inputs.push(u),u.children.push(t)}))}));var s=e.ret;e.signature.outputArg.forEach((function(e){var t=DS(s[e.name]),n=(0,oe.Z)(t,2),r=n[0],i=n[1],u=a[r];null!=u&&(u.defaultOutput=i,o.push(u))}));var u=this.mapArgsToSignature(e);return{nodes:a,inputs:i,outputs:o,weights:r,placeholders:[],signature:u}}},{key:"mapArgsToSignature",value:function(e){var t=this;return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((function(e,n){return e[n.name]=t.mapArgToTensorInfo(n),e}),{}),outputs:e.signature.outputArg.reduce((function(n,r){return n[r.name]=t.mapArgToTensorInfo(r,e.ret),n}),{})}}},{key:"mapArgToTensorInfo",value:function(e,t){var n=e.name;return null!=t&&(n=t[n]),{name:n,dtype:e.type}}}],[{key:"Instance",get:function(){return this._instance||(this._instance=new this)}}]),e}();function aT(e,t){var n=Array.isArray(e)?String.fromCharCode.apply(null,e):function(e){var t=it().global;if("undefined"!==typeof t.atob)return t.atob(e);if("undefined"!==typeof Buffer)return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(e);return t?n:n.toLowerCase()}function iT(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return null!=a?aT(a.s,r):n}function oT(e,t,n){var r=e[t];return r?r.b:n}function sT(e,t,n){var r=e[t]||{},a=null!=r.i?r.i:null!=r.f?r.f:n;return"number"===typeof a?a:parseInt(a,10)}function uT(e){switch("string"===typeof e&&(e=IS[e]),e){case IS.DT_FLOAT:case IS.DT_HALF:return"float32";case IS.DT_INT32:case IS.DT_INT64:case IS.DT_INT8:case IS.DT_UINT8:return"int32";case IS.DT_BOOL:return"bool";case IS.DT_DOUBLE:return"float32";case IS.DT_STRING:return"string";default:return null}}function cT(e,t,n){var r=e[t];return r&&r.func?r.func.name:n}function lT(e,t,n){var r=e[t];return r&&r.type?uT(r.type):n}function pT(e,t,n){var r=e[t];return r&&r.list&&r.list.type?r.list.type.map((function(e){return uT(e)})):n}function fT(e){if(!e.unknownRank)return null!=e.dim?e.dim.map((function(e){return"number"===typeof e.size?e.size:parseInt(e.size,10)})):[]}function hT(e,t,n){var r=e[t];return r&&r.shape?fT(r.shape):n}function dT(e,t,n){var r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((function(e){return"number"===typeof e?e:parseInt(e,10)})):n}function mT(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return a&&a.list&&a.list.s?a.list.s.map((function(e){return aT(e,r)})):n}function vT(e,t,n){var r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map((function(e){return fT(e)})):n}function gT(e,t,n){var r=e[t];return r&&r.list&&r.list.b?r.list.b:n}var yT=function(){function e(t,n,r){var a=this;(0,$.Z)(this,e),this.node=t,this.tensorMap=n,this.context=r,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map((function(e){return a.getInput(e)})),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce((function(e,t){return e[t]=a.getAttr(t),e}),{}))}return(0,ee.Z)(e,[{key:"getInput",value:function(e){return FS(e,this.tensorMap,this.context)}},{key:"getAttr",value:function(e,t){var n=this.node.rawAttrs[e];if(null!=n.tensor)return FS(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return sT(this.node.rawAttrs,e,t);if(null!=n.s)return iT(this.node.rawAttrs,e,t);if(null!=n.b)return oT(this.node.rawAttrs,e,t);if(null!=n.shape)return hT(this.node.rawAttrs,e,t);if(null!=n.type)return lT(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return dT(this.node.rawAttrs,e,t);if(null!=n.list.s)return mT(this.node.rawAttrs,e,t);if(null!=n.list.shape)return vT(this.node.rawAttrs,e,t);if(null!=n.list.b)return gT(this.node.rawAttrs,e,t);if(null!=n.list.type)return pT(this.node.rawAttrs,e,t)}return t}}]),e}();function bT(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if("number"!==typeof e&&"number"!==typeof t){me(e.length===t.length,(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}));for(var r=0;r<e.length;r++){var a=e[r],i=t[r];me(a<0||i<0||a===i,(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}}}function xT(e){return"number"!==typeof e&&!e.some((function(e){return e<0}))}function kT(e,t,n){var r=wT(e,n),a=!xT(r);if(a&&0===t.length)throw new Error("Tried to calculate elements of an empty list"+" with non-fully-defined elementShape: ".concat(r));if(a&&t.forEach((function(e){r=wT(e.shape,r)})),!xT(r))throw new Error("Non-fully-defined elementShape: ".concat(r));return r}function wT(e,t){if("number"===typeof e)return t;if("number"===typeof t)return e;if(e.length!==t.length)throw new Error("Incompatible ranks during merge: ".concat(e," vs. ").concat(t));for(var n=[],r=0;r<e.length;++r){var a=e[r],i=t[r];if(a>=0&&i>=0&&a!==i)throw new Error("Incompatible shape during merge: ".concat(e," vs. ").concat(t));n[r]=a>=0?a:i}return n}var NT=function(){function e(t,n,r,a,i,o,s){(0,$.Z)(this,e),this.name=t,this.dtype=n,this.maxSize=r,this.elementShape=a,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=oc(0),Mu(this.idTensor)}return(0,ee.Z)(e,[{key:"id",get:function(){return this.idTensor.id}},{key:"closed",get:function(){return this.closed_}},{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){null!=e&&e.has(t.tensor.id)||t.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"read",value:function(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read ")+"(perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}},{key:"readMany",value:function(e){var t=this;return e.map((function(e){return t.read(e)}))}},{key:"write",value:function(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,",\n          because the value dtype is ").concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=t.shape),bT(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),n.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(n.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));n.tensor=t,Mu(t),n.written=!0,this.tensors[e]=n}},{key:"writeMany",value:function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,")+"because the index size: ".concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach((function(e,r){return n.write(e,t[r])}))}},{key:"gather",value:function(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(var n=0;n<this.size();n++)e.push(n)}if(0===e.length)return Yi([],[0].concat(this.elementShape));var r=this.readMany(e);return bT(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),zf(r,0)}},{key:"concat",value:function(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(0===this.size())return Yi([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var r=this.readMany(t);return bT(this.elementShape,r[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(r[0].shape,")")),Jc(r,0)}},{key:"scatter",value:function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));var n=Math.max.apply(Math,Y(e));if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size (".concat(n,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,Yf(t,0))}},{key:"split",value:function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));var r=0,a=e.map((function(e){return r+=e}));if(r!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), ")+"and the TensorArray is not marked as dynamically resizeable");var i=0===r?0:t.size/r,o=[];Du((function(){t=Xc(t,[1,r,i]);for(var s=0;s<e.length;++s){var u=[0,0===s?0:a[s-1],0],c=[1,e[s],i];o[s]=Xc(el(t,u,c),n.elementShape)}return o}));for(var s=[],u=0;u<e.length;u++)s[u]=u;this.writeMany(s,o)}}]),e}(),IT=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;(0,$.Z)(this,e),this.tensors=t,this.elementShape=n,this.elementDtype=r,null!=t&&t.forEach((function(e){if(r!==e.dtype)throw new Error("Invalid data types; op elements ".concat(r,", but list elements ").concat(e.dtype));bT(n,e.shape,"TensorList shape mismatch: "),Mu(e)})),this.idTensor=oc(0),this.maxNumElements=a,Mu(this.idTensor)}return(0,ee.Z)(e,[{key:"id",get:function(){return this.idTensor.id}},{key:"copy",value:function(){return new e(Y(this.tensors),this.elementShape,this.elementDtype)}},{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){null!=e&&e.has(t.id)||t.dispose()})),this.tensors.length=0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"stack",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(-1!==r&&this.tensors.length!==r)throw new Error("Operation expected a list with ".concat(r," elements but got a list with ").concat(this.tensors.length," elements."));bT(e,this.elementShape,"TensorList shape mismatch: ");var a=kT(this.elementShape,this.tensors,e);return Du((function(){var e=n.tensors.map((function(e){return Xc(e,a)}));return zf(e,0)}))}},{key:"popBack",value:function(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(0===this.size())throw new Error("Trying to pop from an empty list.");var n=kT(this.elementShape,this.tensors,e),r=this.tensors.pop();return bT(r.shape,e,"TensorList shape mismatch: "),Xc(r,n)}},{key:"pushBack",value:function(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(this.elementDtype));if(bT(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Mu(e),this.tensors.push(e)}},{key:"resize",value:function(e){if(e<0)throw new Error("TensorListResize expects size to be non-negative. Got: ".concat(e));if(-1!==this.maxNumElements&&e>this.maxNumElements)throw new Error("TensorListResize input size ".concat(e," is greater maxNumElement ").concat(this.maxNumElements,"."));this.tensors.length=e}},{key:"getItem",value:function(e,t,n){if(n!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(this.elementDtype));if(e<0||e>this.tensors.length)throw new Error("Trying to access element ".concat(e," in a list with ").concat(this.tensors.length," elements."));if(null==this.tensors[e])throw new Error("element at index ".concat(e," is null."));bT(this.tensors[e].shape,t,"TensorList shape mismatch: ");var r=kT(this.elementShape,this.tensors,t);return Xc(this.tensors[e],r)}},{key:"setItem",value:function(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t.dtype,", but list elements ").concat(this.elementDtype));if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw new Error("Trying to set element ".concat(e," in a list with max ").concat(this.maxNumElements," elements."));bT(this.elementShape,t.shape,"TensorList shape mismatch: "),Mu(t),this.tensors[e]=t}},{key:"gather",value:function(e,t,n){var r=this;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));bT(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());var a=kT(this.elementShape,this.tensors,n);return 0===e.length?Yi([],[0].concat(a)):Du((function(){var t=e.map((function(e){return Xc(r.tensors[e],a)}));return zf(t,0)}))}},{key:"concat",value:function(e,t){var n=this;if(e&&e!==this.elementDtype)throw new Error("TensorList dtype is ".concat(this.elementDtype," but concat requested dtype ").concat(e));bT(this.elementShape,t,"TensorList shape mismatch: ");var r=kT(this.elementShape,this.tensors,t);return 0===this.size()?Yi([],[0].concat(r)):Du((function(){var e=n.tensors.map((function(e){return Xc(e,r)}));return Jc(e,0)}))}}]),e}();function ST(e,t,n){var r=e.dtype;if(e.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: ".concat(e.shape));if(e.dtype!==n)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(n));bT(e.shape.slice(1),t,"TensorList shape mismatch: ");var a=Yf(e);return new IT(a,t,r)}function TT(e,t,n){return new IT([],e,t,n)}function CT(e,t,n,r){if(t.length!==e.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(t.length," vs. ").concat(e.shape[0]));var a=Math.max.apply(Math,Y(t));if(null!=r&&-1!==r&&a>=r)throw new Error("Max index must be < array size (".concat(a,"  vs. ").concat(r,")"));var i=new IT([],n,e.dtype,r),o=Yf(e,0);return t.forEach((function(e,t){i.setItem(e,o[t])})),i}function ET(e,t,n){var r=0,a=t.map((function(e){return r+=e}));if(r!==e.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(e.shape));for(var i=wT(e.shape.slice(1),n),o=0===r?0:e.size/r,s=Du((function(){var n=[];e=Xc(e,[1,r,o]);for(var s=0;s<t.length;++s){var u=[0,0===s?0:a[s-1],0],c=[1,t[s],o];n[s]=Xc(el(e,u,c),i)}return e.dispose(),n})),u=new IT([],n,e.dtype,t.length),c=0;c<s.length;c++)u.setItem(c,s[c]);return u}var AT=function(){var e=J(ne().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,f,h,d,m,v,g,y,b,x,k,w,N,I,S,T,C,E,A,R,_,F,D,O,M,L,z,P,Z,B,W,U,V,G,H,j,q,K,X,Y,Q,J,$,ee,te,re,ae,ie,oe,se,ue,ce,le,pe,fe,he,de,me,ve,ge,ye,be,xe,ke,we,Ne,Ie,Se,Te,Ce,Ee,Ae,Re,_e,Fe,De,Oe,Me,Le,ze,Pe,Ze,Be,We,Ue,Ve,Ge,He,je;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="If"===e.t0||"StatelessIf"===e.t0?3:"While"===e.t0||"StatelessWhile"===e.t0?15:"LoopCond"===e.t0?19:"Switch"===e.t0?21:"Merge"===e.t0?32:"Enter"===e.t0?37:"Exit"===e.t0?41:"NextIteration"===e.t0?44:"TensorArrayV3"===e.t0?47:"TensorArrayWriteV3"===e.t0?57:"TensorArrayReadV3"===e.t0?63:"TensorArrayGatherV3"===e.t0?67:"TensorArrayScatterV3"===e.t0?72:"TensorArrayConcatV3"===e.t0?78:"TensorArraySplitV3"===e.t0?82:"TensorArraySizeV3"===e.t0?88:"TensorArrayCloseV3"===e.t0?91:"TensorListSetItem"===e.t0?95:"TensorListGetItem"===e.t0?101:"TensorListScatterV2"===e.t0||"TensorListScatter"===e.t0?107:"TensorListReserve"===e.t0||"EmptyTensorList"===e.t0?114:"TensorListGather"===e.t0?121:"TensorListStack"===e.t0?127:"TensorListFromTensor"===e.t0?133:"TensorListConcat"===e.t0?139:"TensorListPushBack"===e.t0?144:"TensorListPopBack"===e.t0?149:"TensorListSplit"===e.t0?154:160;break;case 3:return a=_S("thenBranch",t,n,r),i=_S("elseBranch",t,n,r),o=_S("cond",t,n,r),s=_S("args",t,n,r),e.next=9,o.data();case 9:if(!e.sent[0]){e.next=14;break}return e.abrupt("return",r.functionMap[a].executeFunctionAsync(s,r.tensorArrayMap,r.tensorListMap));case 14:return e.abrupt("return",r.functionMap[i].executeFunctionAsync(s,r.tensorArrayMap,r.tensorListMap));case 15:return e.delegateYield(ne().mark((function e(){var a,i,o,s,u,c,l,p;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=_S("body",t,n,r),i=_S("cond",t,n,r),o=_S("args",t,n,r),e.next=5,r.functionMap[i].executeFunctionAsync(o,r.tensorArrayMap,r.tensorListMap);case 5:return s=e.sent,u=o.map((function(e){return e.id})),e.next=9,s[0].data();case 9:c=e.sent,s.forEach((function(e){e.kept||-1!==u.indexOf(e.id)||e.dispose()})),l=o,p=ne().mark((function e(){var t,n,o;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l,e.next=3,r.functionMap[a].executeFunctionAsync(l,r.tensorArrayMap,r.tensorListMap);case 3:return l=e.sent,n=l.map((function(e){return e.id})),t.forEach((function(e){e.kept||-1!==u.indexOf(e.id)||-1!==n.indexOf(e.id)||e.dispose()})),e.next=8,r.functionMap[i].executeFunctionAsync(l,r.tensorArrayMap,r.tensorListMap);case 8:return o=e.sent,e.next=11,o[0].data();case 11:c=e.sent,o.forEach((function(e){e.kept||-1!==u.indexOf(e.id)||-1!==n.indexOf(e.id)||e.dispose()}));case 13:case"end":return e.stop()}}),e)}));case 13:if(!c[0]){e.next=17;break}return e.delegateYield(p(),"t0",15);case 15:e.next=13;break;case 17:return e.abrupt("return",{v:l});case 18:case"end":return e.stop()}}),e)}))(),"t1",16);case 16:if("object"!==typeof(u=e.t1)){e.next=19;break}return e.abrupt("return",u.v);case 19:return c=_S("pred",t,n,r),e.abrupt("return",[zS(c)]);case 21:return l=_S("pred",t,n,r),(p=_S("data",t,n,r)).kept||(p=zS(p)),e.next=26,l.data();case 26:if(!e.sent[0]){e.next=30;break}e.t2=[void 0,p],e.next=31;break;case 30:e.t2=[p,void 0];case 31:return e.abrupt("return",e.t2);case 32:if(f=t.inputNames.find((function(e){return void 0!==FS(e,n,r)})),!f){e.next=36;break}return h=FS(f,n,r),e.abrupt("return",[zS(h)]);case 36:return e.abrupt("return",void 0);case 37:return d=_S("frameName",t,n,r),m=_S("tensor",t,n,r),r.enterFrame(d),e.abrupt("return",[zS(m)]);case 41:return v=_S("tensor",t,n,r),r.exitFrame(),e.abrupt("return",[zS(v)]);case 44:return g=_S("tensor",t,n,r),r.nextIteration(),e.abrupt("return",[zS(g)]);case 47:return y=_S("size",t,n,r),b=_S("dtype",t,n,r),x=_S("elementShape",t,n,r),k=_S("dynamicSize",t,n,r),w=_S("clearAfterRead",t,n,r),N=_S("identicalElementShapes",t,n,r),I=_S("name",t,n,r),S=new NT(I,b,y,x,N,k,w),r.addTensorArray(S),e.abrupt("return",[S.idTensor,oc(1)]);case 57:return T=_S("tensorArrayId",t,n,r),C=_S("index",t,n,r),E=_S("tensor",t,n,r),(A=r.getTensorArray(T.id)).write(C,E),e.abrupt("return",[A.idTensor]);case 63:return R=_S("tensorArrayId",t,n,r),_=_S("index",t,n,r),F=r.getTensorArray(R.id),e.abrupt("return",[F.read(_)]);case 67:return D=_S("tensorArrayId",t,n,r),O=_S("indices",t,n,r),M=_S("dtype",t,n,r),L=r.getTensorArray(D.id),e.abrupt("return",[L.gather(O,M)]);case 72:return z=_S("tensorArrayId",t,n,r),P=_S("indices",t,n,r),Z=_S("tensor",t,n,r),(B=r.getTensorArray(z.id)).scatter(P,Z),e.abrupt("return",[B.idTensor]);case 78:return W=_S("tensorArrayId",t,n,r),U=r.getTensorArray(W.id),V=_S("dtype",t,n,r),e.abrupt("return",[U.concat(V)]);case 82:return G=_S("tensorArrayId",t,n,r),H=_S("tensor",t,n,r),j=_S("lengths",t,n,r),(q=r.getTensorArray(G.id)).split(j,H),e.abrupt("return",[q.idTensor]);case 88:return K=_S("tensorArrayId",t,n,r),X=r.getTensorArray(K.id),e.abrupt("return",[oc(X.size(),"int32")]);case 91:return Y=_S("tensorArrayId",t,n,r),(Q=r.getTensorArray(Y.id)).clearAndClose(),e.abrupt("return",[Q.idTensor]);case 95:return J=_S("tensorListId",t,n,r),$=_S("index",t,n,r),ee=_S("tensor",t,n,r),(te=r.getTensorList(J.id)).setItem($,ee),e.abrupt("return",[te.idTensor]);case 101:return re=_S("tensorListId",t,n,r),ae=_S("index",t,n,r),ie=_S("elementShape",t,n,r),oe=_S("elementDType",t,n,r),se=r.getTensorList(re.id),e.abrupt("return",[se.getItem(ae,ie,oe)]);case 107:return ue=_S("indices",t,n,r),ce=_S("tensor",t,n,r),le=_S("elementShape",t,n,r),pe=_S("numElements",t,n,r),fe=CT(ce,ue,le,pe),r.addTensorList(fe),e.abrupt("return",[fe.idTensor]);case 114:return he=_S("elementShape",t,n,r),de=_S("elementDType",t,n,r),me="TensorListReserve"===t.op?"numElements":"maxNumElements",ve=_S(me,t,n,r),ge=TT(he,de,ve),r.addTensorList(ge),e.abrupt("return",[ge.idTensor]);case 121:return ye=_S("tensorListId",t,n,r),be=_S("indices",t,n,r),xe=_S("elementShape",t,n,r),ke=_S("elementDType",t,n,r),we=r.getTensorList(ye.id),e.abrupt("return",[we.gather(be,ke,xe)]);case 127:return Ne=_S("tensorListId",t,n,r),Ie=_S("elementShape",t,n,r),Se=_S("elementDType",t,n,r),Te=_S("numElements",t,n,r),Ce=r.getTensorList(Ne.id),e.abrupt("return",[Ce.stack(Ie,Se,Te)]);case 133:return Ee=_S("tensor",t,n,r),Ae=_S("elementShape",t,n,r),Re=_S("elementDType",t,n,r),_e=ST(Ee,Ae,Re),r.addTensorList(_e),e.abrupt("return",[_e.idTensor]);case 139:return Fe=_S("tensorListId",t,n,r),De=r.getTensorList(Fe.id),Oe=_S("dtype",t,n,r),Me=_S("elementShape",t,n,r),e.abrupt("return",[De.concat(Oe,Me)]);case 144:return Le=_S("tensorListId",t,n,r),ze=_S("tensor",t,n,r),(Pe=r.getTensorList(Le.id)).pushBack(ze),e.abrupt("return",[Pe.idTensor]);case 149:return Ze=_S("tensorListId",t,n,r),Be=_S("elementShape",t,n,r),We=_S("elementDType",t,n,r),Ue=r.getTensorList(Ze.id),e.abrupt("return",[Ue.popBack(Be,We)]);case 154:return Ve=_S("tensor",t,n,r),Ge=_S("elementShape",t,n,r),He=_S("lengths",t,n,r),je=ET(Ve,He,Ge),r.addTensorList(je),e.abrupt("return",[je.idTensor]);case 160:throw TypeError("Node type ".concat(t.op," is not implemented"));case 161:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();function RT(e,t,n){var r=_S("fusedOps",e,t,n),a=(0,oe.Z)(r,2),i=a[0],o=a[1],s="biasadd"===i,u=!s,c="prelu"===o,l="fusedbatchnorm"===i,p=_S("numArgs",e,t,n);if(s){if(c&&2!==p)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!c&&s&&1!==p)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");var f=_S("strides",e,t,n),h=LS(e,t,n),d=_S("dataFormat",e,t,n).toUpperCase(),m=_S("dilations",e,t,n),v=_S("args",e,t,n),g=(0,oe.Z)(v,2),y=g[0],b=g[1];return u&&(b=y,y=void 0),{stride:f,pad:h,dataFormat:d,dilations:m,biasArg:y,preluArg:b,activationFunc:o,leakyreluAlpha:_S("leakyreluAlpha",e,t,n)}}function _T(e,t,n){return{boxes:_S("boxes",e,t,n),scores:_S("scores",e,t,n),maxOutputSize:_S("maxOutputSize",e,t,n),iouThreshold:_S("iouThreshold",e,t,n),scoreThreshold:_S("scoreThreshold",e,t,n),softNmsSigma:_S("softNmsSigma",e,t,n)}}var FT=function(){var e=J(ne().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,f,h,d,m,v,g,y,b,x,k,w,N,I,S,T,C;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="NonMaxSuppressionV5"===e.t0?3:"NonMaxSuppressionV4"===e.t0?8:"NonMaxSuppressionV3"===e.t0||"NonMaxSuppressionV2"===e.t0?14:"Where"===e.t0?19:"ListDiff"===e.t0?26:27;break;case 3:return a=_T(t,n,r),i=a.boxes,o=a.scores,s=a.maxOutputSize,u=a.iouThreshold,c=a.scoreThreshold,l=a.softNmsSigma,e.next=6,_d.nonMaxSuppressionWithScoreAsync(i,o,s,u,c,l);case 6:return p=e.sent,e.abrupt("return",[p.selectedIndices,p.selectedScores]);case 8:return f=_T(t,n,r),h=f.boxes,d=f.scores,m=f.maxOutputSize,v=f.iouThreshold,g=f.scoreThreshold,y=_S("padToMaxOutputSize",t,n,r),e.next=12,_d.nonMaxSuppressionPaddedAsync(h,d,m,v,g,y);case 12:return b=e.sent,e.abrupt("return",[b.selectedIndices,b.validOutputs]);case 14:return x=_T(t,n,r),k=x.boxes,w=x.scores,N=x.maxOutputSize,I=x.iouThreshold,S=x.scoreThreshold,e.next=17,_d.nonMaxSuppressionAsync(k,w,N,I,S);case 17:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 19:return T=as(_S("condition",t,n,r),"bool"),e.next=22,eh(T);case 22:return e.t2=e.sent,C=[e.t2],T.dispose(),e.abrupt("return",C);case 26:return e.abrupt("return",kf(_S("x",t,n,r),_S("y",t,n,r)));case 27:throw TypeError("Node type ".concat(t.op," is not implemented"));case 28:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),DT=function(){function e(t,n){(0,$.Z)(this,e),this.keyDType=t,this.valueDType=n,this.handle=oc(0),this.tensorMap=new Map,Mu(this.handle)}return(0,ee.Z)(e,[{key:"id",get:function(){return this.handle.id}},{key:"clearAndClose",value:function(){this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),this.handle.dispose()}},{key:"size",value:function(){return this.tensorMap.size}},{key:"tensorSize",value:function(){return oc(this.size(),"int32")}},{key:"import",value:function(){var e=J(ne().mark((function e(t,n){var r,a=this;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return r=e.sent,this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),e.abrupt("return",Du((function(){var e=Yf(n),t=r.length,i=e.length;me(t===i,(function(){return"The number of elements doesn't match, keys has "+"".concat(t," elements, the values has ").concat(i," ")+"elements."}));for(var o=0;o<t;o++){var s=r[o],u=e[o];Mu(u),a.tensorMap.set(s,u)}return a.handle})));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=J(ne().mark((function e(t,n){var r,a=this;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return r=e.sent,e.abrupt("return",Du((function(){for(var e=[],t=0;t<r.length;t++){var i=r[t],o=a.findWithDefault(i,n);e.push(o)}return zf(e)})));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findWithDefault",value:function(e,t){var n=this.tensorMap.get(e);return null!=n?n:t}},{key:"checkKeyAndValueTensor",value:function(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype ".concat(this.keyDType,", but got ")+"".concat(e.dtype));if(t.dtype!==this.valueDType)throw new Error("Expect value dtype ".concat(this.valueDType,", but got ")+"".concat(t.dtype))}}]),e}(),OT=function(){var e=J(ne().mark((function e(t,n,r,a){var i,o,s,u,c,l,p,f,h,d,m,v,g;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="HashTable"===e.t0||"HashTableV2"===e.t0?3:"LookupTableImport"===e.t0||"LookupTableImportV2"===e.t0?8:"LookupTableFind"===e.t0||"LookupTableFindV2"===e.t0?16:"LookupTableSize"===e.t0||"LookupTableSizeV2"===e.t0?24:27;break;case 3:return i=_S("keyDType",t,n,r),o=_S("valueDType",t,n,r),s=new DT(i,o),a.addHashTable(t.name,s),e.abrupt("return",[s.handle]);case 8:return u=_S("tableHandle",t,n,r,a),c=_S("keys",t,n,r),l=_S("values",t,n,r),p=a.getHashTableById(u.id),e.next=14,p.import(c,l);case 14:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 16:return f=_S("tableHandle",t,n,r,a),h=_S("keys",t,n,r),d=_S("defaultValue",t,n,r),m=a.getHashTableById(f.id),e.next=22,m.find(h,d);case 22:return e.t2=e.sent,e.abrupt("return",[e.t2]);case 24:return v=_S("tableHandle",t,n,r,a),g=a.getHashTableById(v.id),e.abrupt("return",[g.tensorSize()]);case 27:throw TypeError("Node type ".concat(t.op," is not implemented"));case 28:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}();function MT(e,t,n,r){var a=function(e,t,n){switch(e.category){case"arithmetic":return Du((function(){return function(e,t,n){switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[ju(_S("a",e,t,n),_S("b",e,t,n))];case"AddN":return[Nc(_S("tensors",e,t,n))];case"FloorMod":case"Mod":return[Mp(_S("a",e,t,n),_S("b",e,t,n))];case"Mul":return[Xu(_S("a",e,t,n),_S("b",e,t,n))];case"RealDiv":case"Div":return[Ku(_S("a",e,t,n),_S("b",e,t,n))];case"DivNoNan":return[Ml(_S("a",e,t,n),_S("b",e,t,n))];case"FloorDiv":return[qu(_S("a",e,t,n),_S("b",e,t,n))];case"Sub":return[fc(_S("a",e,t,n),_S("b",e,t,n))];case"Minimum":return[Dp(_S("a",e,t,n),_S("b",e,t,n))];case"Maximum":return[mc(_S("a",e,t,n),_S("b",e,t,n))];case"Pow":return[pc(_S("a",e,t,n),_S("b",e,t,n))];case"SquaredDifference":return[Mf(_S("a",e,t,n),_S("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"basic_math":return Du((function(){return function(e,t,n){switch(e.op){case"Abs":case"ComplexAbs":return[dc(_S("x",e,t,n))];case"Acos":return[kc(_S("x",e,t,n))];case"Acosh":return[wc(_S("x",e,t,n))];case"Asin":return[Ec(_S("x",e,t,n))];case"Asinh":return[Ac(_S("x",e,t,n))];case"Atan":return[Rc(_S("x",e,t,n))];case"Atan2":return[_c(_S("x",e,t,n),_S("y",e,t,n))];case"Atanh":return[Fc(_S("x",e,t,n))];case"Ceil":return[pl(_S("x",e,t,n))];case"Complex":return[Ki(_S("real",e,t,n),_S("imag",e,t,n))];case"Cos":return[Il(_S("x",e,t,n))];case"Cosh":return[Sl(_S("x",e,t,n))];case"Elu":return[Pl(_S("x",e,t,n))];case"Erf":return[Zl(_S("x",e,t,n))];case"Exp":return[Bl(_S("x",e,t,n))];case"Expm1":return[Ul(_S("x",e,t,n))];case"Floor":return[Hl(_S("x",e,t,n))];case"Log":return[ap(_S("x",e,t,n))];case"Log1p":return[ip(_S("x",e,t,n))];case"Imag":return[Xl(_S("x",e,t,n))];case"Neg":return[op(_S("x",e,t,n))];case"Reciprocal":return[uf(_S("x",e,t,n))];case"Real":return[sf(_S("x",e,t,n))];case"Relu":return[cf(_S("x",e,t,n))];case"Round":return[vf(_S("x",e,t,n))];case"Selu":return[yf(_S("x",e,t,n))];case"Sigmoid":return[$c(_S("x",e,t,n))];case"Sin":return[Nf(_S("x",e,t,n))];case"Sign":return[wf(_S("x",e,t,n))];case"Sinh":return[If(_S("x",e,t,n))];case"Softplus":return[sp(_S("x",e,t,n))];case"Sqrt":return[Yu(_S("x",e,t,n))];case"Square":return[Qu(_S("x",e,t,n))];case"Tanh":return[tl(_S("x",e,t,n))];case"Tan":return[Bf(_S("x",e,t,n))];case"ClipByValue":return[fl(_S("x",e,t,n),_S("clipValueMin",e,t,n),_S("clipValueMax",e,t,n))];case"Relu6":return[lf(_S("x",e,t,n))];case"Rsqrt":return[gf(FS(e.inputNames[0],t,n))];case"Prod":return[Yp(_S("x",e,t,n),_S("axes",e,t,n))];case"LeakyRelu":return[$l(_S("x",e,t,n),_S("alpha",e,t,n))];case"Prelu":return[Xp(_S("x",e,t,n),_S("alpha",e,t,n))];case"IsNan":return[Jl(FS(e.inputNames[0],t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"control":return AT(e,t,n);case"convolution":return Du((function(){return function(e,t,n){switch(e.op){case"Conv1D":var r=_S("stride",e,t,n),a=_S("pad",e,t,n),i=_S("dataFormat",e,t,n).toUpperCase(),o=_S("dilation",e,t,n);return[yl(_S("x",e,t,n),_S("filter",e,t,n),r,a,i,o)];case"Conv2D":var s=_S("strides",e,t,n),u=LS(e,t,n),c=_S("dataFormat",e,t,n).toUpperCase(),l=_S("dilations",e,t,n);return[gl(_S("x",e,t,n),_S("filter",e,t,n),[s[1],s[2]],u,c,[l[1],l[2]])];case"_FusedConv2D":var p=RT(e,t,n),f=p.stride,h=p.pad,d=p.dataFormat,m=p.dilations,v=p.biasArg,g=p.preluArg,y=p.activationFunc,b=p.leakyreluAlpha;return[xh({x:_S("x",e,t,n),filter:_S("filter",e,t,n),strides:[f[1],f[2]],pad:h,dataFormat:d,dilations:[m[1],m[2]],bias:v,activation:y,preluActivationWeights:g,leakyreluAlpha:b})];case"FusedDepthwiseConv2dNative":var x=RT(e,t,n),k=x.stride,w=x.pad,N=x.dataFormat,I=x.dilations,S=x.biasArg,T=x.preluArg,C=x.activationFunc,E=x.leakyreluAlpha;return[Nh({x:_S("x",e,t,n),filter:_S("filter",e,t,n),strides:[k[1],k[2]],pad:w,dataFormat:N,dilations:[I[1],I[2]],bias:S,activation:C,preluActivationWeights:T,leakyreluAlpha:E})];case"Conv2DBackpropInput":case"Conv2dTranspose":var A=_S("outputShape",e,t,n),R=_S("strides",e,t,n),_=LS(e,t,n);return[xl(_S("x",e,t,n),_S("filter",e,t,n),A,[R[1],R[2]],_)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":var F=_S("strides",e,t,n),D=LS(e,t,n),O=_S("dilations",e,t,n),M=_S("dataFormat",e,t,n).toUpperCase();return[Rl(_S("input",e,t,n),_S("filter",e,t,n),[F[1],F[2]],D,M,[O[1],O[2]])];case"Conv3D":var L=_S("strides",e,t,n),z=_S("pad",e,t,n),P=_S("dataFormat",e,t,n).toUpperCase(),Z=_S("dilations",e,t,n);return[kl(_S("x",e,t,n),_S("filter",e,t,n),[L[1],L[2],L[3]],z,P,[Z[1],Z[2],Z[3]])];case"AvgPool":var B=_S("strides",e,t,n),W=_S("pad",e,t,n),U=_S("kernelSize",e,t,n);return[Yc(_S("x",e,t,n),[U[1],U[2]],[B[1],B[2]],W)];case"MaxPool":var V=_S("strides",e,t,n),G=_S("pad",e,t,n),H=_S("kernelSize",e,t,n);return[Sp(_S("x",e,t,n),[H[1],H[2]],[V[1],V[2]],G)];case"MaxPoolWithArgmax":var j=_S("strides",e,t,n),q=_S("pad",e,t,n),K=_S("kernelSize",e,t,n),X=_S("includeBatchInIndex",e,t,n),Y=Cp(_S("x",e,t,n),[K[1],K[2]],[j[1],j[2]],q,X);return[Y.result,Y.indexes];case"AvgPool3D":var Q=_S("strides",e,t,n),J=_S("pad",e,t,n),$=_S("kernelSize",e,t,n);return[Qc(_S("x",e,t,n),[$[1],$[2],$[3]],[Q[1],Q[2],Q[3]],J)];case"MaxPool3D":var ee=_S("strides",e,t,n),te=_S("pad",e,t,n),ne=_S("kernelSize",e,t,n);return[Tp(_S("x",e,t,n),[ne[1],ne[2],ne[3]],[ee[1],ee[2],ee[3]],te)];case"Dilation2D":var re=_S("strides",e,t,n),ae=_S("pad",e,t,n),ie=_S("dilations",e,t,n),oe=re[1],se=re[2],ue=ie[1],ce=ie[2];return[Fl(_S("x",e,t,n),_S("filter",e,t,n),[oe,se],ae,[ue,ce],"NHWC")];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"creation":return Du((function(){return function(e,t,n){switch(e.op){case"Fill":var r=_S("shape",e,t,n),a=_S("dtype",e,t,n);return[cc(r,_S("value",e,t,n),a)];case"LinSpace":return[np(_S("start",e,t,n),_S("stop",e,t,n),_S("num",e,t,n))];case"Multinomial":var i=_S("logits",e,t,n),o=_S("numSamples",e,t,n),s=_S("seed",e,t,n);return[Pp(i,o,s)];case"OneHot":var u=_S("indices",e,t,n),c=_S("depth",e,t,n),l=_S("onValue",e,t,n),p=_S("offValue",e,t,n);return[Es(u,c,l,p)];case"Ones":return[Rp(_S("shape",e,t,n),_S("dtype",e,t,n))];case"OnesLike":return[Bp(_S("x",e,t,n))];case"RandomUniform":return[af(_S("shape",e,t,n),_S("minval",e,t,n),_S("maxval",e,t,n),_S("dtype",e,t,n))];case"Range":return[of(_S("start",e,t,n),_S("stop",e,t,n),_S("step",e,t,n),_S("dtype",e,t,n))];case"TruncatedNormal":var f=_S("shape",e,t,n),h=_S("mean",e,t,n),d=_S("stdDev",e,t,n),m=_S("seed",e,t,n);return[qf(f,h,d,_S("dtype",e,t,n),m)];case"Zeros":return[Ap(_S("shape",e,t,n),_S("dtype",e,t,n))];case"ZerosLike":return[Ju(_S("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"dynamic":return FT(e,t,n);case"evaluation":return Du((function(){return function(e,t,n){switch(e.op){case"TopKV2":var r=_S("x",e,t,n),a=_S("k",e,t,n),i=_S("sorted",e,t,n),o=jf(r,a,i);return[o.values,o.indices];case"Unique":var s=_S("x",e,t,n),u=Kf(s);return[u.values,u.indices];case"UniqueV2":var c=_S("x",e,t,n),l=_S("axis",e,t,n),p=Kf(c,l);return[p.values,p.indices];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"image":return Du((function(){return function(e,t,n){switch(e.op){case"ResizeBilinear":var r=_S("images",e,t,n),a=_S("size",e,t,n),i=_S("alignCorners",e,t,n),o=_S("halfPixelCenters",e,t,n);return[_d.resizeBilinear(r,[a[0],a[1]],i,o)];case"ResizeNearestNeighbor":var s=_S("images",e,t,n),u=_S("size",e,t,n),c=_S("alignCorners",e,t,n),l=_S("halfPixelCenters",e,t,n);return[_d.resizeNearestNeighbor(s,[u[0],u[1]],c,l)];case"CropAndResize":var p=_S("image",e,t,n),f=_S("boxes",e,t,n),h=_S("boxInd",e,t,n),d=_S("cropSize",e,t,n),m=_S("method",e,t,n),v=_S("extrapolationValue",e,t,n);return[_d.cropAndResize(p,f,h,d,m,v)];case"ImageProjectiveTransformV3":var g=_S("images",e,t,n),y=_S("transforms",e,t,n),b=_S("outputShape",e,t,n),x=_S("fillValue",e,t,n),k=_S("interpolation",e,t,n),w=_S("fillMode",e,t,n);return[_d.transform(g,y,k.toLowerCase(),w.toLowerCase(),x,b)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"graph":return Du((function(){return function(e,t,n){switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":var r=_S("default",e,t,n);return[FS(e.name,t,n)||r];case"Placeholder":return[FS(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":case"Snapshot":return[zS(_S("x",e,t,n))];case"IdentityN":return _S("x",e,t,n).map((function(e){return zS(e)}));case"Shape":return[Wf(_S("x",e,t,n).shape,"int32")];case"ShapeN":return _S("x",e,t,n).map((function(e){return Wf(e.shape)}));case"Size":return[oc(_S("x",e,t,n).size,"int32")];case"Rank":return[oc(_S("x",e,t,n).rank,"int32")];case"NoOp":return[oc(1)];case"Print":var a=_S("x",e,t,n),i=_S("data",e,t,n),o=_S("message",e,t,n),s=_S("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(o);for(var u=0;u<i.length;u++)console.log(Array.prototype.slice.call(i[u].dataSync()).slice(0,s));return[a];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"logical":return Du((function(){return function(e,t,n){switch(e.op){case"Equal":return[Dl(_S("a",e,t,n),_S("b",e,t,n))];case"NotEqual":return[Zp(_S("a",e,t,n),_S("b",e,t,n))];case"Greater":return[ql(_S("a",e,t,n),_S("b",e,t,n))];case"GreaterEqual":return[Kl(_S("a",e,t,n),_S("b",e,t,n))];case"Less":return[ep(_S("a",e,t,n),_S("b",e,t,n))];case"LessEqual":return[tp(_S("a",e,t,n),_S("b",e,t,n))];case"LogicalAnd":return[kp(_S("a",e,t,n),_S("b",e,t,n))];case"LogicalNot":return[wp(_S("a",e,t,n))];case"LogicalOr":return[Np(_S("a",e,t,n),_S("b",e,t,n))];case"Select":case"SelectV2":return[Ol(_S("condition",e,t,n),_S("a",e,t,n),_S("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"matrices":return Du((function(){return function(e,t,n){switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[Cs(_S("a",e,t,n),_S("b",e,t,n),_S("transposeA",e,t,n),_S("transposeB",e,t,n))];case"Einsum":return[zl.apply(G,[_S("equation",e,t,n)].concat(Y(_S("tensors",e,t,n))))];case"Transpose":return[As(_S("x",e,t,n),_S("perm",e,t,n))];case"_FusedMatMul":var r=_S("fusedOps",e,t,n),a=(0,oe.Z)(r,2),i=a[0],o=a[1],s="biasadd"===i,u="prelu"===o,c=_S("numArgs",e,t,n),l=_S("leakyreluAlpha",e,t,n);if(s){if(u&&2!==c)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!u&&1!==c)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var p=_S("args",e,t,n),f=(0,oe.Z)(p,2),h=f[0],d=f[1];return[Ih({a:_S("a",e,t,n),b:_S("b",e,t,n),transposeA:_S("transposeA",e,t,n),transposeB:_S("transposeB",e,t,n),bias:h,activation:o,preluActivationWeights:d,leakyreluAlpha:l})];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"normalization":return Du((function(){return function(e,t,n){switch(e.op){case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[al(_S("x",e,t,n),_S("mean",e,t,n),_S("variance",e,t,n),_S("offset",e,t,n),_S("scale",e,t,n),_S("epsilon",e,t,n))];case"LRN":return[rp(_S("x",e,t,n),_S("radius",e,t,n),_S("bias",e,t,n),_S("alpha",e,t,n),_S("beta",e,t,n))];case"Softmax":return[Af(_S("x",e,t,n))];case"LogSoftmax":return[pp(_S("x",e,t,n))];case"SparseToDense":return[uh(_S("sparseIndices",e,t,n),_S("outputShape",e,t,n),_S("sparseValues",e,t,n),_S("defaultValue",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"reduction":return Du((function(){return function(e,t,n){switch(e.op){case"Max":var r=_S("axis",e,t,n),a=_S("keepDims",e,t,n);return[cp(_S("x",e,t,n),r,a)];case"Mean":var i=_S("axis",e,t,n),o=_S("keepDims",e,t,n);return[Ep(_S("x",e,t,n),i,o)];case"Min":var s=_S("axis",e,t,n),u=_S("keepDims",e,t,n);return[Fp(_S("x",e,t,n),s,u)];case"Sum":var c=_S("axis",e,t,n),l=_S("keepDims",e,t,n);return[lp(_S("x",e,t,n),c,l)];case"All":var p=_S("axis",e,t,n),f=_S("keepDims",e,t,n);return[Ic(_S("x",e,t,n),p,f)];case"Any":var h=_S("axis",e,t,n),d=_S("keepDims",e,t,n);return[Sc(_S("x",e,t,n),h,d)];case"ArgMax":var m=_S("axis",e,t,n);return[Tc(_S("x",e,t,n),m)];case"ArgMin":var v=_S("axis",e,t,n);return[Cc(_S("x",e,t,n),v)];case"Prod":var g=_S("axis",e,t,n),y=_S("keepDims",e,t,n);return[Yp(_S("x",e,t,n),g,y)];case"Cumprod":var b=_S("axis",e,t,n),x=_S("exclusive",e,t,n),k=_S("reverse",e,t,n);return[Tl(_S("x",e,t,n),b,x,k)];case"Cumsum":var w=_S("axis",e,t,n),N=_S("exclusive",e,t,n),I=_S("reverse",e,t,n);return[Cl(_S("x",e,t,n),w,N,I)];case"Bincount":var S=_S("x",e,t,n),T=_S("weights",e,t,n),C=_S("size",e,t,n);return[ul(S,T,C)];case"DenseBincount":var E=_S("x",e,t,n),A=_S("weights",e,t,n),R=_S("size",e,t,n),_=_S("binaryOutput",e,t,n);return[El(E,A,R,_)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"slice_join":return Du((function(){return function(e,t,n){switch(e.op){case"ConcatV2":case"Concat":var r=_S("n",e,t,n),a=_S("axis",e,t,n),i=_S("tensors",e,t,n);return i=i.slice(0,r),[Jc(i,a)];case"Gather":var o=_S("x",e,t,n),s=_S("indices",e,t,n);return[jl(o,as(s,"int32"),0)];case"GatherV2":var u=_S("axis",e,t,n),c=_S("batchDims",e,t,n),l=_S("x",e,t,n),p=_S("indices",e,t,n);return[jl(l,as(p,"int32"),u,c)];case"Reverse":for(var f=_S("dims",e,t,n),h=[],d=0;d<f.length;d++)f[d]&&h.push(d);var m=_S("x",e,t,n);return[pf(m,h)];case"ReverseV2":var v=_S("axis",e,t,n),g=_S("x",e,t,n);return[pf(g,v)];case"Slice":var y=_S("begin",e,t,n),b=_S("size",e,t,n);return[el(_S("x",e,t,n),y,b)];case"StridedSlice":var x=_S("begin",e,t,n),k=_S("end",e,t,n),w=_S("strides",e,t,n),N=_S("beginMask",e,t,n),I=_S("endMask",e,t,n),S=_S("ellipsisMask",e,t,n),T=_S("newAxisMask",e,t,n),C=_S("shrinkAxisMask",e,t,n),E=_S("x",e,t,n);return[Zf(E,x,k,w,N,I,S,T,C)];case"Pack":return Du((function(){var r=_S("axis",e,t,n),a=_S("tensors",e,t,n),i=a[0].shape,o=Lf(a[0]).shape,s=a.map((function(e){var t=ke(e.shape,i);if(!t&&!ke(Lf(e).shape,o))throw new Error("the input tensors shape does not match");return t?e:Xc(e,i)}));return[zf(s,r)]}));case"Unpack":var A=_S("axis",e,t,n),R=_S("tensor",e,t,n);return Yf(R,A);case"Tile":var _=_S("reps",e,t,n);return[Vl(_S("x",e,t,n),_)];case"Split":case"SplitV":var F=_S("axis",e,t,n),D=_S("numOrSizeSplits",e,t,n),O=_S("x",e,t,n);return Df(O,D,F);case"ScatterNd":var M=_S("indices",e,t,n),L=_S("values",e,t,n),z=_S("shape",e,t,n);return[oh(M,L,z)];case"GatherNd":var P=_S("x",e,t,n),Z=_S("indices",e,t,n);return[ch(P,Z)];case"SparseToDense":var B=_S("sparseIndices",e,t,n),W=_S("outputShape",e,t,n),U=_S("sparseValues",e,t,n),V=_S("defaultValue",e,t,n);return[uh(B,U,W,U.dtype===V.dtype?V:as(V,U.dtype))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"sparse":return Du((function(){return function(e,t,n){switch(e.op){case"SparseFillEmptyRows":var r=Od.sparseFillEmptyRows(_S("indices",e,t,n),_S("values",e,t,n),_S("denseShape",e,t,n),_S("defaultValue",e,t,n));return[r.outputIndices,r.outputValues,r.emptyRowIndicator,r.reverseIndexMap];case"SparseReshape":var a=Od.sparseReshape(_S("inputIndices",e,t,n),_S("inputShape",e,t,n),_S("newShape",e,t,n));return[a.outputIndices,a.outputShape];case"SparseSegmentMean":return[Od.sparseSegmentMean(_S("data",e,t,n),_S("indices",e,t,n),_S("segmentIds",e,t,n))];case"SparseSegmentSum":return[Od.sparseSegmentSum(_S("data",e,t,n),_S("indices",e,t,n),_S("segmentIds",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"spectral":return Du((function(){return function(e,t,n){switch(e.op){case"FFT":return[Rf(_S("x",e,t,n))];case"IFFT":return[_f(_S("x",e,t,n))];case"RFFT":return[Of(_S("x",e,t,n))];case"IRFFT":return[Ff(_S("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"string":return Du((function(){return function(e,t,n){switch(e.op){case"StringNGrams":var r=Md.stringNGrams(_S("data",e,t,n),_S("dataSplits",e,t,n),_S("separator",e,t,n),_S("nGramWidths",e,t,n),_S("leftPad",e,t,n),_S("rightPad",e,t,n),_S("padWidth",e,t,n),_S("preserveShortSequences",e,t,n));return[r.nGrams,r.nGramsSplits];case"StringSplit":var a=Md.stringSplit(_S("input",e,t,n),_S("delimiter",e,t,n),_S("skipEmpty",e,t,n));return[a.indices,a.values,a.shape];case"StringToHashBucketFast":return[Md.stringToHashBucketFast(_S("input",e,t,n),_S("numBuckets",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"transformation":return Du((function(){return function(e,t,n){switch(e.op){case"Cast":return[as(_S("x",e,t,n),_S("dtype",e,t,n))];case"ExpandDims":var r=_S("axis",e,t,n);return[Wl(_S("x",e,t,n),r)];case"Squeeze":var a=_S("axis",e,t,n);return[Lf(_S("x",e,t,n),a)];case"Reshape":return[Xc(_S("x",e,t,n),_S("shape",e,t,n))];case"MirrorPad":return[Op(_S("x",e,t,n),_S("padding",e,t,n),_S("mode",e,t,n))];case"PadV2":case"Pad":return[Up(_S("x",e,t,n),_S("padding",e,t,n),_S("constantValue",e,t,n))];case"SpaceToBatchND":var i=_S("blockShape",e,t,n),o=_S("paddings",e,t,n);return[qp(_S("x",e,t,n),i,o)];case"BatchToSpaceND":var s=_S("blockShape",e,t,n),u=_S("crops",e,t,n);return[rl(_S("x",e,t,n),s,u)];case"DepthToSpace":var c=_S("blockSize",e,t,n),l=_S("dataFormat",e,t,n).toUpperCase();return[Al(_S("x",e,t,n),c,l)];case"BroadcastTo":return[ll(_S("x",e,t,n),_S("shape",e,t,n))];case"BroadcastArgs":return[cl(_S("s0",e,t,n),_S("s1",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"hash_table":return OT(e,t,n,r);case"custom":var a=AS(e.op);if(a&&a.customExecutor)return a.customExecutor(new yT(e,t,n));throw TypeError("Custom op ".concat(e.op," is not registered."));default:throw TypeError("Unknown op '".concat(e.op,"'. File an issue at ")+"https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(e,t,n);return et(a)?a.then((function(e){return[].concat(e)})):[].concat(a)}var LT=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};(0,$.Z)(this,e),this.weightMap=t,this.tensorArrayMap=n,this.tensorListMap=r,this.functionMap=a,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return(0,ee.Z)(e,[{key:"newFrame",value:function(e,t){return{id:e,frameName:t,iterationId:0}}},{key:"currentContext",get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}},{key:"currentContextId",get:function(){return this._currentContextIds[0]}},{key:"currentContextIds",get:function(){return this._currentContextIds}},{key:"generateCurrentContextIds",value:function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}},{key:"contextIdforContexts",value:function(e){return e?e.map((function(e){return 0===e.id&&0===e.iterationId?"":"".concat(e.frameName,"-").concat(e.iterationId)})).join("/"):""}},{key:"enterFrame",value:function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}},{key:"exitFrame",value:function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}},{key:"nextIteration",value:function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}},{key:"getWeight",value:function(e){return this.weightMap[e]}},{key:"addTensorArray",value:function(e){this.tensorArrayMap[e.id]=e}},{key:"getTensorArray",value:function(e){return this.tensorArrayMap[e]}},{key:"addTensorList",value:function(e){this.tensorListMap[e.id]=e}},{key:"getTensorList",value:function(e){return this.tensorListMap[e]}},{key:"dispose",value:function(e){for(var t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(var n in this.tensorListMap)this.tensorListMap[n].clearAndClose(e)}}]),e}();function zT(e,t,n,r){var a=new Set,i=[],o=null,s=null,u=new Set,c=Object.keys(e).map((function(e){return MS(e)[0]})),l=[];null!=r&&(l=r.map((function(e){return MS(e.name)[0]})));for(var p=Y(t);p.length>0;){var f=p.pop();(WT(f)||UT(f)||VT(f))&&null==o&&(s=(o=f).children.map((function(e){return e.name})).filter((function(e){return a.has(e)}))),a.add(f.name),null==n[f.name]&&(-1===c.indexOf(f.name)&&-1===l.indexOf(f.name)&&(0!==f.inputs.length?f.inputs.forEach((function(e){u.has(e.name)||(u.add(e.name),p.push(e))})):i.push(f.name)))}return{inputs:e,outputs:t,usedNodes:a,missingInputs:i,dynamicNode:o,syncInputs:s}}var PT=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],ZT=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],BT=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function WT(e){return PT.indexOf(e.op)>=0}function UT(e){return ZT.indexOf(e.op)>=0}function VT(e){return BT.indexOf(e.op)>=0}var GT=function(){function e(t,n){var r=this;(0,$.Z)(this,e),this.graph=t,this.parent=n,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.intermediateTensors={},this.keepTensorForDebug=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach((function(n){r._functionExecutorMap[n]=new e(t.functions[n],r)}))}return(0,ee.Z)(e,[{key:"weightIds",get:function(){return this.parent?this.parent.weightIds:this._weightIds}},{key:"functionExecutorMap",get:function(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}},{key:"weightMap",get:function(){return this.parent?this.parent.weightMap:this._weightMap},set:function(e){var t,n=Object.keys(e).map((function(t){return e[t].map((function(e){return e.id}))}));this._weightIds=(t=[]).concat.apply(t,Y(n)),this._weightMap=e}},{key:"resourceManager",set:function(e){this._resourceManager=e}},{key:"inputs",get:function(){return this._inputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"outputs",get:function(){return this._outputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"inputNodes",get:function(){return this._inputs.map((function(e){return e.signatureKey||e.name}))}},{key:"outputNodes",get:function(){return this._outputs.map((function(e){var t=e.signatureKey||e.name;return e.defaultOutput?"".concat(t,":").concat(e.defaultOutput):t}))}},{key:"functions",get:function(){var e=this;return Object.keys(this._functions).reduce((function(t,n){return t[n]=e._functions[n].signature,t}),{})}},{key:"getCompilationKey",value:function(e,t){var n=e.map((function(e){return e.name})).sort(),r=t.map((function(e){return e.name})).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}},{key:"compile",value:function(e,t){var n=zT(e,t,this.weightMap,this._initNodes),r=n.missingInputs,a=n.dynamicNode,i=n.syncInputs;if(null!=a)throw new Error("This execution contains the node '".concat(a.name,"', which has ")+"the dynamic op '".concat(a.op,"'. Please use ")+"model.executeAsync() instead. Alternatively, to avoid the "+"dynamic ops, specify the inputs [".concat(i,"]"));if(r.length>0){var o=t.map((function(e){return e.name})),s=Object.keys(e);throw new Error("Cannot compute the outputs [".concat(o,"] from the provided inputs ")+"[".concat(s,"]. Missing the following inputs: [").concat(r,"]"))}return function(e,t,n){var r=n.usedNodes,a=n.inputs,i=[],o=Object.keys(a).map((function(e){return MS(e)[0]})).map((function(t){return e.nodes[t]})),s=e.initNodes;o.forEach((function(e){r.has(e.name)&&i.push(e)})),e.weights.forEach((function(e){r.has(e.name)&&i.push(e)})),null!=s&&s.forEach((function(e){r.has(e.name)&&i.push(e)}));for(var u=new Set,c=[];i.length>0;){var l=i.pop();u.add(l.name),t[l.name]||c.push(l),l.children.forEach((function(e){!u.has(e.name)&&r.has(e.name)&&e.inputs.every((function(e){return u.has(e.name)}))&&i.push(e)}))}return c}(this.graph,this.weightMap,n)}},{key:"execute",value:function(e,t){var n=this;e=this.mapInputs(e);var r=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var a=r.map((function(e){return n.graph.nodes[MS(e)[0]]})),i=t.map((function(e){return MS(e)[0]})),o=i.map((function(e){return n.graph.nodes[e]}));this.resetIntermediateTensors(),0===o.length&&(o=this._outputs);var s=this.getCompilationKey(a,o),u=this.compiledMap.get(s);null==u&&(u=this.compile(e,o),this.compiledMap.set(s,u));var c={},l={};return Du((function(){var r=new LT(n.weightMap,c,l,n.functionExecutorMap),a=Object.assign({},n.weightMap);Object.keys(e).forEach((function(t){var n=MS(t),r=(0,oe.Z)(n,2),i=r[0],o=[];o[r[1]]=e[t],a[i]=o}));for(var o=n.getFrozenTensorIds(a),s={},p=0;p<u.length;p++){var f=u[p];if(!a[f.name]){var h=MT(f,a,r,n._resourceManager);if(et(h))throw new Error("The execution of the op '".concat(f.op,"' returned a promise. ")+"Please use model.executeAsync() instead.");a[f.name]=h,n.checkTensorForDisposal(f.name,f,a,r,o,i,s)}}return null==n.parent&&r.dispose(o),t.map((function(e){return FS(e,a,r)}))}))}},{key:"getFrozenTensorIds",value:function(e){var t=[].concat.apply([],Object.keys(e).map((function(t){return e[t]})).map((function(e){return e.map((function(e){return e.id}))})));return new Set(t)}},{key:"checkTensorForDisposal",value:function(e,t,n,r,a,i,o){var s=this;"control"!==t.category&&-1===i.indexOf(e)&&(n[e].forEach((function(e){null!=e&&(o[e.id]=(o[e.id]||0)+t.children.length)})),t.inputs.forEach((function(e){if("control"!==e.category){var i=function(e,t,n){return t[OS(e,n.currentContextId)]}(e.name,n,r);null!=i&&i.forEach((function(e){if(e&&!e.kept&&!a.has(e.id)){var n=o[e.id];if(1===n){if(s.keepTensorForDebug){var i=DS(t.name,r),u=(0,oe.Z)(i,2),c=u[0],l=u[1];s.intermediateTensors[c]||(s.intermediateTensors[c]=[]),s.intermediateTensors[c][l]=e}else e.dispose();delete o[e.id]}else null!=n&&o[e.id]--}}))}})))}},{key:"executeAsync",value:function(){var e=J(ne().mark((function e(t,n){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._executeAsync(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"disposeIntermediateTensors",value:function(){var e=this;this.intermediateTensors&&(Object.keys(this.intermediateTensors).forEach((function(t){return e.intermediateTensors[t].forEach((function(e){return e.dispose()}))})),this.disposeTensorsMap())}},{key:"disposeTensorsMap",value:function(){var e=this;this.tensorsMap&&Object.keys(this.tensorsMap).forEach((function(t){e.tensorsMap[t].forEach((function(t){!t||t.kept||t.isDisposed||e.keepIds.has(t.id)||t.dispose()}))}))}},{key:"getIntermediateTensors",value:function(){return this.tensorsMap}},{key:"resetIntermediateTensors",value:function(){for(var e in this.intermediateTensors)this.intermediateTensors[e].forEach((function(e){return e.dispose()})),delete this.intermediateTensors[e]}},{key:"_executeAsync",value:function(){var e=J(ne().mark((function e(t,n){var r,a,i,o,s,u,c,l=this,p=arguments;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=p.length>2&&void 0!==p[2]&&p[2],a=p.length>3&&void 0!==p[3]?p[3]:{},i=p.length>4&&void 0!==p[4]?p[4]:{},r||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),n=this.mapOutputs(n),this.checkOutputs(n));try{this.keepTensorForDebug=it().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(f){console.warn(f.message)}return this.resetIntermediateTensors(),o=new LT(this.weightMap,a,i,this.functionExecutorMap),e.next=9,this.executeWithControlFlow(t,o,n,r);case 9:return this.tensorsMap=e.sent,s=n.map((function(e){return FS(e,l.tensorsMap,o)})),u=s.map((function(e){return e.id})),c=Object.keys(t).map((function(e){return t[e].id})),this.keepIds=new Set([].concat(Y(u),Y(c),Y(this.weightIds))),this.keepTensorForDebug||this.disposeTensorsMap(),null==this.parent&&o.dispose(this.keepIds),e.abrupt("return",s);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"executeFunctionAsync",value:function(){var e=J(ne().mark((function e(t,n,r){var a,i=this;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.reduce((function(e,t,n){return e[i.inputs[n].name]=t,e}),{}),e.abrupt("return",this._executeAsync(a,this.outputNodes,!0,n,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"executeWithControlFlow",value:function(){var e=J(ne().mark((function e(t,n,r,a){var i,o,s,u,c,l,p,f,h,d,m,v,g,y,b,x,k,w=this;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Object.keys(t),o=i.map((function(e){return w.graph.nodes[MS(e)[0]]})),s=r.map((function(e){return MS(e)[0]})),0===(u=s.map((function(e){return w.graph.nodes[e]}))).length&&(u=this._outputs),c=zT(t,u,this.weightMap,this._initNodes),l=c.usedNodes,p=c.missingInputs,f=c.dynamicNode,h=c.syncInputs,d=[].concat(Y(o),Y(this.graph.weights),Y(this._initNodes||[])).map((function(e){return{node:e,contexts:n.currentContext}})),m=Object.assign({},this.weightMap),Object.keys(t).forEach((function(e){var n=MS(e),r=(0,oe.Z)(n,2),a=r[0],i=[];i[r[1]]=t[e],m[a]=i})),v={},g=this.getFrozenTensorIds(m),y={};case 12:if(!(d.length>0)){e.next=18;break}return b=this.processStack(o,d,n,m,y,g,s,v,l),e.next=16,Promise.all(b);case 16:e.next=12;break;case 18:if(null!=f||a||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),!((x=u.filter((function(e){return!WT(e)&&!FS(e.name,m,n)})).map((function(e){return e.name}))).length>0)){e.next=24;break}throw k="",null!=f&&(k="Alternatively, to avoid the dynamic ops, use model.execute() "+"and specify the inputs [".concat(h,"]")),new Error("Cannot compute the outputs [".concat(x,"] from the provided ")+"inputs [".concat(i,"]. Consider providing the following inputs: ")+"[".concat(p,"]. ").concat(k));case 24:return e.abrupt("return",m);case 25:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"processStack",value:function(e,t,n,r,a,i,o,s,u){for(var c=this,l=[],p=function(){var e=t.pop();n.currentContext=e.contexts;var p="";if("Enter"===e.node.op&&_S("isConstant",e.node,r,n)){var f=DS(e.node.name,n),h=(0,oe.Z)(f,1);p=h[0]}if(null==r[e.node.name]){var d=MT(e.node,r,n,c._resourceManager);if(!p){var m=DS(e.node.name,n),v=(0,oe.Z)(m,1);p=v[0]}var g=n.currentContext;et(d)?l.push(d.then((function(l){return r[p]=l,n.currentContext=g,c.checkTensorForDisposal(p,e.node,r,n,i,o,s),c.processChildNodes(e.node,t,n,r,a,u),l}))):(r[p]=d,c.checkTensorForDisposal(p,e.node,r,n,i,o,s),c.processChildNodes(e.node,t,n,r,a,u))}else c.processChildNodes(e.node,t,n,r,a,u)};t.length>0;)p();return l}},{key:"processChildNodes",value:function(e,t,n,r,a,i){e.children.forEach((function(e){var o=DS(e.name,n),s=(0,oe.Z)(o,1)[0];!a[s]&&i.has(e.name)&&("Merge"===e.op?e.inputNames.some((function(e){return!!FS(e,r,n)}))&&(a[s]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every((function(e){return!!FS(e,r,n)}))&&(a[s]=!0,t.push({contexts:n.currentContext,node:e})))}))}},{key:"dispose",value:function(){var e=this;Object.keys(this.weightMap).forEach((function(t){return e.weightMap[t].forEach((function(e){return e.dispose()}))}))}},{key:"checkInputShapeAndType",value:function(e){var t=this;Object.keys(e).forEach((function(n){var r=e[n],a=MS(n),i=(0,oe.Z)(a,1)[0],o=t.graph.nodes[i];if(o.attrParams.shape&&o.attrParams.shape.value){var s=o.attrParams.shape.value;me(s.length===r.shape.length&&r.shape.every((function(e,t){return-1===s[t]||s[t]===e})),(function(){return"The shape of dict['".concat(o.name,"'] provided in ")+"model.execute(dict) must be [".concat(s,"], but was ")+"[".concat(r.shape,"]")}))}o.attrParams.dtype&&o.attrParams.dtype.value&&me(r.dtype===o.attrParams.dtype.value,(function(){return"The dtype of dict['".concat(o.name,"'] provided in ")+"model.execute(dict) must be "+"".concat(o.attrParams.dtype.value,", but was ").concat(r.dtype)}))}))}},{key:"mapInputs",value:function(e){var t={};for(var n in e){if(null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n])t[this._signature.inputs[n].name]=e[n];else t[n]=e[n]}return t}},{key:"checkInputs",value:function(e){var t=this,n=Object.keys(e).filter((function(e){var n=MS(e),r=(0,oe.Z)(n,1)[0];return null==t.graph.nodes[r]}));if(n.length>0)throw new Error("The dict provided in model.execute(dict) has "+"keys: [".concat(n,"] that are not part of graph"))}},{key:"mapOutputs",value:function(e){var t=this;return e.map((function(e){return null!=t._signature&&null!=t._signature.outputs&&null!=t._signature.outputs[e]?t._signature.outputs[e].name:e}),{})}},{key:"checkOutputs",value:function(e){var t=this;e.forEach((function(e){var n=MS(e),r=(0,oe.Z)(n,1)[0];if(!t.graph.nodes[r])throw new Error("The output '".concat(e,"' is not found in the graph"))}))}}]),e}(),HT=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,$.Z)(this,e),this.hashTableNameToHandle=t,this.hashTableMap=n}return(0,ee.Z)(e,[{key:"addHashTable",value:function(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}},{key:"getHashTableHandleByName",value:function(e){return this.hashTableNameToHandle[e]}},{key:"getHashTableById",value:function(e){return this.hashTableMap[e]}},{key:"dispose",value:function(){for(var e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(var t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}]),e}(),jT="?tfjs-format=file",qT="model.json",KT=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,$.Z)(this,e),this.modelUrl=t,this.loadOptions=n,this.version="n/a",null==n&&(this.loadOptions={}),this.resourceManager=new HT}return(0,ee.Z)(e,[{key:"modelVersion",get:function(){return this.version}},{key:"inputNodes",get:function(){return this.executor.inputNodes}},{key:"outputNodes",get:function(){return this.executor.outputNodes}},{key:"inputs",get:function(){return this.executor.inputs}},{key:"outputs",get:function(){return this.executor.outputs}},{key:"weights",get:function(){return this.executor.weightMap}},{key:"metadata",get:function(){return this.artifacts.userDefinedMetadata}},{key:"modelSignature",get:function(){return this.signature}},{key:"findIOHandler",value:function(){var e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=ws(e,this.loadOptions);else{var t=yo(e,this.loadOptions);if(0===t.length)t.push(ws(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one (".concat(t.length,") load handlers for ")+"URL '".concat([e],"'"));this.handler=t[0]}}},{key:"load",value:function(){var e=J(ne().mark((function e(){var t;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.findIOHandler(),null!=this.handler.load){e.next=3;break}throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");case 3:return e.next=5,this.handler.load();case 5:return t=e.sent,e.abrupt("return",this.loadSync(t));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadSync",value:function(e){this.artifacts=e;var t,n=this.artifacts.modelTopology;t=null!=this.artifacts.userDefinedMetadata&&null!=this.artifacts.userDefinedMetadata.signature?this.artifacts.userDefinedMetadata.signature:this.artifacts.signature,this.signature=t,this.version="".concat(n.versions.producer,".").concat(n.versions.minConsumer);var r=eo(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new GT(rT.Instance.transformGraph(n,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,null!=e.modelInitializer&&null!=e.modelInitializer.node){var a=rT.Instance.transformGraph(e.modelInitializer);this.initializer=new GT(a),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}},{key:"save",value:function(){var e=J(ne().mark((function e(t,n){var r;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=9;break}if(0!==(r=go(t)).length){e.next=6;break}throw new Error("Cannot find any save handlers for URL '".concat(t,"'"));case 6:if(!(r.length>1)){e.next=8;break}throw new Error("Found more than one (".concat(r.length,") save handlers for ")+"URL '".concat(t,"'"));case 8:t=r[0];case 9:if(null!=t.save){e.next=11;break}throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 11:return e.abrupt("return",t.save(this.artifacts));case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"predict",value:function(e,t){return this.execute(e,this.outputNodes)}},{key:"normalizeInputs",value:function(e){if(!(e instanceof hi)&&!Array.isArray(e))return e;if((e=Array.isArray(e)?e:[e]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,"+"the graph model has ".concat(this.inputNodes.length," placeholders, ")+"while there are ".concat(e.length," input tensors."));return this.inputNodes.reduce((function(t,n,r){return t[n]=e[r],t}),{})}},{key:"normalizeOutputs",value:function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}},{key:"execute",value:function(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var n=this.executor.execute(e,t);return n.length>1?n:n[0]}},{key:"executeAsync",value:function(){var e=J(ne().mark((function e(t,n){var r;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.normalizeInputs(t),n=this.normalizeOutputs(n),e.next=4,this.executor.executeAsync(t,n);case 4:return r=e.sent,e.abrupt("return",r.length>1?r:r[0]);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getIntermediateTensors",value:function(){return this.executor.getIntermediateTensors()}},{key:"disposeIntermediateTensors",value:function(){this.executor.disposeIntermediateTensors()}},{key:"convertTensorMapToTensorsMap",value:function(e){return Object.keys(e).reduce((function(t,n){return t[n]=[e[n]],t}),{})}},{key:"dispose",value:function(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}]),e}();function XT(e){return YT.apply(this,arguments)}function YT(){return YT=J(ne().mark((function e(t){var n,r,a=arguments;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:{},null!=t){e.next=3;break}throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");case 3:return null==n&&(n={}),n.fromTFHub&&null==t.load&&(t.endsWith("/")||(t+="/"),t="".concat(t).concat(qT).concat(jT)),r=new KT(t,n),e.next=8,r.load();case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)}))),YT.apply(this,arguments)}var QT="3.15.0";function JT(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set;if(null==e)return null;if("function"===typeof Blob&&e instanceof Blob)return e.slice();if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse){if(aC(e)){var i=Array.isArray(e)?[]:{};for(var o in r.add(e),e){var s=e[o],u=JT(s,t,n,r);i[o]=u}return r.delete(e),e.__proto__&&(i.__proto__=e.__proto__),i}throw new Error("Can't recurse into non-iterable type: ".concat(e))}return n.set(e,a.value),a.value}function $T(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tC;return eC(e,t)}function eC(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set,r=e[0];if(n.has(r))throw new Error("Circular references are not supported.");var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse){if(aC(r)){var i=Array.isArray(r)?[]:{};n.add(r);var o=function(r){var a=eC(e.map((function(e){return e[r]})),t,n);i[r]=a};for(var s in r)o(s);return n.delete(r),i}throw new Error("Can't recurse into non-iterable type: ".concat(r))}return a.value}function tC(e){return null===e?null:aC(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function nC(e,t){return rC.apply(this,arguments)}function rC(){return rC=J(ne().mark((function e(t,n){var r,a,i,o,s,u,c;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new Map,JT(t,n,r),a=0,i=Array.from(r.keys());case 3:if(!(a<i.length)){e.next=14;break}if(o=i[a],!et(s=r.get(o))){e.next=11;break}return e.next=9,s;case 9:u=e.sent,r.set(o,u);case 11:a++,e.next=3;break;case 14:return c=JT(t,n,r),e.abrupt("return",c);case 16:case"end":return e.stop()}}),e)}))),rC.apply(this,arguments)}function aC(e){var t=!1;it().get("IS_BROWSER")?t=e instanceof TextDecoder:t=e instanceof n(977).StringDecoder;return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"===typeof e&&!(e instanceof hi)&&!(e instanceof Promise)&&!t)}function iC(e){return function(e,t){return JT(e,t)}(e,oC)}function oC(e){return e instanceof hi?{value:e.clone(),recurse:!1}:aC(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}var sC=function(){function e(t){if((0,$.Z)(this,e),this.capacity=t,this.begin=0,this.end=0,null==t)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}return(0,ee.Z)(e,[{key:"wrap",value:function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}},{key:"get",value:function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}},{key:"set",value:function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}},{key:"length",value:function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}},{key:"isFull",value:function(){return this.length()===this.capacity}},{key:"isEmpty",value:function(){return 0===this.length()}},{key:"push",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}},{key:"pushAll",value:function(e){var t,n=q(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.push(r)}}catch($V){n.e($V)}finally{n.f()}}},{key:"pop",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e}},{key:"unshift",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}},{key:"shift",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}},{key:"shuffleExcise",value:function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}]),e}(),uC=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.call(this,n.INITIAL_CAPACITY)}return(0,ee.Z)(n,[{key:"isFull",value:function(){return!1}},{key:"push",value:function(e){qb((0,rg.Z)(n.prototype),"isFull",this).call(this)&&this.expand(),qb((0,rg.Z)(n.prototype),"push",this).call(this,e)}},{key:"unshift",value:function(e){qb((0,rg.Z)(n.prototype),"isFull",this).call(this)&&this.expand(),qb((0,rg.Z)(n.prototype),"unshift",this).call(this,e)}},{key:"expand",value:function(){for(var e=2*this.capacity,t=new Array(e),n=this.length(),r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}]),n}(sC);function cC(e){return new mC(e)}function lC(e){return new vC(e)}function pC(e,t){return new CC(e,t)}function fC(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:hC.FAIL;return new EC(e,t)}uC.INITIAL_CAPACITY=32;var hC,dC=function(){function e(){(0,$.Z)(this,e)}return(0,ee.Z)(e,[{key:"toArray",value:function(){var e=J(ne().mark((function e(){var t,n;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,this.next();case 3:n=e.sent;case 4:if(n.done){e.next=11;break}return t.push(n.value),e.next=8,this.next();case 8:n=e.sent,e.next=4;break;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=J(ne().mark((function e(){var t,n,r;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.prefetch(100),n=[],e.next=4,t.next();case 4:r=e.sent;case 5:if(r.done){e.next=12;break}return n.push(r.value),e.next=9,t.next();case 9:r=e.sent,e.next=5;break;case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveFully",value:function(){var e=J(ne().mark((function e(){var t;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:t=e.sent;case 3:if(t.done){e.next=9;break}return e.next=6,this.next();case 6:t=e.sent,e.next=3;break;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveWhile",value:function(){var e=J(ne().mark((function e(t){var n,r;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:n=e.sent,r=t(n.value);case 4:if(n.done||!r){e.next=11;break}return e.next=7,this.next();case 7:n=e.sent,r=t(n.value),e.next=4;break;case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleErrors",value:function(e){return new NC(this,e)}},{key:"filter",value:function(e){return new kC(this,e)}},{key:"map",value:function(e){return new wC(this,e)}},{key:"mapAsync",value:function(e){return new IC(this,e)}},{key:"serialMapAsync",value:function(e){return new IC(this,e).serial()}},{key:"flatmap",value:function(e){return new TC(this,e)}},{key:"forEachAsync",value:function(){var e=J(ne().mark((function e(t){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.map(t).resolveFully());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"serialForEach",value:function(){var e=J(ne().mark((function e(t){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.serialMapAsync(t).resolveWhile((function(e){return!0===e})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rowMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new xC(this,e,t)}},{key:"columnMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:tC,r=this.rowMajorBatch(e,t);return r.map((function(e){return $T(e,n)}))}},{key:"concatenate",value:function(e,t){return new CC(cC([this,e]),t)}},{key:"take",value:function(e){return e<0||null==e?this:new bC(this,e)}},{key:"skip",value:function(e){return e<0||null==e?this:new yC(this,e)}},{key:"prefetch",value:function(e){return new AC(this,e)}},{key:"shuffle",value:function(e,t){return new RC(this,e,t)}},{key:"serial",value:function(){return new gC(this)}}]),e}(),mC=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this)).items=e,r.trav=0,r}return(0,ee.Z)(n,[{key:"summary",value:function(){return"Array of ".concat(this.items.length," items")}},{key:"next",value:function(){var e=J(ne().mark((function e(){var t;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.trav>=this.items.length)){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return t=this.items[this.trav],this.trav++,e.abrupt("return",{value:iC(t),done:!1});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(dC),vC=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this)).nextFn=e,r}return(0,ee.Z)(n,[{key:"summary",value:function(){return"Function call"}},{key:"next",value:function(){var e=J(ne().mark((function e(){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",this.nextFn());case 4:throw e.prev=4,e.t0=e.catch(0),e.t0.message="Error thrown while iterating through a dataset: ".concat(e.t0.message),e.t0;case 8:case"end":return e.stop()}}),e,this,[[0,4]])})));return function(){return e.apply(this,arguments)}}()}]),n}(dC),gC=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this)).upstream=e,r.lastRead=Promise.resolve({value:null,done:!1}),r}return(0,ee.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Serial")}},{key:"next",value:function(){var e=J(ne().mark((function e(){var t=this;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=J(ne().mark((function e(){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.upstream.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(dC),yC=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e,r){var a;return(0,$.Z)(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return(0,ee.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Skip")}},{key:"next",value:function(){var e=J(ne().mark((function e(){var t=this;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=J(ne().mark((function e(){var t;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.count++<this.maxCount)){e.next=9;break}return e.next=3,this.upstream.next();case 3:if(!(t=e.sent).done){e.next=6;break}return e.abrupt("return",t);case 6:Ou(t.value),e.next=0;break;case 9:return e.abrupt("return",this.upstream.next());case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(dC),bC=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e,r){var a;return(0,$.Z)(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a}return(0,ee.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Take")}},{key:"next",value:function(){var e=J(ne().mark((function e(){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.count++>=this.maxCount)){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return e.abrupt("return",this.upstream.next());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(dC),xC=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e,r){var a,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return(0,$.Z)(this,n),(a=t.call(this)).upstream=e,a.batchSize=r,a.enableSmallLastBatch=i,a.lastRead=Promise.resolve({value:null,done:!1}),a}return(0,ee.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> RowMajorBatch")}},{key:"next",value:function(){var e=J(ne().mark((function e(){var t=this;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=J(ne().mark((function e(){var t,n;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[];case 1:if(!(t.length<this.batchSize)){e.next=12;break}return e.next=4,this.upstream.next();case 4:if(!(n=e.sent).done){e.next=9;break}if(!(this.enableSmallLastBatch&&t.length>0)){e.next=8;break}return e.abrupt("return",{value:t,done:!1});case 8:return e.abrupt("return",{value:null,done:!0});case 9:t.push(n.value),e.next=1;break;case 12:return e.abrupt("return",{value:t,done:!1});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(dC),kC=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e,r){var a;return(0,$.Z)(this,n),(a=t.call(this)).upstream=e,a.predicate=r,a.lastRead=Promise.resolve({value:null,done:!1}),a}return(0,ee.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Filter")}},{key:"next",value:function(){var e=J(ne().mark((function e(){var t=this;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=J(ne().mark((function e(){var t;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,this.upstream.next();case 3:if(!(t=e.sent).done&&!this.predicate(t.value)){e.next=6;break}return e.abrupt("return",t);case 6:Ou(t.value),e.next=0;break;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(dC),wC=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e,r){var a;return(0,$.Z)(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return(0,ee.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Map")}},{key:"next",value:function(){var e=J(ne().mark((function e(){var t,n,r,a,i,o,s;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:n=Ci(t.value),r=this.transform(t.value),a=Ci(r),i=q(n);try{for(i.s();!(o=i.n()).done;)Ti(s=o.value,a)||s.dispose()}catch($V){i.e($V)}finally{i.f()}return e.abrupt("return",{value:r,done:!1});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(dC),NC=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e,r){var a;return(0,$.Z)(this,n),(a=t.call(this)).upstream=e,a.handler=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return(0,ee.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> handleErrors")}},{key:"next",value:function(){var e=J(ne().mark((function e(){var t=this;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=J(ne().mark((function e(){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,this.upstream.next();case 4:return e.abrupt("return",e.sent);case 7:if(e.prev=7,e.t0=e.catch(1),this.handler(e.t0)){e.next=11;break}return e.abrupt("return",{value:null,done:!0});case 11:e.next=0;break;case 13:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(){return e.apply(this,arguments)}}()}]),n}(dC),IC=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e,r){var a;return(0,$.Z)(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return(0,ee.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> AsyncMap")}},{key:"next",value:function(){var e=J(ne().mark((function e(){var t,n,r,a,i,o,s;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:return n=Ci(t.value),e.next=8,this.transform(t.value);case 8:r=e.sent,a=Ci(r),i=q(n);try{for(i.s();!(o=i.n()).done;)Ti(s=o.value,a)||s.dispose()}catch($V){i.e($V)}finally{i.f()}return e.abrupt("return",{value:r,done:!1});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(dC),SC=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){var e;return(0,$.Z)(this,n),(e=t.call(this)).outputQueue=new uC,e.lastRead=Promise.resolve({value:null,done:!1}),e}return(0,ee.Z)(n,[{key:"next",value:function(){var e=J(ne().mark((function e(){var t=this;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=J(ne().mark((function e(){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.outputQueue.length()){e.next=7;break}return e.next=3,this.pump();case 3:if(e.sent){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:e.next=0;break;case 7:return e.abrupt("return",{value:this.outputQueue.shift(),done:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(dC),TC=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e,r){var a;return(0,$.Z)(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return(0,ee.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Flatmap")}},{key:"pump",value:function(){var e=J(ne().mark((function e(){var t,n,r,a,i,o,s;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",!1);case 5:n=Ci(t.value),r=this.transform(t.value),a=Ci(r),this.outputQueue.pushAll(r),i=q(n);try{for(i.s();!(o=i.n()).done;)Ti(s=o.value,a)||s.dispose()}catch($V){i.e($V)}finally{i.f()}return e.abrupt("return",!0);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(SC),CC=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e,r){var a;return(0,$.Z)(this,n),(a=t.call(this)).baseErrorHandler=r,a.lastRead=null,a.iterator=null,a.moreIterators=e,a}return(0,ee.Z)(n,[{key:"summary",value:function(){return"".concat("TODO: fill in upstream of chained summaries"," -> Chained")}},{key:"next",value:function(){var e=J(ne().mark((function e(){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.readFromChain(this.lastRead),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"readFromChain",value:function(){var e=J(ne().mark((function e(t){var n,r;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(null!=this.iterator){e.next=10;break}return e.next=5,this.moreIterators.next();case 5:if(!(n=e.sent).done){e.next=8;break}return e.abrupt("return",{value:null,done:!0});case 8:this.iterator=n.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler));case 10:return e.next=12,this.iterator.next();case 12:if(!(r=e.sent).done){e.next=16;break}return this.iterator=null,e.abrupt("return",this.readFromChain(t));case 16:return e.abrupt("return",r);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(dC);!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(hC||(hC={}));var EC=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:hC.FAIL;return(0,$.Z)(this,n),(r=t.call(this)).iterators=e,r.mismatchMode=a,r.count=0,r.currentPromise=null,r}return(0,ee.Z)(n,[{key:"summary",value:function(){return"{".concat("TODO: fill in upstream of zip summaries","} -> Zip")}},{key:"nextState",value:function(){var e=J(ne().mark((function e(t){var n,r,a,i;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(e){return e instanceof dC?{value:e.next().then((function(e){return n++,e.done&&r++,e.value})),recurse:!1}:{value:null,recurse:!0}},e.next=3,t;case 3:return n=0,r=0,e.next=7,nC(this.iterators,a);case 7:if(i=e.sent,n!==r){e.next=10;break}return e.abrupt("return",{value:null,done:!0});case 10:if(!(r>0)){e.next=16;break}e.t0=this.mismatchMode,e.next=e.t0===hC.FAIL?14:e.t0===hC.SHORTEST?15:(e.t0,hC.LONGEST,16);break;case 14:throw new Error("Zipped streams should have the same length. "+"Mismatched at element ".concat(this.count,"."));case 15:return e.abrupt("return",{value:null,done:!0});case 16:return this.count++,e.abrupt("return",{value:i,done:!1});case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"next",value:function(){var e=J(ne().mark((function e(){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.currentPromise=this.nextState(this.currentPromise),e.abrupt("return",this.currentPromise);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(dC),AC=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e,r){var a;return(0,$.Z)(this,n),(a=t.call(this)).upstream=e,a.bufferSize=r,a.buffer=new sC(r),a}return(0,ee.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Prefetch")}},{key:"refill",value:function(){for(;!this.buffer.isFull();){var e=this.upstream.next();this.buffer.push(e)}}},{key:"next",value:function(){return this.refill(),this.buffer.shift()}}]),n}(dC),RC=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e,r,a){var i;return(0,$.Z)(this,n),(i=t.call(this,e,r)).upstream=e,i.windowSize=r,i.upstreamExhausted=!1,i.random=Jp.alea(a||Xa().toString()),i.lastRead=Promise.resolve({value:null,done:!1}),i}return(0,ee.Z)(n,[{key:"next",value:function(){var e=J(ne().mark((function e(){var t=this;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"randomInt",value:function(e){return Math.floor(this.random()*e)}},{key:"chooseIndex",value:function(){return this.randomInt(this.buffer.length())}},{key:"serialNext",value:function(){var e=J(ne().mark((function e(){var t,n;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.upstreamExhausted||this.refill();case 1:if(this.buffer.isEmpty()){e.next=14;break}return t=this.chooseIndex(),e.next=5,this.buffer.shuffleExcise(t);case 5:if(!(n=e.sent).done){e.next=10;break}this.upstreamExhausted=!0,e.next=12;break;case 10:return this.refill(),e.abrupt("return",n);case 12:e.next=1;break;case 14:return e.abrupt("return",{value:null,done:!0});case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(AC),_C=function(){function e(){(0,$.Z)(this,e),this.size=null}return(0,ee.Z)(e,[{key:"batch",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this;return me(e>0,(function(){return"batchSize needs to be positive, but it is\n      ".concat(e)})),t=this.size===1/0||null==this.size?this.size:n?Math.ceil(this.size/e):Math.floor(this.size/e),FC(J(ne().mark((function t(){return ne().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.iterator();case 2:return t.abrupt("return",t.sent.columnMajorBatch(e,n,MC));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"concatenate",value:function(e){var t,n=this;return t=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,FC(J(ne().mark((function t(){return ne().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.t0=t.sent,t.next=5,e.iterator();case 5:return t.t1=t.sent,t.abrupt("return",t.t0.concatenate.call(t.t0,t.t1));case 7:case"end":return t.stop()}}),t)}))),t)}},{key:"filter",value:function(e){var t,n=this;return t=this.size===1/0?1/0:null,FC(J(ne().mark((function t(){return ne().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.filter((function(t){return Du((function(){return e(t)}))})));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"forEachAsync",value:function(){var e=J(ne().mark((function e(t){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.iterator();case 2:return e.abrupt("return",e.sent.forEachAsync(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"map",value:function(e){var t=this;return FC(J(ne().mark((function n(){return ne().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.map((function(t){return Du((function(){return e(t)}))})));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"mapAsync",value:function(e){var t=this;return FC(J(ne().mark((function n(){return ne().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.mapAsync(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"prefetch",value:function(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var t=this;return FC(J(ne().mark((function n(){return ne().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.prefetch(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"repeat",value:function(e){var t,n=this;return t=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,FC(J(ne().mark((function t(){var r;return ne().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=lC(J(ne().mark((function e(){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.iterator();case 2:return e.t0=e.sent,e.abrupt("return",{value:e.t0,done:!1});case 4:case"end":return e.stop()}}),e)})))),t.abrupt("return",pC(r.take(e)));case 2:case"end":return t.stop()}}),t)}))),t)}},{key:"skip",value:function(e){var t,n=this;return t=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,FC(J(ne().mark((function t(){return ne().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.skip(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"shuffle",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting "+"bufferSize to the dataset size (".concat(this.size," elements)"));var r=this,a=Jp.alea(t||Xa().toString());return FC(J(ne().mark((function t(){var i;return ne().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=a.int32(),n&&(i+=a.int32()),t.next=4,r.iterator();case 4:return t.abrupt("return",t.sent.shuffle(e,i.toString()));case 5:case"end":return t.stop()}}),t)}))),this.size)}},{key:"take",value:function(e){var t,n=this;return t=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,FC(J(ne().mark((function t(){return ne().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.take(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"toArray",value:function(){var e=J(ne().mark((function e(){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArray());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=J(ne().mark((function e(){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArrayForTest());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function FC(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new(function(n){(0,ri.Z)(a,n);var r=(0,ai.Z)(a);function a(){var e;return(0,$.Z)(this,a),(e=r.apply(this,arguments)).size=t,e}return(0,ee.Z)(a,[{key:"iterator",value:function(){var t=J(ne().mark((function t(){return ne().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e());case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}]),a}(_C))}function DC(e){return FC(J(ne().mark((function t(){return ne().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",cC(e));case 1:case"end":return t.stop()}}),t)}))),e.length)}function OC(e){if(!aC(e))throw new Error("The argument to zip() must be an object or array.");var t;if(Array.isArray(e))for(var n=0;n<e.length;n++)t=null==t?e[n].size:Math.min(t,e[n].size);else if(e instanceof Object)for(var r in e)t=null==t?e[r].size:Math.min(t,e[r].size);return FC(J(ne().mark((function t(){var n;return ne().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,nC(e,(function(e){if(e instanceof _C)return{value:e.iterator(),recurse:!1};if(aC(e))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")}));case 2:return n=t.sent,t.abrupt("return",fC(n,hC.SHORTEST));case 4:case"end":return t.stop()}}),t)}))),t)}function MC(e){return null===e?null:function(e){return null==e||null===(t=e)||"object"!==typeof t&&"function"!==typeof t||Array.isArray(e)||"object"===typeof e&&e instanceof hi||Le(e);var t}(e[0])?{value:function(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof hi?zf(e):Yi(e)}(e),recurse:!1}:{value:null,recurse:!0}}_C.MAX_BUFFER_SIZE=1e4;var LC=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this)).input=e,r}return(0,ee.Z)(n,[{key:"iterator",value:function(){var e=J(ne().mark((function e(){var t,n,r;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.input.iterator();case 2:return t=e.sent,n=t.decodeUTF8(),r=n.split("\n").map((function(e){return e.endsWith("\r")&&(e=e.slice(0,-1)),e})),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(_C),zC='"',PC=Symbol("out"),ZC=Symbol("field"),BC=Symbol("quote"),WC=Symbol("quoteafterquote"),UC=Symbol("quoteinquote"),VC=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e,r){var a;return(0,$.Z)(this,n),(a=t.call(this)).input=e,a.hasHeader=!0,a.fullColumnNames=null,a.columnNamesValidated=!1,a.columnConfigs=null,a.configuredColumnsOnly=!1,a.delimiter=",",a.delimWhitespace=!1,a.base=new LC(e),r||(r={}),a.hasHeader=!1!==r.hasHeader,a.fullColumnNames=r.columnNames,a.columnConfigs=r.columnConfigs,a.configuredColumnsOnly=r.configuredColumnsOnly,r.delimWhitespace?(me(null==r.delimiter,(function(){return"Delimiter should not be provided when delimWhitespace is true."})),a.delimWhitespace=!0,a.delimiter=" "):a.delimiter=r.delimiter?r.delimiter:",",a}return(0,ee.Z)(n,[{key:"columnNames",value:function(){var e=J(ne().mark((function e(){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.columnNamesValidated){e.next=3;break}return e.next=3,this.setColumnNames();case 3:return e.abrupt("return",this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setColumnNames",value:function(){var e=J(ne().mark((function e(){var t,n,r,a,i,o,s=this;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.maybeReadHeaderLine();case 2:if(t=e.sent,this.fullColumnNames||t){e.next=7;break}throw new Error("Column names must be provided if there is no header line.");case 7:this.fullColumnNames&&t&&me(t.length===this.fullColumnNames.length,(function(){return"The length of provided columnNames ("+s.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+")."}));case 8:if(this.fullColumnNames||(this.fullColumnNames=t),n=this.fullColumnNames.reduce((function(e,t){return e[t]=e[t]+1||1,e}),{}),me(0===(r=Object.keys(n).filter((function(e){return n[e]>1}))).length,(function(){return"Duplicate column names found: "+r.toString()})),!this.columnConfigs){e.next=22;break}a=0,i=Object.keys(this.columnConfigs);case 14:if(!(a<i.length)){e.next=22;break}if(o=i[a],-1!==this.fullColumnNames.indexOf(o)){e.next=19;break}throw new Error('The key "'+o+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").");case 19:a++,e.next=14;break;case 22:this.columnNamesValidated=!0;case 23:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"maybeReadHeaderLine",value:function(){var e=J(ne().mark((function e(){var t,n,r,a;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasHeader){e.next=14;break}return e.next=3,this.base.iterator();case 3:return t=e.sent,e.next=6,t.next();case 6:if(!(n=e.sent).done){e.next=9;break}throw new Error("No data was found for CSV parsing.");case 9:return r=n.value,a=this.parseRow(r,!1),e.abrupt("return",a);case 14:return e.abrupt("return",null);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"iterator",value:function(){var e=J(ne().mark((function e(){var t,n=this;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.columnNamesValidated){e.next=3;break}return e.next=3,this.setColumnNames();case 3:return e.next=5,this.base.iterator();case 5:return t=e.sent,this.hasHeader&&(t=t.skip(1)),e.abrupt("return",t.map((function(e){return n.makeDataElement(e)})));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"makeDataElement",value:function(e){for(var t=this.parseRow(e),n={},r={},a=0;a<this.fullColumnNames.length;a++){var i=this.fullColumnNames[a],o=this.columnConfigs?this.columnConfigs[i]:null;if(!this.configuredColumnsOnly||o){var s=t[a],u=null;if(""===s)if(o&&void 0!==o.default)u=o.default;else{if(o&&(o.required||o.isLabel))throw new Error("Required column ".concat(i," is empty in this line: ").concat(e));u=void 0}else{var c=Number(s);if(isNaN(c))u=o&&"bool"===o.dtype?this.getBoolean(s):s;else if(o&&o.dtype)switch(o.dtype){case"float32":default:u=c;break;case"int32":u=Math.floor(c);break;case"bool":u=this.getBoolean(s)}else u=c}o&&o.isLabel?r[i]=u:n[i]=u}}return 0===Object.keys(r).length?n:{xs:n,ys:r}}},{key:"getBoolean",value:function(e){return"1"===e||"true"===e.toLowerCase()?1:0}},{key:"parseRow",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[],r=0,a=e.length,i=PC,o=0;o<a;o++)switch(i){case PC:switch(e.charAt(o)){case zC:r=o+1,i=BC;break;case this.delimiter:if(r=o+1," "===this.delimiter&&this.delimWhitespace)break;n.push(""),i=PC;break;default:i=ZC,r=o}break;case ZC:if(e.charAt(o)===this.delimiter)n.push(e.substring(r,o)),i=PC,r=o+1;break;case BC:if(e.charAt(o)===zC)i=WC;break;case WC:switch(e.charAt(o)){case this.delimiter:n.push(e.substring(r,o-1)),i=PC,r=o+1;break;case zC:i=BC;break;default:i=UC}break;case UC:if(e.charAt(o)===zC)i=BC}if(i===WC?n.push(e.substring(r,a-1)):n.push(e.substring(r)),t&&n.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have ".concat(this.fullColumnNames.length," elements in a row, but got ").concat(n));return n}}]),n}(_C),GC=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;(0,$.Z)(this,n),(r=t.call(this)).microphoneConfig=e,r.isClosed=!1,r.fftSize=e.fftSize||1024;var a=Math.log2(r.fftSize);if(r.fftSize<0||a<4||a>14||!Number.isInteger(a))throw new Error("Invalid fftSize: it must be a power of 2 between "+"2 to 4 and 2 to 14, but got ".concat(r.fftSize));if(r.numFrames=e.numFramesPerSpectrogram||43,r.sampleRateHz=e.sampleRateHz,r.columnTruncateLength=e.columnTruncateLength||r.fftSize,r.audioTrackConstraints=e.audioTrackConstraints,r.smoothingTimeConstant=e.smoothingTimeConstant||0,r.includeSpectrogram=!1!==e.includeSpectrogram,r.includeWaveform=!0===e.includeWaveform,!r.includeSpectrogram&&!r.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return r}return(0,ee.Z)(n,[{key:"summary",value:function(){return"microphone"}},{key:"start",value:function(){var e=J(ne().mark((function e(){var t,n;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({audio:null==this.audioTrackConstraints||this.audioTrackConstraints,video:!1});case 3:this.stream=e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),new Error("Error thrown while initializing video stream: ".concat(e.t0.message));case 9:if(this.stream){e.next=11;break}throw new Error("Could not obtain audio from microphone.");case 11:if(t=window.AudioContext||window.webkitAudioContext,this.audioContext=new t,this.sampleRateHz){e.next=17;break}this.sampleRateHz=this.audioContext.sampleRate,e.next=19;break;case 17:if(this.audioContext.sampleRate===this.sampleRateHz){e.next=19;break}throw new Error("Mismatch in sampling rate: "+"Expected: ".concat(this.sampleRateHz,"; ")+"Actual: ".concat(this.audioContext.sampleRate));case 19:return n=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,n.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize),e.abrupt("return");case 27:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"next",value:function(){var e=J(ne().mark((function e(){var t,n,r,a,i;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isClosed){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return e.next=4,this.getAudioData();case 4:return r=e.sent,this.includeSpectrogram&&(a=this.flattenQueue(r.freqDataQueue),t=this.getTensorFromAudioDataArray(a,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(i=this.flattenQueue(r.timeDataQueue),n=this.getTensorFromAudioDataArray(i,[this.numFrames*this.fftSize,1])),e.abrupt("return",{value:{spectrogram:t,waveform:n},done:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"capture",value:function(){var e=J(ne().mark((function e(){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:return e.abrupt("return",e.sent.value);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAudioData",value:function(){var e=J(ne().mark((function e(){var t,n,r,a=this;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],n=[],r=0,e.abrupt("return",new Promise((function(e){var i=setInterval((function(){a.includeSpectrogram&&(a.analyser.getFloatFrequencyData(a.freqData),a.freqData[0]===-1/0&&e({freqDataQueue:t,timeDataQueue:n}),t.push(a.freqData.slice(0,a.columnTruncateLength))),a.includeWaveform&&(a.analyser.getFloatTimeDomainData(a.timeData),n.push(a.timeData.slice())),++r===a.numFrames&&(clearInterval(i),e({freqDataQueue:t,timeDataQueue:n}))}),a.fftSize/a.sampleRateHz*1e3)})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),null!=this.stream&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())}},{key:"toArray",value:function(){throw new Error("Can not convert infinite audio stream to array.")}},{key:"getSampleRate",value:function(){return this.sampleRateHz}},{key:"flattenQueue",value:function(e){var t=e[0].length,n=new Float32Array(e.length*t);return e.forEach((function(e,r){return n.set(e,r*t)})),n}},{key:"getTensorFromAudioDataArray",value:function(e,t){var n=new Float32Array(be(t));return n.set(e,n.length-e.length),Yi(n,t)}}],[{key:"create",value:function(){var e=J(ne().mark((function e(){var t,r,a=arguments;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:{},it().get("IS_BROWSER")){e.next=3;break}throw new Error("microphone API is only supported in browser environment.");case 3:return r=new n(t),e.next=6,r.start();case 6:return e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(dC),HC=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e,r){var a;if((0,$.Z)(this,n),(a=t.call(this)).webcamVideoElement=e,a.webcamConfig=r,a.isClosed=!0,a.resize=!1,a.needToResize())if(a.resize=!0,a.cropSize=[a.webcamConfig.resizeHeight,a.webcamConfig.resizeWidth],a.cropBoxInd=Wf([0],"int32"),a.webcamConfig.centerCrop){var i=1*a.webcamConfig.resizeWidth/a.webcamVideoElement.width,o=1*a.webcamConfig.resizeHeight/a.webcamVideoElement.height,s=(1-i)/2,u=(1-o)/2,c=s+i,l=o+u;a.cropBox=Uf([u,s,l,c],[1,4])}else a.cropBox=Uf([0,0,1,1],[1,4]);return a}return(0,ee.Z)(n,[{key:"summary",value:function(){return"webcam"}},{key:"start",value:function(){var e=J(ne().mark((function e(){var t=this;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.webcamConfig.facingMode&&me("user"===this.webcamConfig.facingMode||"environment"===this.webcamConfig.facingMode,(function(){return"Invalid webcam facing mode: ".concat(t.webcamConfig.facingMode,". ")+"Please provide 'user' or 'environment'"})),e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}});case 4:this.stream=e.sent,e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(1),e.t0.message="Error thrown while initializing video stream: ".concat(e.t0.message),e.t0;case 11:if(this.stream){e.next=13;break}throw new Error("Could not obtain video from webcam.");case 13:try{this.webcamVideoElement.srcObject=this.stream}catch(n){console.log(n),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,e.abrupt("return",new Promise((function(e){t.webcamVideoElement.onloadedmetadata=function(){e()}})));case 17:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"next",value:function(){var e=J(ne().mark((function e(){var t;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isClosed){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:e.prev=2,t=Us(this.webcamVideoElement),e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(2),new Error("Error thrown converting video to pixels: ".concat(JSON.stringify(e.t0)));case 9:if(!this.resize){e.next=22;break}return e.prev=10,e.abrupt("return",{value:this.cropAndResizeFrame(t),done:!1});case 14:throw e.prev=14,e.t1=e.catch(10),new Error("Error thrown cropping the video: ".concat(e.t1.message));case 17:return e.prev=17,t.dispose(),e.finish(17);case 20:e.next=23;break;case 22:return e.abrupt("return",{value:t,done:!1});case 23:case"end":return e.stop()}}),e,this,[[2,6],[10,14,17,20]])})));return function(){return e.apply(this,arguments)}}()},{key:"needToResize",value:function(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)}},{key:"cropAndResizeFrame",value:function(e){var t=this;return Du((function(){var n,r=Wl(as(e,"float32"),0),a=(n=_d.cropAndResize(r,t.cropBox,t.cropBoxInd,t.cropSize,"bilinear")).shape;return Xc(n,a.slice(1))}))}},{key:"capture",value:function(){var e=J(ne().mark((function e(){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:return e.abrupt("return",e.sent.value);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){this.stream.getTracks().forEach((function(e){return e.stop()}));try{this.webcamVideoElement.srcObject=null}catch(e){console.log(e),this.webcamVideoElement.src=null}this.isClosed=!0}},{key:"toArray",value:function(){throw new Error("Can not convert infinite video stream to array.")}}],[{key:"create",value:function(){var e=J(ne().mark((function e(t){var r,a,i=arguments;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>1&&void 0!==i[1]?i[1]:{},it().get("IS_BROWSER")){e.next=3;break}throw new Error("tf.data.webcam is only supported in browser environment.");case 3:if(t){e.next=9;break}if(t=document.createElement("video"),r.resizeWidth&&r.resizeHeight){e.next=7;break}throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");case 7:t.width=r.resizeWidth,t.height=r.resizeHeight;case 9:return a=new n(t,r),e.next=12,a.start();case 12:return e.abrupt("return",a);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),n}(dC),jC=(0,ee.Z)((function e(){(0,$.Z)(this,e)})),qC=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"split",value:function(e){return new KC(this,e)}}]),n}(dC),KC=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e,r){var a;return(0,$.Z)(this,n),(a=t.call(this)).upstream=e,a.impl=new XC(e,r),a}return(0,ee.Z)(n,[{key:"summary",value:function(){return this.impl.summary()}},{key:"next",value:function(){var e=J(ne().mark((function e(){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.impl.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(qC),XC=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e,r){var a;return(0,$.Z)(this,n),(a=t.call(this)).upstream=e,a.separator=r,a.carryover="",a}return(0,ee.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Split('").concat(this.separator,"')")}},{key:"pump",value:function(){var e=J(ne().mark((function e(){var t,n,r,a,i;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=9;break}if(""!==this.carryover){e.next=6;break}return e.abrupt("return",!1);case 6:return this.outputQueue.push(this.carryover),this.carryover="",e.abrupt("return",!0);case 9:(n=t.value.split(this.separator))[0]=this.carryover+n[0],r=q(n.slice(0,-1));try{for(r.s();!(a=r.n()).done;)i=a.value,this.outputQueue.push(i)}catch($V){r.e($V)}finally{r.f()}return this.carryover=n[n.length-1],e.abrupt("return",!0);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(SC),YC=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){return(0,$.Z)(this,n),t.apply(this,arguments)}return(0,ee.Z)(n,[{key:"decodeUTF8",value:function(){return new QC(this)}}]),n}(dC),QC=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r;return(0,$.Z)(this,n),(r=t.call(this)).upstream=e,r.impl=new JC(e),r}return(0,ee.Z)(n,[{key:"summary",value:function(){return this.impl.summary()}},{key:"next",value:function(){var e=J(ne().mark((function e(){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.impl.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(qC),JC=function(e){(0,ri.Z)(r,e);var t=(0,ai.Z)(r);function r(e){var a;if((0,$.Z)(this,r),(a=t.call(this)).upstream=e,it().get("IS_BROWSER"))a.decoder=new TextDecoder("utf-8");else{var i=n(601).StringDecoder;a.decoder=new i("utf8")}return a}return(0,ee.Z)(r,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Utf8")}},{key:"pump",value:function(){var e=J(ne().mark((function e(){var t,n,r;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=7;break}return e.abrupt("return",!1);case 7:n=t.value;case 8:return r=it().get("IS_BROWSER")?this.decoder.decode(n,{stream:!0}):this.decoder.write(Buffer.from(n.buffer)),this.outputQueue.push(r),e.abrupt("return",!0);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),r}(SC),$C=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,$.Z)(this,n),(r=t.call(this)).file=e,r.options=a,me(e instanceof Uint8Array||!!it().get("IS_BROWSER")&&(e instanceof File||e instanceof Blob),(function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."})),r.offset=a.offset||0,r.chunkSize=a.chunkSize||1048576,r}return(0,ee.Z)(n,[{key:"summary",value:function(){return"FileChunks ".concat(this.file)}},{key:"next",value:function(){var e=J(ne().mark((function e(){var t,n=this;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size))){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return t=new Promise((function(e,t){var r=n.offset+n.chunkSize;if(n.file instanceof Uint8Array)e(new Uint8Array(n.file.slice(n.offset,r)));else{var a=new FileReader;a.onload=function(n){var r=a.result;if(r instanceof ArrayBuffer&&(r=new Uint8Array(r)),!(r instanceof Uint8Array))return t(new TypeError("FileReader returned unknown type."));e(r)},a.onabort=function(e){return t(new Error("Aborted"))},a.onerror=function(e){return t(new Error(e.type))};var i=n.file.slice(n.offset,r);a.readAsArrayBuffer(i)}n.offset=r})),e.next=5,t;case 5:return e.t0=e.sent,e.abrupt("return",{value:e.t0,done:!1});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(YC);function eE(e){return tE.apply(this,arguments)}function tE(){return tE=J(ne().mark((function e(t){var n,r,a,i,o,s,u=arguments;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>1&&void 0!==u[1]?u[1]:{},r=u.length>2?u[2]:void 0,"string"===typeof t?a=t:(a=t.url,i=nE(t)),e.next=5,(r||Ya)(a,i);case 5:if(!(o=e.sent).ok){e.next=15;break}return e.t0=Uint8Array,e.next=10,o.arrayBuffer();case 10:return e.t1=e.sent,s=new e.t0(e.t1),e.abrupt("return",new $C(s,n));case 15:throw new Error(o.statusText);case 16:case"end":return e.stop()}}),e)}))),tE.apply(this,arguments)}var nE=function(e){return{method:e.method,headers:e.headers,body:e.body,mode:e.mode,credentials:e.credentials,cache:e.cache,redirect:e.redirect,referrer:e.referrer,integrity:e.integrity}};function rE(e){return"string"===typeof e&&"file://"===e.substr(0,7)}var aE=function(e){(0,ri.Z)(r,e);var t=(0,ai.Z)(r);function r(e){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,$.Z)(this,r),(n=t.call(this)).input=e,n.options=a,n}return(0,ee.Z)(r,[{key:"iterator",value:function(){var e=J(ne().mark((function e(){var t;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return rE(this.input)&&it().get("IS_NODE")&&(t=n(792),this.input=t.readFileSync(this.input.substr(7))),e.abrupt("return",new $C(this.input,this.options));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),r}(jC),iE=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,$.Z)(this,n),(r=t.call(this)).url=e,r.fileOptions=a,r}return(0,ee.Z)(n,[{key:"iterator",value:function(){var e=J(ne().mark((function e(){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!rE(this.url)){e.next=4;break}return e.abrupt("return",new aE(this.url,this.fileOptions).iterator());case 4:return e.abrupt("return",eE(this.url,this.fileOptions));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(jC);function oE(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new VC(new iE(e),t)}function sE(e){var t=lC(e);return FC(J(ne().mark((function e(){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)}))))}function uE(e){return FC(J(ne().mark((function t(){var n;return ne().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:return n=t.sent,t.abrupt("return",lC((function(){return n.next()})));case 4:case"end":return t.stop()}}),t)}))))}function cE(e,t){return lE.apply(this,arguments)}function lE(){return(lE=J(ne().mark((function e(t,n){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",HC.create(t,n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pE(e){return fE.apply(this,arguments)}function fE(){return(fE=J(ne().mark((function e(t){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",GC.create(t));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var hE="3.15.0";function dE(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&me("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors in the CPU backend.")}))}))}var mE=Jf,vE=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(){var e;return(0,$.Z)(this,n),(e=t.call(this)).blockSize=48,e.firstUse=!0,e.data=new re((0,ng.Z)(e),Ru()),e}return(0,ee.Z)(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"write",value:function(e,t,n){this.firstUse&&(this.firstUse=!1,it().get("IS_NODE")&&ga("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&Ze(n[0])){var a=n.map((function(e){return Qa(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}},{key:"refCount",value:function(e){return this.data.has(e)?this.data.get(e).refCount:0}},{key:"incRef",value:function(e){this.data.get(e).refCount++}},{key:"decRef",value:function(e){this.data.has(e)&&this.data.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){this.data.set(e,{values:t,dtype:r,refCount:a})}},{key:"numDataIds",value:function(){return this.data.numDataIds()}},{key:"read",value:function(){var e=J(ne().mark((function e(t){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readSync(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readSync",value:function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensorInfos;return"complex64"===n?rm(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(e).values}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map((function(e){return Ja(e)}))}catch(r){throw new Error("Failed to decode encoded string bytes into utf-8")}return rs(e.shape,e.dtype,n)}},{key:"makeOutput",value:function(e,t,n){var r=this.write(e,t,n);return Ru().makeTensorFromDataId(r,t,n,this)}},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;var n=this.data.get(e),r=n.complexTensorInfos;null!=r&&(this.disposeData(r.real.dataId,!0),this.disposeData(r.imag.dataId,!0)),this.data.delete(e)}return!0}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"time",value:function(){var e=J(ne().mark((function e(t){var n,r;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Xa(),t(),r=Xa()-n,e.abrupt("return",{kernelMs:r});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"memory",value:function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}},{key:"where",value:function(e){dE([e],"where");var t=this.readSync(e.dataId);return mE(e.shape,t)}},{key:"dispose",value:function(){}},{key:"floatPrecision",value:function(){return 32}},{key:"epsilon",value:function(){return qb((0,rg.Z)(n.prototype),"epsilon",this).call(this)}}]),n}(ae);vE.nextDataId=0;function gE(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(dE(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");for(var u=o,c=u.data.get(s.dataId).values,l=be(s.shape),p=n||s.dtype,f=Fe(p,l),h=0;h<l;++h)f[h]=t(c[h],i);return u.makeTensorInfo(s.shape,p,f)}}function yE(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(dE(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");var u=o,c=u.data.get(s.dataId).values,l=n||s.dtype,p=t(c,l,i);return u.makeTensorInfo(s.shape,l,p)}}Vu("cpu",(function(){return new vE}),1);var bE=gE(un,(function(e){return e>=0?e:Math.exp(e)-1})),xE={kernelName:un,backendName:"cpu",kernelFunc:bE};function kE(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var wE={kernelName:Sn,backendName:"cpu",kernelFunc:kE};function NE(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha;dE([a],"leakyRelu");for(var o=be(a.shape),s=n.data.get(a.dataId).values,u=_e("float32",o),c=0;c<s.length;c++)u[c]=s[c]<0?i*s[c]:s[c];return n.makeTensorInfo(a.shape,"float32",u)}var IE={kernelName:_n,backendName:"cpu",kernelFunc:NE};function SE(e){return function(t,n,r,a,i){var o=Os(t,n),s=o.length,u=He(o),c=_e(i,be(o)),l=t.length,p=n.length,f=He(t),h=He(n),d=Fs(t,o),m=Fs(n,o);if(d.length+m.length===0)for(var v=0;v<c.length;++v)c[v]=e(r[v%r.length],a[v%a.length]);else for(var g=function(t){var n=$e(t,s,u),i=n.slice(-l);d.forEach((function(e){return i[e]=0}));var o=Je(i,l,f),v=n.slice(-p);m.forEach((function(e){return v[e]=0}));var g=Je(v,p,h);c[t]=e(r[o],a[g])},y=0;y<c.length;++y)g(y);return[c,o]}}var TE=SE((function(e,t){return e<0?t*e:e}));function CE(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha;dE([r,a],"prelu");var i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=TE(r.shape,a.shape,i,o,"float32"),u=(0,oe.Z)(s,2),c=u[0],l=u[1];return n.makeTensorInfo(l,"float32",c)}var EE={kernelName:dr,backendName:"cpu",kernelFunc:CE},AE=gE(br,(function(e){return Math.max(0,e)})),RE={kernelName:br,backendName:"cpu",kernelFunc:AE},_E=gE(Sr,(function(e){return Math.min(Math.max(0,e),6)})),FE={kernelName:Sr,backendName:"cpu",kernelFunc:_E};function DE(e){return function(t,n,r){for(var a=_e(n,t.length),i=0;i<t.length;++i)a[i]=e(t[i],r);return a}}var OE=DE((function(e){return 1/(1+Math.exp(-e))})),ME=gE(Lr,(function(e){return 1/(1+Math.exp(-e))})),LE={kernelName:Lr,backendName:"cpu",kernelFunc:ME};function zE(e,t,n,r,a){if("linear"===n)return kE({inputs:{x:t},backend:e});if("relu"===n)return AE({inputs:{x:t},backend:e});if("elu"===n)return bE({inputs:{x:t},backend:e});if("relu6"===n)return _E({inputs:{x:t},backend:e});if("prelu"===n)return CE({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return NE({inputs:{x:t},backend:e,attrs:{alpha:a}});if("sigmoid"===n)return ME({inputs:{x:t},backend:e});throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}function PE(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=n.makeTensorInfo(r.shape,"complex64");return n.data.get(s.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",i),imag:n.makeTensorInfo(a.shape,"float32",o)},s}var ZE={kernelName:Lt,backendName:"cpu",kernelFunc:PE};function BE(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32";if("complex64"===n){var r=BE(e,t,"float32"),a=BE(e,t,"float32");return PE({inputs:{real:r,imag:a},backend:e})}var i=Xe(be(t),n);return e.makeTensorInfo(t,n,i)}function WE(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.real,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var UE={kernelName:gr,backendName:"cpu",kernelFunc:WE};function VE(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dtype;if("complex64"===i){if("complex64"===a.dtype)return kE({inputs:{x:a},backend:n});var o=BE(n,a.shape,a.dtype),s=VE({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),u=PE({inputs:{real:s,imag:o},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}if("complex64"===a.dtype){var c=WE({inputs:{input:a},backend:n}),l=VE({inputs:{x:c},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(c),l}if(!Me(a.dtype,i)){var p=kE({inputs:{x:a},backend:n});return{dataId:p.dataId,shape:p.shape,dtype:i}}if("int32"===i){var f=n.data.get(a.dataId).values,h=Int32Array.from(f);return n.makeTensorInfo(a.shape,"int32",h)}if("bool"===i){var d=n.data.get(a.dataId).values,m=Ka([0],a.dtype),v=SE((function(e,t){return e!==t?1:0}))(a.shape,[],d,m,"bool"),g=(0,oe.Z)(v,2),y=g[0],b=g[1];return n.makeTensorInfo(b,"bool",y)}throw new Error("Error in Cast: failed to cast ".concat(a.dtype," to ").concat(i))}var GE={kernelName:Dt,backendName:"cpu",kernelFunc:VE};function HE(e,t,n,r){return null==n?function(n){var a=n.inputs,i=n.backend,o=a.a,s=a.b,u=i;dE([o,s],e);var c=u.data.get(o.dataId).values,l=u.data.get(s.dataId).values,p="string"===o.dtype?Mm(c):c,f="string"===o.dtype?Mm(l):l,h=r||o.dtype,d=t(o.shape,s.shape,p,f,h),m=(0,oe.Z)(d,2),v=m[0],g=m[1];return u.makeTensorInfo(g,h,v)}:function(e){var a=e.inputs,i=e.backend,o=a.a,s=a.b,u=i;if("complex64"===o.dtype||"complex64"===s.dtype){var c=VE({inputs:{x:o},backend:u,attrs:{dtype:"complex64"}}),l=u.data.get(c.dataId),p=l.complexTensorInfos.real,f=l.complexTensorInfos.imag,h=u.data.get(p.dataId).values,d=u.data.get(f.dataId).values,m=VE({inputs:{x:s},backend:u,attrs:{dtype:"complex64"}}),v=u.data.get(m.dataId),g=v.complexTensorInfos.real,y=v.complexTensorInfos.imag,b=u.data.get(g.dataId).values,x=u.data.get(y.dataId).values,k=n(o.shape,s.shape,h,d,b,x),w=(0,oe.Z)(k,3),N=w[0],I=w[1],S=w[2],T=u.makeTensorInfo(S,"float32",N),C=u.makeTensorInfo(S,"float32",I),E=PE({inputs:{real:T,imag:C},backend:u});return u.disposeIntermediateTensorInfo(c),u.disposeIntermediateTensorInfo(m),u.disposeIntermediateTensorInfo(T),u.disposeIntermediateTensorInfo(C),E}var A=u.data.get(o.dataId).values,R=u.data.get(s.dataId).values,_=r||o.dtype,F=t(o.shape,s.shape,A,R,_),D=(0,oe.Z)(F,2),O=D[0],M=D[1];return u.makeTensorInfo(M,_,O)}}function jE(e){return function(t,n,r,a,i,o){var s=Os(t,n),u=be(s),c=s.length,l=He(s),p=_e("float32",u),f=_e("float32",u),h=Fs(t,s),d=Fs(n,s),m=rm(r,a),v=rm(i,o),g=t.length,y=He(t),b=n.length,x=He(n);if(h.length+d.length===0)for(var k=0;k<p.length;k++){var w=k%m.length,N=k%v.length,I=e(m[2*w],m[2*w+1],v[2*N],v[2*N+1]);p[k]=I.real,f[k]=I.imag}else for(var S=function(t){var n=$e(t,c,l),r=n.slice(-g);h.forEach((function(e){return r[e]=0}));var a=Je(r,g,y),i=n.slice(-b);d.forEach((function(e){return i[e]=0}));var o=Je(i,b,x),s=e(m[2*a],m[2*a+1],v[2*o],v[2*o+1]);p[t]=s.real,f[t]=s.imag},T=0;T<p.length;T++)S(T);return[p,f,s]}}var qE=SE((function(e,t){return e+t})),KE=jE((function(e,t,n,r){return{real:e+n,imag:t+r}})),XE=HE(ht,qE,KE),YE={kernelName:ht,backendName:"cpu",kernelFunc:XE};function QE(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=be(a.shape),s=Ee(i,o),u=be(s);me(o===u,(function(){return"The new shape (".concat(s,") has ").concat(u," elements and the old ")+"shape (".concat(a.shape,") has ").concat(o," elements. The new shape and old ")+"shape must have the same number of elements."})),n.incRef(a.dataId);var c=n.data.get(a.dataId);if(null!=c.complexTensorInfos){var l=c.complexTensorInfos.real,p=c.complexTensorInfos.imag;l.shape=s,p.shape=s}return{dataId:a.dataId,shape:s,dtype:a.dtype}}var JE={kernelName:xr,backendName:"cpu",kernelFunc:QE};function $E(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=r.transposeA,s=r.transposeB;dE([a,i],"matMul");var u=a.shape.length,c=i.shape.length,l=o?a.shape[u-2]:a.shape[u-1],p=s?i.shape[c-1]:i.shape[c-2],f=o?a.shape[u-1]:a.shape[u-2],h=s?i.shape[c-2]:i.shape[c-1],d=a.shape.slice(0,-2),m=i.shape.slice(0,-2),v=be(d),g=be(m),y=Os(a.shape.slice(0,-2),i.shape.slice(0,-2)).concat([f,h]);me(l===p,(function(){return"Error in matMul: inner shapes (".concat(l,") and (")+"".concat(p,") of Tensors with shapes ").concat(a.shape," and ")+"".concat(i.shape," and transposeA=").concat(o)+" and transposeB=".concat(s," must match.")}));for(var b=s?[g,h,p]:[g,p,h],x=QE({inputs:{x:a},backend:n,attrs:{shape:o?[v,l,f]:[v,f,l]}}),k=QE({inputs:{x:i},backend:n,attrs:{shape:b}}),w=o?x.shape[1]:x.shape[2],N=o?x.shape[2]:x.shape[1],I=s?k.shape[1]:k.shape[2],S=Math.max(v,g),T=n.data.get(x.dataId).values,C=n.data.get(k.dataId).values,E=He(x.shape),A=He(k.shape),R=o?[E[0],1,E[1]]:[E[0],E[1],1],_=(0,oe.Z)(R,3),F=_[0],D=_[1],O=_[2],M=s?[1,A[1],A[0]]:[A[1],1,A[0]],L=(0,oe.Z)(M,3),z=L[0],P=L[1],Z=L[2],B=N*I,W=rs([S,N,I],x.dtype),U=W.values,V=n.blockSize,G=0;G<S;G++)for(var H=0;H<N;H+=V)for(var j=0;j<I;j+=V)for(var q=0;q<w;q+=V)for(var K=Math.min(H+V,N),X=Math.min(j+V,I),Y=Math.min(q+V,w),Q=H;Q<K;Q++)for(var J=j;J<X;J++){for(var $=0,ee=q;ee<Y;ee++){var te=Math.min(G,v-1)*F,ne=Math.min(G,g-1)*Z;$+=T[te+Q*D+ee*O]*C[ee*z+J*P+ne]}U[G*B+(Q*I+J)]+=$}return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(k),n.makeTensorInfo(y,W.dtype,W.values)}var eA={kernelName:Et,backendName:"cpu",kernelFunc:$E};var tA={kernelName:da,backendName:"cpu",kernelFunc:function(e){var t,n,r,a=e.inputs,i=e.backend,o=e.attrs,s=a.a,u=a.b,c=a.bias,l=a.preluActivationWeights,p=o.transposeA,f=o.transposeB,h=o.activation,d=o.leakyreluAlpha,m=[];t=$E({inputs:{a:s,b:u},attrs:{transposeA:p,transposeB:f},backend:i}),c&&(n=XE({inputs:{a:t,b:c},backend:i}),m.push(t),t=n),h&&(r=zE(i,t,h,l,d),m.push(t),t=r);for(var v=0,g=m;v<g.length;v++){var y=g[v];i.disposeIntermediateTensorInfo(y)}return t}};function nA(e){for(var t=new Float32Array(e.length),n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}var rA={kernelName:lt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs.x,n=e.backend;dE(t,"abs");var r=new Float32Array(be(t.shape));return r=nA(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,t.dtype)}},aA=gE(pt,(function(e){return Math.acos(e)})),iA={kernelName:pt,backendName:"cpu",kernelFunc:aA},oA=gE(ft,(function(e){return Math.acosh(e)})),sA={kernelName:ft,backendName:"cpu",kernelFunc:oA};var uA={kernelName:dt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t;dE(t,"addN");for(var a=r.map((function(e){return n.data.get(e.dataId).values})),i=rs(r[0].shape,r[0].dtype),o=i.values,s=0;s<r.length;s++)for(var u=a[s],c=0;c<o.length;c++)o[c]+=u[c];return n.makeTensorInfo(i.shape,i.dtype,i.values)}};function cA(e,t,n,r,a){for(var i=t.length,o=be(t),s=He(t),u=He(a),c=_e(n,be(a)),l=0;l<o;++l){for(var p=$e(l,i,s),f=new Array(p.length),h=0;h<f.length;h++)f[h]=p[r[h]];c[Je(f,i,u)]=e[l]}return c}function lA(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.perm;dE(a,"transpose");for(var o=a.shape.length,s=new Array(o),u=0;u<s.length;u++)s[u]=a.shape[i[u]];var c=cA(r.data.get(a.dataId).values,a.shape,a.dtype,i,s);return{dataId:r.write(c,s,a.dtype),shape:s,dtype:a.dtype}}var pA={kernelName:oa,backendName:"cpu",kernelFunc:lA};var fA={kernelName:mt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;dE(a,"all");var s=Ae(i,a.shape),u=s,c=gp(u,a.shape.length),l=a;null!=c&&(l=lA({inputs:{x:a},backend:n,attrs:{perm:c}}),u=bp(u.length,a.shape.length)),vp("all",u,l.shape.length);for(var p=dp(l.shape,u),f=(0,oe.Z)(p,2),h=f[0],d=be(f[1]),m=Xe(be(h),l.dtype),v=n.data.get(l.dataId).values,g=0;g<m.length;++g){for(var y=g*d,b=v[y],x=0;x<d;++x){var k=v[y+x];b=b&&k}m[g]=b}null!=c&&n.disposeIntermediateTensorInfo(l);var w=n.makeTensorInfo(h,l.dtype,m);if(o){var N=QE({inputs:{x:w},backend:n,attrs:{shape:mp(h,s)}});return n.disposeIntermediateTensorInfo(w),N}return w}};var hA={kernelName:vt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;dE(a,"any");var s=Ae(i,a.shape),u=s,c=gp(u,a.shape.length),l=a;null!=c&&(l=lA({inputs:{x:a},backend:n,attrs:{perm:c}}),u=bp(u.length,a.shape.length)),vp("any",u,l.shape.length);for(var p=dp(l.shape,u),f=(0,oe.Z)(p,2),h=f[0],d=be(f[1]),m=Xe(be(h),l.dtype),v=n.data.get(l.dataId).values,g=0;g<m.length;++g){for(var y=g*d,b=v[y],x=0;x<d;++x){var k=v[y+x];b=b||k}m[g]=b}null!=c&&n.disposeIntermediateTensorInfo(l);var w=n.makeTensorInfo(h,l.dtype,m);if(o){var N=QE({inputs:{x:w},backend:n,attrs:{shape:mp(h,s)}});return n.disposeIntermediateTensorInfo(w),N}return w}};var dA={kernelName:gt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis;dE(a,"argMax");var o=Ae(i,a.shape),s=gp(o,a.shape.length),u=a,c=[];null!=s&&(u=lA({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=bp(o.length,u.shape.length)),vp("argMax",o=[o[0]],u.shape.length);for(var l=dp(u.shape,o),p=(0,oe.Z)(l,2),f=p[0],h=p[1],d=Xe(be(f),"int32"),m=be(h),v=n.data.get(u.dataId).values,g=0;g<d.length;++g){for(var y=g*m,b=v[y],x=0,k=0;k<m;++k){var w=v[y+k];w>b&&(b=w,x=k)}d[g]=x}return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(f,"int32",d)}};var mA={kernelName:yt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis;dE(a,"argMin");var o=Ae(i,a.shape),s=gp(o,a.shape.length),u=a,c=[];null!=s&&(u=lA({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=bp(o.length,u.shape.length)),vp("argMin",o=[o[0]],u.shape.length);for(var l=dp(u.shape,o),p=(0,oe.Z)(l,2),f=p[0],h=p[1],d=Xe(be(f),"int32"),m=be(h),v=n.data.get(u.dataId).values,g=0;g<d.length;++g){for(var y=g*m,b=v[y],x=0,k=0;k<m;++k){var w=v[y+k];w<b&&(b=w,x=k)}d[g]=x}return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(f,"int32",d)}},vA=gE(bt,(function(e){return Math.asin(e)})),gA={kernelName:bt,backendName:"cpu",kernelFunc:vA},yA=gE(xt,(function(e){return Math.asinh(e)})),bA={kernelName:xt,backendName:"cpu",kernelFunc:yA},xA=gE(kt,(function(e){return Math.atan(e)})),kA={kernelName:kt,backendName:"cpu",kernelFunc:xA},wA=SE((function(e,t){return Math.atan2(e,t)})),NA=HE(Nt,wA),IA={kernelName:Nt,backendName:"cpu",kernelFunc:NA},SA=gE(wt,(function(e){return Math.atanh(e)})),TA={kernelName:wt,backendName:"cpu",kernelFunc:SA};function CA(e,t,n,r,a,i){for(var o=a.strideHeight,s=a.strideWidth,u=a.dilationHeight,c=a.dilationWidth,l=a.effectiveFilterHeight,p=a.effectiveFilterWidth,f=a.padInfo.top,h=a.padInfo.left,d="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=rs(a.outShape,n),v=m.values,g=a.outShape[1]*a.outShape[2]*a.outShape[3],y=a.outShape[2]*a.outShape[3],b=a.outShape[3],x=0;x<a.batchSize;++x)for(var k=x*g,w=x*r[0],N=0;N<a.inChannels;++N)for(var I=0;I<a.outHeight;++I)for(var S=I*o-f,T=Math.max(0,S),C=Math.min(a.inHeight,l+S),E=k+I*y,A=0;A<a.outWidth;++A){for(var R=A*s-h,_=Math.max(0,R),F=Math.min(a.inWidth,p+R),D=d,O=0,M=0,L=T;L<C;L+=u){for(var z=w+L*r[1],P=_;P<F;P+=c){var Z=e[z+P*r[2]+N];"max"===i&&Z>D?D=Z:"avg"===i&&(O+=Z,M++)}if(isNaN(D))break}v[E+A*b+N]="avg"===i?O/M:D}return m}function EA(e,t,n,r){for(var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=rs(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,p=r.effectiveFilterHeight,f=r.effectiveFilterWidth,h=r.padInfo.top,d=r.padInfo.left,m=rs(t,n,e),v=0;v<r.batchSize;++v)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.outHeight;++y){for(var b=y*s-h,x=b;x<0;)x+=c;for(var k=Math.min(r.inHeight,p+b),w=0;w<r.outWidth;++w){for(var N=w*u-d,I=N;I<0;)I+=l;for(var S=Math.min(r.inWidth,f+N),T=Number.NEGATIVE_INFINITY,C=-1,E=x;E<k;E+=c)for(var A=E-b,R=I;R<S;R+=l){var _=R-N,F=m.get(v,E,R,g);F>T&&(T=F,C=a?i?((v*r.inHeight+E)*r.inWidth+R)*r.inChannels+g:(E*r.inWidth+R)*r.inChannels+g:A*f+_)}o.set(C,v,y,w,g)}}return o}function AA(e,t,n,r,a,i){for(var o=a.strideDepth,s=a.strideHeight,u=a.strideWidth,c=a.dilationDepth,l=a.dilationHeight,p=a.dilationWidth,f=a.effectiveFilterDepth,h=a.effectiveFilterHeight,d=a.effectiveFilterWidth,m=a.padInfo.front,v=a.padInfo.top,g=a.padInfo.left,y="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=rs(a.outShape,n),x=b.values,k=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],w=a.outShape[2]*a.outShape[3]*a.outShape[4],N=a.outShape[3]*a.outShape[4],I=a.outShape[4],S=0;S<a.batchSize;++S)for(var T=S*k,C=S*r[0],E=0;E<a.inChannels;++E)for(var A=0;A<a.outDepth;++A){for(var R=A*o-m,_=R;_<0;)_+=c;for(var F=Math.min(a.inDepth,f+R),D=T+A*w,O=0;O<a.outHeight;++O){for(var M=O*s-v,L=M;L<0;)L+=l;for(var z=Math.min(a.inHeight,h+M),P=D+O*N,Z=0;Z<a.outWidth;++Z){for(var B=Z*u-g,W=B;W<0;)W+=p;for(var U=Math.min(a.inWidth,d+B),V=P+Z*I,G=y,H=0,j=0,q=_;q<F;q+=c){for(var K=C+q*r[1],X=L;X<z;X+=l){for(var Y=K+X*r[2],Q=W;Q<U;Q+=p){var J=e[Y+Q*r[3]+E];if("max"===i&&J>G?G=J:"avg"===i&&(H+=J,j++),isNaN(G))break}if(isNaN(G))break}if(isNaN(G))break}x[V+E]="avg"===i?H/j:G}}}return b}var RA={kernelName:It,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;dE(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;me(jc(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var c,l=Oc(a.shape,i,o,1,s,u);if(1===l.filterWidth&&1===l.filterHeight&&ke(l.inShape,l.outShape))c=kE({inputs:{x:a},backend:n});else{var p=n.data.get(a.dataId).values,f=He(a.shape),h=CA(p,a.shape,a.dtype,f,l,"avg");c=n.makeTensorInfo(l.outShape,a.dtype,h.values)}return c}};var _A={kernelName:Tt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;dE(a,"avgPool3d");var l=Mc(a.shape,i,o,1,s,u,c),p=AA(n.data.get(a.dataId).values,a.shape,a.dtype,He(a.shape),l,"avg");return n.makeTensorInfo(p.shape,"float32",p.values)}};var FA={kernelName:Ct,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;dE([a,i],"avgPool3DGrad");for(var l=Mc(i.shape,o,s,1,u,c),p=l.strideDepth,f=l.strideHeight,h=l.strideWidth,d=l.filterDepth,m=l.filterHeight,v=l.filterWidth,g=l.dilationDepth,y=l.dilationHeight,b=l.dilationWidth,x=l.effectiveFilterDepth,k=l.effectiveFilterHeight,w=l.effectiveFilterWidth,N=x-1-l.padInfo.front,I=w-1-l.padInfo.left,S=k-1-l.padInfo.top,T=rs(i.shape,"float32"),C=1/(d*m*v),E=n.bufferSync(a),A=0;A<l.batchSize;++A)for(var R=0;R<l.inChannels;++R)for(var _=0;_<l.inDepth;++_)for(var F=0;F<l.inHeight;++F)for(var D=0;D<l.inWidth;++D){for(var O=_-N,M=F-S,L=D-I,z=0,P=0;P<x;P+=g){var Z=(O+P)/p;if(!(Z<0||Z>=l.outDepth||Math.floor(Z)!==Z))for(var B=0;B<k;B+=y){var W=(M+B)/f;if(!(W<0||W>=l.outHeight||Math.floor(W)!==W))for(var U=0;U<w;U+=b){var V=(L+U)/h;if(!(V<0||V>=l.outWidth||Math.floor(V)!==V))z+=E.get(A,Z,W,V,R)}}}T.set(z*C,A,_,F,D,R)}return n.makeTensorInfo(T.shape,T.dtype,T.values)}};var DA={kernelName:St,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;dE([a,i],"avgPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=Oc(o.shape,s,u,1,c),p=l.strideHeight,f=l.strideWidth,h=l.filterHeight,d=l.filterWidth,m=l.dilationHeight,v=l.dilationWidth,g=l.effectiveFilterHeight,y=l.effectiveFilterWidth,b=y-1-l.padInfo.left,x=g-1-l.padInfo.top,k=rs(o.shape,"float32"),w=1/(h*d),N=n.data.get(a.dataId).values,I=rs(a.shape,"float32",N),S=0;S<l.batchSize;++S)for(var T=0;T<l.inChannels;++T)for(var C=0;C<l.inHeight;++C)for(var E=0;E<l.inWidth;++E){for(var A=C-x,R=E-b,_=0,F=0;F<g;F+=m){var D=(A+F)/p;if(!(D<0||D>=l.outHeight||Math.floor(D)!==D))for(var O=0;O<y;O+=v){var M=(R+O)/f;if(!(M<0||M>=l.outWidth||Math.floor(M)!==M))_+=I.get(S,D,M,T)}}k.set(_*w,S,C,E,T)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}};var OA={kernelName:xn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.scale,o=t.offset,s=t.mean,u=t.variance;me(s.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),me(null==o||s.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),me(null==i||s.shape.length===i.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),dE([a,s,u,i,o],"batchNorm");var c=r.varianceEpsilon;null==c&&(c=.001);for(var l=n.data.get(a.dataId).values,p=n.data.get(s.dataId).values,f=n.data.get(u.dataId).values,h=i?n.data.get(i.dataId).values:new Float32Array([1]),d=o?n.data.get(o.dataId).values:new Float32Array([0]),m=new Float32Array(l.length),v=d.length,g=h.length,y=f.length,b=p.length,x=0,k=0,w=0,N=0,I=0;I<l.length;++I)m[I]=d[x++]+(l[I]-p[k++])*h[w++]/Math.sqrt(f[N++]+c),x>=v&&(x=0),k>=b&&(k=0),w>=g&&(w=0),N>=y&&(N=0);return n.makeTensorInfo(a.shape,a.dtype,m)}};function MA(e,t,n,r,a){var i=iu(r,t,n),o=be(n),s=He(r);if(i){var u=ou(t,s);return"string"===a?e.slice(u,u+o):e.subarray(u,u+o)}for(var c=rs(r,a,"string"===a?Mm(e):e),l=rs(n,a),p=0;p<l.size;++p){var f=l.indexToLoc(p),h=f.map((function(e,n){return e+t[n]}));l.set.apply(l,[c.get.apply(c,Y(h))].concat(Y(f)))}return"string"===a?Lm(l.values):l.values}function LA(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.size;dE(a,"slice");var s=su(a,i,o),u=(0,oe.Z)(s,2),c=u[0],l=u[1];qs(a,c,l);var p=MA(n.data.get(a.dataId).values,c,l,a.shape,a.dtype);return n.makeTensorInfo(l,a.dtype,p)}var zA={kernelName:Fr,backendName:"cpu",kernelFunc:LA};var PA={kernelName:At,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;dE([a],"batchToSpaceND");var s=i.reduce((function(e,t){return e*t})),u=Gd(a.shape,i,s),c=Hd(u.length,i.length),l=jd(a.shape,i,s),p=qd(o,i.length),f=Kd(l,o,i.length),h=QE({inputs:{x:a},backend:n,attrs:{shape:u}}),d=lA({inputs:{x:h},backend:n,attrs:{perm:c}}),m=QE({inputs:{x:d},backend:n,attrs:{shape:l}}),v=LA({inputs:{x:m},backend:n,attrs:{begin:p,size:f}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(m),v}};function ZA(e,t,n,r,a){for(var i=be(r),o=Xe(a,n),s=0;s<e.length;s++){var u=e[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(o[u]+=i>0?t[s]:1)}return o}function BA(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.shape[0],i=e.shape[1],o=rs([a,n],t.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=e.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=n||(r?o.set(1,s,c):t.size>0?o.set(o.get(s,c)+t.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o}var WA={kernelName:Rt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=ZA(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,s)}};var UA={kernelName:Ft,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=Os(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},VA=DE((function(e){return Math.ceil(e)})),GA=yE(Ot,VA),HA={kernelName:Ot,backendName:"cpu",kernelFunc:GA},jA=gE(Mt,(function(e,t){var n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e})),qA={kernelName:Mt,backendName:"cpu",kernelFunc:jA},KA={kernelName:zt,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs.x,n=e.backend,r=new Float32Array(be(t.shape)),a=n.data.get(t.dataId),i=a.complexTensorInfos.real,o=a.complexTensorInfos.imag,s=n.data.get(i.dataId).values,u=n.data.get(o.dataId).values,c=0;c<s.length;c++){var l=s[c],p=u[c];r[c]=Math.hypot(l,p)}return n.makeOutput(r,t.shape,"float32")}};function XA(e,t,n,r){var a=Fe(n,be(t));if(r&&"string"!==n){var i=0;e.forEach((function(e){var t=be(e.shape);a.set(e.vals,i),i+=t}))}else{var o=0;e.forEach((function(e){for(var r="string"===n?Mm(e.vals):e.vals,i=0,s=0;s<e.shape[0];++s)for(var u=s*t[1]+o,c=0;c<e.shape[1];++c)a[u+c]=r[i++];o+=e.shape[1]}))}return a}function YA(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.imag,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var QA={kernelName:Cn,backendName:"cpu",kernelFunc:YA};function JA(e){var t=e.inputs,n=e.backend,r=Ae(e.attrs.axis,t[0].shape)[0],a=Bd(t.map((function(e){return e.shape})),r);if(0===be(a))return n.makeTensorInfo(a,t[0].dtype,[]);var i=t.filter((function(e){return be(e.shape)>0}));if(1===i.length)return kE({inputs:{x:i[0]},backend:n});if(Zd(i.map((function(e){return e.shape})),r),"complex64"===i[0].dtype){var o=i.map((function(e){return WE({inputs:{input:e},backend:n})})),s=i.map((function(e){return YA({inputs:{input:e},backend:n})})),u=JA({inputs:o,backend:n,attrs:{axis:r}}),c=JA({inputs:s,backend:n,attrs:{axis:r}}),l=PE({inputs:{real:u,imag:c},backend:n});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),s.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),l}var p=i.map((function(e){var t=be(e.shape.slice(r));return QE({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})})),f=p.map((function(e){return{vals:n.data.get(e.dataId).values,shape:e.shape}}));a=Bd(p.map((function(e){return e.shape})),1);var h=1===p[0].shape[0],d=XA(f,a,t[0].dtype,h),m=Bd(i.map((function(e){return e.shape})),r),v=n.makeTensorInfo(m,t[0].dtype,d);return p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),v}var $A={kernelName:Pt,backendName:"cpu",kernelFunc:JA};function eR(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dilations,l=r.dimRoundingMode;dE([a,i],"conv2d");for(var p=qc(u),f=Lc(a.shape,i.shape,o,c,s,l,!1,p),h=f.filterHeight,d=f.filterWidth,m=f.dilationHeight,v=f.dilationWidth,g=f.padInfo.left,y=f.padInfo.top,b="channelsLast"===f.dataFormat,x=new li(f.outShape,a.dtype),k=He(a.shape),w=He(i.shape),N=k[0],I=b?k[1]:k[2],S=b?k[2]:1,T=b?1:k[1],C=x.strides[0],E=b?x.strides[1]:x.strides[2],A=b?x.strides[2]:1,R=b?1:x.strides[1],_=n.data.get(a.dataId).values,F=n.data.get(i.dataId).values,D=x.values,O=0;O<f.batchSize;++O)for(var M=O*N,L=O*C,z=0;z<f.outHeight;++z)for(var P=L+z*E,Z=z*f.strideHeight-y,B=0;B<h;++B){var W=Z+B*m;if(!(W<0||W>=f.inHeight))for(var U=B*w[0],V=M+W*I,G=0;G<f.outWidth;++G)for(var H=P+G*A,j=G*f.strideWidth-g,q=0;q<d;++q){var K=j+q*v;if(!(K<0||K>=f.inWidth))for(var X=V+K*S,Y=U+q*w[1],Q=0;Q<f.inChannels;++Q){for(var J=_[X+Q*T],$=0;$<f.outChannels;++$)D[H+$*R]+=J*F[Y+$];Y+=f.outChannels}}}return n.makeTensorInfo(x.shape,x.dtype,D)}var tR={kernelName:Zt,backendName:"cpu",kernelFunc:eR};var nR={kernelName:Bt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape;dE([a,i],"conv2dBackpropFilter");for(var p=qc(u),f=Lc(a.shape,l,o,1,s,c,!1,p),h=f.strideHeight,d=f.strideWidth,m=f.filterHeight,v=f.filterWidth,g="channelsLast"===f.dataFormat,y=new li(f.filterShape,"float32"),b=f.padInfo.left,x=f.padInfo.top,k=n.data.get(a.dataId).values,w=n.data.get(i.dataId).values,N=new li(a.shape,a.dtype,k),I=new li(i.shape,i.dtype,w),S=0;S<m;++S)for(var T=Math.max(0,Math.ceil((x-S)/h)),C=Math.min(f.outHeight,(f.inHeight+x-S)/h),E=0;E<v;++E)for(var A=Math.max(0,Math.ceil((b-E)/d)),R=Math.min(f.outWidth,(f.inWidth+b-E)/d),_=0;_<f.inChannels;++_)for(var F=0;F<f.outChannels;++F){for(var D=0,O=0;O<f.batchSize;++O)for(var M=T;M<C;++M)for(var L=S+M*h-x,z=A;z<R;++z){var P=E+z*d-b;D+=g?N.get(O,L,P,_)*I.get(O,M,z,F):N.get(O,_,L,P)*I.get(O,F,M,z)}y.set(D,S,E,_,F)}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};var rR={kernelName:Wt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode;dE([a,i],"conv2dBackpropInput");var p=He(i.shape),f=He(a.shape),h=qc(c),d=Lc(o,i.shape,s,1,u,l,!1,h),m=new li(d.inShape,"float32"),v=m.values,g=n.data.get(a.dataId).values,y=n.data.get(i.dataId).values,b=(0,oe.Z)(p,3),x=b[0],k=b[1],w=b[2],N=d.batchSize,I=d.filterHeight,S=d.filterWidth,T=d.inChannels,C=d.inHeight,E=d.inWidth,A=d.outChannels,R=d.outHeight,_=d.outWidth,F=d.strideHeight,D=d.strideWidth;h=d.dataFormat;for(var O=I-1-d.padInfo.top,M=S-1-d.padInfo.left,L="channelsLast"===h,z=m.strides[0],P=L?m.strides[1]:m.strides[2],Z=L?m.strides[2]:1,B=L?1:m.strides[1],W=f[0],U=L?f[1]:f[2],V=L?f[2]:1,G=L?1:f[1],H=0;H<N;++H)for(var j=0;j<T;++j)for(var q=0;q<C;++q)for(var K=q-O,X=Math.max(0,Math.ceil(K/F)),Y=Math.min(R,(I+K)/F),Q=0;Q<E;++Q){for(var J=Q-M,$=Math.max(0,Math.ceil(J/D)),ee=Math.min(_,(S+J)/D),te=0,ne=X;ne<Y;++ne)for(var re=ne*F-K,ae=$;ae<ee;++ae)for(var ie=W*H+U*ne+V*ae,se=x*(I-1-re)+k*(S-1-(ae*D-J))+w*j,ue=0;ue<A;++ue){te+=g[ie+G*ue]*y[se+ue]}v[z*H+P*q+Z*Q+B*j]=te}return n.makeTensorInfo(m.shape,m.dtype,m.values)}};var aR={kernelName:Ut,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations;dE([a,i],"conv3d");for(var c=zc(a.shape,i.shape,o,u,s),l=c.filterDepth,p=c.filterHeight,f=c.filterWidth,h=c.dilationDepth,d=c.dilationHeight,m=c.dilationWidth,v=c.padInfo,g=v.front,y=v.left,b=v.top,x=new li(c.outShape,a.dtype),k=n.data.get(a.dataId).values,w=n.data.get(i.dataId).values,N=x.values,I=He(a.shape),S=He(i.shape),T=0;T<c.batchSize;++T)for(var C=T*I[0],E=T*x.strides[0],A=0;A<c.outDepth;++A)for(var R=E+A*x.strides[1],_=A*c.strideDepth-g,F=0;F<l;++F){var D=_+F*h;if(!(D<0||D>=c.inDepth))for(var O=F*S[0],M=C+D*I[1],L=0;L<c.outHeight;++L)for(var z=R+L*x.strides[2],P=L*c.strideHeight-b,Z=0;Z<p;++Z){var B=P+Z*d;if(!(B<0||B>=c.inHeight))for(var W=O+Z*S[1],U=M+B*I[2],V=0;V<c.outWidth;++V)for(var G=z+V*c.outChannels,H=V*c.strideWidth-y,j=0;j<f;++j){var q=H+j*m;if(!(q<0||q>=c.inWidth))for(var K=W+j*S[2],X=U+q*c.inChannels,Y=K,Q=0;Q<c.inChannels;++Q){for(var J=k[X+Q],$=0;$<c.outChannels;++$)N[G+$]+=J*w[Y+$];Y+=c.outChannels}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};var iR={kernelName:Vt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape;dE([a,i],"conv3dBackpropFilterV2");for(var c=He(a.shape),l=He(i.shape),p=zc(a.shape,u,o,1,s),f=p.strideDepth,h=p.strideHeight,d=p.strideWidth,m=p.filterDepth,v=p.filterHeight,g=p.filterWidth,y=new li(p.filterShape,"float32"),b=y.values,x=(0,oe.Z)(y.strides,4),k=x[0],w=x[1],N=x[2],I=x[3],S=n.data.get(i.dataId).values,T=(0,oe.Z)(l,4),C=T[0],E=T[1],A=T[2],R=T[3],_=n.data.get(a.dataId).values,F=(0,oe.Z)(c,4),D=F[0],O=F[1],M=F[2],L=F[3],z=p.padInfo.front,P=p.padInfo.left,Z=p.padInfo.top,B=0;B<m;++B)for(var W=Math.max(0,Math.ceil((z-B)/f)),U=Math.min(p.outDepth,(p.inDepth+z-B)/f),V=B*k,G=0;G<v;++G)for(var H=Math.max(0,Math.ceil((Z-G)/h)),j=Math.min(p.outHeight,(p.inHeight+Z-G)/h),q=G*w+V,K=0;K<g;++K)for(var X=Math.max(0,Math.ceil((P-K)/d)),Y=Math.min(p.outWidth,(p.inWidth+P-K)/d),Q=K*N+q,J=0;J<p.inChannels;++J)for(var $=J*I+Q,ee=0;ee<p.outChannels;++ee){for(var te=0,ne=0;ne<p.batchSize;++ne)for(var re=ne*D,ae=ne*C,ie=W;ie<U;++ie)for(var se=(B+ie*f-z)*O+re,ue=ie*E+ae,ce=H;ce<j;++ce)for(var le=(G+ce*h-Z)*M+se,pe=ce*A+ue,fe=X;fe<Y;++fe){var he=fe*R+pe;te+=_[(K+fe*d-P)*L+le+J]*S[he+ee]}b[$+ee]=te}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};var oR={kernelName:Gt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=r.inputShape;dE([a],"conv3dBackpropInputV2");for(var c=He(a.shape),l=He(i.shape),p=zc(u,i.shape,s,1,o),f=new li(p.inShape,"float32"),h=f.values,d=(0,oe.Z)(f.strides,4),m=d[0],v=d[1],g=d[2],y=d[3],b=n.data.get(a.dataId).values,x=(0,oe.Z)(c,4),k=x[0],w=x[1],N=x[2],I=x[3],S=n.data.get(i.dataId).values,T=(0,oe.Z)(l,4),C=T[0],E=T[1],A=T[2],R=T[3],_=p.batchSize,F=p.filterDepth,D=p.filterHeight,O=p.filterWidth,M=p.inChannels,L=p.inDepth,z=p.inHeight,P=p.inWidth,Z=p.outChannels,B=p.outDepth,W=p.outHeight,U=p.outWidth,V=p.strideDepth,G=p.strideHeight,H=p.strideWidth,j=F-1-p.padInfo.front,q=D-1-p.padInfo.top,K=O-1-p.padInfo.left,X=0;X<_;++X)for(var Y=0;Y<M;++Y)for(var Q=0;Q<L;++Q)for(var J=Q-j,$=Math.max(0,Math.ceil(J/V)),ee=Math.min(B,(F+J)/V),te=0;te<z;++te)for(var ne=te-q,re=Math.max(0,Math.ceil(ne/G)),ae=Math.min(W,(D+ne)/G),ie=0;ie<P;++ie){for(var se=ie-K,ue=Math.max(0,Math.ceil(se/H)),ce=Math.min(U,(O+se)/H),le=0,pe=$;pe<ee;++pe)for(var fe=pe*V-J,he=re;he<ae;++he)for(var de=he*G-ne,me=ue;me<ce;++me)for(var ve=k*X+w*pe+N*he+I*me,ge=C*(F-1-fe)+E*(D-1-de)+A*(O-1-(me*H-se))+R*Y,ye=0;ye<Z;++ye){le+=b[ve+ye]*S[ge+ye]}h[m*X+v*Q+g*te+y*ie+Y]=le}return n.makeTensorInfo(f.shape,f.dtype,f.values)}},sR=gE(Ht,(function(e){return Math.cos(e)})),uR={kernelName:Ht,backendName:"cpu",kernelFunc:sR},cR=gE(jt,(function(e){return Math.cosh(e)})),lR={kernelName:jt,backendName:"cpu",kernelFunc:cR};var pR={kernelName:Xt,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=(0,oe.Z)(a.shape,4),p=l[0],f=l[1],h=l[2],d=l[3],m=i.shape[0],v=(0,oe.Z)(s,2),g=v[0],y=v[1],b=rs([m,g,y,d],"float32"),x=n.data.get(i.dataId).values,k=n.data.get(o.dataId).values,w=n.data.get(a.dataId).values,N=He(a.shape),I=He(b.shape),S=0;S<m;S++){var T=4*S,C=x[T],E=x[T+1],A=x[T+2],R=x[T+3],_=k[S];if(!(_>=p))for(var F=g>1?(A-C)*(f-1)/(g-1):0,D=y>1?(R-E)*(h-1)/(y-1):0,O=0;O<g;O++){var M=g>1?C*(f-1)+O*F:.5*(C+A)*(f-1);if(M<0||M>f-1)for(var L=0;L<y;L++)for(var z=0;z<d;z++){var P=z+L*I[2]+O*I[1]+S*I[0];b.values[P]=c}else if("bilinear"===u)for(var Z=Math.floor(M),B=Math.ceil(M),W=M-Z,U=0;U<y;U++){var V=y>1?E*(h-1)+U*D:.5*(E+R)*(h-1);if(V<0||V>h-1)for(var G=0;G<d;G++){var H=G+U*I[2]+O*I[1]+S*I[0];b.values[H]=c}else for(var j=Math.floor(V),q=Math.ceil(V),K=V-j,X=0;X<d;X++){var Y=X+j*N[2]+Z*N[1]+_*N[0],Q=w[Y],J=w[Y=X+q*N[2]+Z*N[1]+_*N[0]],$=w[Y=X+j*N[2]+B*N[1]+_*N[0]],ee=Q+(J-Q)*K,te=$+(w[Y=X+q*N[2]+B*N[1]+_*N[0]]-$)*K;Y=X+U*I[2]+O*I[1]+S*I[0],b.values[Y]=ee+(te-ee)*W}}else for(var ne=0;ne<y;++ne){var re=y>1?E*(h-1)+ne*D:.5*(E+R)*(h-1);if(re<0||re>h-1)for(var ae=0;ae<d;ae++){var ie=ae+ne*I[2]+O*I[1]+S*I[0];b.values[ie]=c}else for(var se=Math.round(re),ue=Math.round(M),ce=0;ce<d;ce++){var le=ce+se*N[2]+ue*N[1]+_*N[0],pe=ce+ne*I[2]+O*I[1]+S*I[0];b.values[pe]=w[le]}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};var fR={kernelName:qt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;dE(a,"cumprod");var u=gp([i],a.shape.length),c=a;null!=u&&(c=lA({inputs:{x:a},backend:n,attrs:{perm:u}}));var l=bp(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var p=wi(c.dtype,"int32"),f=Ke(be(c.shape),p),h=n.data.get(c.dataId).values,d=c.shape[c.shape.length-1],m=s?function(e,t){return e+d-t-1}:function(e,t){return e+t},v=0;v<h.length;v+=d)for(var g=0;g<d;g++){var y=m(v,g);if(0===g)f[y]=o?1:h[y];else{var b=m(v,g-1);f[y]=o?h[b]*f[b]:h[y]*f[b]}}var x=n.makeTensorInfo(c.shape,p,f);if(null!=u){var k=lA({inputs:{x:x},backend:n,attrs:{perm:yp(u)}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(c),k}return x}};var hR={kernelName:Kt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;dE(a,"cumsum");var u=gp([i],a.shape.length),c=a;null!=u&&(c=lA({inputs:{x:a},backend:n,attrs:{perm:u}}));var l=bp(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var p=wi(c.dtype,"int32"),f=Xe(be(c.shape),p),h=n.data.get(c.dataId).values,d=c.shape[c.shape.length-1],m=s?function(e,t){return e+d-t-1}:function(e,t){return e+t},v=0;v<h.length;v+=d)for(var g=0;g<d;g++){var y=m(v,g);if(0===g)f[y]=o?0:h[y];else{var b=m(v,g-1);f[y]=o?h[b]+f[b]:h[y]+f[b]}}var x=n.makeTensorInfo(c.shape,p,f);if(null!=u){var k=lA({inputs:{x:x},backend:n,attrs:{perm:yp(u)}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(c),k}return x}};var dR={kernelName:Yt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=ZA(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}if(2===a.shape.length){var c=BA(n.bufferSync(a),n.bufferSync(i),o,s);return n.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}};var mR={kernelName:Qt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat;me("NHWC"===o,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(o)}));for(var s=a.shape[0],u=a.shape[1],c=a.shape[2],l=a.shape[3],p=u*i,f=c*i,h=l/(i*i),d=n.data.get(a.dataId).values,m=new Float32Array(s*p*f*h),v=0,g=0;g<s;++g)for(var y=0;y<p;++y)for(var b=Math.floor(y/i),x=y%i,k=0;k<f;++k)for(var w=Math.floor(k/i),N=(x*i+k%i)*h,I=0;I<h;++I){var S=I+N+l*(w+c*(b+u*g));m[v++]=d[S]}return n.makeTensorInfo([s,p,f,h],a.dtype,m)}};function vR(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode;dE([a,i],"depthwiseConv2DNative");var l=He(a.shape),p=He(i.shape),f=u;null==f&&(f=[1,1]),me(jc(o,f),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(f,"'")}));for(var h=Lc(a.shape,i.shape,o,f,s,c,!0),d=h.filterHeight,m=h.filterWidth,v=h.dilationHeight,g=h.dilationWidth,y=h.padInfo,b=y.left,x=y.top,k=h.outChannels/h.inChannels,w=new li(h.outShape,a.dtype),N=n.data.get(a.dataId).values,I=n.data.get(i.dataId).values,S=w.values,T=0;T<h.batchSize;++T)for(var C=T*l[0],E=T*w.strides[0],A=0;A<h.outHeight;++A)for(var R=E+A*w.strides[1],_=A*h.strideHeight-x,F=0;F<d;++F){var D=_+F*v;if(!(D<0||D>=h.inHeight))for(var O=F*p[0],M=C+D*l[1],L=0;L<h.outWidth;++L)for(var z=R+L*w.strides[2],P=L*h.strideWidth-b,Z=0;Z<m;++Z){var B=P+Z*g;if(!(B<0||B>=h.inWidth))for(var W=O+Z*p[1],U=M+B*h.inChannels,V=z,G=W,H=0;H<h.inChannels;++H){for(var j=N[U+H],q=0;q<k;++q)S[V+q]+=j*I[G+q];V+=k,G+=k}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}var gR={kernelName:Jt,backendName:"cpu",kernelFunc:vR};var yR={kernelName:$t,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape;dE([a,i],"depthwiseConv2dNativeBackpropFilter");for(var p=Lc(a.shape,l,o,s,u,c,!0),f=p.strideHeight,h=p.strideWidth,d=p.filterHeight,m=p.filterWidth,v=new li(p.filterShape,"float32"),g=p.padInfo.left,y=p.padInfo.top,b=p.outChannels/p.inChannels,x=n.data.get(a.dataId).values,k=new li(a.shape,a.dtype,x),w=n.data.get(i.dataId).values,N=new li(i.shape,i.dtype,w),I=0;I<d;++I)for(var S=Math.max(0,Math.ceil((y-I)/f)),T=Math.min(p.outHeight,(p.inHeight+y-I)/f),C=0;C<m;++C)for(var E=Math.max(0,Math.ceil((g-C)/h)),A=Math.min(p.outWidth,(p.inWidth+g-C)/h),R=0;R<p.outChannels;++R){for(var _=Math.trunc(R/b),F=R%b,D=0,O=0;O<p.batchSize;++O)for(var M=S;M<T;++M)for(var L=I+M*f-y,z=E;z<A;++z){var P=C+z*h-g;D+=k.get(O,L,P,_)*N.get(O,M,z,R)}v.set(D,I,C,_,F)}return n.makeTensorInfo(v.shape,v.dtype,v.values)}};var bR={kernelName:en,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.inputShape;dE([a,i],"depthwiseConv2DNativeBackpropInput");for(var p=He(a.shape),f=He(i.shape),h=Lc(l,i.shape,o,s,u,c,!0),d=new li(h.inShape,"float32"),m=d.values,v=(0,oe.Z)(d.strides,3),g=v[0],y=v[1],b=v[2],x=n.data.get(a.dataId).values,k=(0,oe.Z)(p,3),w=k[0],N=k[1],I=k[2],S=n.data.get(i.dataId).values,T=(0,oe.Z)(f,3),C=T[0],E=T[1],A=T[2],R=h.batchSize,_=h.filterHeight,F=h.filterWidth,D=h.inChannels,O=h.inHeight,M=h.inWidth,L=h.outChannels,z=h.outHeight,P=h.outWidth,Z=h.strideHeight,B=h.strideWidth,W=_-1-h.padInfo.top,U=F-1-h.padInfo.left,V=L/D,G=0;G<R;++G)for(var H=0;H<D;++H)for(var j=0;j<O;++j)for(var q=j-W,K=Math.max(0,Math.ceil(q/Z)),X=Math.min(z,(_+q)/Z),Y=0;Y<M;++Y){for(var Q=Y-U,J=Math.max(0,Math.ceil(Q/B)),$=Math.min(P,(F+Q)/B),ee=0,te=K;te<X;++te)for(var ne=te*Z-q,re=J;re<$;++re)for(var ae=w*G+N*te+I*re,ie=C*(_-1-ne)+E*(F-1-(re*B-Q))+A*H,se=0;se<V;++se){ee+=x[ae+(H*V+se)]*S[ie+se]}m[g*G+y*j+b*Y+H]=ee}return n.makeTensorInfo(d.shape,d.dtype,d.values)}};var xR={kernelName:tn,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=t.x,a=be(r.shape),i=n.data.get(r.dataId).values,o=rs([a,a],r.dtype),s=o.values,u=0;u<i.length;u++)s[u*a+u]=i[u];var c=[].concat(Y(r.shape),Y(r.shape));return n.makeTensorInfo(c,o.dtype,o.values)}},kR={kernelName:nn,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=n,l=c.data.get(a.dataId).values,p=a.shape.length,f=c.data.get(i.dataId).values,h=i.shape.length,d=Dc(a.shape,i.shape,o,s,"NHWC",u),m=d.batchSize,v=d.inHeight,g=d.inWidth,y=d.inChannels,b=d.outHeight,x=d.outWidth,k=d.padInfo,w=d.strideHeight,N=d.strideWidth,I=d.filterHeight,S=d.filterWidth,T=d.dilationHeight,C=d.dilationWidth,E=d.outShape,A=be(E),R=E.length,_=Fe(a.dtype,A),F=0;F<m;++F)for(var D=0;D<b;++D)for(var O=D*w-k.top,M=0;M<x;++M)for(var L=M*N-k.left,z=0;z<y;++z){for(var P=Number.MIN_SAFE_INTEGER,Z=0;Z<I;++Z){var B=O+Z*T;if(B>=0&&B<v)for(var W=0;W<S;++W){var U=L+W*C;if(U>=0&&U<g){var V=Je([F,B,U,z],p,He(a.shape)),G=Je([Z,W,z],h,He(i.shape)),H=l[V]+f[G];H>P&&(P=H)}}}_[Je([F,D,M,z],R,He(E))]=P}return{dataId:c.write(Ka(_,a.dtype),E,a.dtype),shape:E,dtype:a.dtype}}},wR={kernelName:an,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations,l=n,p=qe(a.shape,l.data.get(a.dataId).values),f=qe(i.shape,l.data.get(i.dataId).values),h=Dc(a.shape,i.shape,s,u,"NHWC",c),d=h.batchSize,m=h.inHeight,v=h.inWidth,g=h.inChannels,y=h.outHeight,b=h.outWidth,x=h.padInfo,k=h.strideHeight,w=h.strideWidth,N=h.filterHeight,I=h.filterWidth,S=h.dilationHeight,T=h.dilationWidth,C=h.outShape;me(o.rank===C.length,(function(){return"Error in ".concat(an,", dy ")+"must have the same rank as output ".concat(C.length,", but got ")+"".concat(o.rank)}));for(var E=qe(C,l.data.get(o.dataId).values),A=Ye(i.shape,i.dtype),R=0;R<d;++R)for(var _=0;_<y;++_)for(var F=_*k-x.top,D=0;D<b;++D)for(var O=D*w-x.left,M=0;M<g;++M){for(var L=Number.MIN_SAFE_INTEGER,z=0,P=0,Z=0;Z<N;++Z){var B=F+Z*S;if(B>=0&&B<m)for(var W=0;W<I;++W){var U=O+W*T;if(U>=0&&U<v){var V=p[R][B][U][M]+f[Z][W][M];V>L&&(L=V,z=Z,P=W)}}}A[z][P][M]+=E[R][_][D][M]}return{dataId:l.write(Ka(A,a.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},NR={kernelName:rn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations,l=n,p=qe(a.shape,l.data.get(a.dataId).values),f=qe(i.shape,l.data.get(i.dataId).values),h=Dc(a.shape,i.shape,s,u,"NHWC",c),d=h.batchSize,m=h.inHeight,v=h.inWidth,g=h.inChannels,y=h.outHeight,b=h.outWidth,x=h.padInfo,k=h.strideHeight,w=h.strideWidth,N=h.filterHeight,I=h.filterWidth,S=h.dilationHeight,T=h.dilationWidth,C=h.outShape;me(o.rank===C.length,(function(){return"Error in ".concat(rn,", dy ")+"must have the same rank as output ".concat(C.length,", but got ")+"".concat(o.rank)}));for(var E=qe(C,l.data.get(o.dataId).values),A=Ye(a.shape,a.dtype),R=0;R<d;++R)for(var _=0;_<y;++_)for(var F=_*k-x.top,D=0;D<b;++D)for(var O=D*w-x.left,M=0;M<g;++M){for(var L=Number.MIN_SAFE_INTEGER,z=F<0?0:F,P=O<0?0:O,Z=0;Z<N;++Z){var B=F+Z*S;if(B>=0&&B<m)for(var W=0;W<I;++W){var U=O+W*T;if(U>=0&&U<v){var V=p[R][B][U][M]+f[Z][W][M];V>L&&(L=V,z=B,P=U)}}}A[R][z][P][M]+=E[R][_][D][M]}return{dataId:l.write(Ka(A,a.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},IR=SE((function(e,t){return e*t})),SR=jE((function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})),TR=HE(nr,IR,SR),CR={kernelName:nr,backendName:"cpu",kernelFunc:TR};function ER(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.axis,s=a.keepDims;dE(i,"sum");var u=(t="bool"===i.dtype?VE({inputs:{x:i},backend:r,attrs:{dtype:"int32"}}):kE({inputs:{x:i},backend:r})).shape.length,c=Ae(o,t.shape),l=gp(c,u),p=c,f=t;null!=l&&(f=lA({inputs:{x:t},backend:r,attrs:{perm:l}}),p=bp(p.length,u)),vp("sum",p,f.shape.length);for(var h=dp(f.shape,p),d=(0,oe.Z)(h,2),m=d[0],v=d[1],g=BE(r,m,wi(f.dtype,"int32")),y=be(v),b=r.data.get(g.dataId).values,x=r.data.get(f.dataId).values,k=0;k<b.length;++k){for(var w=k*y,N=0,I=0;I<y;++I)N+=x[w+I];b[k]=N}if(s){var S=g;g=QE({inputs:{x:g},backend:r,attrs:{shape:mp(g.shape,c)}}),r.disposeIntermediateTensorInfo(S)}return r.disposeIntermediateTensorInfo(t),null!=l&&r.disposeIntermediateTensorInfo(f),g}var AR={kernelName:Zr,backendName:"cpu",kernelFunc:ER};var RR={kernelName:sn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,a=hm(e.attrs.equation,r.length),i=a.allDims,o=a.summedDims,s=a.idDims;mm(i.length,s,r);for(var u=vm(o,s),c=u.path,l=u.steps,p=l.length,f=null,h=i.length,d=[],m=0;m<p;++m){var v,g=q(l[m]);try{for(g.s();!(v=g.n()).done;){var y=v.value,b=dm(h,s[y]),x=b.permutationIndices,k=b.expandDims,w=void 0;gm(x)?w=r[y]:(w=lA({inputs:{x:r[y]},backend:n,attrs:{perm:x}}),d.push(w));for(var N=w.shape.slice(),I=0;I<k.length;++I)N.splice(k[I],0,1);ke(w.shape,N)||(w=QE({inputs:{x:w},backend:n,attrs:{shape:N}}),d.push(w)),null===f?f=w:(f=TR({inputs:{a:w,b:f},backend:n}),d.push(f))}}catch($V){g.e($V)}finally{g.f()}m<p-1&&(c[m]>=0&&(f=ER({inputs:{x:f},backend:n,attrs:{axis:c[m]-(i.length-h),keepDims:!1}}),d.push(f)),h--)}for(var S=0,T=d;S<T.length;S++){var C=T[S];C!==f&&n.disposeIntermediateTensorInfo(C)}return f}};var _R={kernelName:cn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y;dE([r,a],"eluGrad");for(var i=new Float32Array(be(a.shape)),o=n.data.get(a.dataId).values,s=n.data.get(r.dataId).values,u=0;u<o.length;++u){var c=o[u];i[u]=c>=1?s[u]:s[u]*(c+1)}return n.makeTensorInfo(a.shape,"float32",i)}},FR=SE((function(e,t){return e===t?1:0})),DR=HE(pn,FR,null,"bool"),OR={kernelName:pn,backendName:"cpu",kernelFunc:DR},MR=Qd,LR=Jd,zR=$d,PR=em,ZR=tm,BR=nm,WR=gE(ln,(function(e){var t=Math.sign(e),n=Math.abs(e),r=1/(1+MR*n);return t*(1-((((BR*r+ZR)*r+PR)*r+zR)*r+LR)*r*Math.exp(-n*n))})),UR={kernelName:ln,backendName:"cpu",kernelFunc:WR},VR=DE((function(e){return Math.exp(e)})),GR=yE(fn,VR,"float32"),HR={kernelName:fn,backendName:"cpu",kernelFunc:GR};function jR(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.input,i=r.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(me(-(o+1)<=i,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+i+1),s.splice(u,0,1),QE({inputs:{x:a},backend:n,attrs:{shape:s}})}var qR={kernelName:hn,backendName:"cpu",kernelFunc:jR},KR=DE((function(e){return Math.expm1(e)})),XR=yE(dn,KR),YR={kernelName:dn,backendName:"cpu",kernelFunc:XR},QR=SE((function(e,t){return e/t})),JR=HE(on,QR),$R={kernelName:on,backendName:"cpu",kernelFunc:JR},e_=SE((function(e,t){return e-t})),t_=jE((function(e,t,n,r){return{real:e-n,imag:t-r}})),n_=HE(ea,e_,t_),r_={kernelName:ea,backendName:"cpu",kernelFunc:n_};function a_(e,t,n){for(var r=e.shape,a=r[0],i=r[1],o=n.data.get(e.dataId),s=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,c=[a,i],l=be(c),p=_e("float32",l),f=_e("float32",l),h=0;h<a;h++){for(var d=LA({inputs:{x:s},backend:n,attrs:{begin:[h,0],size:[1,i]}}),m=LA({inputs:{x:u},backend:n,attrs:{begin:[h,0],size:[1,i]}}),v=PE({inputs:{real:d,imag:m},backend:n}),g=i_(v,t,n),y=rm(g.real,g.imag),b=0;b<i;b++){var x=sm(y,b);p[h*i+b]=x.real,f[h*i+b]=x.imag}n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v)}var k=n.makeTensorInfo(c,"float32",p),w=n.makeTensorInfo(c,"float32",f),N=PE({inputs:{real:k,imag:w},backend:n});return n.disposeIntermediateTensorInfo(k),n.disposeIntermediateTensorInfo(w),N}function i_(e,t,n){var r=be(e.shape),a=n.data.get(e.dataId),i=n.data.get(a.complexTensorInfos.real.dataId).values,o=n.data.get(a.complexTensorInfos.imag.dataId).values;if(0===((g=r)&g-1)){var s=o_(i,o,r,t,n),u=[e.shape[0],e.shape[1]];if(t){var c=n.makeTensorInfo(u,"float32",s.real),l=n.makeTensorInfo(u,"float32",s.imag),p=n.makeTensorInfo([],"float32",qa(r,"float32")),f=kE({inputs:{x:p},backend:n}),h=$R.kernelFunc({inputs:{a:c,b:p},backend:n}),d=$R.kernelFunc({inputs:{a:l,b:f},backend:n}),m=n.data.get(h.dataId).values,v=n.data.get(d.dataId).values;return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),{real:m,imag:v}}return s}var g,y=function(e,t,n){for(var r=new Float32Array(2*t),a=0;a<t;a++){for(var i=0,o=0,s=0;s<t;s++){var u=lm(a*s,t,n),c=sm(e,s);i+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}n&&(i/=t,o/=t),um(r,i,o,a)}return r}(rm(i,o),r,t);return am(y)}function o_(e,t,n,r,a){if(1===n)return{real:e,imag:t};var i=rm(e,t),o=n/2,s=im(i),u=s.real,c=s.imag,l=[u.length],p=a.makeTensorInfo(l,"float32",u),f=a.makeTensorInfo(l,"float32",c),h=PE({inputs:{real:p,imag:f},backend:a}),d=om(i),m=d.real,v=d.imag,g=[m.length],y=a.makeTensorInfo(g,"float32",m),b=a.makeTensorInfo(g,"float32",v),x=PE({inputs:{real:y,imag:b},backend:a}),k=o_(u,c,o,r,a),w=k.real,N=k.imag,I=[w.length],S=a.makeTensorInfo(I,"float32",w),T=a.makeTensorInfo(I,"float32",N),C=PE({inputs:{real:S,imag:T},backend:a}),E=o_(m,v,o,r,a),A=E.real,R=E.imag,_=[A.length],F=a.makeTensorInfo(_,"float32",A),D=a.makeTensorInfo(_,"float32",R),O=PE({inputs:{real:F,imag:D},backend:a}),M=cm(n,r),L=[M.real.length],z=a.makeTensorInfo(L,"float32",M.real),P=a.makeTensorInfo(L,"float32",M.imag),Z=PE({inputs:{real:z,imag:P},backend:a}),B=TR({inputs:{a:Z,b:O},backend:a}),W=XE({inputs:{a:C,b:B},backend:a}),U=n_({inputs:{a:C,b:B},backend:a}),V=WE({inputs:{input:W},backend:a}),G=WE({inputs:{input:U},backend:a}),H=YA({inputs:{input:W},backend:a}),j=YA({inputs:{input:U},backend:a}),q=JA({inputs:[V,G],backend:a,attrs:{axis:0}}),K=JA({inputs:[H,j],backend:a,attrs:{axis:0}}),X=a.data.get(q.dataId).values,Y=a.data.get(K.dataId).values;return a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(f),a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(y),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(x),a.disposeIntermediateTensorInfo(S),a.disposeIntermediateTensorInfo(T),a.disposeIntermediateTensorInfo(C),a.disposeIntermediateTensorInfo(F),a.disposeIntermediateTensorInfo(D),a.disposeIntermediateTensorInfo(O),a.disposeIntermediateTensorInfo(z),a.disposeIntermediateTensorInfo(P),a.disposeIntermediateTensorInfo(Z),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(U),a.disposeIntermediateTensorInfo(V),a.disposeIntermediateTensorInfo(H),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(q),a.disposeIntermediateTensorInfo(K),{real:X,imag:Y}}var s_={kernelName:mn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=be(r.shape),i=r.shape[r.shape.length-1],o=QE({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=a_(o,!1,n),u=QE({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}};function u_(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype||Ue(a),o=Fe(i,be(r));return function(e,t,n){e.fill(t)}(o,a),t.makeTensorInfo(r,i,o)}var c_={kernelName:vn,backendName:"cpu",kernelFunc:u_};var l_={kernelName:gn,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=(e.attrs,e.backend),r=t.image,a=n,i=_e(r.dtype,be(r.shape)),o=(0,oe.Z)(r.shape,4),s=o[0],u=o[1],c=o[2],l=o[3],p=a.data.get(r.dataId).values,f=0;f<s;f++)for(var h=f*c*u*l,d=0;d<u;d++)for(var m=d*(c*l),v=0;v<c;v++)for(var g=v*l,y=0;y<l;y++){var b=Math.round(c-v-1),x=h+m+g+y,k=p[x];if(b>=0&&b<c)k=p[h+m+b*l+y];i[x]=k}return{dataId:a.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},p_=DE((function(e){return Math.floor(e)})),f_=yE(yn,p_),h_={kernelName:yn,backendName:"cpu",kernelFunc:f_},d_=SE((function(e,t){return Math.floor(e/t)})),m_=HE(bn,d_,null,"int32"),v_={kernelName:bn,backendName:"cpu",kernelFunc:m_};var g_={kernelName:ma,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,p=r.dilations,f=r.dimRoundingMode,h=r.activation,d=r.leakyreluAlpha,m=eR({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:p,dimRoundingMode:f}});if(o){var v=m;m=XE({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(v)}if(h){var g=m;m=zE(n,m,h,s,d),n.disposeIntermediateTensorInfo(g)}return m}};var y_={kernelName:va,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,p=r.dilations,f=r.dimRoundingMode,h=r.activation,d=r.leakyreluAlpha,m=vR({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:p,dimRoundingMode:f}});if(o){var v=m;m=XE({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(v)}if(h){var g=m;m=zE(n,m,h,s,d),n.disposeIntermediateTensorInfo(g)}return m}};function b_(e,t,n,r,a,i,o,s,u){for(var c=rs([r,i],n),l=0;l<r;l++){for(var p=[],f=0,h=0;h<a;h++){var d=e[l*a+h];f+=d*o[h],p.push(d)}if(f<0||f>=u/i)throw new Error("Invalid indices: ".concat(p," does not index into ").concat(s));for(var m=0;m<i;m++)c.values[l*i+m]=t.get.apply(t,Y(t.indexToLoc(f*i+m)))}return c}var x_={kernelName:wn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,i=be(r.shape),o=a.shape,s=o[o.length-1],u=Vs(r,a),c=(0,oe.Z)(u,4),l=c[0],p=c[1],f=c[2],h=c[3];if(0===p)return n.makeTensorInfo(l,r.dtype,[]);var d=b_(n.data.get(a.dataId).values,n.bufferSync(r),r.dtype,p,s,f,h,r.shape,i);return n.makeTensorInfo(l,r.dtype,d.values)}};function k_(e,t,n){for(var r=rs(n,e.dtype),a=0;a<r.size;++a){var i=r.indexToLoc(a).slice(),o=i[0],s=i[2],u=t.locToIndex([o,s]);i[2]=t.values[u];var c=e.locToIndex(i);0<=c&&c<e.values.length&&(r.values[a]=e.values[c])}return r}var w_={kernelName:kn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims;dE([a,i],"gatherV2");for(var u=Ae(o,a.shape)[0],c=n.data.get(i.dataId).values,l=a.shape[u],p=function(e){var t=c[e];me(t<=l-1&&t>=0,(function(){return"GatherV2: the index value ".concat(t," is not in [0, ").concat(l-1,"]")}))},f=0;f<c.length;++f)p(f);var h=s;null==s&&(h=0);var d=be(i.shape),m=Om(a,i,u,h),v=QE({inputs:{x:a},backend:n,attrs:{shape:[m.batchSize,m.outerSize,m.dimSize,m.sliceSize]}}),g=QE({inputs:{x:i},backend:n,attrs:{shape:[m.batchSize,d/m.batchSize]}}),y=[m.batchSize,m.outerSize,d/m.batchSize,m.sliceSize],b=n.bufferSync(g),x=k_(n.bufferSync(v),b,y);return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),n.makeTensorInfo(m.outputShape,x.dtype,x.values)}},N_=SE((function(e,t){return e>t?1:0})),I_=HE(Nn,N_,null,"bool"),S_={kernelName:Nn,backendName:"cpu",kernelFunc:I_},T_=SE((function(e,t){return e>=t?1:0})),C_=HE(In,T_,null,"bool"),E_={kernelName:In,backendName:"cpu",kernelFunc:C_};var A_={kernelName:Tn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=be(r.shape),i=r.shape[r.shape.length-1],o=QE({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=a_(o,!0,n),u=QE({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}},R_=gE(En,(function(e){return Number.isFinite(e)?1:0}),"bool"),__={kernelName:En,backendName:"cpu",kernelFunc:R_},F_=gE(An,(function(e){return Math.abs(e)===1/0?1:0}),"bool"),D_={kernelName:An,backendName:"cpu",kernelFunc:F_},O_=gE(Rn,(function(e){return Number.isNaN(e)?1:0}),"bool"),M_={kernelName:Rn,backendName:"cpu",kernelFunc:O_},L_=SE((function(e,t){return e<t?1:0})),z_=HE(Fn,L_,null,"bool"),P_={kernelName:Fn,backendName:"cpu",kernelFunc:z_},Z_=SE((function(e,t){return e<=t?1:0})),B_=HE(Dn,Z_,null,"bool"),W_={kernelName:Dn,backendName:"cpu",kernelFunc:B_};function U_(e,t,n){var r=(t-e)/(n-1),a=Xe(n,"float32");a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return a}var V_={kernelName:On,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=U_(n.start,n.stop,n.num);return t.makeTensorInfo([r.length],"float32",r)}},G_=DE((function(e){return Math.log(e)})),H_=yE(Mn,G_),j_={kernelName:Mn,backendName:"cpu",kernelFunc:H_},q_=gE(Ln,(function(e){return Math.log1p(e)})),K_={kernelName:Ln,backendName:"cpu",kernelFunc:q_},X_=SE((function(e,t){return e&&t})),Y_=HE(zn,X_,null,"bool"),Q_={kernelName:zn,backendName:"cpu",kernelFunc:Y_},J_=gE(Pn,(function(e){return e?0:1}),"bool"),$_={kernelName:Pn,backendName:"cpu",kernelFunc:J_},eF=SE((function(e,t){return e||t})),tF=HE(Zn,eF,null,"bool"),nF={kernelName:Zn,backendName:"cpu",kernelFunc:tF};var rF={kernelName:Wn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta;dE(a,"LRN");var c=a.shape[3],l=c-1,p=n.data.get(a.dataId).values,f=be(a.shape),h=new Float32Array(f);function d(e){for(var t=e%c,n=e-t+Math.max(0,t-i),r=e-t+Math.min(t+i,l),a=0;n<=r;n++){var o=p[n];a+=o*o}return a}for(var m=0;m<f;m++){var v=d(m),g=p[m]*Math.pow(o+s*v,-u);h[m]=g}return n.makeTensorInfo(a.shape,a.dtype,h)}};var aF={kernelName:Un,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta;dE(o,"LRNGrad");for(var p=be(o.shape),f=o.shape[3],h=n.data.get(o.dataId).values,d=n.data.get(a.dataId).values,m=n.data.get(i.dataId).values,v=new Float32Array(p),g=p,y=0;y<g;y++){for(var b=y%f,x=y-b+Math.max(0,b-s),k=y-b+Math.min(f,b+s+1),w=0,N=x;N<k;N++)w+=Math.pow(d[N],2);w=c*w+u;for(var I=x;I<k;I++){var S=-2*c*l*d[I]*m[y]/w;y===I&&(S+=Math.pow(w,-l)),S*=h[y],v[I]+=S}}return n.makeTensorInfo(o.shape,a.dtype,v)}};function iF(e,t,n,r){for(var a=_e(r,be(n)),i=0;i<a.length;++i){for(var o=i*t,s=e[o],u=0;u<t;++u){var c=e[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a}function oF(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reductionIndices,o=r.keepDims,s=n,u=a.shape,c=u.length,l=Ae(i,u),p=l,f=gp(p,c),h=s.data.get(a.dataId).values;if(null!=f){for(var d=new Array(c),m=0;m<d.length;m++)d[m]=u[f[m]];h=cA(h,u,a.dtype,f,d),p=bp(p.length,c),u=d}dE(a,"max"),vp("max",p,c);var v=dp(u,p),g=(0,oe.Z)(v,2),y=g[0],b=iF(h,be(g[1]),y,a.dtype),x=s.write(b,y,a.dtype),k=y;o&&(k=mp(y,l));return{dataId:x,shape:k,dtype:a.dtype}}var sF={kernelName:Vn,backendName:"cpu",kernelFunc:oF},uF=SE((function(e,t){return Math.max(e,t)})),cF=HE(Gn,uF),lF={kernelName:Gn,backendName:"cpu",kernelFunc:cF};var pF={kernelName:Hn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;dE(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;me(jc(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var c,l=Oc(a.shape,i,o,1,s,u);if(1===l.filterWidth&&1===l.filterHeight&&ke(l.inShape,l.outShape))c=kE({inputs:{x:a},backend:n});else{var p=n.data.get(a.dataId).values,f=He(a.shape),h=CA(p,a.shape,a.dtype,f,l,"max");c=n.makeTensorInfo(l.outShape,a.dtype,h.values)}return c}};var fF={kernelName:qn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;dE(a,"maxPool3d");var l=Mc(a.shape,i,o,1,s,u,c),p=AA(n.data.get(a.dataId).values,a.shape,a.dtype,He(a.shape),l,"max");return n.makeTensorInfo(p.shape,"float32",p.values)}};var hF={kernelName:Kn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;dE([a,i],"maxPool3DGrad");for(var l=Mc(i.shape,o,s,1,u,c),p=function(e,t){for(var n=rs(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,p=t.effectiveFilterWidth,f=t.padInfo.front,h=t.padInfo.top,d=t.padInfo.left,m=0;m<t.batchSize;++m)for(var v=0;v<t.inChannels;++v)for(var g=0;g<t.outDepth;++g){for(var y=g*r-f,b=y;b<0;)b+=o;for(var x=Math.min(t.inDepth,c+y),k=0;k<t.outHeight;++k){for(var w=k*a-h,N=w;N<0;)N+=s;for(var I=Math.min(t.inHeight,l+w),S=0;S<t.outWidth;++S){for(var T=S*i-d,C=T;C<0;)C+=u;for(var E=Math.min(t.inWidth,p+T),A=Number.NEGATIVE_INFINITY,R=-1,_=b;_<x;_+=o)for(var F=_-y,D=N;D<I;D+=s)for(var O=D-w,M=C;M<E;M+=u){var L=M-T,z=e.get(m,_,D,M,v);z>=A&&(A=z,R=F*l*p+O*l+L)}n.set(R,m,g,k,S,v)}}}return n}(n.bufferSync(i),l),f=l.strideDepth,h=l.strideHeight,d=l.strideWidth,m=l.dilationDepth,v=l.dilationHeight,g=l.dilationWidth,y=l.effectiveFilterDepth,b=l.effectiveFilterHeight,x=l.effectiveFilterWidth,k=y-1-l.padInfo.front,w=x-1-l.padInfo.left,N=b-1-l.padInfo.top,I=rs(i.shape,"float32"),S=n.bufferSync(a),T=0;T<l.batchSize;++T)for(var C=0;C<l.inChannels;++C)for(var E=0;E<l.inDepth;++E)for(var A=0;A<l.inHeight;++A)for(var R=0;R<l.inWidth;++R){for(var _=E-k,F=A-N,D=R-w,O=0,M=0;M<y;M+=m){var L=(_+M)/f;if(!(L<0||L>=l.outDepth||Math.floor(L)!==L))for(var z=0;z<b;z+=v){var P=(F+z)/h;if(!(P<0||P>=l.outHeight||Math.floor(P)!==P))for(var Z=0;Z<x;Z+=g){var B=(D+Z)/d;if(!(B<0||B>=l.outWidth||Math.floor(B)!==B)){var W=y*b*x-1-p.get(T,L,P,B,C)===M*b*x+z*x+Z?1:0;if(0!==W)O+=S.get(T,L,P,B,C)*W}}}}I.set(O,T,E,A,R,C)}return n.makeTensorInfo(I.shape,I.dtype,I.values)}};var dF={kernelName:jn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;dE([i,t.output],"maxPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,p=Oc(o.shape,s,u,1,c,l),f=n.data.get(o.dataId).values,h=rs(p.outShape,o.dtype,EA(f,o.shape,o.dtype,p).values),d=p.strideHeight,m=p.strideWidth,v=p.dilationHeight,g=p.dilationWidth,y=p.effectiveFilterHeight,b=p.effectiveFilterWidth,x=b-1-p.padInfo.left,k=y-1-p.padInfo.top,w=rs(o.shape,"float32"),N=n.data.get(a.dataId).values,I=rs(a.shape,"float32",N),S=0;S<p.batchSize;++S)for(var T=0;T<p.inChannels;++T)for(var C=0;C<p.inHeight;++C)for(var E=0;E<p.inWidth;++E){for(var A=C-k,R=E-x,_=0,F=0;F<y;F+=v){var D=(A+F)/d;if(!(D<0||D>=p.outHeight||Math.floor(D)!==D))for(var O=0;O<b;O+=g){var M=(R+O)/m;if(!(M<0||M>=p.outWidth||Math.floor(M)!==M)){var L=y*b-1-h.get(S,D,M,T)===F*b+O?1:0;if(0!==L)_+=I.get(S,D,M,T)*L}}}w.set(_,S,C,E,T)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}};var mF={kernelName:Xn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.includeBatchInIndex,c=r;dE(a,"MaxPoolWithArgmax");var l=c.data.get(a.dataId).values,p=Oc(a.shape,i,o,[1,1],s),f=function(e,t,n,r,a){var i=CA(e,0,n,He(t),a,"max"),o=EA(e,t,n,a,!0,r);return[i.values,o.values]}(l,a.shape,a.dtype,u,p),h=(0,oe.Z)(f,2),d=h[0],m=h[1],v=c.write(d,p.outShape,a.dtype),g=c.write(m,p.outShape,a.dtype);return[{dataId:v,shape:p.outShape,dtype:a.dtype},{dataId:g,shape:p.outShape,dtype:"int32"}]}};var vF={kernelName:Yn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=Ae(i,a.shape),u=be(dp(a.shape,s)[1]),c=[],l=n.makeTensorInfo([],"float32",new Float32Array([u]));c.push(l);var p=VE({inputs:{x:a},backend:n,attrs:{dtype:"float32"}});c.push(p);var f=JR({inputs:{a:p,b:l},backend:n});c.push(f);var h=ER({inputs:{x:f},backend:n,attrs:{axis:i,keepDims:o}});return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),h}};var gF={kernelName:Qn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;dE(a,"min");var s=Ae(i,a.shape),u=s,c=gp(u,a.shape.length),l=a;null!=c&&(l=lA({inputs:{x:a},backend:n,attrs:{perm:c}}),u=bp(u.length,a.shape.length)),vp("min",u,l.shape.length);for(var p=dp(l.shape,u),f=(0,oe.Z)(p,2),h=f[0],d=be(f[1]),m=Xe(be(h),l.dtype),v=n.data.get(l.dataId).values,g=0;g<m.length;++g){for(var y=g*d,b=v[y],x=0;x<d;++x){var k=v[y+x];(Number.isNaN(k)||k<b)&&(b=k)}m[g]=b}null!=c&&n.disposeIntermediateTensorInfo(l);var w=n.makeTensorInfo(h,l.dtype,m);if(o){var N=QE({inputs:{x:w},backend:n,attrs:{shape:mp(h,s)}});return n.disposeIntermediateTensorInfo(w),N}return w}},yF=SE((function(e,t){return Math.min(e,t)})),bF=HE(Jn,yF),xF={kernelName:Jn,backendName:"cpu",kernelFunc:bF};var kF={kernelName:$n,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode;dE(a,"mirrorPad");for(var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=i.map((function(e){return e[0]})),c=i.map((function(e,t){return e[0]+a.shape[t]})),l="reflect"===o?0:1,p=n.data.get(a.dataId).values,f=a.shape.length,h=He(a.shape),d=be(s),m=s.length,v=He(s),g=_e(a.dtype,d),y=0;y<d;y++){for(var b=$e(y,m,v),x=0;x<m;x++)b[x]<u[x]?b[x]=2*u[x]-b[x]-l:b[x]>=c[x]&&(b[x]=2*(c[x]-1)-b[x]+l);b=b.map((function(e,t){return e-u[t]}));var k=Je(b,f,h);g[y]=p[k]}return{dataId:n.write(g,s,a.dtype),shape:s,dtype:a.dtype}}},wF=SE((function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})),NF=HE(er,wF),IF={kernelName:er,backendName:"cpu",kernelFunc:NF};function SF(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.dim,o=a.shape.length,s=i;if(-1===s&&(s=o-1),s!==o-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(o," and dim was ").concat(s));var u=Ae([s],a.shape),c=oF({inputs:{x:a},backend:n,attrs:{reductionIndices:u,keepDims:!1}}),l=mp(c.shape,u),p=QE({inputs:{x:c},backend:n,attrs:{shape:l}}),f=n_({inputs:{a:a,b:p},backend:n}),h=GR({inputs:{x:f},backend:n}),d=ER({inputs:{x:h},backend:n,attrs:{axis:u,keepDims:!1}}),m=QE({inputs:{x:d},backend:n,attrs:{shape:l}}),v=JR({inputs:{a:h,b:m},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(m),v}var TF={kernelName:Ur,backendName:"cpu",kernelFunc:SF};var CF={kernelName:tr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized;dE(a,"multinomial");for(var u=s?a:SF({inputs:{logits:a},backend:n,attrs:{dim:-1}}),c=u.shape[0],l=u.shape[1],p=n.data.get(u.dataId).values,f=[c,i],h=Xe(be(f),"int32"),d=0;d<c;++d){var m=d*l,v=new Float32Array(l-1);v[0]=p[m];for(var g=1;g<v.length;++g)v[g]=v[g-1]+p[m+g];for(var y=Jp.alea(o.toString()),b=d*i,x=0;x<i;++x){var k=y();h[b+x]=v.length;for(var w=0;w<v.length;w++)if(k<v[w]){h[b+x]=w;break}}}return s||n.disposeIntermediateTensorInfo(u),n.makeTensorInfo(f,"int32",h)}};function EF(e,t,n){var r=qa(-1,n);return IR([],t,r,e,n)}var AF={kernelName:rr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x;dE(r,"neg");var a=EF(n.data.get(r.dataId).values,r.shape,r.dtype),i=(0,oe.Z)(a,2),o=i[0],s=i[1];return n.makeTensorInfo(s,r.dtype,o)}},RF=zh;var _F={kernelName:ir,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold;dE(a,"NonMaxSuppression");var c=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,p=RF(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([p.length],"int32",new Int32Array(p))}},FF=Ph;var DF={kernelName:or,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize;dE(a,"NonMaxSuppressionPadded");var l=n.data.get(a.dataId).values,p=n.data.get(i.dataId).values,f=FF(l,p,o,s,u,c),h=f.selectedIndices,d=f.validOutputs;return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([d]))]}},OF=Zh;var MF={kernelName:sr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma;dE(a,"NonMaxSuppressionWithScore");var l=n.data.get(a.dataId).values,p=n.data.get(i.dataId).values,f=OF(l,p,o,s,u,c),h=f.selectedIndices,d=f.selectedScores;return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([d.length],"float32",new Float32Array(d))]}},LF=SE((function(e,t){return e!==t?1:0})),zF=HE(ar,LF,null,"bool"),PF={kernelName:ar,backendName:"cpu",kernelFunc:zF};var ZF={kernelName:cr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.depth,o=r.onValue,s=r.offValue;dE(a,"oneHot");var u=be(a.shape),c=new Float32Array(u*i);c.fill(s);for(var l=n.data.get(a.dataId).values,p=0;p<u;++p)l[p]>=0&&l[p]<i&&(c[p*i+l[p]]=o);return n.makeTensorInfo([].concat(Y(a.shape),[i]),"int32",c)}};function BF(e){var t=e.inputs,n=e.backend,r=t.x;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){var a=WE({inputs:{input:r},backend:n}),i=BF({inputs:{x:a},backend:n}),o=YA({inputs:{input:r},backend:n}),s=BF({inputs:{x:o},backend:n}),u=PE({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return u_({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var WF={kernelName:la,backendName:"cpu",kernelFunc:BF};var UF={kernelName:ur,backendName:"cpu",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===a.dtype){var i=WE({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=YA({inputs:{input:a},backend:r}),u=BF({inputs:{x:s},backend:r}),c=PE({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return u_({backend:r,attrs:{shape:a.shape,value:1,dtype:a.dtype}})}};function VF(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return jR({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){ve(a,e.shape,"All tensors passed to stack must have matching shapes"),me(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=JA({inputs:t.map((function(e){var t=jR({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),s}var GF={kernelName:lr,backendName:"cpu",kernelFunc:VF};var HF={kernelName:pr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;dE(a,"pad");var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=i.map((function(e){return e[0]})),c=n.data.get(a.dataId).values,l=be(a.shape),p=a.shape.length,f=He(a.shape),h=be(s),d=s.length,m=He(s),v=_e(a.dtype,h);0!==o&&v.fill(o);for(var g=0;g<l;g++){v[Je($e(g,p,f).map((function(e,t){return e+u[t]})),d,m)]=c[g]}return{dataId:n.write(v,s,a.dtype),shape:s,dtype:a.dtype}}},jF=SE((function(e,t){return Math.pow(e,t)})),qF=HE(hr,jF),KF={kernelName:hr,backendName:"cpu",kernelFunc:qF};function XF(e,t,n,r){for(var a=dp(e,r),i=(0,oe.Z)(a,2),o=i[0],s=i[1],u=wi(t,"int32"),c=Xe(be(o),u),l=be(s),p=0;p<c.length;++p){for(var f=p*l,h=1,d=0;d<l;++d)h*=n[f+d];c[p]=h}return{outVals:c,outShape:o,outDtype:u}}var YF={kernelName:mr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;dE(a,"prod");var s=a.shape.length,u=Ae(i,a.shape),c=gp(u,s),l=u,p=a,f=[];null!=c&&(p=lA({inputs:{x:a},backend:n,attrs:{perm:c}}),f.push(p),l=bp(l.length,s));var h=n.data.get(p.dataId).values,d=XF(p.shape,p.dtype,h,l),m=d.outVals,v=d.outShape,g=d.outDtype,y=v;return o&&(y=mp(v,u)),f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(y,g,m)}};function QF(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return Xe(0,r);var a=Xe(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return a}var JF={kernelName:vr,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.dtype,o=QF(r,a,n.step,i);return t.makeTensorInfo([o.length],i,o)}},$F=gE(yr,(function(e){return 1/e})),eD={kernelName:yr,backendName:"cpu",kernelFunc:$F};var tD={kernelName:Nr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;dE(a,"resizeBilinear");for(var u=He(a.shape),c=(0,oe.Z)(s,2),l=c[0],p=c[1],f=(0,oe.Z)(a.shape,4),h=f[0],d=f[1],m=f[2],v=f[3],g=n.data.get(a.dataId).values,y=new Float32Array(be([h,l,p,v])),b=[i&&l>1?d-1:d,i&&p>1?m-1:m],x=[i&&l>1?l-1:l,i&&p>1?p-1:p],k=0,w=b[0]/x[0],N=b[1]/x[1],I=0;I<h;I++)for(var S=0;S<l;S++){var T=void 0;T=o?w*(S+.5)-.5:w*S;for(var C=Math.max(0,Math.floor(T)),E=T-C,A=Math.min(d-1,Math.ceil(T)),R=I*u[0]+C*u[1],_=I*u[0]+A*u[1],F=0;F<p;F++){var D=void 0;D=o?N*(F+.5)-.5:N*F;for(var O=Math.max(0,Math.floor(D)),M=D-O,L=Math.min(m-1,Math.ceil(D)),z=R+O*u[2],P=_+O*u[2],Z=R+L*u[2],B=_+L*u[2],W=0;W<v;W++){var U=g[z+W],V=g[P+W],G=U+(g[Z+W]-U)*M,H=G+(V+(g[B+W]-V)*M-G)*E;y[k++]=H}}}return n.makeTensorInfo([h,l,p,v],"float32",y)}};var nD={kernelName:Ir,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners;dE([i,a],"resizeBilinearGrad");for(var s=He(a.shape),u=(0,oe.Z)(a.shape,4),c=u[0],l=u[1],p=u[2],f=u[3],h=(0,oe.Z)(i.shape,3),d=h[1],m=h[2],v=new Float32Array(c*l*p*f),g=[o&&d>1?l-1:l,o&&m>1?p-1:p],y=[o&&d>1?d-1:d,o&&m>1?m-1:m],b=g[0]/y[0],x=g[1]/y[1],k=n.data.get(i.dataId).values,w=0,N=0;N<c;N++)for(var I=N*s[0],S=0;S<d;S++)for(var T=S*b,C=Math.floor(T),E=Math.min(Math.ceil(T),l-1),A=I+C*s[1],R=I+E*s[1],_=T-C,F=1-_,D=0;D<m;D++)for(var O=D*x,M=Math.floor(O),L=Math.min(Math.ceil(O),p-1),z=O-M,P=1-z,Z=A+M*s[2],B=A+L*s[2],W=R+M*s[2],U=R+L*s[2],V=F*P,G=F*z,H=_*P,j=_*z,q=0;q<f;q++){var K=k[w++];v[Z+q]+=K*V,v[B+q]+=K*G,v[W+q]+=K*H,v[U+q]+=K*j}return n.makeTensorInfo([c,p,l,f],"float32",v)}};var rD={kernelName:kr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;dE(a,"resizeNearestNeighbor");for(var u=He(a.shape),c=(0,oe.Z)(s,2),l=c[0],p=c[1],f=(0,oe.Z)(a.shape,4),h=f[0],d=f[1],m=f[2],v=f[3],g=n.data.get(a.dataId).values,y=new Float32Array(h*l*p*v),b=[i&&l>1?d-1:d,i&&p>1?m-1:m],x=[i&&l>1?l-1:l,i&&p>1?p-1:p],k=b[0]/x[0],w=b[1]/x[1],N=0,I=0;I<h;I++)for(var S=I*u[0],T=0;T<l;T++){var C=o?k*(T+.5):k*T,E=Math.min(d-1,i?Math.round(C):Math.floor(C));o&&(E=Math.max(0,E));for(var A=S+E*u[1],R=0;R<p;R++){var _=o?w*(R+.5):w*R,F=Math.min(m-1,i?Math.round(_):Math.floor(_));o&&(F=Math.max(0,F));for(var D=A+F*u[2],O=0;O<v;O++){var M=g[D+O];y[N++]=M}}}return n.makeTensorInfo([h,l,p,v],a.dtype,y)}};var aD={kernelName:wr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners;dE([i,a],"resizeNearestNeighborGrad");for(var s=He(a.shape),u=He(i.shape),c=(0,oe.Z)(a.shape,4),l=c[0],p=c[1],f=c[2],h=c[3],d=(0,oe.Z)(i.shape,3),m=d[1],v=d[2],g=new Float32Array(l*p*f*h),y=n.data.get(i.dataId).values,b=[o&&m>1?p-1:p,o&&v>1?f-1:f],x=[o&&m>1?m-1:m,o&&v>1?v-1:v],k=b[0]/x[0],w=b[1]/x[1],N=1/k,I=1/w,S=2*Math.ceil(N)+2,T=2*Math.ceil(I)+2,C=0;C<l;C++)for(var E=C*s[0],A=0;A<p;A++)for(var R=E+A*s[1],_=Math.floor(A*N),F=Math.floor(_-S/2),D=0;D<f;D++)for(var O=R+D*s[2],M=Math.floor(D*I),L=Math.floor(M-T/2),z=0;z<h;z++){for(var P=0,Z=0;Z<S;Z++){var B=Z+F;if(!(B<0||B>=m)){var W=E+B*u[1],U=B*k;if(A===Math.min(p-1,o?Math.round(U):Math.floor(U)))for(var V=0;V<T;V++){var G=V+L;if(!(G<0||G>=v)){var H=W+G*u[2],j=G*w;D===Math.min(f-1,o?Math.round(j):Math.floor(j))&&(P+=y[H+z])}}}}g[O+z]=P}return n.makeTensorInfo(a.shape,a.dtype,g)}};var iD={kernelName:Tr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims;dE(a,"reverse");var o=a.shape.length,s=Ae(i,a.shape);if(0===o)return kE({inputs:{x:a},backend:n});for(var u=new li(a.shape,a.dtype),c=n.bufferSync(a),l=function(e){var t=u.indexToLoc(e),n=t.slice();s.forEach((function(e){return n[e]=a.shape[e]-1-n[e]})),u.set.apply(u,[c.get.apply(c,Y(n))].concat(Y(t)))},p=0;p<u.size;p++)l(p);return n.makeTensorInfo(u.shape,u.dtype,u.values)}},oD={kernelName:ha,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,c=_e(a.dtype,be(a.shape)),l=(0,oe.Z)(a.shape,4),p=l[0],f=l[1],h=l[2],d=l[3],m=Vd(s,f,h),v=(0,oe.Z)(m,2),g=v[0],y=v[1],b=Math.sin(i),x=Math.cos(i),k=u.data.get(a.dataId).values,w=0;w<p;w++)for(var N=w*h*f*d,I=0;I<f;I++)for(var S=I*(h*d),T=0;T<h;T++)for(var C=T*d,E=0;E<d;E++){var A=[p,I,T,E],R=A[2],_=A[1],F=(R-g)*x-(_-y)*b,D=(R-g)*b+(_-y)*x;F=Math.round(F+g),D=Math.round(D+y);var O=o;if("number"!==typeof o&&(O=3===E?255:o[E]),F>=0&&F<h&&D>=0&&D<f)O=k[N+D*(h*d)+F*d+E];c[N+S+C+E]=O}return{dataId:u.write(c,a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},sD=gE(Cr,(function(e){var t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1})),uD={kernelName:Cr,backendName:"cpu",kernelFunc:sD},cD=DE((function(e){return 1/Math.sqrt(e)})),lD=yE(Er,cD),pD={kernelName:Er,backendName:"cpu",kernelFunc:lD};function fD(e,t,n,r,a,i,o,s,u,c){var l=[r/a,a],p=e.values,f=t.values;if(0===r)return rs(n,t.dtype);var h=rs(l,t.dtype);h.values.fill(u);for(var d=0;d<i;d++){for(var m=[],v=0,g=0;g<o;g++){var y=p[d*o+g];m.push(y),v+=y*s[g]}if(v<0||v>=r/a)throw new Error("Invalid indices: ".concat(m," does not index into ").concat(n));for(var b=0;b<a;b++)c?h.values[v*a+b]+=f[d*a+b]:h.values[v*a+b]=0===t.rank?f[0]:f[d*a+b]}return h}var hD={kernelName:Ar,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=js(0,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,p=s.strides,f=s.outputSize,h=fD(n.bufferSync(a),n.bufferSync(i),o,f,l,c,u,p,0,!0);return n.makeTensorInfo(o,h.dtype,h.values)}};var dD={kernelName:Rr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e;dE([r,a,i],"select");for(var o=r.shape.length,s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,l=wi(a.dtype,i.dtype),p=Xe(be(a.shape),l),f=0,h=0===o||o>1||1===a.shape.length?1:be(a.shape.slice(1)),d=0;d<s.length;d++)for(var m=0;m<h;m++)1===s[d]?p[f++]=u[d]:p[f++]=c[d];return n.makeTensorInfo(a.shape,l,p)}},mD=Xd,vD=Yd,gD=gE(_r,(function(e){return e>=0?vD*e:mD*(Math.exp(e)-1)})),yD={kernelName:_r,backendName:"cpu",kernelFunc:gD},bD=gE(Mr,(function(e){return e<0?-1:e>0?1:0})),xD={kernelName:Mr,backendName:"cpu",kernelFunc:bD},kD=gE(Dr,(function(e){return Math.sin(e)})),wD={kernelName:Dr,backendName:"cpu",kernelFunc:kD},ND=gE(Or,(function(e){return Math.sinh(e)})),ID={kernelName:Or,backendName:"cpu",kernelFunc:ND},SD=Math.log(1.1920928955078125e-7)+2,TD=gE(zr,(function(e){var t=e>-SD,n=e<SD,r=Math.exp(e);return n?r:t?e:Math.log(1+r)})),CD={kernelName:zr,backendName:"cpu",kernelFunc:TD};var ED={kernelName:Br,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;dE([a],"spaceToBatchND");var s=be(i),u=[[0,0]];u.push.apply(u,Y(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=HF.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),p=Gd(l.shape,i,s,!1),f=Hd(p.length,i.length,!1),h=jd(l.shape,i,s,!1),d=QE({inputs:{x:l},backend:n,attrs:{shape:p}}),m=lA({inputs:{x:d},backend:n,attrs:{perm:f}}),v=QE({inputs:{x:m},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(m),v}};function AD(e,t,n,r,a,i,o){var s=t[0],u=i[0],c=new Array(u),l=new Array(s),p=t[1];if(0===u){if(0!==s)throw new Error(xm(s));return[Fe(n,0),[0,p],Fe(a,0),c,l]}for(var f=!0,h=0,d=new Array(u).fill(0),m=0;m<s;++m){var v=e[m*p];if(v<0)throw new Error(km(m,v));if(v>=u)throw new Error(wm(m,v,u));++d[v],f=f&&v>=h,h=v}for(var g=!0,y=0;y<u;++y){var b=0===d[y];c[y]=b,g=g&&!b,d[y]=Math.max(d[y],1),y>0&&(d[y]+=d[y-1])}if(g&&f){for(var x=e,k=r,w=0;w<s;++w)l[w]=w;return[x,[s,p],k,c,l]}for(var N=d[u-1],I=Fe(n,N*p),S=Fe(a,N),T=new Array(u).fill(0),C=0;C<s;++C){var E=e[C*p],A=T[E],R=(0===E?0:d[E-1])+A;T[E]++;for(var _=0;_<p;++_)I[R*p+_]=e[C*p+_];S[R]=r[C],l[C]=R}for(var F=0;F<u;++F){if(0===T[F]){var D=0===F?0:d[F-1];I[D*p+0]=F;for(var O=1;O<p;++O)I[D*p+O]=0;S[D]=o}}return[I,[N,p],S,c,l]}var RD={kernelName:Vr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,i=t.denseShape,o=t.defaultValue;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n        ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n        ".concat(a.shape));if(0!==o.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(o.shape));var s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values[0],p=AD(s,r.shape,r.dtype,u,a.dtype,c,l),f=(0,oe.Z)(p,5),h=f[0],d=f[1],m=f[2],v=f[3],g=f[4];return[n.makeTensorInfo(d,r.dtype,h),n.makeTensorInfo([d[0]],a.dtype,m),n.makeTensorInfo([v.length],"bool",new Uint8Array(v.map((function(e){return Number(e)})))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}};function _D(e,t,n,r,a){for(var i=be(r),o=t[0],s=a.length,u=[],c=1,l=-1,p=0;p<s;++p){var f=a[p];if(-1===f){if(-1!==l)throw new Error(Nm(l,p));l=p,u.push(1)}else{if(f<0)throw new Error(Im(p,f));c*=f,u.push(f)}}if(-1!==l){if(c<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");var h=Math.trunc(i/c);if(c*h!==i)throw new Error(Tm(r,u));u[l]=h}if(be(u)!==i)throw new Error(Cm(r,u));var d=r.length,m=[];if(d>0){m[d-1]=1;for(var v=d-2;v>=0;--v)m[v]=m[v+1]*r[v+1]}var g=[];if(s>0){g[s-1]=1;for(var y=s-2;y>=0;--y)g[y]=g[y+1]*u[y+1]}for(var b=Fe(n,o*s),x=0;x<o;++x){for(var k=0,w=0;w<d;++w)k+=e[x*d+w]*m[w];for(var N=0;N<s;++N)b[x*s+N]=Math.trunc(k/g[N]),k%=g[N]}return[b,[o,s],u]}var FD={kernelName:Gr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,i=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape\n        ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(n.data.get(a.dataId).values),s=n.data.get(r.dataId).values,u=Array.from(n.data.get(i.dataId).values),c=_D(s,r.shape,r.dtype,o,u),l=(0,oe.Z)(c,3),p=l[0],f=l[1],h=l[2];return[n.makeTensorInfo(f,r.dtype,p),n.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}};function DD(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=r.length,u=[t[0],e.length/t[0]],c=u[1],l=s>0?a[s-1]+1:0,p=l;if(p<0)throw new Error("segment ids must be >= 0");var f=t.slice();f[0]=p;var h=f.reduce((function(e,t){return e*t}),1),d=Fe(n,h);if(0===s)return p>0&&d.fill(o),[d,f];if(p<=0)throw new Error("segment ids must be >= 0");for(var m=0,v=1,g=0,y=a[m];;){var b=0;if(v<s){if(y===(b=a[v])){++v;continue}if(y>=b)throw new Error("segment ids are not increasing")}if(y<0||y>=p)throw new Error(Rm(y,p));y>g&&d.fill(o,g*c,y*c);for(var x=m;x<v;++x){var k=r[x];if(k<0||k>=u[0])throw new Error(_m(x,r[x],u[0]));for(var w=0;w<c;w++)d[y*c+w]+=e[k*c+w]}if(i)for(var N=0;N<c;N++)d[y*c+N]/=v-m;if(m=v,g=y+1,y=b,++v>s)break}return g<p&&d.fill(o,g*c,p*c),[d,f]}var OD={kernelName:Hr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n          ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n          ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,c=DD(o,r.shape,r.dtype,s,u,!0),l=(0,oe.Z)(c,2),p=l[0],f=l[1];return n.makeTensorInfo(f,r.dtype,p)}};var MD={kernelName:jr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n         ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n         ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,c=DD(o,r.shape,r.dtype,s,u),l=(0,oe.Z)(c,2),p=l[0],f=l[1];return n.makeTensorInfo(f,r.dtype,p)}};var LD={kernelName:qr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sparseIndices,i=t.sparseValues,o=t.defaultValue,s=r.outputShape,u=js(0,a,s),c=u.sliceRank,l=u.numUpdates,p=u.sliceSize,f=u.strides,h=u.outputSize,d=fD(n.bufferSync(a),n.bufferSync(i),s,h,p,l,c,f,n.data.get(o.dataId).values[0],!1);return n.makeTensorInfo(s,d.dtype,d.values)}};var zD={kernelName:Wr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=Ae(r.axis,a.shape)[0],s=bm(a,i,o),u=new Array(a.shape.length).fill(0),c=a.shape.slice();return s.map((function(e){var t=Y(c);t[o]=e;var r=LA({inputs:{x:a},backend:n,attrs:{begin:u,size:t}});return u[o]+=e,r}))}},PD=DE((function(e){return Math.sqrt(e)})),ZD=gE(Pr,(function(e){return Math.sqrt(e)})),BD={kernelName:Pr,backendName:"cpu",kernelFunc:ZD},WD={kernelName:Xr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n;dE(r,"square");for(var i=a.data.get(r.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},UD=SE((function(e,t){var n=e-t;return n*n})),VD=HE(Kr,UD),GD={kernelName:Kr,backendName:"cpu",kernelFunc:VD},HD=gE(pa,(function(e,t){var n=t;return isNaN(e)?NaN:e>0?1:n.alpha})),jD={kernelName:pa,backendName:"cpu",kernelFunc:HD};function qD(e,t,n,r){for(var a=rs(e,t.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*n[u]+r[u];a.set.apply(a,[t.get.apply(t,s)].concat(Y(o)))}return a}var KD={kernelName:Yr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.end,s=r.strides,u=r.beginMask,c=r.endMask,l=r.ellipsisMask,p=r.newAxisMask,f=r.shrinkAxisMask;dE(a,"stridedSlice");var h,d=uu(a.shape,i,o,s,u,c,l,p,f),m=d.finalShapeSparse,v=d.finalShape,g=d.isIdentity,y=d.sliceDim0,b=d.isSimpleSlice,x=d.begin,k=d.end,w=d.strides;if(g)h=QE({inputs:{x:a},backend:n,attrs:{shape:v}});else if(y||b){me(a.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(a.shape.length)}));var N=Xs(x,k,w),I=LA({inputs:{x:a},backend:n,attrs:{begin:x,size:N}});h=QE({inputs:{x:I},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(I)}else{var S=qD(m,n.bufferSync(a),w,x);h=n.makeTensorInfo(v,S.dtype,S.values)}return h}},XD=function(){function e(t,n,r,a,i,o){(0,$.Z)(this,e),this.separator=Qa(t),this.nGramWidths=n,this.leftPad=Qa(r),this.rightPad=Qa(a),this.padWidth=i,this.preserveShort=o}return(0,ee.Z)(e,[{key:"getPadWidth",value:function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}},{key:"getNumNGrams",value:function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}},{key:"createNGrams",value:function(e,t,n,r,a,i){for(var o=this,s=function(s){var u=o.getPadWidth(i),c=Math.max(0,u-s),l=Math.max(0,u-(a-(s+1))),p=i-(c+l),f=t+(c>0?0:s-u),h=0;h+=c*o.leftPad.length;for(var d=0;d<p;++d)h+=e[f+d].length;h+=l*o.rightPad.length,h+=(c+l+p-1)*o.separator.length,n[r+s]=new Uint8Array(h);for(var m=n[r+s],v=0,g=function(e){return e.forEach((function(e){return m[v++]=e}))},y=0;y<c;++y)g(o.leftPad),g(o.separator);for(var b=0;b<p-1;++b)g(e[f+b]),g(o.separator);if(p>0){g(e[f+p-1]);for(var x=0;x<l;++x)g(o.separator),g(o.rightPad)}else{for(var k=0;k<l-1;++k)g(o.rightPad),g(o.separator);g(o.rightPad)}},u=0;u<a;++u)s(u)}},{key:"compute",value:function(e,t){var n=this,r=e.length,a=t.length;if(a>0){var i=t[0];if(0!==i)throw new Error("First split value must be 0, got ".concat(i));for(var o=1;o<a;++o){var s=t[o]>=i;if(!(s=s&&t[o]<=r))throw new Error("Invalid split value ".concat(t[o],", must be in [").concat(i,", ").concat(r,"]"));i=t[o]}if(i!==r)throw new Error("Last split value must be data size. Expected ".concat(r,", got ").concat(i))}var u=a-1,c=Fe("int32",a);if(0===r||0===a){for(var l=new Array(r),p=0;p<=u;++p)c[p]=0;return[l,c]}c[0]=0;for(var f=function(e){var r=t[e]-t[e-1],a=0;n.nGramWidths.forEach((function(e){a+=n.getNumNGrams(r,e)})),n.preserveShort&&r>0&&0===a&&(a=1),c[e]=c[e-1]+a},h=1;h<=u;++h)f(h);for(var d=new Array(c[u]),m=function(r){var a=t[r],i=c[r];if(n.nGramWidths.forEach((function(o){var s=t[r+1]-t[r],u=n.getNumNGrams(s,o);n.createNGrams(e,a,d,i,u,o),i+=u})),n.preserveShort&&i===c[r]){var o=t[r+1]-t[r];if(0===o)return"continue";var s=o+2*n.padWidth;n.createNGrams(e,a,d,i,1,s)}},v=0;v<u;++v)m(v);return[d,c]}}]),e}();function YD(e,t,n,r,a,i,o,s){return new XD(n,r,a,i,o,s).compute(e,t)}var QD={kernelName:Qr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,c=r.preserveShortSequences,l=t.data,p=t.dataSplits,f=YD(n.data.get(l.dataId).values,n.data.get(p.dataId).values,a,i,o,s,u,c),h=(0,oe.Z)(f,2),d=h[0],m=h[1];return[n.makeTensorInfo([d.length],"string",d),n.makeTensorInfo(p.shape,"int32",m)]}};function JD(e,t,n,r){if(e.length)if(0!==t.length)if(1!==t.length){for(var a=0,i=0;i<e.length+1;i++)if(i===e.length||-1!==t.indexOf(e[i])){var o=e.subarray(a,i);n&&0===o.length||r.push(o),a=i+1}}else{for(var s=t[0],u=e.indexOf(s);-1!==u;){var c=e.subarray(0,u);n&&0===c.length||r.push(c),u=(e=e.subarray(u+1)).indexOf(s)}n&&0===e.length||r.push(e)}else for(var l=0;l<e.length;++l)r.push(e.subarray(l,l+1))}function $D(e,t,n){for(var r=e.length,a=[],i=0,o=0,s=new Array(r),u=0;u<r;++u){var c=a.length;JD(e[u],t,n,a);var l=a.length-c;s[u]=l,i+=l,o=Math.max(o,l)}for(var p=Fe("int32",2*i),f=new Array(i),h=[r,o],d=0,m=0;m<r;++m)for(var v=0;v<s[m];++v)p[2*d]=m,p[2*d+1]=v,f[d]=a[d],++d;return[p,f,h]}var eO={kernelName:Jr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,i=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==i.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(i.shape));var o=$D(n.data.get(a.dataId).values,n.data.get(i.dataId).values[0],r),s=(0,oe.Z)(o,3),u=s[0],c=s[1],l=s[2],p=c.length;return[n.makeTensorInfo([p,2],"int32",u),n.makeTensorInfo([p],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(l))]}};function tO(e,t){for(var n=Fe("int32",e.length),r=0;r<e.length;++r)n[r]=ja(e[r]).modulo(t).getLowBitsUnsigned();return n}var nO={kernelName:$r,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var i=tO(n.data.get(a.dataId).values,r);return n.makeTensorInfo(a.shape,"int32",i)}},rO=gE(ta,(function(e){return Math.tan(e)})),aO={kernelName:ta,backendName:"cpu",kernelFunc:rO},iO=gE(na,(function(e){return Math.tanh(e)}));function oO(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];for(var a=rs(n,e.dtype),i=0;i<a.values.length;++i){for(var o=a.indexToLoc(i),s=new Array(e.rank),u=0;u<s.length;u++)s[u]=o[u]%e.shape[u];var c=e.locToIndex(s);a.values[i]=e.values[c]}return a}var sO={kernelName:ra,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;dE(a,"tile");var o=oO(n.bufferSync(a),i);return n.makeTensorInfo(o.shape,o.dtype,o.values)}},uO=function(e,t){var n=t.value-e.value;return 0===n?e.index-t.index:n};function cO(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length-1;r>n;){if(r-n>600){var a=r-n+1,i=t-n+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2),c=Math.max(n,Math.floor(t-i*s/a+u)),l=Math.min(r,Math.floor(t+(a-i)*s/a+u));cO(e,t,c,l)}var p=e[t],f=n,h=r;for(pe(e,n,t),uO(e[r],p)>0&&pe(e,n,r);f<h;){for(pe(e,f,h),f++,h--;uO(e[f],p)<0;)f+=1;for(;uO(e[h],p)>0;)h-=1}0===uO(e[n],p)?pe(e,n,h):pe(e,h+=1,r),h<=t&&(n=h+1),t<=h&&(r=h-1)}}function lO(e,t,n,r,a){for(var i=t[t.length-1],o=e.length/i,s=i,u=_e(n,o*r),c=_e("int32",o*r),l=function(t){var n=t*s,i=e.subarray(n,n+s),o=new Array(i.length);i.forEach((function(e,t){return o[t]={value:e,index:t}})),r<o.length&&(cO(o,r),o=o.slice(0,r)),a&&o.sort(uO);for(var l=t*r,p=u.subarray(l,l+r),f=c.subarray(l,l+r),h=0;h<r;h++)p[h]=o[h].value,f[h]=o[h].index},p=0;p<o;p++)l(p);var f=t.slice();return f[f.length-1]=r,[rs(f,n,u),rs(f,"int32",c)]}var pO={kernelName:aa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted;dE(a,"topk");var s=lO(n.data.get(a.dataId).values,a.shape,a.dtype,i,o),u=(0,oe.Z)(s,2),c=u[0],l=u[1];return[n.makeTensorInfo(c.shape,c.dtype,c.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}};var fO={kernelName:ia,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=t.transforms,o=n.interpolation,s=n.fillMode,u=n.fillValue,c=n.outputShape,l=(0,oe.Z)(a.shape,4),p=l[0],f=l[1],h=l[2],d=l[3],m=null!=c?c:[f,h],v=(0,oe.Z)(m,2),g=v[0],y=v[1],b=[p,g,y,d],x=He(a.shape),k=x[0],w=x[1],N=x[2],I=_e(a.dtype,be(b));I.fill(u);for(var S=r.data.get(a.dataId).values,T=r.data.get(i.dataId).values,C=0;C<p;++C){for(var E=1===i.shape[0]?T:T.subarray(8*C,8*C+8),A=0;A<g;++A)for(var R=0;R<y;++R)for(var _=0;_<d;++_){var F=void 0,D=E[6]*R+E[7]*A+1;if(0!==D){var O=(E[0]*R+E[1]*A+E[2])/D,M=(E[3]*R+E[4]*A+E[5])/D,L=hO(O,h,s),z=hO(M,f,s);switch(o){case"nearest":F=mO(S,f,h,k,w,N,C,z,L,_,u);break;case"bilinear":F=vO(S,f,h,k,w,N,C,z,L,_,u);break;default:throw new Error("Error in Transform: Expect 'nearest' or "+"'bilinear', but got ".concat(o))}I[C*k+A*w+R*N+_]=F}}return r.makeTensorInfo(b,a.dtype,I)}return{dataId:r.write(I,b,a.dtype),shape:a.shape,dtype:a.dtype}}};function hO(e,t,n){switch(n){case"reflect":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=2*t;n<r&&(n=r*Math.trunc(-n/r)+n),n=n<-t?n+r:-n-1}else if(n>t-1)if(t<=1)n=0;else{var a=2*t;(n-=a*Math.trunc(n/a))>=t&&(n=a-n-1)}return ce(0,n,t-1)}(e,t);case"wrap":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=t-1;n+=t*(Math.trunc(-n/r)+1)}else if(n>t-1)if(t<=1)n=0;else{var a=t-1;n-=t*Math.trunc(n/a)}return ce(0,n,t-1)}(e,t);case"nearest":return function(e,t){return ce(0,e,t-1)}(e,t);default:return function(e,t){return e}(e)}}function dO(e,t,n,r,a,i,o,s,u,c,l){return 0<=s&&s<t&&0<=u&&u<n?e[o*r+s*a+u*i+c]:l}function mO(e,t,n,r,a,i,o,s,u,c,l){return dO(e,t,n,r,a,i,o,Math.round(s),Math.round(u),c,l)}function vO(e,t,n,r,a,i,o,s,u,c,l){var p=Math.floor(s),f=Math.floor(u),h=p+1,d=f+1;return(h-s)*((d-u)*dO(e,t,n,r,a,i,o,p,f,c,l)+(u-f)*dO(e,t,n,r,a,i,o,p,d,c,l))+(s-p)*((d-u)*dO(e,t,n,r,a,i,o,h,f,c,l)+(u-f)*dO(e,t,n,r,a,i,o,h,d,c,l))}function gO(e,t,n,r){for(var a=Ae(t,n)[0],i=[1,n[0],1],o=0;o<a;o++)i[0]*=n[o];i[1]=n[a];for(var s=a+1;s<n.length;s++)i[2]*=n[s];for(var u={},c=new Int32Array(n[a]),l=new li(i,r,e),p=[],f=1===i[0]&&1===i[2],h=0;h<n[a];h++){var d=void 0;if(f)d=e[h].toString();else{for(var m=[],v=0;v<i[0];v++)for(var g=0;g<i[2];g++)m.push(l.get(v,h,g));d=m.join(",")}if(void 0!==u[d])c[h]=u[d];else{var y=Object.keys(u).length;u[d]=y,c[h]=y,p.push(h)}}var b=i.slice();b[1]=Object.keys(u).length;var x=new li(b,r);p.forEach((function(e,t){for(var n=0;n<i[0];n++)for(var r=0;r<i[2];r++)x.set(l.get(n,e,r),n,t,r)}));var k=n.slice();return k[a]=b[1],{outputValues:x.values,outputShape:k,indices:c}}var yO={kernelName:sa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;dE(i,"unique");var o=gO(r.data.get(i.dataId).values,a,i.shape,i.dtype),s=o.outputValues,u=o.outputShape,c=o.indices;return[r.makeTensorInfo(u,i.dtype,s),r.makeTensorInfo([c.length],"int32",c)]}};var bO={kernelName:ua,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a.shape.length,s=a.shape[i],u=new Array(o-1),c=0,l=0;l<o;l++)l!==i&&(u[c++]=a.shape[l]);var p=new Array(o).fill(0),f=a.shape.slice();f[i]=1;for(var h=new Array(s),d=0;d<h.length;d++){p[i]=d;var m=LA({inputs:{x:a},backend:n,attrs:{begin:p,size:f}});h[d]=QE({inputs:{x:m},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(m)}return h}};for(var xO={kernelName:ca,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments;dE(a,"unsortedSegmentSum");for(var s=[],u=[],c=a.shape.length-i.shape.length,l=i,p=0;p<c;++p){var f=jR({inputs:{input:l},backend:n,attrs:{dim:p+1}});l=f,u.push(f)}for(var h=0;h<o;++h){var d=qa(h,"int32"),m=n.makeTensorInfo([],"int32",d),v=DR({inputs:{a:m,b:l},backend:n}),g=VE({inputs:{x:v},backend:n,attrs:{dtype:"float32"}}),y=TR({inputs:{a:g,b:a},backend:n}),b=ER({inputs:{x:y},backend:n,attrs:{axis:0,keepDims:!1}});s.push(b),u.push(m),u.push(v),u.push(g),u.push(y),u.push(b)}var x=VF({inputs:s,backend:n,attrs:{axis:0}});return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),x}},kO=0,wO=[tA,rA,iA,sA,YE,uA,fA,hA,dA,mA,gA,bA,kA,IA,TA,RA,_A,FA,DA,eA,OA,PA,WA,UA,GE,HA,qA,ZE,KA,$A,tR,nR,rR,aR,iR,oR,uR,lR,pR,fR,hR,dR,mR,gR,yR,bR,xR,kR,wR,NR,RR,xE,_R,OR,UR,HR,qR,YR,s_,c_,l_,h_,v_,g_,y_,x_,w_,S_,E_,wE,A_,QA,__,D_,M_,IE,P_,W_,V_,j_,K_,Q_,$_,nF,rF,aF,sF,lF,pF,fF,hF,dF,mF,vF,gF,xF,kF,IF,CF,CR,AF,_F,DF,MF,PF,ZF,UF,GF,HF,KF,EE,YF,JF,UE,$R,eD,RE,FE,JE,tD,nD,rD,aD,iD,oD,uD,pD,hD,dD,yD,LE,xD,wD,ID,zA,TF,CD,ED,RD,FD,OD,MD,LD,zD,BD,WD,GD,jD,KD,QD,eO,nO,r_,AR,aO,{kernelName:na,backendName:"cpu",kernelFunc:iO},sO,pO,fO,pA,yO,bO,xO,WF];kO<wO.length;kO++){Ia(wO[kO])}var NO,IO,SO,TO={},CO={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function EO(e,t){if(!(e in TO)||null!=t){var n=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=null==t?function(e){if("undefined"!==typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!==typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e):t;if(n.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete TO[e]}),!1),1===e)return n.getContext("webgl",CO)||n.getContext("experimental-webgl",CO);return n.getContext("webgl2",CO)}(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;TO[e]=n}var r=TO[e];return null==r||r.isContextLost()?(delete TO[e],EO(e)):(r.disable(r.DEPTH_TEST),r.disable(r.STENCIL_TEST),r.disable(r.BLEND),r.disable(r.DITHER),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SAMPLE_COVERAGE),r.enable(r.SCISSOR_TEST),r.enable(r.CULL_FACE),r.cullFace(r.BACK),TO[e])}function AO(e,t){return[t,e]}function RO(e){var t=be(e);return Ie(Math.ceil(t/4))}function _O(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function FO(e,t){var n,r,a,i,o,s,u,c,l,p,f=e;return 2===it().getNumber("WEBGL_VERSION")?(n=f.R32F,r=f.R16F,a=f.RGBA16F,i=f.RGBA32F,o=f.RED,u=4,c=1,l=f.HALF_FLOAT,p=f.FLOAT,s=f.RGBA8):(n=e.RGBA,r=e.RGBA,a=e.RGBA,i=f.RGBA,o=e.RGBA,u=4,c=4,l=null!=t?t.HALF_FLOAT_OES:null,p=e.FLOAT,s=e.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:s,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:l,textureTypeFloat:p}}function DO(e,t){var n=t();return it().getBool("DEBUG")&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}(e,t))}(e),n}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(NO||(NO={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(IO||(IO={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(SO||(SO={}));function OO(e){return!!(it().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function MO(e,t){return KO(e,(function(){return e.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}var LO,zO,PO=/ERROR: [0-9]+:([0-9]+):/g;function ZO(e,t){var n=PO.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);for(var r=+n[1],a=e.split("\n"),i=a.length.toString().length+2,o=a.map((function(e,t){return Te((t+1).toString(),i)+e})),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var c=o.slice(0,r-1),l=o.slice(r-1,r),p=o.slice(r);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat(Te(l[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(p.join("\n"))}function BO(e,t){if(DO(e,(function(){return e.validateProgram(t)})),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function WO(e,t,n,r,a,i,o){var s=e.getAttribLocation(t,n);return-1!==s&&(DO(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),DO(e,(function(){return e.vertexAttribPointer(s,a,e.FLOAT,!1,i,o)})),DO(e,(function(){return e.enableVertexAttribArray(s)})),!0)}function UO(e,t,n){return KO(e,(function(){return e.getUniformLocation(t,n)}),'uniform "'+n+'" not present in program.')}function VO(e,t,n){return e.getUniformLocation(t,n)}function GO(e,t,n,r){DO(e,(function(){return function(e,t,n){XO(e,n),DO(e,(function(){return e.activeTexture(e.TEXTURE0+n)})),DO(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)}))}(e,t,r)})),DO(e,(function(){return e.uniform1i(n,r)}))}function HO(e,t,n){DO(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),DO(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}))}function jO(e,t){DO(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)})),DO(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function qO(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}(e,t))}function KO(e,t,n){var r=DO(e,(function(){return t()}));if(null==r)throw new Error(n);return r}function XO(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){var a="[gl.TEXTURE0, gl.TEXTURE".concat(n,"]");throw new Error("textureUnit must be in ".concat(a,"."))}}function YO(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return be(e.slice(0,e.length-t))}function QO(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function JO(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[YO(e)].concat(Y(QO(e)))),t}function $O(e){return e%2===0}function eM(e,t){if(ke(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if($O(n)&&$O(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&$O(e[0])&&$O(t[0])}function tM(e,t){return null!=e.getExtension(t)}function nM(e){try{if(null!=EO(e))return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function rM(e){if(0===e)return!1;var t=EO(e);if(1!==e){if(tM(t,"EXT_color_buffer_float"))return aM(t);var n="EXT_color_buffer_half_float";if(tM(t,n)){var r=t.getExtension(n);return function(e,t){var n=FO(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);var a=1,i=1;e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,a,i,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var s=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(o),s}(t,r)}return!1}return!!tM(t,"OES_texture_float")&&(!!tM(t,"WEBGL_color_buffer_float")&&aM(t))}function aM(e){var t=FO(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function iM(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&me("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors ")+"in the WebGL backend."}))}))}var oM=it();function sM(){var e,t,n,r,a,i,o,s,u,c;return 2===it().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function uM(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=He(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / ").concat(t),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(t):"index -= ".concat(e[a]," * ").concat(t);return"".concat(i,"; ").concat(o,";")})).join("")}function cM(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=He(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / outShapeStrides[").concat(a,"]"),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * outShapeStrides[").concat(a,"]"):"index -= ".concat(e[a]," * outShapeStrides[").concat(a,"]");return"".concat(i,"; ").concat(o,";")})).join("")}function lM(e,t){var n=e.length,r=e.map((function(e){return"".concat(t,"[").concat(e,"]")})),a=new Array(n-1);a[n-2]=r[n-1];for(var i=n-3;i>=0;--i)a[i]="(".concat(a[i+1]," * ").concat(r[i+1],")");return a}function pM(e){var t=He(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}oM.registerFlag("HAS_WEBGL",(function(){return oM.getNumber("WEBGL_VERSION")>0})),oM.registerFlag("WEBGL_VERSION",(function(){return nM(2)?2:nM(1)?1:0})),oM.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(function(){return!1})),oM.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===oM.get("WEBGL_VERSION")})),oM.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),oM.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),oM.registerFlag("WEBGL_PACK",(function(){return oM.getBool("HAS_WEBGL")})),oM.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return oM.getBool("WEBGL_PACK")})),oM.registerFlag("WEBGL_PACK_CLIP",(function(){return oM.getBool("WEBGL_PACK")})),oM.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return oM.getBool("WEBGL_PACK")})),oM.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return oM.getBool("WEBGL_PACK")})),oM.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return oM.getBool("WEBGL_PACK")})),oM.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return oM.getBool("WEBGL_PACK")})),oM.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return oM.getBool("WEBGL_PACK")})),oM.registerFlag("WEBGL_PACK_REDUCE",(function(){return oM.getBool("WEBGL_PACK")})),oM.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return oM.getBool("WEBGL_PACK")})),oM.registerFlag("WEBGL_CONV_IM2COL",(function(){return oM.getBool("WEBGL_PACK")})),oM.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return function(e){if(null==LO){var t=EO(e);LO=t.getParameter(t.MAX_TEXTURE_SIZE)}return LO}(oM.getNumber("WEBGL_VERSION"))})),oM.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return function(e){if(null==zO){var t=EO(e);zO=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,zO)}(oM.getNumber("WEBGL_VERSION"))})),oM.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=oM.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;var t=EO(e);return tM(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:tM(t,"EXT_disjoint_timer_query")?1:0}(e)})),oM.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return oM.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Pi()})),oM.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return function(e){if(0===e)return!1;var t=EO(e);if(1===e){if(!tM(t,"OES_texture_float"))return!1}else if(!tM(t,"EXT_color_buffer_float"))return!1;return aM(t)}(oM.getNumber("WEBGL_VERSION"))})),oM.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!oM.getBool("WEBGL_FORCE_F16_TEXTURES")&&oM.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),oM.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return rM(oM.getNumber("WEBGL_VERSION"))})),oM.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return 2===(e=oM.getNumber("WEBGL_VERSION"))&&null!=EO(e).fenceSync;var e})),oM.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return oM.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),oM.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(function(){return-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never "+"delete) or at least 0, but got ".concat(e,"."))})),oM.registerFlag("WEBGL_FLUSH_THRESHOLD",(function(){return Pi()?1:-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never "+"manual flush) or at least 0, but got ".concat(e,"."))})),oM.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 128})),oM.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(function(){return!1})),oM.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 1e5})),oM.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(function(){return 128}));var fM="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",hM=Fs;function dM(e,t,n){var r=[];if(e.forEach((function(e){var t=be(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?r.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(r.push("uniform sampler2D ".concat(e.name,";")),r.push("uniform int offset".concat(e.name,";"))),n.enableShapeUniforms){switch(DM(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape).uniformShape.length){case 1:r.push("uniform int ".concat(e.name,"Shape;"));break;case 2:r.push("uniform ivec2 ".concat(e.name,"Shape;"));break;case 3:r.push("uniform ivec3 ".concat(e.name,"Shape;"));break;case 4:r.push("uniform ivec4 ".concat(e.name,"Shape;"))}r.push("uniform ivec2 ".concat(e.name,"TexShape;"))}})),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((function(e){r.push("uniform ".concat(e.type," ").concat(e.name).concat(e.arrayIndex?"[".concat(e.arrayIndex,"]"):"",";"))}));var a,i,o=r.join("\n"),s=e.map((function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,a="";a+=n?vM(e,r):mM(e,r);var i=e.shapeInfo.logicalShape,o=t.logicalShape;i.length<=o.length&&(a+=n?RM(e,t):_M(e,t));return a}(e,t,n.packedInputs,n.enableShapeUniforms)})).join("\n"),u=t.texShape,c=sM(),l=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(c),p=function(e){return"".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(gM,"\n    ").concat(yM,"\n    ").concat(bM,"\n  ")}(c);return t.isPacked?(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(1===r[0])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(r[1],".0);\n      }\n    ");if(1===r[1])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(r[0],".0);\n      }\n    ");if(n)return"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      return 2 * (resTexRC.x * ").concat(r[1]," + resTexRC.y);\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(ke(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(r[0],", ").concat(r[1],"));\n      }\n    ");var a=Math.ceil(e[1]/2);if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[2]/2),i=a*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t,n);default:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";for(var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[e.length-1]/2),i=a*Math.ceil(e[e.length-2]/2),o=i,s="",u="b, r, c",c=2;c<e.length-1;c++)o*=e[e.length-c-1],s="\n      int b".concat(c," = index / ").concat(o,";\n      index -= b").concat(c," * ").concat(o,";\n    ")+s,u="b".concat(c,", ")+u;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      ").concat(s,"\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec").concat(e.length,"(").concat(u,");\n    }\n  ")}(e,t,n)}}(t.logicalShape,u,n.enableShapeUniforms),i=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(c)):(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){if(1===t[0])return n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    ");if(1===t[1])return n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    ");if(n)return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){if(ke(e,t))return n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    ");if(1===e[1])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ");if(1===e[0])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ");if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n){var r=cM(["r","c","d"],e);return"\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ".concat(r,"\n    return ivec3(r, c, d);\n  }\n")}var a=uM(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(a,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t,n);case 4:return function(e,t,n){if(n){var r=cM(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ".concat(r,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}var a=uM(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(a,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t,n);case 5:return function(e,t){var n=uM(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){var n=uM(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}}(t.logicalShape,u,n.enableShapeUniforms),i=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(c)),n.packedInputs&&(p+=xM),[p,l,i,o,a,s,n.userCode].join("\n")}function mM(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.shapeInfo.logicalShape;switch(n.length){case 0:return wM(e,t);case 1:return NM(e,t);case 2:return IM(e,t);case 3:return SM(e,t);case 4:return TM(e,t);case 5:return CM(e);case 6:return EM(e);default:throw new Error("".concat(n.length,"-D input sampling")+" is not yet supported")}}function vM(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=sM();return"\n    vec4 ".concat(n,"() {\n      return ").concat(r.texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(e);case 1:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=sM();if(t)return"\n    vec4 ".concat(r,"(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ");var o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return"\n    vec4 ".concat(r,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(o[0],", ").concat(o[1],", index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=i[0],s=i[1],u=sM();if(null!=i&&ke(n,i))return t?"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    "):"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    ");if(t)return"\n    vec4 ".concat(a,"(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ");var c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],l=Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(l,", ").concat(c[0],", ").concat(c[1],", row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0]){var s=[1,2],u=OM(e,n.slice(1)),c=["b","row","col"];return"\n        ".concat(vM(u,t),"\n        vec4 ").concat(a,"(int b, int row, int col) {\n          return ").concat(a,"(").concat(MM(c,s),");\n        }\n      ")}var l=sM();if(t)return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ").concat(l.texture2D,"(").concat(r,", uv);\n    }\n  ");var p=o[0],f=o[1],h=Math.ceil(n[2]/2),d=h*Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(p,", ").concat(f,", ").concat(d,", ").concat(h,", b, row, col);\n      return ").concat(l.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);default:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=sM();if(t)return"\n    vec4 ".concat(r,"(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(").concat(n,"Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(n,"Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ").concat(n,"Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ");for(var i=e.shapeInfo.logicalShape,o=i.length,s=e.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=u[0],l=u[1],p=Math.ceil(i[o-1]/2),f=p*Math.ceil(i[o-2]/2),h="int b, int row, int col",d="b * ".concat(f," + (row / 2) * ").concat(p," + (col / 2)"),m=2;m<o-1;m++)h="int b".concat(m,", ")+h,f*=i[o-m-1],d="b".concat(m," * ").concat(f," + ")+d;return"\n    vec4 ".concat(r,"(").concat(h,") {\n      int index = ").concat(d,";\n      int texR = index / ").concat(l,";\n      int texC = index - texR * ").concat(l,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(l,", ").concat(c,");\n      return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t)}}var gM="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",yM="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",bM="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",xM="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function kM(e){return"offset".concat(e)}function wM(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(r,"() {return ").concat(n,";}");var a=(0,oe.Z)(e.shapeInfo.texShape,2),i=a[0],o=a[1];if(1===i&&1===o)return"\n      float ".concat(r,"() {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var s=kM(n);if(t)return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");var u=(0,oe.Z)(e.shapeInfo.texShape,2),c=u[0],l=u[1];return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(c,", ").concat(l,", ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}function NM(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int index) {\n        ").concat(AM(e),"\n      }\n    ");var a=e.shapeInfo.texShape,i=a[0],o=a[1];if(1===o&&1===i)return"\n      float ".concat(r,"(int index) {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var s=kM(n);return 1===o?t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[0]));\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / ").concat(i,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):1===i?t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / ").concat(o,".0, 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):t?"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  "):"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(i,", ").concat(o,", index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}function IM(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape;if(null!=i&&ke(n,i)){if(t)return"\n      float ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var o=i[0],s=i[1];return"\n    float ".concat(a,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}var u=Re(n),c=u.newShape,l=u.keptDims,p=c;if(p.length<n.length){var f=OM(e,p);return"\n      ".concat(mM(f,t),"\n      float ").concat(a,"(int row, int col) {\n        return ").concat(a,"(").concat(MM(["row","col"],l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(n[1],", 1)));\n        ").concat(AM(e),"\n      }\n    ");var h=i[0],d=i[1],m=kM(r);return 1===d?t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(m,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(").concat(r,"TexShape[0]));\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(m,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(h,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):1===h?t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(m,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(").concat(r,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(m,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(d,".0, 0.5);\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):t?"\n      float ".concat(a,"(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(r,"Shape[1] + col + ").concat(m,";\n        vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n  float ".concat(a,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(n[1]," + col + ").concat(m,";\n    vec2 uv = uvFromFlat(").concat(h,", ").concat(d,", index);\n    return sampleTexture(").concat(r,", uv);\n  }\n")}function SM(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[1]*n[2],o=n[2],s=Re(n),u=s.newShape,c=s.keptDims,l=u;if(l.length<n.length){var p=OM(e,l);return"\n        ".concat(mM(p,t),"\n        float ").concat(a,"(int row, int col, int depth) {\n          return ").concat(a,"(").concat(MM(["row","col","depth"],c),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(i,", ").concat(o,", 1)));\n        ").concat(AM(e),"\n      }\n    ");var f=e.shapeInfo.texShape,h=f[0],d=f[1],m=e.shapeInfo.flatOffset;if(d===i&&null==m)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        int stride1 = ").concat(r,"Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n        float ".concat(a,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(o,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(d,".0, ").concat(h,".0);\n          return sampleTexture(").concat(r,", uv);\n        }\n      ");if(d===o&&null==m)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(").concat(r,"Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(n[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(d,".0, ").concat(h,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");var v=kM(r);return t?"\n    float ".concat(a,"(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ").concat(r,"Shape[1] * ").concat(r,"Shape[2];\n      int stride1 = ").concat(r,"Shape[2];\n      int index = row * ").concat(i," + col * ").concat(o," + depth + ").concat(v,";\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n      return sampleTexture(").concat(r,", uv);\n    }\n    "):"\n      float ".concat(a,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(i," + col * ").concat(o," + depth + ").concat(v,";\n        vec2 uv = uvFromFlat(").concat(h,", ").concat(d,", index);\n        return sampleTexture(").concat(r,", uv);\n      }\n  ")}function TM(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[3],o=n[2]*i,s=n[1]*o,u=Re(n),c=u.newShape,l=u.keptDims;if(c.length<n.length){var p=OM(e,c);return"\n      ".concat(mM(p,t),"\n      float ").concat(a,"(int row, int col, int depth, int depth2) {\n        return ").concat(a,"(").concat(MM(["row","col","depth","depth2"],l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(s,", ").concat(o,", ").concat(i,", 1)));\n        ").concat(AM(e),"\n      }\n    ");var f=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,d=h[0],m=h[1],v="int stride2 = ".concat(r,"Shape[3];"),g="int stride1 = ".concat(r,"Shape[2] * stride2;"),y="int stride0 = ".concat(r,"Shape[1] * stride1;");if(m===s&&null==f)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        ").concat(v,"\n        ").concat(g,"\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(o,", ").concat(i,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(m,".0, ").concat(d,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");if(m===i&&null==f)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(r,"Shape[1] * ").concat(r,"Shape[2], ").concat(r,"Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(n[1]*n[2],", ").concat(n[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(m,".0, ").concat(d,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var b=kM(r);return t?"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ").concat(v,"\n      ").concat(g,"\n      ").concat(y,"\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index + ").concat(b,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," +\n          depth * ").concat(i," + depth2;\n      vec2 uv = uvFromFlat(").concat(d,", ").concat(m,", index + ").concat(b,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}function CM(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],i=t[3]*a,o=t[2]*i,s=t[1]*o,u=Re(t),c=u.newShape,l=u.keptDims;if(c.length<t.length){var p=OM(e,c);return"\n      ".concat(mM(p),"\n      float ").concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(r,"(").concat(MM(["row","col","depth","depth2","depth3"],l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(s,", ").concat(o,", ").concat(i,", ").concat(a,")) +\n          depth3;\n        ").concat(AM(e),"\n      }\n    ");var f=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,d=h[0],m=h[1];if(m===s&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(o,", ").concat(i,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(m,".0, ").concat(d,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(m===a&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(m,".0, ").concat(d,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var v=kM(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," + depth * ").concat(i," +\n          depth2 * ").concat(a," + depth3 + ").concat(v,";\n      vec2 uv = uvFromFlat(").concat(d,", ").concat(m,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}function EM(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=Re(t),i=a.newShape,o=a.keptDims;if(i.length<t.length){var s=OM(e,i);return"\n      ".concat(mM(s),"\n      float ").concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(r,"(").concat(MM(["row","col","depth","depth2","depth3","depth4"],o),");\n      }\n    ")}var u=t[5],c=t[4]*u,l=t[3]*c,p=t[2]*l,f=t[1]*p;if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(f,", ").concat(p,", ").concat(l,", ").concat(c,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(u,", 1)));\n        ").concat(AM(e),"\n      }\n    ");var h=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,m=d[0],v=d[1];if(v===f&&null==h)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(p,", ").concat(l,", ").concat(c,", ").concat(u,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(v===u&&null==h)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var g=kM(n);return"\n    float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(f," + col * ").concat(p," + depth * ").concat(l," +\n          depth2 * ").concat(c," + depth3 * ").concat(u," + depth4 + ").concat(g,";\n      vec2 uv = uvFromFlat(").concat(m,", ").concat(v,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}function AM(e){var t=e.name,n=be(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function RM(e,t){var n,r=e.name,a=r.charAt(0).toUpperCase()+r.slice(1),i="get"+a+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,u=hM(e.shapeInfo.logicalShape,t.logicalShape),c=FM(s),l=s-o,p=["x","y","z","w","u","v"];n=0===o?"":s<2&&u.length>=1?"coords = 0;":u.map((function(e){return"coords.".concat(p[e+l]," = 0;")})).join("\n");var f="";f=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(p[t+l])})).join(", ");var h="return outputValue;",d=1===be(e.shapeInfo.logicalShape),m=1===be(t.logicalShape);if(1!==o||d||m){if(d&&!m)h=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var v=o-2,g=o-1;u.indexOf(v)>-1&&u.indexOf(g)>-1?h="return vec4(outputValue.x);":u.indexOf(v)>-1?h="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(g)>-1&&(h="return vec4(outputValue.xx, outputValue.zz);")}}else h="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(i,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(n,"\n      vec4 outputValue = get").concat(a,"(").concat(f,");\n      ").concat(h,"\n    }\n  ")}function _M(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=t.texShape,o=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&ke(o,i))return"\n      float ".concat(a,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");var c,l=FM(u),p=hM(e.shapeInfo.logicalShape,t.logicalShape),f=u-s,h=["x","y","z","w","u","v"];c=0===s?"":u<2&&p.length>=1?"coords = 0;":p.map((function(e){return"coords.".concat(h[e+f]," = 0;")})).join("\n");var d="";return d=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(h[t+f])})).join(", "),"\n    float ".concat(a,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(c,"\n      return get").concat(r,"(").concat(d,");\n    }\n  ")}function FM(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function DM(e,t,n){var r=Re(t),a=r.newShape,i=r.keptDims,o=t.length,s=e&&3===o&&1===t[0],u=s?t.slice(1):a,c=!e&&o>1&&!ke(t,n)&&a.length<o||s;return{useSqueezeShape:c,uniformShape:c?u:t,keptDims:i}}function OM(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function MM(e,t){return t.map((function(t){return e[t]})).join(", ")}function LM(e,t,n,r){var a=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),i=a.map((function(e){return e.shapeInfo})),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},s=dM(a,o,t),u=function(e,t){var n=KO(e,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(DO(e,(function(){return e.shaderSource(n,t)})),DO(e,(function(){return e.compileShader(n)})),it().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw ZO(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(e.gl,s),c=e.createProgram(u);return it().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:t,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o},zM(e,t,c))}function zM(e,t,n){var r,a,i,o,s={},u={},c={},l=[],p=null;o=e.getUniformLocation(n,"NAN",!1),1===it().getNumber("WEBGL_VERSION")&&(p=e.getUniformLocation(n,"INFINITY",!1));for(var f=!1,h=0;h<t.variableNames.length;h++){var d=t.variableNames[h];s[d]=e.getUniformLocation(n,d,f),s["offset".concat(d)]=e.getUniformLocation(n,"offset".concat(d),f),t.enableShapeUniforms&&(u["".concat(d,"Shape")]=e.getUniformLocation(n,"".concat(d,"Shape"),f),c["".concat(d,"TexShape")]=e.getUniformLocation(n,"".concat(d,"TexShape"),f))}return t.enableShapeUniforms&&(r=e.getUniformLocation(n,"outShape",f),i=e.getUniformLocation(n,"outShapeStrides",f),a=e.getUniformLocation(n,"outTexShape",f)),t.customUniforms&&t.customUniforms.forEach((function(t,r){l[r]=e.getUniformLocation(n,t.name,f)})),{uniformLocations:s,customUniformLocations:l,infLoc:p,nanLoc:o,inShapesLocations:u,inTexShapesLocations:c,outShapeLocation:r,outShapeStridesLocation:i,outTexShapeLocation:a}}function PM(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but ")+"was executed with ".concat(t.length," inputs"));e.forEach((function(e,n){var r=e.logicalShape,a=t[n],i=a.shape;if(!ke(r,i))throw Error("Binary was compiled with different shapes than "+"the current args. Shapes ".concat(r," and ").concat(i," must match"));if(!e.isUniform||!a.isUniform){var o=e.texShape,s=a.isUniform?null:a.texData.texShape;if(!ke(o,s))throw Error("Binary was compiled with different texture shapes than the"+" current args. Shape ".concat(o," and ").concat(s," must match"))}}))}function ZM(e,t,n,r,a){t.program.enableShapeUniforms||(PM(t.inShapeInfos,n),PM([t.outShapeInfo],[r]));var i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):e.setOutputMatrixTexture(i.texture,o[0],o[1]),e.setProgram(t.webGLProgram),1===it().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,r){var a=t.program.variableNames[r],i=t.uniformLocations[a],o=t.uniformLocations["offset".concat(a)],s=t.inShapesLocations["".concat(a,"Shape")],u=t.inTexShapesLocations["".concat(a,"TexShape")];if(s){var c=DM(t.program.packedInputs,n.shape,n.texData.texShape).uniformShape;switch(c.length){case 1:e.gl.uniform1iv(s,new Int32Array(c));break;case 2:e.gl.uniform2iv(s,new Int32Array(c));break;case 3:e.gl.uniform3iv(s,new Int32Array(c));break;case 4:e.gl.uniform4iv(s,new Int32Array(c))}}if(u&&e.gl.uniform2i(u,n.texData.texShape[0],n.texData.texShape[1]),null!=i)if(n.isUniform)if(be(n.shape)<2)e.gl.uniform1f(i,n.uniformValues[0]);else{var l=n.uniformValues;l instanceof Float32Array||(l=new Float32Array(l)),e.gl.uniform1fv(i,l)}else null!=n.texData.slice&&null!=o&&e.gl.uniform1i(o,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture.texture,i,r)}));var s=t.outShapeLocation;if(s)switch(r.shape.length){case 1:e.gl.uniform1iv(s,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(s,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(s,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(s,new Int32Array(r.shape))}if(t.outShapeStridesLocation){var u=He(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(u));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(u));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(u))}}t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&a&&t.program.customUniforms.forEach((function(n,r){var i=t.customUniformLocations[r],o=a[r];if("float"===n.type)e.gl.uniform1fv(i,o);else if("vec2"===n.type)e.gl.uniform2fv(i,o);else if("vec3"===n.type)e.gl.uniform3fv(i,o);else if("vec4"===n.type)e.gl.uniform4fv(i,o);else if("int"===n.type)e.gl.uniform1iv(i,o);else if("ivec2"===n.type)e.gl.uniform2iv(i,o);else if("ivec3"===n.type)e.gl.uniform3iv(i,o);else{if("ivec4"!==n.type)throw Error("uniform type ".concat(n.type," is not supported yet."));e.gl.uniform4iv(i,o)}})),e.executeProgram()}function BM(e,t,n){var r="";t.concat(n).forEach((function(t){var a=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){var i=t.texData.texShape,o=DM(e.packedInputs,t.shape,i),s=o.useSqueezeShape,u=o.uniformShape,c=o.keptDims,l="",p="",f="";if(1===u.length&&e.packedInputs){var h=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];l="".concat(h[0]>1,"_").concat(h[1]>1)}else if(2!==u.length||e.packedInputs){if(u.length>2&&!e.packedInputs){var d=He(u);f="".concat(d[0]===i[1],"_").concat(d[d.length-1]===i[1])}}else p="".concat(u[0]>1,"_").concat(u[1]>1);var m=t.shape.length,v=2===u.length&&ke(t.shape,i),g=1===be(t.shape),y=Fs(t.shape,n.shape),b=!e.packedInputs&&m===n.shape.length&&ke(i,n.texData.texShape),x=e.packedInputs||u.length>2?"":"".concat(i[0]>1,"_").concat(i[1]>1);r+="".concat(m,"_").concat(b,"_").concat(s?c:"","_").concat(u.length,"_").concat(g,"_").concat(y,"_").concat(v,"_").concat(l,"_").concat(p,"_").concat(f,"_").concat(x,"_").concat(a)}else{var k=t.isUniform?"uniform":t.texData.texShape;r+="".concat(t.shape,"_").concat(k,"_").concat(a)}}));var a=e.userCode,i=e.constructor.name;return i+="_"+r+"_"+a+"".concat(it().getNumber("WEBGL_VERSION"))}function WM(e){return it().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}var UM=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=NO.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=sM();this.outputShape=t,this.enableShapeUniforms=WM(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?cM(["r","c","d"],t):uM(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),VM=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=NO.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=sM();this.outputShape=t,this.enableShapeUniforms=WM(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?cM(["r","c","d"],t):uM(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),GM=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["A"],this.outTexUsage=IO.DOWNLOAD;var n=sM();this.outputShape=t,this.userCode="\n      ".concat(fM,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),HM=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=IO.DOWNLOAD;var n=sM();this.outputShape=t,this.userCode="\n      ".concat(fM,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),jM=(0,ee.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,$.Z)(this,e),this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];var r=sM();this.outputShape=t,this.enableShapeUniforms=WM(this.outputShape.length);var a="result";n&&(a="floor(result * 255. + 0.5)"),this.userCode="\n      ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":pM(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / texShape[1];\n        int c = imod(flatIndex, texShape[1]);\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n        vec4 values = ").concat(r.texture2D,"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ").concat(r.output," = vec4(").concat(a,", 0., 0., 0.);\n      }\n    ")})),qM=(0,ee.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,$.Z)(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];var r=sM();this.outputShape=t,this.enableShapeUniforms=WM(this.outputShape.length);var a="",i="result";n&&(i="floor(result * 255. + 0.5)");for(var o=0;o<=1;o++)for(var s=0;s<=1;s++){var u=2*o+s;a+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(s," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(t[2]),") {\n          localCoords[2] += ").concat(s,";\n          if (localCoords[1] + ").concat(o," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(t[1]),") {\n            localCoords[1] += ").concat(o,";\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ").concat(r.texture2D,"(A, uv);\n\n            if (offset == 0) {\n              result[").concat(u,"] = values[0];\n            } else if (offset == 1) {\n              result[").concat(u,"] = values[1];\n            } else if (offset == 2) {\n              result[").concat(u,"] = values[2];\n            } else {\n              result[").concat(u,"] = values[3];\n            }\n          }\n        }\n        ")}this.userCode="\n        ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":pM(t),"\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ").concat(a,"\n\n          ").concat(r.output," = ").concat(i,";\n        }\n    ")}));function KM(e){var t=sM();return function(e,t){var n=KO(e,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(DO(e,(function(){return e.shaderSource(n,t)})),DO(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}function XM(e){return function(e,t){var n=KO(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return DO(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),DO(e,(function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function YM(e){return function(e,t){var n=KO(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return DO(e,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)})),DO(e,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Uint16Array([0,1,2,2,1,3]))}function QM(e,t,n,r,a,i){!function(e,t){var n=it().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="[".concat(e,"x").concat(t,"]");throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n){var a="[".concat(e,"x").concat(t,"]"),i="[".concat(n,"x").concat(n,"]");throw new Error("Requested texture size "+a+" greater than WebGL maximum on this browser / GPU "+i+".")}}(t,n);var o=function(e){return KO(e,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}(e),s=e.TEXTURE_2D;return DO(e,(function(){return e.bindTexture(s,o)})),DO(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),DO(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),DO(e,(function(){return e.texParameteri(s,e.TEXTURE_MIN_FILTER,e.NEAREST)})),DO(e,(function(){return e.texParameteri(s,e.TEXTURE_MAG_FILTER,e.NEAREST)})),1===it().getNumber("WEBGL_VERSION")?DO(e,(function(){return e.texImage2D(s,0,r,t,n,0,a,i,null)})):DO(e,(function(){return e.texStorage2D(s,1,r,t,n)})),DO(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),{texture:o,texShape:[n,t]}}function JM(e){return e.internalFormatFloat}function $M(e){return e.internalFormatHalfFloat}function eL(e){return e.downloadTextureFormat}function tL(e){return e.internalFormatPackedFloat}function nL(e){return e.internalFormatPackedHalfFloat}function rL(e,t,n,r,a,i,o,s){var u=e,c=new Float32Array(function(e,t){var n=_O(e,t),r=(0,oe.Z)(n,2);return r[0]*r[1]*4}(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}var aL=function(){function e(t){(0,$.Z)(this,e),this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var n=it().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,function(e,t){TO[e]=t}(n,t)):this.gl=EO(n);var r="WEBGL_color_buffer_float",a="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===it().getNumber("WEBGL_VERSION")){var i="OES_texture_half_float";if(this.textureFloatExtension=MO(this.gl,"OES_texture_float"),tM(this.gl,i))this.textureHalfFloatExtension=MO(this.gl,i);else if(it().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),tM(this.gl,a))this.colorBufferHalfFloatExtension=MO(this.gl,a);else if(it().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",tM(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!tM(this.gl,a))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(a)}this.vertexBuffer=XM(this.gl),this.indexBuffer=YM(this.gl),this.framebuffer=function(e){return KO(e,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=FO(this.gl,this.textureHalfFloatExtension)}return(0,ee.Z)(e,[{key:"debug",get:function(){return it().getBool("DEBUG")}},{key:"dispose",value:function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;DO(t,(function(){return t.finish()})),DO(t,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),DO(t,(function(){return t.deleteFramebuffer(e.framebuffer)})),DO(t,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),DO(t,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),DO(t,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}}},{key:"createFloat32MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=AO(t,n),i=(0,oe.Z)(a,2);return QM(e,i[0],i[1],JM(r),r.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"createFloat16MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=AO(t,n),i=(0,oe.Z)(a,2);return QM(e,i[0],i[1],$M(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createUnsignedBytesMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=AO(t,n),i=(0,oe.Z)(a,2);return QM(e,i[0],i[1],eL(r),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}},{key:"uploadPixelDataToTexture",value:function(e,t){this.throwIfDisposed(),function(e,t,n){DO(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),n.data instanceof Uint8Array?2===it().getNumber("WEBGL_VERSION")?DO(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)})):DO(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)})):2===it().getNumber("WEBGL_VERSION")?DO(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)})):DO(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)})),DO(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t)}},{key:"uploadDenseMatrixToTexture",value:function(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,a,i){var o,s,u;DO(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),a instanceof Uint8Array?(o=new Uint8Array(n*r*4),s=e.UNSIGNED_BYTE,u=e.RGBA):(o=new Float32Array(n*r*4),s=e.FLOAT,u=i.internalFormatPackedFloat),o.set(a),2===it().getNumber("WEBGL_VERSION")?DO(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,s,o)})):DO(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,s,o)})),DO(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t,n,r,this.textureConfig)}},{key:"createFloat16PackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=_O(t,n),i=(0,oe.Z)(a,2);return QM(e,i[0],i[1],nL(r),e.RGBA,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createPackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=_O(t,n),i=(0,oe.Z)(a,2);return QM(e,i[0],i[1],tL(r),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"deleteMatrixTexture",value:function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(jO(this.gl,this.framebuffer),this.outputTexture=null),DO(this.gl,(function(){return t.gl.deleteTexture(e)}))}},{key:"downloadByteEncodedFloatMatrixFromOutputTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n,r){var a=AO(t,n),i=(0,oe.Z)(a,2),o=i[0],s=i[1],u=new Uint8Array(t*n*4);return DO(e,(function(){return e.readPixels(0,0,o,s,r.downloadTextureFormat,e.UNSIGNED_BYTE,u)})),new Float32Array(u.buffer)}(r.gl,t,n,r.textureConfig)}))}},{key:"downloadPackedMatrixFromBuffer",value:function(e,t,n,r,a,i){return rL(this.gl,e,0,0,0,a,i,this.textureConfig)}},{key:"downloadFloat32MatrixFromBuffer",value:function(e,t){return function(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}(this.gl,e,t)}},{key:"createBufferFromTexture",value:function(e,t,n){this.bindTextureToFrameBuffer(e);var r=function(e,t,n,r){var a=e.createBuffer();DO(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var i=16*t*n;return DO(e,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)})),DO(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)})),DO(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}},{key:"createAndWaitForFence",value:function(){var e=this.createFence(this.gl);return this.pollFence(e)}},{key:"createFence",value:function(e){var t,n,r=this;if(it().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=a.clientWaitSync(i,0,0);return e===a.ALREADY_SIGNALED||e===a.CONDITION_SATISFIED},t=i}else it().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,it().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}}},{key:"downloadMatrixFromPackedTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n){var r=new Float32Array(t*n*4);return DO(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)})),r}(r.gl,t,n)}))}},{key:"createProgram",value:function(e){var t=this;this.throwIfDisposed();var n=this.gl;null==this.vertexShader&&(this.vertexShader=KM(n));var r=function(e){return KO(e,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}(n);return DO(n,(function(){return n.attachShader(r,t.vertexShader)})),DO(n,(function(){return n.attachShader(r,e)})),function(e,t){if(DO(e,(function(){return e.linkProgram(t)})),!it().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(n,r),this.debug&&BO(n,r),this.vertexAttrsAreBound||(this.setProgram(r),this.vertexAttrsAreBound=function(e,t,n){return DO(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),WO(e,t,"clipSpacePos",n,3,20,0)&&WO(e,t,"uv",n,2,20,12)}(n,this.program,this.vertexBuffer)),r}},{key:"deleteProgram",value:function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&DO(this.gl,(function(){return t.gl.deleteProgram(e)}))}},{key:"setProgram",value:function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&BO(this.gl,this.program),DO(this.gl,(function(){return t.gl.useProgram(e)}))}},{key:"getUniformLocation",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?UO(this.gl,e,t):VO(this.gl,e,t)}},{key:"getAttributeLocation",value:function(e,t){var n=this;return this.throwIfDisposed(),DO(this.gl,(function(){return n.gl.getAttribLocation(e,t)}))}},{key:"getUniformLocationNoThrow",value:function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}},{key:"setInputMatrixTexture",value:function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),GO(this.gl,e,t,n)}},{key:"setOutputMatrixTexture",value:function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}},{key:"setOutputPackedMatrixTexture",value:function(e,t,n){this.throwIfDisposed();var r=_O(t,n),a=(0,oe.Z)(r,2),i=a[0],o=a[1];this.setOutputMatrixTextureDriver(e,i,o)}},{key:"setOutputMatrixWriteRegion",value:function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}},{key:"setOutputPackedMatrixWriteRegion",value:function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}},{key:"debugValidate",value:function(){null!=this.program&&BO(this.gl,this.program),qO(this.gl)}},{key:"executeProgram",value:function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),DO(e,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))}},{key:"blockUntilAllProgramsCompleted",value:function(){var e=this;this.throwIfDisposed(),DO(this.gl,(function(){return e.gl.finish()}))}},{key:"getQueryTimerExtension",value:function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=MO(this.gl,2===it().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}},{key:"getQueryTimerExtensionWebGL2",value:function(){return this.getQueryTimerExtension()}},{key:"getQueryTimerExtensionWebGL1",value:function(){return this.getQueryTimerExtension()}},{key:"beginQuery",value:function(){if(2===it().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),a=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,a),a}},{key:"endQuery",value:function(){if(2!==it().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}}},{key:"waitForQueryAndGetTime",value:function(){var e=J(ne().mark((function e(t){var n=this;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ce((function(){return n.disposed||n.isQueryAvailable(t,it().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}));case 2:return e.abrupt("return",this.getQueryTime(t,it().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getQueryTime",value:function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}},{key:"isQueryAvailable",value:function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}var i=this.getQueryTimerExtensionWebGL1(),o=i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}},{key:"pollFence",value:function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))}},{key:"pollItems",value:function(){for(var e=function(e){for(var t=0;t<e.length;++t){if(!e[t]())break}return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t){(0,this.itemsToPoll[t].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}},{key:"addItemToPoll",value:function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||Ce((function(){return n.pollItems(),0===n.itemsToPoll.length}))}},{key:"bindTextureToFrameBuffer",value:function(e){this.throwIfDisposed(),HO(this.gl,e,this.framebuffer),this.debug&&qO(this.gl)}},{key:"unbindTextureToFrameBuffer",value:function(){null!=this.outputTexture?(HO(this.gl,this.outputTexture,this.framebuffer),this.debug&&qO(this.gl)):jO(this.gl,this.framebuffer)}},{key:"downloadMatrixDriver",value:function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n}},{key:"setOutputMatrixTextureDriver",value:function(e,t,n){this.throwIfDisposed();var r=this.gl;HO(r,e,this.framebuffer),this.debug&&qO(r),this.outputTexture=e,DO(r,(function(){return r.viewport(0,0,t,n)})),DO(r,(function(){return r.scissor(0,0,t,n)}))}},{key:"setOutputMatrixWriteRegionDriver",value:function(e,t,n,r){var a=this;this.throwIfDisposed(),DO(this.gl,(function(){return a.gl.scissor(e,t,n,r)}))}},{key:"throwIfDisposed",value:function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}},{key:"throwIfNoProgram",value:function(){if(null==this.program)throw new Error("No GPU program is currently set.")}}]),e}();var iL=qE,oL=ZA,sL=BA,uL=VA,cL=XA,lL=FR,pL=VR,fL=KR,hL=p_,dL=b_,mL=k_,vL=N_,gL=T_,yL=L_,bL=Z_,xL=U_,kL=G_,wL=iF,NL=uF,IL=yF,SL=IR,TL=EF,CL=LF,EL=XF,AL=QF,RL=cD,_L=OE,FL=nA,DL=MA,OL=AD,ML=_D,LL=DD,zL=PD,PL=qD,ZL=YD,BL=$D,WL=tO,UL=e_,VL=oO,GL=lO,HL=cA,jL=gO;function qL(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return"".concat(e,".").concat(t)}))}function KL(e,t){return 1===t?[e]:qL(e,t)}var XL=function(){function e(t){if((0,$.Z)(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=WM(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=KL("rc",this.rank),r=FM(this.rank),a=this.getOutOfBoundsCondition(n),i=this.getSetup(n),o=this.getOutput(n);this.userCode="\n        void main() {\n          ".concat(r," rc = getOutputCoords();\n\n          if(").concat(a,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(i,"\n\n            setOutput(vec4(").concat(o,"));\n          }\n        }\n      ")}}return(0,ee.Z)(e,[{key:"getSourceCoordsArr",value:function(e){for(var t=[],n=0;n<=1;n++)for(var r=0;r<=1;r++){for(var a="".concat(0===n?"r":"rp1",", ").concat(0===r?"c":"cp1"),i=2;i<this.rank;i++)a="".concat(e[e.length-1-i],",")+a;t.push(a)}return t}},{key:"getOutOfBoundsCondition",value:function(e){if(1===this.rank)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);for(var t="",n=this.rank-2;n<this.rank;n++)t+="".concat(e[n]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(n,"]"):this.outputShape[n]),n<this.rank-1&&(t+="||");return t}},{key:"getSetup",value:function(e){if(1===this.rank)return"";var t=e.slice(-2),n=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],r=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return"\n      int r = ".concat(t[0],";\n      int c = ").concat(t[1],";\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ").concat(n,";\n      bool rEdge = rp1 >= ").concat(r,";\n    ")}},{key:"getOutput",value:function(e){var t=this.getSourceCoordsArr(e);if(1===this.rank){var n=this.enableShapeUniforms?"outShape":this.outputShape[0];return"getA(rc), (rc + 1 >= ".concat(n," ? 0. : getA(rc + 1)), 0, 0")}return"getA(".concat(t[0],"),\n            cEdge ? 0. : getA(").concat(t[1],"),\n            rEdge ? 0. : getA(").concat(t[2],"),\n            rEdge || cEdge ? 0. : getA(").concat(t[3],")")}}]),e}(),YL=(0,ee.Z)((function e(t,n){(0,$.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=WM(this.outputShape.length);for(var r="",a=0;a<4;a++){var i="thisRC = rc;";a%2===1&&(i+="thisRC.z += 1;"),a>1&&(i+="thisRC.y += 1;"),r+="\n        ".concat(i,"\n        ").concat(a>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(a,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(a>0?"}":"","\n      ")}this.userCode="\n      ".concat(function(e,t){var n=t?function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=e.map((function(e,t){return t})),a=lM(r,t);return a.map((function(t,r){var i="int ".concat(e[r]," = ").concat(n," / ").concat(a[r]),o=r===a.length-1?"int ".concat(e[r+1]," = ").concat(n," - ").concat(e[r]," * ").concat(a[r]):"index -= ".concat(e[r]," * ").concat(a[r]);return"".concat(i,"; ").concat(o,";")})).join("")}(["r","c","d"],"inputShape"):uM(["r","c","d"],e);return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(n,"\n      return ivec3(r, c, d);\n    }\n  ")}(n,this.enableShapeUniforms),"\n      ").concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":pM(t),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(this.enableShapeUniforms?"outShape[1]":t[1],";\n        int cols = ").concat(this.enableShapeUniforms?"outShape[2]":t[2],";\n\n        ").concat(r,"\n\n        setOutput(result);\n      }\n    ")}));var QL=function(){function e(t){(0,$.Z)(this,e),this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return(0,ee.Z)(e,[{key:"acquireTexture",value:function(e,t,n){var r=$L(t,n),a=ez(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);var i,o=JL(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return r===SO.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===SO.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===SO.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===SO.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===SO.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),i}},{key:"releaseTexture",value:function(e,t,n,r){if(null!=this.freeTextures){var a=$L(n,r),i=ez(t,a,r);i in this.freeTextures||(this.freeTextures[i]=[]);var o=JL(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),s=it().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==s&&this._numBytesAllocated>s?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=o):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;var u=this.usedTextures[i],c=u.indexOf(e);if(c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u.splice(c,1),this.log()}}},{key:"log",value:function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}}},{key:"numBytesAllocated",get:function(){return this._numBytesAllocated}},{key:"numBytesFree",get:function(){return this._numBytesFree}},{key:"getNumUsedTextures",value:function(){return this.numUsedTextures}},{key:"getNumFreeTextures",value:function(){return this.numFreeTextures}},{key:"dispose",value:function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));for(var n in this.usedTextures)this.usedTextures[n].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}]),e}();function JL(e,t,n,r,a){var i,o=function(e,t){switch(e){case SO.PACKED_2X2_FLOAT32:return tL(t);case SO.PACKED_2X2_FLOAT16:return nL(t);case SO.UNPACKED_FLOAT32:return JM(t);case SO.UNPACKED_FLOAT16:return $M(t);case SO.PACKED_4X1_UNSIGNED_BYTE:return eL(t);default:throw new Error("Unknown physical texture type ".concat(e))}}(t,r);if(a){var s=_O(e[0],e[1]),u=(0,oe.Z)(s,2);i=u[0]*u[1]}else{var c=AO(e[0],e[1]),l=(0,oe.Z)(c,2);i=l[0]*l[1]}var p=function(e,t){var n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error("Unknown internal format ".concat(t))}(n,o);return i*p}function $L(e,t){if(e===IO.UPLOAD)return SO.PACKED_2X2_FLOAT32;if(e===IO.RENDER||null==e)return function(e){return it().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?SO.PACKED_2X2_FLOAT32:SO.UNPACKED_FLOAT32:e?SO.PACKED_2X2_FLOAT16:SO.UNPACKED_FLOAT16}(t);if(e===IO.DOWNLOAD||e===IO.PIXELS)return SO.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function ez(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}var tz=(0,ee.Z)((function e(t,n){(0,$.Z)(this,e),this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=WM(this.outputShape.length),this.userCode="\n      float unaryOperation(float x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),nz="if (isnan(x)) return x;",rz="return x;",az="return abs(x);";var iz="return (x >= 0.0) ? x : (exp(x) - 1.0);",oz=nz+"\n  return (x < 0.0) ? 0.0 : x;\n",sz=nz+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",uz="return x;",cz="return 1.0 / (1.0 + exp(-1.0 * x));",lz="return x;",pz="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",fz="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",hz="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",dz="return 1.0 / (1.0 + exp(-1.0 * x));",mz=(0,ee.Z)((function e(t,n){(0,$.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=WM(this.outputShape.length),this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),vz=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=WM(this.outputShape.length);var n=t.length,r=KL("rc",n),a=FM(n),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(n,r),o=r.slice(-2),s=n<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode="\n      void main() {\n        ".concat(a," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(i,");\n\n        setOutput(getChannel(packedInput, ").concat(s,"));\n      }\n    ")})),gz=Jf,yz={};var bz=it().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");var xz=function(e){(0,ri.Z)(n,e);var t=(0,ai.Z)(n);function n(e){var r,a,i;if((0,$.Z)(this,n),(r=t.call(this)).pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.lastGlFlushTime=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!it().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null!=e){if(e instanceof aL)a=e;else{var o=EO(it().getNumber("WEBGL_VERSION"),e);a=new aL(o)}r.binaryCache={},r.gpgpuCreatedLocally=!1}else{var s=EO(it().getNumber("WEBGL_VERSION"));a=new aL(s),r.binaryCache=((i=it().getNumber("WEBGL_VERSION"))in yz||(yz[i]={}),yz[i]),r.gpgpuCreatedLocally=!0}return r.gpgpu=a,r.canvas=r.gpgpu.gl.canvas,r.textureManager=new QL(r.gpgpu),r.numMBBeforeWarning=null==it().global.screen?1024:it().global.screen.height*it().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new re((0,ng.Z)(r),Ru()),r}return(0,ee.Z)(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"numDataIds",value:function(){return this.texData.numDataIds()-this.pendingDeletes}},{key:"write",value:function(e,t,n){if((it().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||it().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:IO.UPLOAD,refCount:1}),r}},{key:"refCount",value:function(e){return this.texData.has(e)?this.texData.get(e).refCount:0}},{key:"incRef",value:function(e){this.texData.get(e).refCount++}},{key:"decRef",value:function(e){this.texData.has(e)&&this.texData.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){if(it().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:IO.UPLOAD,refCount:a})}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"readSync",value:function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,a=t.complexTensorInfos,i=t.slice,o=t.shape,s=t.isPacked;if(null!=i){var u;u=s?new mz(o,uz):new tz(o,uz);var c=this.runWebGLProgram(u,[{dataId:e,shape:o,dtype:r}],r),l=this.readSync(c.dataId);return this.disposeIntermediateTensorInfo(c),l}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var p,f,h=null!=this.activeTimers;(h&&(p=Xa()),"complex64"===r)?f=rm(this.readSync(a.real.dataId),this.readSync(a.imag.dataId)):f=this.getValuesFromTexture(e);return h&&(this.downloadWaitMs+=Xa()-p),this.convertAndCacheOnCPU(e,f)}},{key:"read",value:function(){var e=J(ne().mark((function e(t){var n,r,a,i,o,s,u,c,l,p,f,h,d,m,v,g,y,b,x,k,w,N,I;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pendingRead.has(t)){e.next=3;break}return n=this.pendingRead.get(t),e.abrupt("return",new Promise((function(e){return n.push(e)})));case 3:if(r=this.texData.get(t),a=r.values,i=r.shape,o=r.slice,s=r.dtype,u=r.complexTensorInfos,c=r.isPacked,null==o){e.next=11;break}return l=c?new mz(i,uz):new tz(i,uz),p=this.runWebGLProgram(l,[{dataId:t,shape:i,dtype:s}],s),f=this.read(p.dataId),this.disposeIntermediateTensorInfo(p),e.abrupt("return",f);case 11:if(null==a){e.next=13;break}return e.abrupt("return",this.convertAndCacheOnCPU(t));case 13:if(!it().getBool("DEBUG")){e.next=16;break}if(it().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")||2!==it().getNumber("WEBGL_VERSION")){e.next=16;break}throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");case 16:if(h=null,"complex64"!==s&&it().get("WEBGL_BUFFER_SUPPORTED")&&(d=this.decode(t),v=this.texData.get(d.dataId),h=(m=this.gpgpu).createBufferFromTexture.apply(m,[v.texture.texture].concat(Y(RO(i))))),this.pendingRead.set(t,[]),"complex64"===s){e.next=22;break}return e.next=22,this.gpgpu.createAndWaitForFence();case 22:if("complex64"!==s){e.next=31;break}return e.next=25,Promise.all([this.read(u.real.dataId),this.read(u.imag.dataId)]);case 25:y=e.sent,b=y[0],x=y[1],g=rm(b,x),e.next=32;break;case 31:null==h?g=this.getValuesFromTexture(t):(k=be(i),g=this.gpgpu.downloadFloat32MatrixFromBuffer(h,k));case 32:return null!=d&&this.disposeIntermediateTensorInfo(d),null!=h&&DO(w=this.gpgpu.gl,(function(){return w.deleteBuffer(h)})),N=this.convertAndCacheOnCPU(t,g),I=this.pendingRead.get(t),this.pendingRead.delete(t),I.forEach((function(e){return e(N)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&Ru().removeDataId(t,this),this.pendingDeletes--),e.abrupt("return",N);case 40:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readToGPU",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.texData.get(e),r=n.values,a=n.shape,i=n.slice,o=n.dtype,s=n.isPacked,u=n.texture;if("complex64"===o)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=i){var c;c=s?new mz(a,uz):new tz(a,uz);var l=this.runWebGLProgram(c,[{dataId:e,shape:a,dtype:o}],o),p=this.readToGPU(l,t);return this.disposeIntermediateTensorInfo(l),p}if(null==u)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");var f=this.decode(e,t.customTexShape),h=Ru().makeTensorFromDataId(f.dataId,f.shape,f.dtype),d=this.texData.get(f.dataId);return Object.assign({tensorRef:h},d.texture)}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map((function(e){return Ja(e)}))}catch(r){throw new Error("Failed to decode encoded string bytes into utf-8")}return rs(e.shape,e.dtype,n)}},{key:"checkNumericalProblems",value:function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!OO(n)){if(it().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value ".concat(n," cannot be represented with your ")+"current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value ".concat(n," cannot be represented on this device."))}}}},{key:"getValuesFromTexture",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.isPacked,i=be(n);if(it().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var o,s=this.decode(e),u=this.texData.get(s.dataId),c=(o=this.gpgpu).downloadMatrixFromPackedTexture.apply(o,[u.texture.texture].concat(Y(RO(n)))).subarray(0,i);return this.disposeIntermediateTensorInfo(s),c}var l=it().getBool("WEBGL_PACK")&&!0===a,p=l?JO(n):n,f=l?new HM(p):new GM(p),h=this.runWebGLProgram(f,[{shape:p,dtype:r,dataId:e}],"float32"),d=this.texData.get(h.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture.texture,d.texShape[0],d.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(h),m}},{key:"timerAvailable",value:function(){return it().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}},{key:"time",value:function(e){var t=this,n=this.activeTimers,r=[],a=!1;null==this.programTimersStack?(this.programTimersStack=r,a=!0):this.activeTimers.push(r),this.activeTimers=r,e();var i=ye(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),o=ye(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e}));this.activeTimers=n,a&&(this.programTimersStack=null);var s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return J(ne().mark((function e(){var n;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(it().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=8;break}return e.next=3,Promise.all(i);case 3:n=e.sent,s.kernelMs=fe(n),s.getExtraProfileInfo=function(){return n.map((function(e,t){return{name:o[t],ms:e}})).map((function(e){return"".concat(e.name,": ").concat(e.ms)})).join(", ")},e.next=9;break;case 8:s.kernelMs={error:"WebGL query timers are not supported in this environment."};case 9:return t.uploadWaitMs=0,t.downloadWaitMs=0,e.abrupt("return",s);case 12:case"end":return e.stop()}}),e)})))()}},{key:"memory",value:function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}},{key:"startTimer",value:function(){return it().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Xa(),endMs:null}}},{key:"endTimer",value:function(e){return it().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Xa(),e)}},{key:"getQueryTime",value:function(){var e=J(ne().mark((function e(t){var n;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(it().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=2;break}return e.abrupt("return",this.gpgpu.waitForQueryAndGetTime(t));case 2:return n=t,e.abrupt("return",n.endMs-n.startMs);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);var n=this.texData.get(e),r=n.complexTensorInfos;return null!=r&&(this.disposeData(r.real.dataId,t),this.disposeData(r.imag.dataId,t)),this.texData.delete(e),!0}},{key:"releaseGPUData",value:function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,a=t.texShape,i=t.usage,o=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,i,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}},{key:"getTexture",value:function(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}},{key:"getDataInfo",value:function(e){return this.texData.get(e)}},{key:"shouldExecuteOnCPU",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bz;return it().getBool("WEBGL_CPU_FORWARD")&&e.every((function(e){return null==t.texData.get(e.dataId).texture&&be(e.shape)<n}))}},{key:"getGPGPUContext",value:function(){return this.gpgpu}},{key:"where",value:function(e){ga("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return gz(e.shape,t)}},{key:"packedUnaryOp",value:function(e,t,n){var r=new mz(e.shape,t),a=this.compileAndRun(r,[e],n);return Ru().makeTensorFromDataId(a.dataId,a.shape,a.dtype)}},{key:"abs",value:function(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){var t=FL(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(it().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,az,e.dtype);var n=new tz(e.shape,az),r=this.compileAndRun(n,[e]);return Ru().makeTensorFromDataId(r.dataId,r.shape,r.dtype)}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&Ze(n[0])){var a=n.map((function(e){return Qa(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}},{key:"makeOutput",value:function(e,t,n){var r=this.makeTensorInfo(e,t,n).dataId;return Ru().makeTensorFromDataId(r,e,t,this)}},{key:"unpackTensor",value:function(e){var t=new vz(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}},{key:"packTensor",value:function(e){var t=new XL(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}},{key:"packedReshape",value:function(e,t){var n=[YO(e.shape)].concat(Y(QO(e.shape))),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[YO(t)].concat(Y(QO(t))),i=new YL(a,n),o=[n],s=this.runWebGLProgram(i,[r],e.dtype,o,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}},{key:"decode",value:function(e,t){var n=this.texData.get(e),r=n.isPacked,a=n.shape,i=n.dtype;null!=t&&me(be(a)<=t[0]*t[1]*4,(function(){return"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."}));var o,s=JO(a);o=r?new VM(s):new UM(s);var u=[null!=t?t:RO(s)];return{dtype:i,shape:a,dataId:this.runWebGLProgram(o,[{shape:s,dtype:i,dataId:e}],i,u,!0,t).dataId}}},{key:"runWebGLProgram",value:function(e,t,n,r){var a=this,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0,s=this.makeTensorInfo(e.outputShape,n),u=this.texData.get(s.dataId);if(e.packedOutput&&(u.isPacked=!0),e.outPackingScheme===NO.DENSE){var c=null!=o?o:RO(e.outputShape);u.texShape=c.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(u.usage=e.outTexUsage),0===be(s.shape))return u.values=_e(s.dtype,0),s;var l=[],p=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&be(t.shape)<=it().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(a.uploadToGPU(t.dataId),!!n.isPacked!==!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),l.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!eM(n.shape,t.shape)){var r=t,i=t.shape;t.shape=n.shape,t=a.packedReshape(t,i),l.push(t),n=a.texData.get(t.dataId),r.shape=i}return{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(s.dataId);var f,h={shape:s.shape,texData:u,isUniform:!1},d=BM(e,p,h),m=this.getAndSaveBinary(d,(function(){return LM(a.gpgpu,e,p,h)})),v=null!=this.activeTimers;v&&(f=this.startTimer()),it().get("ENGINE_COMPILE_ONLY")||ZM(this.gpgpu,m,p,h,r),l.forEach((function(e){return a.disposeIntermediateTensorInfo(e)})),v&&(f=this.endTimer(f),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(f)}));var g=it().get("WEBGL_FLUSH_THRESHOLD");if(g>0){var y=Xa();y-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!it().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&!1===i){var b=this.unpackTensor(s);return this.disposeIntermediateTensorInfo(s),b}return s}},{key:"compileAndRun",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];n=n||t[0].dtype;var i=this.runWebGLProgram(e,t,n,r,a);return i}},{key:"getAndSaveBinary",value:function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}},{key:"getTextureManager",value:function(){return this.textureManager}},{key:"dispose",value:function(){var e=this;if(!this.disposed){if(!it().getBool("IS_TEST"))Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]}));this.textureManager.dispose(),null!=this.canvas&&"undefined"!==typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}}},{key:"floatPrecision",value:function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Du((function(){if(!it().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=it().getBool("DEBUG");it().set("DEBUG",!1);var n=e.abs(oc(1e-8)).dataSync()[0];if(it().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"uploadToGPU",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.values,i=t.texture,o=t.usage,s=t.isPacked;if(null==i){var u,c=null!=this.activeTimers;c&&(u=Xa());var l=t.texShape;if(null==l&&(l=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=it().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(n*=2,1===(e=e.map((function(t,n){return n>=e.length-2?le(e[n]):e[n]}))).length&&(e=[2,e[0]])),2!==e.length){var r=Re(e);e=r.newShape}var a=be(e);if(e.length<=1&&a<=n)return[1,a];if(2===e.length&&e[0]<=n&&e[1]<=n)return e;if(3===e.length&&e[0]*e[1]<=n&&e[2]<=n)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=n&&e[1]*e[2]<=n)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n)return[e[0],e[1]*e[2]*e[3]];if(t){var i=YO(e),o=2,s=2;if(e.length){var u=QO(e),c=(0,oe.Z)(u,2);o=c[0],s=c[1]}return Ie(a=i*(o/2)*(s/2)).map((function(e){return 2*e}))}return Ie(a)}(n,s),t.texShape=l),null!=a){var p,f=JO(n),h=l[1],d=l[0],m=a instanceof Uint8Array||a instanceof Uint8ClampedArray;if(s||!m){var v=_O(l[0],l[1]),g=(0,oe.Z)(v,2);h=g[0],d=g[1]}p=s?new qM(f,m):new jM(f,m);var y=m?[d,h]:l,b=this.makeTensorInfo(y,r),x=this.texData.get(b.dataId);x.usage=m?IO.PIXELS:IO.UPLOAD,x.texShape=y,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),h,d,a);var k=[[d,h]],w=this.runWebGLProgram(p,[b],r,k,!0),N=this.texData.get(w.dataId);t.texShape=N.texShape,t.isPacked=N.isPacked,t.usage=N.usage,it().get("ENGINE_COMPILE_ONLY")?this.disposeData(w.dataId):(t.texture=N.texture,t.values=null,this.texData.delete(w.dataId)),this.disposeIntermediateTensorInfo(b),c&&(this.uploadWaitMs+=Xa()-u)}else{var I=this.acquireTexture(l,o,r,s);t.texture=I}}}},{key:"convertAndCacheOnCPU",value:function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype ".concat(t))}(t,r)),n.values}},{key:"acquireTexture",value:function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(a," MB, ")+"most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)}},{key:"computeBytes",value:function(e,t){return e[0]*e[1]*ze(t)}},{key:"checkCompileCompletion",value:function(){for(var e=0,t=Object.entries(this.binaryCache);e<t.length;e++){var n=(0,oe.Z)(t[e],2)[1];this.checkCompletion_(n)}}},{key:"checkCompileCompletionAsync",value:function(){var e=J(ne().mark((function e(){var t,n,r,a,i,o,s,u,c=this;return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],!this.gpgpu.parallelCompilationExtension){e.next=6;break}for(n=0,r=Object.entries(this.binaryCache);n<r.length;n++)a=(0,oe.Z)(r[n],2),i=a[1],t.push(this.checkCompletionAsync_(i));return e.abrupt("return",Promise.all(t));case 6:for(o=function(){var e=(0,oe.Z)(u[s],2)[1],n=new Promise((function(t){try{c.checkCompletion_(e),t(!0)}catch(n){throw n}}));t.push(n)},s=0,u=Object.entries(this.binaryCache);s<u.length;s++)o();return e.abrupt("return",Promise.all(t));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkCompletionAsync_",value:function(){var e=J(ne().mark((function e(t){return ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)){e.next=4;break}return e.abrupt("return",this.checkCompletion_(t));case 4:return e.next=6,Pd();case 6:return e.abrupt("return",this.checkCompletionAsync_(t));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkCompletion_",value:function(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw ZO(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.");throw new Error("Failed to link vertex and fragment shaders.")}return!0}},{key:"getUniformLocations",value:function(){for(var e=0,t=Object.entries(this.binaryCache);e<t.length;e++){var n=(0,oe.Z)(t[e],2)[1],r=zM(this.gpgpu,n.program,n.webGLProgram),a=r.uniformLocations,i=r.customUniformLocations,o=r.infLoc,s=r.nanLoc,u=r.inShapesLocations,c=r.inTexShapesLocations,l=r.outShapeLocation,p=r.outShapeStridesLocation,f=r.outTexShapeLocation;n.uniformLocations=a,n.customUniformLocations=i,n.infLoc=o,n.nanLoc=s,n.inShapesLocations=u,n.inTexShapesLocations=c,n.outShapeLocation=l,n.outShapeStridesLocation=p,n.outTexShapeLocation=f}}}]),n}(ae);xz.nextDataId=0;Zi()&&Vu("webgl",(function(){return new xz}),2);var kz=(0,ee.Z)((function e(t,n,r){(0,$.Z)(this,e),this.variableNames=["A","B"],this.outputShape=Os(n,r),this.enableShapeUniforms=WM(this.outputShape.length),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")})),wz=(0,ee.Z)((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];(0,$.Z)(this,e),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Os(n,r);var i=this.outputShape.length;this.enableShapeUniforms=WM(i);var o="";if(a)if(0===i||1===be(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else{var s=FM(i);if(o="\n          ".concat(s," coords = getOutputCoords();\n        "),1===i)this.enableShapeUniforms?o+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":o+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{var u=KL("coords",i);this.enableShapeUniforms?o+="\n            bool nextRowOutOfBounds =\n              (".concat(u[i-2]," + 1) >= outShape[").concat(i," - 2];\n            bool nextColOutOfBounds =\n              (").concat(u[i-1]," + 1) >= outShape[").concat(i," - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "):o+="\n            bool nextRowOutOfBounds =\n              (".concat(u[i-2]," + 1) >= ").concat(this.outputShape[i-2],";\n            bool nextColOutOfBounds =\n              (").concat(u[i-1]," + 1) >= ").concat(this.outputShape[i-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(o,"\n\n        setOutput(result);\n      }\n    ")}));function Nz(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var Iz={kernelName:Sn,backendName:"webgl",kernelFunc:Nz};function Sz(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(i.dataId),s=Nz({inputs:{x:r},backend:n}),u=Nz({inputs:{x:a},backend:n});return o.complexTensorInfos={real:s,imag:u},i}var Tz={kernelName:Lt,backendName:"webgl",kernelFunc:Sz},Cz="return (a < 0.) ? b * a : a;",Ez="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var Az={kernelName:_n,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha,o=n.makeTensorInfo([],"float32",qa(i,"float32")),s=it().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new wz(Ez,a.shape,o.shape):new kz(Cz,a.shape,o.shape),u=n.runWebGLProgram(s,[a,o],"float32");return n.disposeIntermediateTensorInfo(o),u}},Rz="return (a < 0.) ? b * a : a;",_z="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var Fz={kernelName:dr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,i=it().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new wz(_z,r.shape,a.shape):new kz(Rz,r.shape,a.shape);return n.runWebGLProgram(i,[r,a],"float32")}};function Dz(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.cpuKernelImpl,a=e.dtype;return function(e){var i,o=e.inputs,s=e.backend,u=o.x,c=s,l=a||u.dtype;if(c.shouldExecuteOnCPU([u])&&null!=r){var p=c.texData.get(u.dataId),f=r(p.values,l);return c.makeTensorInfo(u.shape,l,f)}return i=it().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=n?new mz(u.shape,n):new tz(u.shape,t),c.runWebGLProgram(i,[u],l)}}function Oz(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.checkOutOfBounds,a=void 0!==r&&r,i=e.supportsComplex,o=void 0!==i&&i,s=e.cpuKernelImpl,u=e.dtype;return function(e){var r=e.inputs,i=e.backend,c=r.a,l=r.b,p=i;if(o&&"complex64"===c.dtype){var f=p.texData.get(c.dataId),h=p.texData.get(l.dataId),d=[[f.complexTensorInfos.real,h.complexTensorInfos.real],[f.complexTensorInfos.imag,h.complexTensorInfos.imag]].map((function(e){var n=(0,oe.Z)(e,2),r=n[0],a=n[1],i={dataId:r.dataId,dtype:r.dtype,shape:c.shape},o={dataId:a.dataId,dtype:a.dtype,shape:l.shape},s=new kz(t,c.shape,l.shape);return p.runWebGLProgram(s,[i,o],wi(r.dtype,a.dtype))})),m=(0,oe.Z)(d,2),v=m[0],g=m[1],y=Sz({inputs:{real:v,imag:g},backend:p});return p.disposeIntermediateTensorInfo(v),p.disposeIntermediateTensorInfo(g),y}var b,x=u||wi(c.dtype,l.dtype);if(("string"===c.dtype||"string"===l.dtype||p.shouldExecuteOnCPU([c,l]))&&null!=s){var k=p.texData.get(c.dataId).values,w=p.texData.get(l.dataId).values,N="string"===c.dtype?Mm(k):k,I="string"===c.dtype?Mm(w):w,S=s(c.shape,l.shape,N,I,x),T=(0,oe.Z)(S,2),C=T[0],E=T[1],A=p.makeTensorInfo(E,x);return p.texData.get(A.dataId).values=C,A}return b=it().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=n?new wz(n,c.shape,l.shape,a):new kz(t,c.shape,l.shape),p.runWebGLProgram(b,[c,l],x)}}function Mz(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return t?lz:rz;if("relu"===e)return t?fz:oz;if("elu"===e)return t?pz:iz;if("relu6"===e)return t?hz:sz;if("prelu"===e)return t?_z:Rz;if("leakyrelu"===e)return t?Ez:Cz;if("sigmoid"===e)return t?dz:cz;throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}var Lz=(0,ee.Z)((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8];(0,$.Z)(this,e),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=WM(this.outputShape.length);var l=a?t[1]:t[2],p=Math.ceil(l/2),f=a?"i * 2, rc.y":"rc.y, i * 2",h=i?"rc.z, i * 2":"i * 2, rc.z",d=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],v="",g="";s&&(v=u?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(s,"\n        }"):c?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(s,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(s,"\n        }"),g="result = activation(result);");var y=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");var b="rc.x",x="rc.x";t[0]<n[0]?b="int(min(float(rc.x), ".concat(t[0]-1,".))"):n[0]<t[0]&&(x="int(min(float(rc.x), ".concat(n[0]-1,".))")),this.userCode="\n      ".concat(v,"\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ").concat(p,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ").concat(p,"; i++) {\n          int batchA = ").concat(b,";\n          int batchB = ").concat(x,";\n          vec4 a = getMatrixA(batchA, ").concat(f,");\n          vec4 b = getMatrixB(batchB, ").concat(h,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(d[0]," * ").concat(m[0],");\n          result += (").concat(d[1]," * ").concat(m[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(y,"\n\n        ").concat(g,"\n\n        setOutput(result);\n      }\n    ")})),zz="return areal * breal - aimag * bimag;",Pz="return areal * bimag + aimag * breal;",Zz=(0,ee.Z)((function e(t,n,r){(0,$.Z)(this,e),this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Os(n,r),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")})),Bz="return a * b;";function Wz(e){var t,n=e.inputs,r=e.backend,a=n.a,i=n.b,o=wi(a.dtype,i.dtype);if("complex64"===a.dtype){var s=r.texData.get(a.dataId),u=r.texData.get(i.dataId),c=new Zz(zz,a.shape,i.shape),l=new Zz(Pz,a.shape,i.shape),p=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:a.shape},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:a.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:i.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:i.shape}],f=r.runWebGLProgram(c,p,"float32"),h=r.runWebGLProgram(l,p,"float32"),d=Sz({inputs:{real:f,imag:h},backend:r});return r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(h),d}if(r.shouldExecuteOnCPU([a,i])){var m=r.texData.get(a.dataId),v=r.texData.get(i.dataId),g=SL(a.shape,i.shape,m.values,v.values,o),y=(0,oe.Z)(g,2),b=y[0],x=y[1],k=r.makeTensorInfo(x,o);return r.texData.get(k.dataId).values=b,k}return t=it().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new wz(Bz,a.shape,i.shape):new kz(Bz,a.shape,i.shape),r.runWebGLProgram(t,[a,i],o)}var Uz={kernelName:nr,backendName:"webgl",kernelFunc:Wz};function Vz(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=n,s=be(a.shape),u=Ee(i,s),c=be(u);me(s===c,(function(){return"The new shape (".concat(u,") has ").concat(c," elements and the old ")+"shape (".concat(a.shape,") has ").concat(s," elements. The new shape and old ")+"shape must have the same number of elements."}));var l=o.texData.get(a.dataId);return!l.isPacked||eM(a.shape,u)||null!==l.texture&&eM(l.shape,u)?(o.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype}):function(e,t,n){var r=[YO(e.shape)].concat(Y(QO(e.shape))),a={dtype:e.dtype,shape:r,dataId:e.dataId},i=[YO(t)].concat(Y(QO(t))),o=new YL(i,r),s=[r],u=n.runWebGLProgram(o,[a],e.dtype,s,!0);return{dataId:u.dataId,shape:t,dtype:u.dtype}}(a,u,o)}var Gz={kernelName:xr,backendName:"webgl",kernelFunc:Vz},Hz=(0,ee.Z)((function e(t,n){(0,$.Z)(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s=4*Math.floor(r/4),u=r%4,c="sumValue += dot(values, ones);";if(null!=n){var l=1/n;c="sumValue += dot(values * ".concat(we(l)?l.toPrecision(2):l,", ones);")}var p="";i%r>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(p,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(s,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(c,"\n        }\n\n        int inIdx = inOffset + ").concat(s,";\n        if (").concat(1===u,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(2===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(3===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(c,"\n        }\n        setOutput(sumValue);\n      }\n    ")})),jz=(0,ee.Z)((function e(t,n){(0,$.Z)(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s="0.0",u="";"prod"===n?s="1.0":"min"===n?(s="1.0 / 1e-20",u="min"):"max"===n&&(s="-1.0 / 1e-20",u="max");var c="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===n?c="sumValue":"prod"===n?c="prodValue":"all"===n?c="allValue":"any"===n&&(c="anyValue");var l=4*Math.floor(r/4),p=r%4,f="\n      if (".concat("sum"===n,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===n,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(u,"(values, minMaxValue);\n        if (").concat("min"===n," || ").concat("max"===n,") {\n          minMaxValue = ").concat(u,"(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    "),h="vec4";"all"===n?(s="1.0",f="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",h="bvec4"):"any"===n&&(s="0.0",f="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",h="bvec4");var d="";i%r>0&&(d="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(s,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(d,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        vec4 minMaxValue = vec4(").concat(s,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(l,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(h," values = ").concat(h,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(f,"\n        }\n\n        int inIdx = inOffset + ").concat(l,";\n        if (").concat(1===p,") {\n          ").concat(h," values = ").concat(h,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(f,"\n        } else if (").concat(2===p,") {\n          ").concat(h," values = ").concat(h,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(f,"\n        } else if (").concat(3===p,") {\n          ").concat(h," values = ").concat(h,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(f,"\n        }\n        setOutput(").concat(c,");\n      }\n    ")}));function qz(e,t,n,r){for(var a=function(e){for(var t=[];0===t.length||1!==t[t.length-1].outSize;){var n=t.length?t[t.length-1].outSize:e[1],r=Ud(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape),i=e,o=0;o<a.length;o++){var s,u=a[o],c=u.inSize,l=u.windowSize,p=u.outSize,f=void 0;f="mean"===n?0===o?new Hz({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:p},c):new Hz({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:p}):new jz({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:p},n),s=i,i=r.runWebGLProgram(f,[i],t),s.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(s)}return i}var Kz=(0,ee.Z)((function e(t,n){(0,$.Z)(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];this.outputShape=r,this.rank=r.length;var i=FM(this.rank),o=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(n);this.userCode="\n    void main() {\n      ".concat(i," resRC = getOutputCoords();\n      setOutput(getA(").concat(o,"));\n    }\n    ")}));var Xz=(0,ee.Z)((function e(t,n){(0,$.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=FM(this.rank),o=qL("rc",this.rank),s=new Array(this.rank),u=0;u<n.length;u++)s[n[u]]=o[u];var c="vec2(".concat(s.slice(-2).join(),")"),l="++".concat(o[this.rank-1]," < ").concat(r[this.rank-1]),p="getChannel(getA(".concat(s.join(),"), ").concat(c,")");this.userCode="\n    void main() {\n      ".concat(i," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(p,";\n      if(").concat(l,") {\n        result[1] = ").concat(p,";\n      }\n      --").concat(o[this.rank-1],";\n      if(++").concat(o[this.rank-2]," < ").concat(r[this.rank-2],") {\n        result[2] = ").concat(p,";\n        if(").concat(l,") {\n          result[3] = ").concat(p,";\n        }\n      }\n      setOutput(result);\n    }\n    ")}));function Yz(e,t,n){var r=it().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Xz(e.shape,t):new Kz(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function Qz(e){var t=e.inputs,n=e.backend,r=e.attrs;return function(e,t,n,r){var a=t,i=e.shape.length,o=Ae(a,e.shape),s=o,u=gp(s,i),c=null!=u,l=e;c&&(l=Yz(e,u,r),s=bp(s.length,i)),vp("sum",s,i);var p=dp(l.shape,s),f=(0,oe.Z)(p,2),h=f[0],d=f[1],m=h;n&&(m=mp(h,o));var v=be(d),g=Vz({inputs:{x:l},attrs:{shape:[be(e.shape)/v,v]},backend:r}),y=qz(g,Ni(e.dtype),"sum",r),b=Vz({inputs:{x:y},attrs:{shape:m},backend:r});return r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(y),c&&r.disposeIntermediateTensorInfo(l),b}(t.x,r.axis,r.keepDims,n)}var Jz={kernelName:Zr,backendName:"webgl",kernelFunc:Qz};function $z(e){for(var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.perm,s=r,u=i.shape.length,c=new Array(u),l=0;l<c.length;l++)c[l]=i.shape[o[l]];if(s.shouldExecuteOnCPU([i])){var p=s.texData.get(i.dataId).values,f=HL(p,i.shape,i.dtype,o,c);t=s.makeTensorInfo(c,i.dtype),s.texData.get(t.dataId).values=f}else t=Yz(i,o,s);return t}var eP={kernelName:oa,backendName:"webgl",kernelFunc:$z};function tP(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,p=void 0===l?0:l,f=e.activation,h=void 0===f?null:f,d=t.shape.length,m=n.shape.length,v=r?t.shape[d-2]:t.shape[d-1],g=a?n.shape[m-1]:n.shape[m-2],y=r?t.shape[d-1]:t.shape[d-2],b=a?n.shape[m-2]:n.shape[m-1],x=t.shape.slice(0,-2),k=n.shape.slice(0,-2),w=be(x),N=be(k),I=Os(t.shape.slice(0,-2),n.shape.slice(0,-2)).concat([y,b]);me(v===g,(function(){return"Error in matMul: inner shapes (".concat(v,") and (")+"".concat(g,") of Tensors with shapes ").concat(t.shape," and ")+"".concat(n.shape," and transposeA=").concat(r)+" and transposeB=".concat(a," must match.")}));var S,T=r?[w,v,y]:[w,y,v],C=a?[N,b,g]:[N,g,b],E=Vz({inputs:{x:t},backend:i,attrs:{shape:T}}),A=Vz({inputs:{x:n},backend:i,attrs:{shape:C}}),R=[E,A],_=Math.max(w,N),F=r?E.shape[1]:E.shape[2],D=null!=s,O=null!=c,M="leakyrelu"===h,L=null!=h?Mz(h,!0):null;if((1===y||1===b)&&F>1e3&&!1===(D||O||M||null!=L)){var z=E,P=A;r&&(z=$z({inputs:{x:E},backend:i,attrs:{perm:[0,2,1]}}),R.push(z)),a&&(P=$z({inputs:{x:A},backend:i,attrs:{perm:[0,2,1]}}),R.push(P));var Z=1===b,B=z;1!==b&&(B=Vz({inputs:{x:z},backend:i,attrs:{shape:[_,F,1]}}),R.push(B));var W=1===b?2:1,U=P;Z&&(U=Vz({inputs:{x:P},backend:i,attrs:{shape:[_,1,F]}}),R.push(U));var V=Wz({inputs:{a:B,b:U},backend:i});S=Qz({inputs:{x:V},backend:i,attrs:{axis:W,keepDims:!0}}),R.push(V)}else{var G=wi(t.dtype,n.dtype),H=new Lz(T,C,[_,y,b],r,a,D,L,O,M),j=[E,A];if(null!=s&&j.push(s),O&&j.push(c),M){var q=i.makeTensorInfo([],"float32",qa(p,"float32"));j.push(q),R.push(q)}S=i.runWebGLProgram(H,j,G)}var K=Vz({inputs:{x:S},backend:i,attrs:{shape:I}});R.push(S);for(var X=0,Y=R;X<Y.length;X++){var Q=Y[X];i.disposeIntermediateTensorInfo(Q)}return K}var nP={kernelName:da,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=t.bias,s=t.preluActivationWeights,u=r.transposeA,c=r.transposeB,l=r.activation;return tP({a:a,b:i,transposeA:u,transposeB:c,backend:n,bias:o,preluActivationWeights:s,leakyreluAlpha:r.leakyreluAlpha,activation:l})}},rP="return abs(x);";var aP={kernelName:lt,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])&&"complex64"!==a.dtype){var i=r.texData.get(a.dataId),o=FL(i.values);return r.makeTensorInfo(a.shape,a.dtype,o)}return t=it().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new mz(a.shape,rP):new tz(a.shape,rP),r.runWebGLProgram(t,[a],a.dtype)}},iP=Dz({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),oP={kernelName:pt,backendName:"webgl",kernelFunc:iP},sP=Dz({opSnippet:"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),uP={kernelName:ft,backendName:"webgl",kernelFunc:sP},cP="return a + b;",lP=Oz({opSnippet:cP,packedOpSnippet:cP,supportsComplex:!0,cpuKernelImpl:iL}),pP={kernelName:ht,backendName:"webgl",kernelFunc:lP},fP=(0,ee.Z)((function e(t,n){(0,$.Z)(this,e),this.outputShape=[],this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        float result = ").concat(a,";\n        setOutput(result);\n      }\n    ")})),hP=(0,ee.Z)((function e(t,n){(0,$.Z)(this,e),this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        vec4 result = ").concat(a,";\n        setOutput(result);\n      }\n    ")}));var dP={kernelName:dt,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n;if(1===a.length)return Nz({inputs:{x:a[0]},backend:r});if(a.length>it().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(a.length/2),o=e({inputs:a.slice(0,i),backend:r}),s=e({inputs:a.slice(i),backend:r});return e({inputs:[o,s],backend:r})}var u=a.map((function(e){return e.dtype})).reduce((function(e,t){return wi(e,t)})),c=a.map((function(e){return e.shape})),l=it().getBool("WEBGL_PACK")?new hP(a[0].shape,c):new fP(a[0].shape,c);return r.runWebGLProgram(l,a,u)}};var mP={kernelName:mt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=Ae(i,a.shape),c=u,l=gp(c,s),p=a;null!=l&&(p=$z({inputs:{x:a},backend:n,attrs:{perm:l}}),c=bp(c.length,s)),vp("all",c,s);var f,h=dp(p.shape,c),d=(0,oe.Z)(h,2),m=d[0],v=Vz({inputs:{x:p},backend:n,attrs:{shape:[-1,be(d[1])]}}),g=qz(v,v.dtype,"all",n);return f=Vz(o?{inputs:{x:g},backend:n,attrs:{shape:mp(m,u)}}:{inputs:{x:g},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),null!=l&&n.disposeIntermediateTensorInfo(p),f}};var vP={kernelName:vt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=Ae(i,a.shape),c=u,l=gp(c,s),p=a;null!=l&&(p=$z({inputs:{x:a},backend:n,attrs:{perm:l}}),c=bp(c.length,s)),vp("any",c,s);var f,h=dp(p.shape,c),d=(0,oe.Z)(h,2),m=d[0],v=Vz({inputs:{x:p},backend:n,attrs:{shape:[-1,be(d[1])]}}),g=qz(v,v.dtype,"any",n);return f=Vz(o?{inputs:{x:g},backend:n,attrs:{shape:mp(m,u)}}:{inputs:{x:g},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),null!=l&&n.disposeIntermediateTensorInfo(p),f}},gP=(0,ee.Z)((function e(t,n,r){(0,$.Z)(this,e),this.variableNames=["A"];var a=t.windowSize,i=t.batchSize,o=t.outSize;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s="max"===n?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(a,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          int inIdx = ").concat(u,";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat(s," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")})),yP=(0,ee.Z)((function e(t,n,r,a){(0,$.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,me(t.length>2,(function(){return"Packed arg".concat(r.charAt(0).toUpperCase()+r.slice(1)," supports only inputs with rank above 2.")}));var i=t[t.length-1],o=Math.ceil(i/n);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),a||this.variableNames.push("bestIndicesA");var s,u,c=this.outputShape,l=c.length,p=FM(l),f=KL("coords",l);if(1===o){var h=FM(u=l+1);s="\n        ".concat(h," sourceLocR = ").concat(h,"(").concat(f.join(),", 0);\n        ++").concat(f[l-1],";\n        ").concat(h," sourceLocG = ").concat(h,"(").concat(f.join(),", 0);\n        ++").concat(f[l-2],";\n        ").concat(h," sourceLocA = ").concat(h,"(").concat(f.join(),", 0);\n        --").concat(f[l-1],";\n        ").concat(h," sourceLocB = ").concat(h,"(").concat(f.join(),", 0);\n        --").concat(f[l-2],";")}else u=l,s="\n        ".concat(p," sourceLocR = coords;\n        ++").concat(f[l-1],";\n        ").concat(p," sourceLocG = coords;\n        ++").concat(f[l-2],";\n        ").concat(p," sourceLocA = coords;\n        --").concat(f[l-1],";\n        ").concat(p," sourceLocB = coords;\n        --").concat(f[l-2],";");var d=["x","y","z","w","u","v"].slice(0,u),m="."+d[u-1],v=d.map((function(e){return"int "+e})),g=KL("sourceLocR",u-1).concat("inIdx.r"),y=KL("sourceLocG",u-1).concat("inIdx.g"),b=KL("sourceLocB",u-1).concat("inIdx.b"),x=KL("sourceLocA",u-1).concat("inIdx.a"),k="max"===r?"greaterThan":"lessThan",w=a?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(g.join(),"),\n                             getBestIndicesAChannel(").concat(y.join(),"),\n                             getBestIndicesAChannel(").concat(b.join(),"),\n                             getBestIndicesAChannel(").concat(x.join(),")));"),N="vec4(\n            getAChannel(".concat(g.join(),"),\n            hasNextCol ? getAChannel(").concat(y.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(b.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(x.join(),") : 0.)"),I=a?"":"\n      float getBestIndicesAChannel(".concat(v.join(),") {\n        return getChannel(getBestIndicesA(").concat(d.join(),"),\n                                          vec2(").concat(d.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(v.join(),") {\n        return getChannel(getA(").concat(d.join(),"),\n                               vec2(").concat(d.slice(-2).join(),"));\n      }\n      ").concat(I,"\n      void main() {\n        ").concat(p," coords = getOutputCoords();\n        bool hasNextCol = ").concat(f[l-1]," < ").concat(c[l-1]-1,";\n        bool hasNextRow = ").concat(f[l-2]," < ").concat(c[l-2]-1,";\n        ").concat(s,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(m,", sourceLocG").concat(m,",\n          sourceLocB").concat(m,", sourceLocA").concat(m,") * ").concat(n,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(N,";\n\n        for (int i = 0; i < ").concat(n,"; i++) {\n          inIdx = srcIdx;\n          ").concat(w,"\n          vec4 candidate = ").concat(N,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(k,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")}));function bP(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=t.shape[0],i=t.shape[1];null!=r&&(a=r.shape[0],i=r.shape[1]);var o=Ud(i),s={windowSize:o,inSize:i,batchSize:a,outSize:Math.ceil(i/o)},u=new gP(s,n,null==r),c=[t];null!=r&&c.push(r);var l=e.runWebGLProgram(u,c,"int32");if(1===l.shape[1])return l;var p=bP(e,t,n,l);return e.disposeIntermediateTensorInfo(l),p}function xP(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=null!=r?r.shape:t.shape,i=a[a.length-1],o=Ud(i),s=new yP(a,o,n,null==r),u=null==r?[t]:[t,r],c=e.runWebGLProgram(s,u,"int32");if(c.shape.length===t.shape.length){var l=xP(e,t,n,c);return e.disposeIntermediateTensorInfo(c),l}return c}function kP(e,t,n,r){var a=[n];if(vp("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!it().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){var i=[],o=e.texData.get(t.dataId),s=t;null!==o&&o.isPacked&&(s=e.unpackTensor(t),i.push(s));var u=dp(s.shape,a),c=(0,oe.Z)(u,2),l=c[0],p=be(c[1]),f=Vz({inputs:{x:s},backend:e,attrs:{shape:[-1,p]}});i.push(f);var h=bP(e,f,r);i.push(h);var d=Vz({inputs:{x:h},backend:e,attrs:{shape:l}});return i.forEach((function(t){return e.disposeIntermediateTensorInfo(t)})),d}return xP(e,t,r)}var wP={kernelName:gt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=Ae(r.axis,a.shape),o=gp(i,a.shape.length),s=a,u=[];null!=o&&(s=$z({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(s),i=bp(i.length,s.shape.length)),vp("argMax",[i[0]],s.shape.length);var c=kP(n,s,i[0],"max");return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c}};var NP={kernelName:yt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=Ae(r.axis,a.shape),o=gp(i,a.shape.length),s=a,u=[];null!=o&&(s=$z({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(s),i=bp(i.length,s.shape.length)),vp("argMin",[i[0]],s.shape.length);var c=kP(n,s,i[0],"min");return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c}},IP=Dz({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),SP={kernelName:bt,backendName:"webgl",kernelFunc:IP},TP=Dz({opSnippet:"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));"}),CP={kernelName:xt,backendName:"webgl",kernelFunc:TP},EP=Dz({opSnippet:"if (isnan(x)) return x;\n  return atan(x);\n"}),AP={kernelName:kt,backendName:"webgl",kernelFunc:EP},RP=Oz({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),_P={kernelName:Nt,backendName:"webgl",kernelFunc:RP},FP=Dz({opSnippet:"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),DP={kernelName:wt,backendName:"webgl",kernelFunc:FP},OP=(0,ee.Z)((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if((0,$.Z)(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,l=t.dilationWidth,p=t.effectiveFilterHeight,f=t.effectiveFilterWidth,h=t.padInfo.top,d=t.padInfo.left;this.outputShape=t.outShape;var m="avg"===n,v="((batch  * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),g="(xR * ".concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),y="0.0";if(m||(y="-1.0 / 1e-20"),r){var b=">=";this.userCode="\n        const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n        const ivec2 pads = ivec2(").concat(h,", ").concat(d,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(p,";\n              wR += ").concat(c,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(f,";\n                wC += ").concat(l,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ").concat(b," currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(a?i?v:g:"wR * ".concat(f," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var x="max",k="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(k="avgValue / count");var w=4*Math.floor(o/4),N=o%4,I="\n      if (".concat(m,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat(x,"(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(h,", ").concat(d,");\n      const float initializationValue = ").concat(y,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(y,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(p,";\n            wR += ").concat(c,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(w,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              getValue(batch, xR, xC + 3 * ").concat(l,", d)\n            );\n\n            ").concat(I,"\n          }\n\n          int xC = xCCorner + ").concat(w,";\n          if (").concat(1===N,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(I,"\n          } else if (").concat(2===N,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(I,"\n          } else if (").concat(3===N,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              initializationValue\n            );\n\n            ").concat(I,"\n          }\n        }\n        setOutput(").concat(k,");\n      }\n    ")}})),MP=(0,ee.Z)((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if((0,$.Z)(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideDepth,u=t.strideHeight,c=t.strideWidth,l=t.dilationDepth,p=t.dilationHeight,f=t.dilationWidth,h=t.effectiveFilterDepth,d=t.effectiveFilterHeight,m=t.effectiveFilterWidth,v=t.padInfo.front,g=t.padInfo.top,y=t.padInfo.left;this.outputShape=t.outShape;var b="avg"===n,x="0.0";if(b||(x="-1.0 / 1e-20"),r){var k=">=";this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n        const ivec3 pads = ivec3(").concat(v,", ").concat(g,", ").concat(y,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(h,";\n              wD += ").concat(l,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(d,";\n                wR += ").concat(p,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(m,";\n                  wC += ").concat(f,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ").concat(k," currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(a?i?"(((batch * ".concat(t.inDepth," + xD) * ").concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"((xD * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"wD * ".concat(d," * ").concat(m," +\n                      wR * ").concat(m," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var w="max",N="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(N="avgValue / count");var I=4*Math.floor(o/4),S=o%4,T="\n      if (".concat(b,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat(w,"(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n      const ivec3 pads = ivec3(").concat(v,", ").concat(g,", ").concat(y,");\n      const float initializationValue = ").concat(x,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(x,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(h,";\n            wD += ").concat(l,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(d,";\n            wR += ").concat(p,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(I,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(f,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(f,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(f,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(f,", ch)\n              );\n\n              ").concat(T,"\n            }\n\n            int xC = xCCorner + ").concat(I,";\n            if (").concat(1===S,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(T,"\n            } else if (").concat(2===S,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(f,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(T,"\n            } else if (").concat(3===S,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(f,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(f,", ch),\n                initializationValue\n              );\n\n              ").concat(T,"\n            }\n          }\n          setOutput(").concat(N,");\n        }\n      }\n    ")}}));var LP={kernelName:It,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;iM(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;me(jc(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var c=Oc(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&ke(c.inShape,c.outShape))return Nz({inputs:{x:a},backend:n});var l=new OP(c,"avg",!1);return n.runWebGLProgram(l,[a],"float32")}};var zP={kernelName:Tt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat,l=Mc(a.shape,i,o,[1,1,1],s,u,c),p=new MP(l,"avg",!1);return n.runWebGLProgram(p,[a],"float32")}},PP=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=u-1-t.padInfo.top,p=c-1-t.padInfo.left,f=1/(n*r);this.userCode="\n      const ivec2 pads = ivec2(".concat(l,", ").concat(p,");\n      const float avgMultiplier = float(").concat(f,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(u,";\n            wR += ").concat(o,") {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(c,";\n            wC+= ").concat(s,") {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),ZP=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,p=t.effectiveFilterDepth,f=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=p-1-t.padInfo.front,m=f-1-t.padInfo.top,v=h-1-t.padInfo.left,g=1/(n*r*a);this.userCode="\n      const ivec3 pads = ivec3(".concat(d,", ").concat(m,", ").concat(v,");\n      const float avgMultiplier = float(").concat(g,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(p,";\n            wD += ").concat(u,") {\n          float dyD = float(dyDCorner + wD) / ").concat(i,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(f,";\n              wR += ").concat(c,") {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(h,";\n                wC += ").concat(l,") {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var BP={kernelName:Ct,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=Mc(i.shape,o,s,[1,1,1],u,c),p=new ZP(l);return n.runWebGLProgram(p,[a],i.dtype)}};var WP={kernelName:St,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;iM([a,i],"avgPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=Oc(o.shape,s,u,1,c),p=new PP(l);return n.runWebGLProgram(p,[a],o.dtype)}};var UP={kernelName:Et,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;return tP({a:t.a,b:t.b,transposeA:r.transposeA,transposeB:r.transposeB,backend:n})}},VP=(0,ee.Z)((function e(t,n,r,a,i,o){(0,$.Z)(this,e),this.outputShape=[],this.variableNames=["x","mean","variance"],Os(t,n),Os(t,r);var s="0.0";null!=a&&(Os(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";null!=i&&(Os(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(s,";\n        float scale = ").concat(u,";\n        float inv = scale * inversesqrt(variance + float(").concat(o,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")})),GP=(0,ee.Z)((function e(t,n,r,a,i,o){(0,$.Z)(this,e),this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Os(t,n),Os(t,r);var s="vec4(0.0)";null!=a&&(Os(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";null!=i&&(Os(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = ".concat(s,";\n        vec4 scale = ").concat(u,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(o,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")})),HP={kernelName:xn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.mean,o=t.variance,s=t.offset,u=t.scale;me(i.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),me(null==s||i.shape.length===s.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),me(null==u||i.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var c=r.varianceEpsilon;null==c&&(c=.001);var l=[a,i,o],p=null;null!=s&&(p=s.shape,l.push(s));var f=null;null!=u&&(f=u.shape,l.push(u));var h=it().getBool("WEBGL_PACK_NORMALIZATION")?new GP(a.shape,i.shape,o.shape,p,f,c):new VP(a.shape,i.shape,o.shape,p,f,c);return n.runWebGLProgram(h,l,l[0].dtype)}},jP=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n=FM(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var r,a=function(e){if(1===e)return"sourceLoc";if(e<=6)return qP.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank),i=t.map((function(e,t){return"sourceLoc.".concat(qP[t]," = start[").concat(t,"] + coords.").concat(qP[t],";")}));r="\n        ".concat(n," sourceLoc;\n        ").concat(n," coords = getOutputCoords();\n        ").concat(i.join("\n"),"\n      "),this.userCode="\n      void main() {\n        ".concat(r,"\n        setOutput(getSource(").concat(a,"));\n      }\n    ")})),qP=["x","y","z","w","u","v"];var KP=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var n=FM(this.rank),r=KL("coords",this.rank),a=KL("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s="\n      result.x = ".concat(o,";\n      if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n        ++").concat(a[this.rank-1],";\n        result.y = ").concat(o,";\n        --").concat(a[this.rank-1],";\n      }\n    "),u=1===this.rank?"":"\n      --".concat(r[this.rank-1],";\n      if (++").concat(r[this.rank-2]," < ").concat(t[this.rank-2],") {\n        ++").concat(a[this.rank-2],";\n        result.z = ").concat(o,";\n        if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n          ++").concat(a[this.rank-1],";\n          result.w = ").concat(o,";\n        }\n      }\n    "),c=this.rank<=4?"sourceLoc = coords +\n            ".concat(n,"(").concat(t.map((function(e,t){return"start[".concat(t,"]")})).join(),");"):t.map((function(e,t){return"".concat(a[t]," = ").concat(r[t]," + start[").concat(t,"];")})).join("\n");this.userCode="\n      void main() {\n        ".concat(n," coords = getOutputCoords();\n        ").concat(n," sourceLoc;\n        ").concat(c,"\n        vec4 result = vec4(0.);\n        ").concat(s,"\n        ").concat(u,"\n        setOutput(result);\n      }\n    ")}));function XP(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=su(a,r.begin,r.size),o=(0,oe.Z)(i,2),s=o[0],u=o[1];if(qs(a,s,u),0===be(u))return n.makeTensorInfo(u,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||"string"===a.dtype){var c=n.texData.get(a.dataId),l=DL(c.values,s,u,a.shape,a.dtype);return n.makeTensorInfo(u,a.dtype,l)}var p=n.texData.get(a.dataId).isPacked,f=iu(a.shape,s,u);if(p||!f){var h=it().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new KP(u):new jP(u),d=[s];return n.runWebGLProgram(h,[a],a.dtype,d)}return n.uploadToGPU(a.dataId),function(e,t,n,r){var a=r.texData.get(e.dataId),i=r.makeTensorInfo(n,e.dtype),o=r.texData.get(i.dataId);Object.assign(o,a),o.refCount=1,o.shape=n,o.dtype=e.dtype;var s=ou(t,He(e.shape));a.slice&&(s+=a.slice.flatOffset),o.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||e.dataId};var u=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,u+1),i}(a,s,u,n)}var YP={kernelName:Fr,backendName:"webgl",kernelFunc:XP},QP={kernelName:At,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;me(a.shape.length<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=Gd(a.shape,i,s),c=Hd(u.length,i.length),l=jd(a.shape,i,s),p=qd(o,i.length),f=Kd(l,o,i.length),h=[],d=Vz({inputs:{x:a},backend:n,attrs:{shape:u}}),m=$z({inputs:{x:d},backend:n,attrs:{perm:c}}),v=Vz({inputs:{x:m},backend:n,attrs:{shape:l}}),g=XP({inputs:{x:v},backend:n,attrs:{begin:p,size:f}});return h.push(d),h.push(m),h.push(v),h.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}};var JP={kernelName:Rt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=oL(s,u,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}};var $P={kernelName:Ft,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,i=n.readSync(r.dataId),o=n.readSync(a.dataId),s=Os(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},eZ=Oz({opSnippet:"return float(a != b);",cpuKernelImpl:CL,dtype:"bool"}),tZ={kernelName:ar,backendName:"webgl",kernelFunc:eZ};function nZ(e){var t=e.inputs,n=e.backend,r=t.input;return Nz({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}var rZ={kernelName:gr,backendName:"webgl",kernelFunc:nZ};var aZ={kernelName:Dt,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=t.attrs,i=n.x,o=a.dtype;if("complex64"===o){if("complex64"===i.dtype)return Nz({inputs:{x:i},backend:r});var s=Ap(i.shape),u=e({inputs:{x:i},backend:r,attrs:{dtype:"float32"}}),c=Sz({inputs:{real:u,imag:s},backend:r});return s.dispose(),r.disposeIntermediateTensorInfo(u),c}if("complex64"===i.dtype){var l=nZ({inputs:{input:i},backend:r}),p=e({inputs:{x:l},backend:r,attrs:{dtype:o}});return r.disposeIntermediateTensorInfo(l),p}if(!Me(i.dtype,o)){var f=Nz({inputs:{x:i},backend:r});return{dataId:f.dataId,shape:f.shape,dtype:o}}if("int32"===o)return function(e,t){var n=new tz(e.shape,"return float(int(x));"),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(i,r);if("bool"===o){var h=r.makeTensorInfo([],"bool",_e("bool",1)),d=eZ({inputs:{a:i,b:h},backend:r});return r.disposeIntermediateTensorInfo(h),d}throw new Error("Error in Cast: failed to cast ".concat(i.dtype," to ").concat(o))}},iZ="return ceil(x);",oZ=Dz({opSnippet:iZ,packedOpSnippet:iZ,cpuKernelImpl:uL}),sZ={kernelName:Ot,backendName:"webgl",kernelFunc:oZ},uZ=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "})),cZ=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}));var lZ={kernelName:Mt,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.clipValueMin,s=a.clipValueMax;t=it().getBool("WEBGL_PACK_CLIP")?new cZ(i.shape):new uZ(i.shape);var u=[[o],[s]];return r.runWebGLProgram(t,[i],i.dtype,u)}},pZ=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}));function fZ(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}var hZ={kernelName:zt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n.texData.get(r.dataId),i=new pZ(r.shape),o=[fZ(r,a.complexTensorInfos.real),fZ(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(i,o,o[0].dtype)}},dZ=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.outputShape=[],this.outputShape=Bd(t,1),this.variableNames=t.map((function(e,t){return"T".concat(t)}));var n=new Array(t.length-1);n[0]=t[0][1];for(var r=1;r<n.length;r++)n[r]=n[r-1]+t[r][1];for(var a=["if (yC < ".concat(n[0],") setOutput(getT0(yR, yC));")],i=1;i<n.length;i++){var o=n[i-1];a.push("else if (yC < ".concat(n[i],") ")+"setOutput(getT".concat(i,"(yR, yC-").concat(o,"));"))}var s=n.length,u=n[n.length-1];a.push("else setOutput(getT".concat(s,"(yR, yC-").concat(u,"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(a.join("\n        "),"\n      }\n    ")})),mZ=(0,ee.Z)((function e(t,n){(0,$.Z)(this,e),this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Bd(t,n);var r=this.outputShape,a=r.length,i=FM(a),o=KL("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=t.map((function(e,t){return"T".concat(t)}));var u=new Array(t.length-1);u[0]=t[0][n];for(var c=1;c<u.length;c++)u[c]=u[c-1]+t[c][n];for(var l=s[n],p=s.slice(-2),f=s.join(),h="if (".concat(l," < ").concat(u[0],") {\n        return getChannel(\n            getT0(").concat(f,"), vec2(").concat(p.join(),"));\n        }"),d=1;d<u.length;d++){var m=u[d-1];h+="\n        if (".concat(l," < ").concat(u[d],"  && ").concat(l," >= ").concat(u[d-1],") {\n          return getChannel(\n            getT").concat(d,"(").concat(vZ(s,l,m),"),\n            vec2(").concat(vZ(p,l,m),"));\n        }")}var v=u.length,g=u[u.length-1];h+="\n        return getChannel(\n          getT".concat(v,"(").concat(vZ(s,l,g),"),\n          vec2(").concat(vZ(p,l,g),"));"),this.userCode="\n      float getValue(".concat(s.map((function(e){return"int "+e})),") {\n        ").concat(h,"\n      }\n\n      void main() {\n        ").concat(i," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(o,"), 0., 0., 0.);\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," + 1;\n        if (").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.g = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-2]," = ").concat(o[a-2]," + 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2],") {\n          result.a = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," - 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2]," &&\n            ").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.b = getValue(").concat(o,");\n        }\n        setOutput(result);\n      }\n    ")}));function vZ(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?"".concat(e," - ").concat(n):e})).join()}function gZ(e){var t=e.inputs,n=e.backend,r=t.input;return Nz({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}var yZ={kernelName:Cn,backendName:"webgl",kernelFunc:gZ};function bZ(e,t,n){var r=e[0].dtype;if("complex64"===r){var a=e.map((function(e){return nZ({inputs:{input:e},backend:n})})),i=e.map((function(e){return gZ({inputs:{input:e},backend:n})})),o=bZ(a,t,n),s=bZ(i,t,n),u=Sz({inputs:{real:o,imag:s},backend:n});return a.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),i.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}var c=n.shouldExecuteOnCPU(e);if("string"===r&&(c=!0),c){var l=e.map((function(e){var r=be(e.shape.slice(t));return Vz({inputs:{x:e},backend:n,attrs:{shape:[-1,r]}})})),p=l.map((function(e){return{vals:n.readSync(e.dataId),shape:e.shape}})),f=Bd(l.map((function(e){return e.shape})),1),h=1===l[0].shape[0],d=cL(p,f,r,h),m=Bd(e.map((function(e){return e.shape})),t),v=n.makeTensorInfo(m,r,d);return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),v}if(e.length>it().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var g=Math.floor(e.length/2),y=bZ(e.slice(0,g),t,n),b=bZ(e.slice(g),t,n),x=bZ([y,b],t,n);return n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),x}if(it().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].shape.length>1){var k=new mZ(e.map((function(e){return e.shape})),t);return n.runWebGLProgram(k,e,r)}var w=function(e,t,n){var r=Bd(e.map((function(e){return e.shape})),t);return{tensors2D:e.map((function(e){return Vz({inputs:{x:e},attrs:{shape:[-1,be(e.shape.slice(t))]},backend:n})})),outShape:r}}(e,t,n),N=w.tensors2D,I=w.outShape,S=new dZ(N.map((function(e){return e.shape}))),T=n.runWebGLProgram(S,N,r);N.forEach((function(e){return n.disposeIntermediateTensorInfo(e)}));var C=Vz({inputs:{x:T},attrs:{shape:I},backend:n});return n.disposeIntermediateTensorInfo(T),C}function xZ(e){var t=e.inputs,n=e.backend,r=Ae(e.attrs.axis,t[0].shape)[0],a=Bd(t.map((function(e){return e.shape})),r);if(0===be(a))return n.makeTensorInfo(a,t[0].dtype,[]);var i=t.filter((function(e){return be(e.shape)>0}));return 1===i.length?Nz({inputs:{x:i[0]},backend:n}):(Zd(i.map((function(e){return e.shape})),r),bZ(i,r,n))}var kZ={kernelName:Pt,backendName:"webgl",kernelFunc:xZ},wZ=(0,ee.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];(0,$.Z)(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,p=t.dilationWidth,f=t.filterHeight,h=t.filterWidth,d=4*Math.floor(t.inChannels/4),m=t.inChannels%4,v="channelsLast"===t.dataFormat,g=v?1:2,y=v?2:3,b=v?3:1,x="",k="";r&&(x=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),k="result = activation(result);");var w=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(x,"\n\n      const ivec2 strides = ivec2(").concat(u,", ").concat(c,");\n      const ivec2 pads = ivec2(").concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(b,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(g,"], coords[").concat(y,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(f,"; wR++) {\n          int xR = xRCorner + wR * ").concat(l,";\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(h,"; wC++) {\n            int xC = xCCorner + wC * ").concat(p,";\n\n            if (xC < 0 || xC >= ").concat(t.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(d,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(v,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===m,") {\n\n              if (").concat(v,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(d,") *\n                    getW(wR, wC, ").concat(d,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(d,", xR, xC) *\n                    getW(wR, wC, ").concat(d,", d2);\n              }\n\n            } else if (").concat(2===m,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(d,", d2),\n                getW(wR, wC, ").concat(d," + 1, d2)\n              );\n\n              if (").concat(v,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(d,"),\n                  getX(batch, xR, xC, ").concat(d," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(d,", xR, xC),\n                  getX(batch, ").concat(d," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===m,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(d,", d2),\n                getW(wR, wC, ").concat(d," + 1, d2),\n                getW(wR, wC, ").concat(d," + 2, d2)\n              );\n\n              if (").concat(v,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(d,"),\n                  getX(batch, xR, xC, ").concat(d," + 1),\n                  getX(batch, xR, xC, ").concat(d," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(d,", xR, xC),\n                  getX(batch, ").concat(d," + 1, xR, xC),\n                  getX(batch, ").concat(d," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(w,"\n        ").concat(k,"\n        setOutput(result);\n      }\n    ")})),NZ=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.padInfo.front,r=t.padInfo.top,a=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,p=t.filterDepth,f=t.filterHeight,h=t.filterWidth,d=4*Math.floor(t.inChannels/4),m=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(i,", ").concat(o,", ").concat(s,");\n      const ivec3 pads = ivec3(").concat(n,", ").concat(r,", ").concat(a,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(p,"; wF++) {\n          int xF = xFCorner + wF * ").concat(u,";\n\n          if (xF < 0 || xF >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(f,"; wR++) {\n            int xR = xRCorner + wR * ").concat(c,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(h,"; wC++) {\n              int xC = xCCorner + wC * ").concat(l,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(d,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===m,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(d,") *\n                  getW(wF, wR, wC, ").concat(d,", d2);\n              } else if (").concat(2===m,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(d,"),\n                  getX(batch, xF, xR, xC, ").concat(d," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(d,", d2),\n                  getW(wF, wR, wC, ").concat(d," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===m,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(d,"),\n                  getX(batch, xF, xR, xC, ").concat(d," + 1),\n                  getX(batch, xF, xR, xC, ").concat(d," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(d,", d2),\n                  getW(wF, wR, wC, ").concat(d," + 1, d2),\n                  getW(wF, wR, wC, ").concat(d," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),IZ=(0,ee.Z)((function e(t,n){(0,$.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=WM(this.outputShape.length);for(var r=n.dataFormat,a=sM(),i="channelsLast"===r,o=i?0:1,s=i?1:2,u=this.enableShapeUniforms?"if(blockIndex < outShape[1] && pos < outShape[0]) {":"if(blockIndex < ".concat(t[1]," && pos < ").concat(t[0],") {"),c="",l=0;l<=1;l++)for(var p=0;p<=1;p++)c+="\n          blockIndex = rc.y + ".concat(p,";\n          pos = rc.x + ").concat(l,";\n\n          ").concat(u,"\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[").concat(o,"] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[").concat(s,"] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (").concat(i,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*l+p,"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*l+p,"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(c,"\n\n        ").concat(a.output," = result;\n      }\n    ")}));function SZ(e){var t,n=e.x,r=e.filter,a=e.convInfo,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,p=void 0===l?0:l,f=e.activation,h=void 0===f?null:f,d=n.shape,m=i.texData.get(n.dataId),v=a.inChannels,g=d[0]*d[1]*d[2],y=a.outChannels,b="channelsLast"===a.dataFormat,x=[];if(!((1===g||1===y)&&v>1e3)&&m.isPacked&&b&&null!=m.texture&&d[2]%2!==0&&ke(m.shape.slice(-3),d.slice(-3))){var k=d[0]*d[1]*(d[2]+1),w={dataId:n.dataId,shape:[1,k,a.inChannels],dtype:n.dtype},N=m.shape;m.shape=m.shape.slice(),m.shape[m.shape.length-2]++,me(eM(m.shape,w.shape),(function(){return"packed reshape ".concat(m.shape," to ").concat(w.shape," isn't free")}));var I=Vz({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}});x.push(I);var S=tP({a:w,b:I,backend:i,transposeA:false,transposeB:false,bias:s,activation:h,preluActivationWeights:c,leakyreluAlpha:p}),T=i.texData.get(S.dataId);me(T.isPacked,(function(){return"batchMatMul result is expected to be packed"})),m.shape=N,T.shape=a.outShape,(t=Nz({inputs:{x:S},backend:i})).shape=a.outShape,x.push(S)}else{var C=Vz({inputs:{x:n},backend:i,attrs:{shape:[1,b?d[0]*d[1]*d[2]:d[0]*d[2]*d[3],a.inChannels]}}),E=Vz({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}}),A=tP({a:C,b:E,transposeA:false,transposeB:false,backend:i,bias:s,activation:h,preluActivationWeights:c,leakyreluAlpha:p});t=Vz({inputs:{x:A},backend:i,attrs:{shape:a.outShape}}),x.push(C),x.push(E),x.push(A)}for(var R=0,_=x;R<_.length;R++){var F=_[R];i.disposeIntermediateTensorInfo(F)}return t}function TZ(e){var t=e.x,n=e.filter,r=e.convInfo,a=e.backend,i=e.bias,o=void 0===i?null:i,s=e.preluActivationWeights,u=void 0===s?null:s,c=e.leakyreluAlpha,l=void 0===c?0:c,p=e.activation,f=void 0===p?null:p,h=r.filterWidth,d=r.filterHeight,m=r.inChannels,v=r.outWidth,g=r.outHeight,y="channelsLast"===r.dataFormat,b=h*d*m,x=g*v,k=[b,x],w=[],N=Vz({inputs:{x:t},backend:a,attrs:{shape:t.shape.slice(1)}}),I=Vz({inputs:{x:n},backend:a,attrs:{shape:[1,b,be(n.shape)/b]}});w.push(N),w.push(I);var S=new IZ(k,r),T=[N.shape,[r.padInfo.top,r.padInfo.left],[r.strideHeight,r.strideWidth],[r.dilationHeight,r.dilationWidth],[r.inChannels],[r.filterWidth*r.inChannels],[r.outWidth]],C=a.runWebGLProgram(S,[N],"float32",T),E=Vz({inputs:{x:C},backend:a,attrs:{shape:[1,k[0],k[1]]}});w.push(C),w.push(E);var A=null!=o,R=null!=u,_="leakyrelu"===f,F=f?Mz(f,!0):null,D=new Lz(E.shape,I.shape,[1,x,r.outChannels],!0,!1,A,F,R,_),O=[E,I];if(o&&O.push(o),R&&O.push(u),_){var M=a.makeTensorInfo([],"float32",qa(l,"float32"));O.push(M),w.push(M)}var L=a.runWebGLProgram(D,O,"float32"),z=Vz({inputs:{x:L},backend:a,attrs:{shape:y?[1,g,v,r.outChannels]:[1,r.outChannels,g,v]}});w.push(L);for(var P=0,Z=w;P<Z.length;P++){var B=Z[P];a.disposeIntermediateTensorInfo(B)}return z}var CZ={kernelName:Zt,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dataFormat,l=a.dilations,p=a.dimRoundingMode,f=qc(c),h=Lc(i.shape,o.shape,s,l,u,p,!1,f);if(1!==h.filterHeight||1!==h.filterWidth||1!==h.dilationHeight||1!==h.dilationWidth||1!==h.strideHeight||1!==h.strideWidth||"SAME"!==h.padInfo.type&&"VALID"!==h.padInfo.type)if(it().getBool("WEBGL_CONV_IM2COL")&&1===i.shape[0])t=TZ({x:i,filter:o,convInfo:h,backend:r});else{var d=new wZ(h);t=r.runWebGLProgram(d,[i,o],"float32")}else t=SZ({x:i,filter:o,convInfo:h,backend:r});var m=Vz({inputs:{x:t},backend:r,attrs:{shape:h.outShape}});return r.disposeIntermediateTensorInfo(t),m}},EZ=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o="channelsLast"===t.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              if (").concat(o,") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),AZ=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o="channelsLast"===t.dataFormat,s=n-1-t.padInfo.top,u=r-1-t.padInfo.left,c=o?1:2,l=o?2:3,p=o?3:1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(p,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(c,"], coords[").concat(l,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n\n              if (").concat(o,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),RZ=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.padInfo.front,o=t.padInfo.top,s=t.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(t.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(n," - ").concat(i,";\n\n            if (xF < 0 || xF >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(r," - ").concat(o,";\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(a," - ").concat(s,";\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),_Z=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=n-1-t.padInfo.front,c=r-1-t.padInfo.top,l=a-1-t.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3(".concat(u,", ").concat(c,", ").concat(l,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(n,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(i,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(t.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(n," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(r,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(r," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(a,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(a," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var FZ={kernelName:Bt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape,p=qc(u),f=Lc(a.shape,l,o,1,s,c,!1,p),h=new EZ(f);return n.runWebGLProgram(h,[a,i],"float32")}};var DZ={kernelName:Wt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode,p=qc(c),f=Lc(o,i.shape,s,1,u,l,!1,p),h=new AZ(f);return n.runWebGLProgram(h,[a,i],"float32")}};var OZ={kernelName:Ut,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=zc(a.shape,i.shape,o,u,s),l=new NZ(c);return n.runWebGLProgram(l,[a,i],"float32")}};var MZ={kernelName:Vt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape,c=zc(a.shape,u,o,1,s),l=new RZ(c);return n.runWebGLProgram(l,[a,i],"float32")}};var LZ={kernelName:Gt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=zc(r.inputShape,i.shape,s,1,o),c=new _Z(u);return n.runWebGLProgram(c,[a,i],"float32")}},zZ=Dz({opSnippet:"if (isnan(x)) return x;\n  return cos(x);\n"}),PZ={kernelName:Ht,backendName:"webgl",kernelFunc:zZ},ZZ=Dz({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),BZ={kernelName:jt,backendName:"webgl",kernelFunc:ZZ},WZ=(0,ee.Z)((function e(t,n,r,a,i){(0,$.Z)(this,e),this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=(0,oe.Z)(t,4),s=o[0],u=o[1],c=o[2],l=o[3],p=(0,oe.Z)(n,1)[0],f=(0,oe.Z)(r,2),h=f[0],d=f[1];this.outputShape=[p,h,d,l];var m="bilinear"===a?1:0,v="".concat(u-1,".0"),g="".concat(c-1,".0"),y=h>1?["".concat((u-1)/(h-1)),"(y2-y1) * height_ratio","y1*".concat(v," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(v)],b=(0,oe.Z)(y,3),x=b[0],k=b[1],w=b[2],N=d>1?["".concat((c-1)/(d-1)),"(x2-x1) * width_ratio","x1*".concat(g," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(g)],I=(0,oe.Z)(N,3),S=I[0],T=I[1],C=I[2];this.userCode="\n      const float height_ratio = float(".concat(x,");\n      const float width_ratio = float(").concat(S,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(s,") {\n          return;\n        }\n\n        float height_scale = ").concat(k,";\n        float width_scale = ").concat(T,";\n\n        float in_y = ").concat(w,";\n        if( in_y < 0.0 || in_y > ").concat(v," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n        float in_x = ").concat(C,";\n        if( in_x < 0.0 || in_x > ").concat(g," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(m," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")})),UZ={kernelName:Xt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=new WZ(a.shape,i.shape,s,u,c);return n.runWebGLProgram(l,[a,i,o],"float32")}},VZ=(0,ee.Z)((function e(t,n,r){(0,$.Z)(this,e),this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}],this.outputShape=t;var a=t.length,i=n?"1.0":"getX(".concat(GZ(a,"coords"),")"),o=t[t.length-1],s="",u="";n?(s=r?"end != ".concat(o-1):"end != 0",u=r?"end + 1":"end - 1"):(s=r?"end + pow2 < ".concat(o):"end >= pow2",u=r?"end + pow2":"end - pow2"),this.userCode="\n      void main() {\n        ".concat(FM(a)," coords = getOutputCoords();\n        int end = ").concat(HZ(a,"coords"),";\n        float val = ").concat(i,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(s,") {\n          int idx = ").concat(u,";\n          ").concat(HZ(a,"coords")," = idx;\n          val *= getX(").concat(GZ(a,"coords"),");\n        }\n        setOutput(val);\n      }\n    ")}));function GZ(e,t){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw Error("Cumulative product for rank ".concat(e," is not yet supported"))}function HZ(e,t){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw Error("Cumulative product for rank ".concat(e," is not yet supported"))}var jZ={kernelName:qt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse,u=a.shape.length,c=gp([i],u),l=a;null!=c&&(l=$z({inputs:{x:a},backend:n,attrs:{perm:c}}));var p=bp(1,u)[0];if(p!==u-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(a.shape.length-1," ")+"but got axis=".concat(i));for(var f=l.shape[p],h=Nz({inputs:{x:l},backend:n}),d=0;d<=Math.ceil(Math.log2(f))-1;d++){var m=new VZ(l.shape,!1,s),v=[[d]],g=h;h=n.runWebGLProgram(m,[h],h.dtype,v),n.disposeIntermediateTensorInfo(g)}if(o){var y=new VZ(l.shape,o,s),b=h;h=n.runWebGLProgram(y,[h],h.dtype),n.disposeIntermediateTensorInfo(b)}if(null!=c){var x=$z({inputs:{x:h},backend:n,attrs:{perm:yp(c)}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(l),x}return h}},qZ=(0,ee.Z)((function e(t,n,r){(0,$.Z)(this,e),this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}],this.outputShape=t;var a=t.length,i=n?"0.0":"getX(".concat(KZ(a,"coords"),")"),o=t[t.length-1],s="",u="";n?(s=r?"end != ".concat(o-1):"end != 0",u=r?"end + 1":"end - 1"):(s=r?"end + pow2 < ".concat(o):"end >= pow2",u=r?"end + pow2":"end - pow2"),this.userCode="\n      void main() {\n        ".concat(FM(a)," coords = getOutputCoords();\n        int end = ").concat(XZ(a,"coords"),";\n        float val = ").concat(i,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(s,") {\n          int idx = ").concat(u,";\n          ").concat(XZ(a,"coords")," = idx;\n          val += getX(").concat(KZ(a,"coords"),");\n        }\n        setOutput(val);\n      }\n    ")}));function KZ(e,t){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw Error("Cumulative sum for rank ".concat(e," is not yet supported"))}function XZ(e,t){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw Error("Cumulative sum for rank ".concat(e," is not yet supported"))}var YZ={kernelName:Kt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse,u=a.shape.length,c=gp([i],u),l=a;null!=c&&(l=$z({inputs:{x:a},backend:n,attrs:{perm:c}}));var p=bp(1,u)[0];if(p!==u-1)throw new Error("WebGL cumsum shader expects an inner-most axis=".concat(a.shape.length-1," ")+"but got axis=".concat(i));for(var f=l.shape[p],h=Nz({inputs:{x:l},backend:n}),d=0;d<=Math.ceil(Math.log2(f))-1;d++){var m=new qZ(l.shape,!1,s),v=[[d]],g=h;h=n.runWebGLProgram(m,[h],h.dtype,v),n.disposeIntermediateTensorInfo(g)}if(o){var y=new qZ(l.shape,o,s),b=h;h=n.runWebGLProgram(y,[h],h.dtype),n.disposeIntermediateTensorInfo(b)}if(null!=c){var x=$z({inputs:{x:h},backend:n,attrs:{perm:yp(c)}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(l),x}return h}};var QZ={kernelName:Yt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=n.readSync(a.dataId),c=n.readSync(i.dataId),l=oL(u,c,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,l)}if(2===a.shape.length){var p=n.bufferSync(a),f=n.bufferSync(i),h=sL(p,f,o,s);return n.makeTensorInfo(h.shape,i.dtype,h.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}},JZ=function(){function e(t,n,r){(0,$.Z)(this,e),this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(n,";\n      int offset_h = imod(h, ").concat(n,");\n      int in_w = w / ").concat(n,";\n      int offset_w = imod(w, ").concat(n,");\n      int offset_d = (offset_h * ").concat(n," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}return(0,ee.Z)(e,[{key:"getHeightCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}},{key:"getWidthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}},{key:"getDepthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}},{key:"getOutputDepthSize",value:function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}},{key:"getInputSamplingString",value:function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}]),e}();var $Z={kernelName:Qt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat,s=a.shape[0],u=("NHWC"===o?a.shape[1]:a.shape[2])*i,c=("NHWC"===o?a.shape[2]:a.shape[3])*i,l=("NHWC"===o?a.shape[3]:a.shape[1])/(i*i),p=new JZ("NHWC"===o?[s,u,c,l]:[s,l,u,c],i,o);return n.runWebGLProgram(p,[a],a.dtype)}},eB=(0,ee.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];(0,$.Z)(this,e),this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=WM(this.outputShape.length);var o=t.filterHeight,s=t.filterWidth,u=t.outChannels/t.inChannels,c="",l="";r&&(c=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),l="result = activation(result);");var p=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(c,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(u,";\n        int q = d2 - d1 * ").concat(u,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(o,"; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(s,"; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(p,"\n        ").concat(l,"\n        setOutput(result);\n      }\n    ")})),tB=(0,ee.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];(0,$.Z)(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=WM(this.outputShape.length);for(var o=t.outChannels/t.inChannels,s=t.padInfo.left,u=t.strideWidth,c=t.dilationWidth,l=t.filterHeight,p=t.filterWidth,f=p,h="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;",d=0;d<p;d++)h+="\n          vec4 xTexelC".concat(2*d,";\n          int xTexelC").concat(2*d,"Ready;\n          vec4 xTexelC").concat(2*d+1,";\n          int xTexelC").concat(2*d+1,"Ready;\n          vec4 xC").concat(d,";");h+="\n    for (int r = 0; r < ".concat(l,"; r++) {\n      ");for(var m=0;m<p;m++)h+="\n          xTexelC".concat(2*m," = vec4(0.0);\n          xTexelC").concat(2*m,"Ready = 0;\n          xTexelC").concat(2*m+1," = vec4(0.0);\n          xTexelC").concat(2*m+1,"Ready = 0;\n          xC").concat(m," = vec4(0.0);");h+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(var v=0;v<(f+1)/2;v++){var g=2*v;if(h+="\n          xC = xCCorner + ".concat(g*c,";\n          "),1===u){if(g<p&&(s%2===1?(h+="\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n              "),h+=1===c&&g>0?"\n                xC".concat(g," = vec4(xTexelC").concat(g-2,".zw, xTexelC").concat(g,".xy);\n                "):"\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC".concat(g," = vec4(previous.zw, xTexelC").concat(g,".xy);\n                  } else {\n                    xC").concat(g," = vec4(0.0, 0.0, xTexelC").concat(g,".xy);\n                  }\n                  ")):h+="\n                if (xC >= 0 && xC < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n\n                xC").concat(g," = xTexelC").concat(g,";\n                "),g+1<p)){var y=s%2===0?le(c):c;c%2===0&&s%2===1||c%2!==0&&s%2!==1?(h+="\n                  xCOffset = xC + imod(pads[1], 2) + ".concat(y,";\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                    xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC").concat(g+1,".zw = vec2(0.0);\n                    }\n                    xTexelC").concat(g+1,"Ready = 1;\n                  }\n                  "),c>1&&(h+="\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                      xTexelC").concat(g," = getX(batch, xR, xCOffset, d1);\n                      xTexelC").concat(g,"Ready = 1;\n                    }\n                    ")),h+="\n                  xC".concat(g+1," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".xy);\n                  ")):h+=1===y?"\n                    xC".concat(g+1," = xTexelC").concat(g,";\n                    "):"\n                    xCOffset = xC + ".concat(y,";\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                      xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC").concat(g+1,".zw = vec2(0.0);\n                      }\n                      xTexelC").concat(g+1,"Ready = 1;\n                    }\n\n                    xC").concat(g+1," = xTexelC").concat(g+1,";\n                    ")}}else g<p&&(s%2===1?(h+="\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                  xTexelC").concat(g+1," = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC").concat(g+1,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g+1,"Ready = 1;\n                }\n\n                xC").concat(g," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".zw);\n              "),g+1<p&&(h+="\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC".concat(g+1," = vec4(xTexelC").concat(g+1,".xy, final.xy);\n                "))):(h+="\n                if(xC >= 0 && xC < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                  xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(g+1,".zw = vec2(0.);\n                  }\n                  xTexelC").concat(g+1,"Ready = 1;\n                }\n\n                xC").concat(g," = vec4(\n                  xTexelC").concat(g,".xy, xTexelC").concat(g+1,".xy);\n              "),g+1<p&&(h+="\n                  xC".concat(g+1," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".zw);\n                "))));g<p&&(h+="\n            wTexel = getW(r, ".concat(g,", d1, q);\n            dotProd += xC").concat(g," * vec4(wTexel.xz, wTexel.xz);\n          "),g+1<p&&(h+="\n              wTexel = getW(r, ".concat(g+1,", d1, q);\n              dotProd += xC").concat(g+1," * vec4(wTexel.xz, wTexel.xz);\n            ")))}h+="\n    }\n  ",h+="\n      }\n    ";var b="",x="";r&&(b=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(r,"\n        }"),x="result = activation(result);");var k=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(b,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(o,";\n        int q = d2 - d1 * ").concat(o,";\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ").concat(h,"\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ").concat(k,"\n        ").concat(x,"\n        setOutput(result);\n      }\n    ")}));var nB={kernelName:Jt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode,l=u;null==l&&(l=[1,1]),me(jc(o,l),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(l,"'")}));var p,f=Lc(a.shape,i.shape,o,l,s,c,!0);p=it().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?new tB(f):new eB(f);var h=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return n.runWebGLProgram(p,[a,i],"float32",h)}},rB=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(o," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),aB=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=n-1-t.padInfo.top,s=r-1-t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(u,"; dm++) {\n              int d2 = d1 * ").concat(u," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var iB={kernelName:$t,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape,p=Lc(a.shape,l,o,s,u,c,!0),f=new rB(p);return n.runWebGLProgram(f,[a,i],"float32")}};var oB={kernelName:en,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=Lc(r.inputShape,i.shape,o,s,u,c,!0),p=new aB(l);return n.runWebGLProgram(p,[a,i],"float32")}},sB=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}));var uB={kernelName:tn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=[].concat(Y(r.shape),Y(r.shape)),i=be(r.shape),o=Vz({inputs:{x:r},backend:n,attrs:{shape:[i]}}),s=new sB(i),u=n.runWebGLProgram(s,[o],o.dtype),c=Vz({inputs:{x:u},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),c}},cB=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.inHeight,r=t.inWidth,a=t.padInfo,i=t.strideHeight,o=t.strideWidth,s=t.filterHeight,u=t.filterWidth,c=t.dilationHeight,l=t.dilationWidth,p=a.top,f=a.left;this.userCode="\n      const ivec2 strides = ivec2(".concat(i,", ").concat(o,");\n      const ivec2 pads = ivec2(").concat(p,", ").concat(f,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(s,"; h++) {\n          int hIn = hBeg + h * ").concat(c,";\n\n          if (hIn >= 0 && hIn < ").concat(n,") {\n            for (int w = 0; w < ").concat(u,"; w++) {\n              int wIn = wBeg + w * ").concat(l,";\n\n              if (wIn >= 0 && wIn < ").concat(r,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")}));var lB={kernelName:nn,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dilations,l=Dc(i.shape,o.shape,s,u,"NHWC",c),p=new cB(l),f=Vz({inputs:{x:t=r.runWebGLProgram(p,[i,o],"float32")},backend:r,attrs:{shape:l.outShape}});return r.disposeIntermediateTensorInfo(t),f}};var pB={kernelName:sn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,a=hm(e.attrs.equation,r.length),i=a.allDims,o=a.summedDims,s=a.idDims;mm(i.length,s,r);for(var u=vm(o,s),c=u.path,l=u.steps,p=l.length,f=null,h=i.length,d=[],m=0;m<p;++m){var v,g=q(l[m]);try{for(g.s();!(v=g.n()).done;){var y=v.value,b=dm(h,s[y]),x=b.permutationIndices,k=b.expandDims,w=void 0;gm(x)?w=r[y]:(w=$z({inputs:{x:r[y]},backend:n,attrs:{perm:x}}),d.push(w));for(var N=w.shape.slice(),I=0;I<k.length;++I)N.splice(k[I],0,1);ke(w.shape,N)||(w=Vz({inputs:{x:w},backend:n,attrs:{shape:N}}),d.push(w)),null===f?f=w:(f=Wz({inputs:{a:w,b:f},backend:n}),d.push(f))}}catch($V){g.e($V)}finally{g.f()}m<p-1&&(c[m]>=0&&(f=Qz({inputs:{x:f},backend:n,attrs:{axis:c[m]-(i.length-h),keepDims:!1}}),d.push(f)),h--)}for(var S=0,T=d;S<T.length;S++){var C=T[S];C!==f&&n.disposeIntermediateTensorInfo(C)}return f}},fB=Dz({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),hB={kernelName:un,backendName:"webgl",kernelFunc:fB},dB={kernelName:cn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y,i=it().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new wz("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,a.shape):new kz("return (b >= 1.0) ? a : a * (b + 1.0);",r.shape,a.shape);return n.runWebGLProgram(i,[r,a],r.dtype)}},mB=Oz({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:lL}),vB={kernelName:pn,backendName:"webgl",kernelFunc:mB},gB=Dz({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(Qd,";\n  float a1 = ").concat(Jd,";\n  float a2 = ").concat($d,";\n  float a3 = ").concat(em,";\n  float a4 = ").concat(tm,";\n  float a5 = ").concat(nm,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n")}),yB={kernelName:ln,backendName:"webgl",kernelFunc:gB},bB=Dz({opSnippet:"if (isnan(x)) return x;\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:pL,dtype:"float32"}),xB={kernelName:fn,backendName:"webgl",kernelFunc:bB};function kB(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.dim,i=t.input,o=i.shape.length,s=i.shape.slice(),u=a;return a<0&&(me(-(o+1)<=a,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+a+1),s.splice(u,0,1),Vz({inputs:{x:i},backend:r,attrs:{shape:s}})}var wB={kernelName:hn,backendName:"webgl",kernelFunc:kB},NB="return exp(x) - 1.0;",IB=Dz({opSnippet:NB,packedOpSnippet:NB,cpuKernelImpl:fL}),SB={kernelName:dn,backendName:"webgl",kernelFunc:IB},TB=(0,ee.Z)((function e(t,n,r){(0,$.Z)(this,e),this.variableNames=["real","imag"];var a=n[1];this.outputShape=n;var i,o=r?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),s=r?"".concat(a,".0"):"1.0";if("real"===t)i="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error('FFT component must be either "real" or "imag", got '.concat(t,"."));i="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(o,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(i,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(a,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(s,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")}));function CB(e,t,n){var r=n.texData.get(e.dataId),a=be(e.shape),i=e.shape[e.shape.length-1],o=Vz({inputs:{x:e},backend:n,attrs:{shape:[a/i,i]}}),s=o.shape,u=new TB("real",s,t),c=new TB("imag",s,t),l=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:s},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:s}],p=n.runWebGLProgram(u,l,"float32"),f=n.runWebGLProgram(c,l,"float32"),h=Sz({inputs:{real:p,imag:f},backend:n});n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f);var d=Vz({inputs:{x:h},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(h),d}var EB={kernelName:mn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return CB(t.input,!1,n)}},AB=(0,ee.Z)((function e(t,n){(0,$.Z)(this,e),this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}));function RB(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype;if("string"===(i=i||Ue(a))){var o=Fe(i,be(r));return o.fill(a),t.makeTensorInfo(r,i,o)}var s=new AB(r,a),u=[[a]];return t.runWebGLProgram(s,[],i,u)}var _B,FB={kernelName:vn,backendName:"webgl",kernelFunc:RB},DB=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["Image"],this.outputShape=[];var n=t[2];this.outputShape=t,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(n," - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(n,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),OB={kernelName:gn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n,i=new DB(r.shape);return a.runWebGLProgram(i,[r],r.dtype)}},MB="return floor(x);",LB=Dz({opSnippet:MB,packedOpSnippet:MB,cpuKernelImpl:hL}),zB={kernelName:yn,backendName:"webgl",kernelFunc:LB},PB=Oz({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),ZB={kernelName:bn,backendName:"webgl",kernelFunc:PB},BB=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["A"];var n=sM(),r=(0,oe.Z)(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(i,".0, ").concat(a,".0);\n\n        vec4 values = ").concat(n.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")})),WB=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=sM(),r=(0,oe.Z)(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(i,".0, ").concat(a,".0);\n            vec4 values = ").concat(n.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),UB={kernelName:fa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,i=r.numChannels,o="undefined"!==typeof HTMLVideoElement&&a instanceof HTMLVideoElement,s="undefined"!==typeof HTMLImageElement&&a instanceof HTMLImageElement,u=o?[a.videoWidth,a.videoHeight]:[a.width,a.height],c=(0,oe.Z)(u,2),l=c[0],p=c[1],f=[p,l],h=[p,l,i];(s||o)&&(null==_B&&(_B=document.createElement("canvas").getContext("2d")),_B.canvas.width=l,_B.canvas.height=p,_B.drawImage(a,0,0,l,p),a=_B.canvas);var d=n.makeTensorInfo(f,"int32");n.texData.get(d.dataId).usage=IO.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),a);var m=it().getBool("WEBGL_PACK")?new WB(h):new BB(h),v=n.runWebGLProgram(m,[d],"int32");return n.disposeData(d.dataId),v}};var VB={kernelName:ma,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=n.bias,u=n.preluActivationWeights,c=a.strides,l=a.pad,p=a.dataFormat,f=a.dilations,h=a.dimRoundingMode,d=a.activation,m=a.leakyreluAlpha,v=qc(p),g=Lc(i.shape,o.shape,c,f,l,h,!1,v),y=[];if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(it().getBool("WEBGL_CONV_IM2COL")&&1===i.shape[0])t=TZ({x:i,filter:o,convInfo:g,backend:r,bias:s,activation:d,preluActivationWeights:u,leakyreluAlpha:m});else{var b=null!=s,x=null!=u,k="leakyrelu"===d,w=d?Mz(d,!1):null,N=new wZ(g,b,w,x,k),I=[i,o];if(s&&I.push(s),u&&I.push(u),k){var S=r.makeTensorInfo([],"float32",qa(m,"float32"));I.push(S),y.push(S)}t=r.runWebGLProgram(N,I,"float32")}else t=SZ({x:i,filter:o,convInfo:g,backend:r,bias:s,activation:d,preluActivationWeights:u,leakyreluAlpha:m});var T=Vz({inputs:{x:t},backend:r,attrs:{shape:g.outShape}});return y.push(t),y.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),T}};var GB={kernelName:va,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dilations,p=r.dimRoundingMode,f=r.activation,h=r.leakyreluAlpha,d=[],m=l;null==m&&(m=[1,1]),me(jc(u,m),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(u," and dilations '").concat(m,"'")}));var v,g=Lc(a.shape,i.shape,u,m,c,p,!0),y=it().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,b=f?Mz(f,y):null,x=[a,i],k=null!=o,w=null!=s,N="leakyrelu"===f;if(k&&x.push(o),w&&x.push(s),N){var I=n.makeTensorInfo([],"float32",qa(h,"float32"));x.push(I),d.push(I)}v=y?new tB(g,k,b,w,N):new eB(g,k,b,w,N);var S=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],T=n.runWebGLProgram(v,x,"float32",S);return d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),T}},HB=(0,ee.Z)((function e(t,n,r){(0,$.Z)(this,e),this.sliceDim=t,this.strides=n,this.variableNames=["x","indices"],this.outputShape=r;var a=FM(n.length),i=FM(r.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        ".concat(a," strides = ").concat(a,"(").concat(this.strides,");\n         void main() {\n          ").concat(i," coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < ").concat(this.sliceDim,"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * ").concat(o,";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      ")}));var jB={kernelName:wn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,i=a.shape,o=i[i.length-1],s=be(r.shape),u=Vs(r,a),c=(0,oe.Z)(u,4),l=c[0],p=c[1],f=c[2],h=c[3],d=Vz({inputs:{x:a},backend:n,attrs:{shape:[p,o]}}),m=Vz({inputs:{x:r},backend:n,attrs:{shape:[be(r.shape)/f,f]}});if(n.shouldExecuteOnCPU([r,a])||"string"===r.dtype){var v=n.readSync(a.dataId),g=n.bufferSync(r),y=dL(v,g,r.dtype,p,o,f,h,r.shape,s);return n.makeTensorInfo(l,r.dtype,y.values)}var b=new HB(o,h,[p,f]),x=n.runWebGLProgram(b,[m,d],m.dtype),k=Vz({inputs:{x:x},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(x),k}},qB=(0,ee.Z)((function e(t,n){(0,$.Z)(this,e),this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;var r=FM(this.rank),a=function(e,t){for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],a=0;a<e.length;a++)2===a?r.push("index"):r.push("".concat(n[a]));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(r," resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ").concat(t[2],") ? 1.0 : 0.0;\n        setOutput(inBounds * getA(").concat(a,"));\n      }\n    ")}));function KB(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims,u=Ae(o,a.shape)[0];it().get("DEBUG")&&function(){for(var e=n.readSync(i.dataId),t=a.shape[u],r=function(n){var r=e[n];me(r<=t-1&&r>=0,(function(){return"GatherV2: the index value ".concat(r," is not in [0, ").concat(t-1,"]")}))},o=0;o<e.length;++o)r(o)}();var c=Om(a,i,u,s),l=be(i.shape),p=[],f=Vz({inputs:{x:a},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),h=Vz({inputs:{x:i},backend:n,attrs:{shape:[c.batchSize,l/c.batchSize]}});p.push(f),p.push(h);var d=[c.batchSize,c.outerSize,l/c.batchSize,c.sliceSize];if(n.shouldExecuteOnCPU([a,i])||"string"===a.dtype){var m=n.bufferSync(h),v=n.bufferSync(f),g=mL(v,m,d);return p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(c.outputShape,g.dtype,g.values)}var y=new qB(f.shape,d),b=n.runWebGLProgram(y,[f,h],f.dtype);p.push(b);var x=Vz({inputs:{x:b},backend:n,attrs:{shape:c.outputShape}});return p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),x}var XB={kernelName:kn,backendName:"webgl",kernelFunc:KB},YB=Oz({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:vL,dtype:"bool"}),QB={kernelName:Nn,backendName:"webgl",kernelFunc:YB},JB=Oz({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:gL}),$B={kernelName:In,backendName:"webgl",kernelFunc:JB};var eW={kernelName:Tn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return CB(t.input,!0,n)}},tW=Dz({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),nW={kernelName:En,backendName:"webgl",kernelFunc:tW},rW=Dz({opSnippet:"return float(isinf(x));",dtype:"bool"}),aW={kernelName:An,backendName:"webgl",kernelFunc:rW},iW=Dz({opSnippet:"return float(isnan(x));",dtype:"bool"}),oW={kernelName:Rn,backendName:"webgl",kernelFunc:iW},sW=Oz({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:yL,dtype:"bool"}),uW={kernelName:Fn,backendName:"webgl",kernelFunc:sW},cW=Oz({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:bL,dtype:"bool"}),lW={kernelName:Dn,backendName:"webgl",kernelFunc:cW};var pW={kernelName:On,backendName:"webgl",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.num,o=xL(r,a,i);return t.makeTensorInfo([o.length],"float32",o)}},fW=Dz({opSnippet:"if (isnan(x)) return x;\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:kL}),hW={kernelName:Mn,backendName:"webgl",kernelFunc:fW},dW=Dz({opSnippet:"if (isnan(x)) return x;\n  return log(1.0 + x);\n"}),mW={kernelName:Ln,backendName:"webgl",kernelFunc:dW},vW=Oz({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),gW={kernelName:zn,backendName:"webgl",kernelFunc:vW},yW=Dz({opSnippet:"return float(!(x >= 1.0));"}),bW={kernelName:Pn,backendName:"webgl",kernelFunc:yW},xW=Oz({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),kW={kernelName:Zn,backendName:"webgl",kernelFunc:xW},wW=(0,ee.Z)((function e(t,n,r,a,i){(0,$.Z)(this,e),this.variableNames=["x"],this.outputShape=[];var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(s,"; j <= ").concat(s,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(u,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(o,";\n        setOutput(val);\n      }\n    ")})),NW=(0,ee.Z)((function e(t,n,r,a,i){(0,$.Z)(this,e),this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(s,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(s,"; j <= ").concat(s,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(u,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(o,";\n        setOutput(result);\n      }\n    ")})),IW={kernelName:Wn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta,c=it().getBool("WEBGL_PACK_NORMALIZATION")?new NW(a.shape,i,o,s,u):new wW(a.shape,i,o,s,u);return n.runWebGLProgram(c,[a],a.dtype)}},SW=(0,ee.Z)((function e(t,n,r,a,i){(0,$.Z)(this,e),this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=r,this.alpha=a,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(n,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(n," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(a,") * norm + float(").concat(r,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(a,")\n                * float(").concat(i,")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(i,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")})),TW={kernelName:Un,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta,p=new SW(a.shape,s,u,c,l);return n.runWebGLProgram(p,[a,i,o],a.dtype)}};function CW(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reductionIndices,o=r.keepDims,s=a.shape.length,u=Ae(i,a.shape),c=u,l=gp(c,s),p=null!=l,f=n.shouldExecuteOnCPU([a]),h=a;if(p){if(f){for(var d=n.texData.get(h.dataId).values,m=new Array(s),v=0;v<m.length;v++)m[v]=a.shape[l[v]];var g=HL(d,a.shape,a.dtype,l,m);h=n.makeTensorInfo(m,a.dtype),n.texData.get(h.dataId).values=g}else h=Yz(a,l,n);c=bp(c.length,s)}vp("max",c,s);var y,b=dp(h.shape,c),x=(0,oe.Z)(b,2),k=x[0],w=x[1],N=k;if(o&&(N=mp(k,u)),f){var I=n.texData.get(h.dataId).values,S=wL(I,be(w),N,a.dtype);y=n.makeTensorInfo(N,a.dtype),n.texData.get(y.dataId).values=S}else y=function(e,t,n,r){var a=be(t),i=Vz({inputs:{x:e},attrs:{shape:[be(e.shape)/a,a]},backend:r}),o=qz(i,e.dtype,"max",r),s=Vz({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(h,w,N,n);return p&&n.disposeIntermediateTensorInfo(h),y}var EW={kernelName:Vn,backendName:"webgl",kernelFunc:CW},AW=Oz({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:NL}),RW={kernelName:Gn,backendName:"webgl",kernelFunc:AW};var _W={kernelName:Hn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;iM(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;me(jc(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var c=Oc(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&ke(c.inShape,c.outShape))return Nz({inputs:{x:a},backend:n});var l=new OP(c,"max",!1);return n.runWebGLProgram(l,[a],a.dtype)}};var FW={kernelName:qn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=Mc(a.shape,i,o,[1,1,1],s,c,u),p=new MP(l,"max",!1);return n.runWebGLProgram(p,[a],a.dtype)}},DW=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideHeight,r=t.strideWidth,a=t.dilationHeight,i=t.effectiveFilterHeight,o=t.effectiveFilterWidth,s=i-1-t.padInfo.top,u=o-1-t.padInfo.left,c=i*o-1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(i,";\n          wR += ").concat(a,") {\n          float dyR = float(dyRCorner + wR) / ").concat(n,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(o,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(c," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(o," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),OW=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.dilationDepth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterDepth,c=t.effectiveFilterHeight,l=t.effectiveFilterWidth,p=u-1-t.padInfo.front,f=c-1-t.padInfo.top,h=l-1-t.padInfo.left,d=u*c*l-1;this.userCode="\n      const ivec3 pads = ivec3(".concat(p,", ").concat(f,", ").concat(h,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(u,";\n           wD += ").concat(i,") {\n          float dyD = float(dyDCorner + wD) / ").concat(n,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(c,";\n              wR += ").concat(o,") {\n            float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(l,";\n                wC += ").concat(s,") {\n              float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(d," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(c," * ").concat(l," +\n                  wR * ").concat(l," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var MW={kernelName:Kn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=Mc(i.shape,o,s,[1,1,1],u,c),p=new MP(l,"max",!0),f=n.runWebGLProgram(p,[i],i.dtype),h=new OW(l),d=n.runWebGLProgram(h,[a,f],i.dtype);return n.disposeIntermediateTensorInfo(f),d}};var LW={kernelName:jn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;iM([i,t.output],"maxPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,p=Oc(o.shape,s,u,1,c,l),f=new OP(p,"max",!0),h=n.runWebGLProgram(f,[o],o.dtype),d=new DW(p),m=n.runWebGLProgram(d,[a,h],o.dtype);return n.disposeIntermediateTensorInfo(h),m}};var zW={kernelName:Xn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.includeBatchInIndex,c=r;me(4===a.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,".")}));var l=[1,1];me(jc(o,l),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(l,"'")}));var p=Oc(a.shape,i,o,l,s),f=function(e,t,n,r){var a=new OP(n,"max",!1),i=r.runWebGLProgram(a,[e],"float32");return a=new OP(n,"max",!0,!0,t),[i,r.runWebGLProgram(a,[e],"float32")]}(a,u,p,c),h=(0,oe.Z)(f,2);return[h[0],h[1]]}};var PW={kernelName:Yn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.keepDims,o=n.axis,s=r,u=a.shape.length,c=Ae(o,a.shape),l=c,p=gp(l,u),f=null!=p,h=s.shouldExecuteOnCPU([a]),d=[],m=a;if(f){if(h){for(var v=s.texData.get(m.dataId).values,g=new Array(u),y=0;y<g.length;y++)g[y]=a.shape[p[y]];var b=HL(v,a.shape,a.dtype,p,g);m=s.makeTensorInfo(g,a.dtype),s.texData.get(m.dataId).values=b}else m=Yz(a,p,s);d.push(m),l=bp(l.length,u)}vp("sum",l,u);var x=dp(m.shape,l),k=(0,oe.Z)(x,2),w=k[0],N=k[1],I=w;i&&(I=mp(w,c));for(var S=function(e,t,n,r){var a=be(t),i=Vz({inputs:{x:e},attrs:{shape:[be(e.shape)/a,a]},backend:r}),o=qz(i,"float32","mean",r),s=Vz({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(m,N,I,s),T=0,C=d;T<C.length;T++){var E=C[T];s.disposeIntermediateTensorInfo(E)}return S}};var ZW={kernelName:Qn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=Ae(i,a.shape),c=u,l=gp(c,s),p=a;null!=l&&(p=$z({inputs:{x:a},backend:n,attrs:{perm:l}}),c=bp(c.length,a.shape.length)),vp("min",c,s);var f,h=dp(p.shape,c),d=(0,oe.Z)(h,2),m=d[0],v=Vz({inputs:{x:p},backend:n,attrs:{shape:[-1,be(d[1])]}}),g=qz(v,v.dtype,"min",n);return f=Vz(o?{inputs:{x:g},backend:n,attrs:{shape:mp(m,u)}}:{inputs:{x:g},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),null!=l&&n.disposeIntermediateTensorInfo(p),f}},BW=Oz({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:IL}),WW={kernelName:Jn,backendName:"webgl",kernelFunc:BW},UW=(0,ee.Z)((function e(t,n,r){(0,$.Z)(this,e),this.variableNames=["x"],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=FM(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),c="reflect"===r?0:1;this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(a,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(c,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(c,";\n          }\n        }\n        ").concat(i," coords = outC - start;\n        setOutput(getX(").concat(u,"));\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(c,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(c,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")})),VW=(0,ee.Z)((function e(t,n,r){(0,$.Z)(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=FM(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=KL("rc",a),c=KL("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),p=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),f="reflect"===r?0:1,h="";if(1===a){var d="\n        ".concat(i," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(f,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(f,";\n        }\n        source -= start;\n      ");h="\n        ".concat(i," rc = outputLoc;\n        ").concat(d,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(d,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        }\n      ")}else{var m="\n        ".concat(i," source = rc;\n        ").concat(i," lt = ").concat(i,"(lessThan(source, start));\n        ").concat(i," gte = ").concat(i,"(greaterThanEqual(source, end));\n        ").concat(i," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(f,") +\n                gte * ((end - 1) * 2 - source + ").concat(f,");\n        source -= start;\n      ");h="\n        ".concat(i," rc = outputLoc;\n        ").concat(m,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(m,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        }\n        rc = outputLoc;\n        ").concat(u[a-2]," += 1;\n        if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {\n          ").concat(m,"\n          result[2] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n          ").concat(u[a-1]," += 1;\n          if(").concat(l,") {\n            ").concat(m,"\n            result[3] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(h,"\n        setOutput(result);\n      }\n    ")})),GW={kernelName:$n,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode,s=it().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new VW(a.shape,i,o):new UW(a.shape,i,o);return n.runWebGLProgram(s,[a],a.dtype)}},HW=Oz({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),jW={kernelName:er,backendName:"webgl",kernelFunc:HW},qW=(0,ee.Z)((function e(t,n,r){(0,$.Z)(this,e),this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,r],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(n-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(n-1,"));\n      }\n    ")})),KW=Oz({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),XW={kernelName:on,backendName:"webgl",kernelFunc:KW},YW="return a - b;",QW=Oz({opSnippet:YW,packedOpSnippet:YW,supportsComplex:!0,cpuKernelImpl:UL}),JW={kernelName:ea,backendName:"webgl",kernelFunc:QW};function $W(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=Ae([r.dim],a.shape),o=CW({inputs:{x:a},backend:n,attrs:{reductionIndices:i,keepDims:!1}}),s=mp(o.shape,i),u=Vz({inputs:{x:o},backend:n,attrs:{shape:s}}),c=QW({inputs:{a:a,b:u},backend:n}),l=bB({inputs:{x:c},backend:n}),p=Qz({inputs:{x:l},backend:n,attrs:{axis:i,keepDims:!1}}),f=Vz({inputs:{x:p},backend:n,attrs:{shape:s}}),h=KW({inputs:{a:l,b:f},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),h}var eU={kernelName:Ur,backendName:"webgl",kernelFunc:$W};var tU={kernelName:tr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized,u=s?a:$W({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),c=u.shape[0],l=u.shape[1],p=new qW(c,l,i),f=[[o]],h=n.runWebGLProgram(p,[u],"int32",f);return s||n.disposeIntermediateTensorInfo(u),h}};var nU={kernelName:rr,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])){var i=r.texData.get(a.dataId),o=TL(i.values,a.shape,a.dtype),s=(0,oe.Z)(o,2),u=s[0],c=s[1];return r.makeTensorInfo(c,a.dtype,u)}return t=it().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new mz(a.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new tz(a.shape,"if (isnan(x)) return x;\n  return -x;\n"),r.runWebGLProgram(t,[a],a.dtype)}},rU=zh;var aU={kernelName:ir,backendName:"webgl",kernelFunc:function(e){ga("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=n.readSync(a.dataId),l=n.readSync(i.dataId),p=rU(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([p.length],"int32",new Int32Array(p))}},iU=Ph;var oU={kernelName:or,backendName:"webgl",kernelFunc:function(e){ga("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize,l=n.readSync(a.dataId),p=n.readSync(i.dataId),f=iU(l,p,o,s,u,c),h=f.selectedIndices,d=f.validOutputs;return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([d]))]}},sU=Zh;var uU={kernelName:sr,backendName:"webgl",kernelFunc:function(e){ga("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma,l=n.readSync(a.dataId),p=n.readSync(i.dataId),f=sU(l,p,o,s,u,c),h=f.selectedIndices,d=f.selectedScores;return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([d.length],"float32",new Float32Array(d))]}},cU=(0,ee.Z)((function e(t,n,r,a){(0,$.Z)(this,e),this.variableNames=["indices"],this.outputShape=[t,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(a,"), float(").concat(r,"),\n                      float(index == coords.y)));\n      }\n    ")})),lU={kernelName:cr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.depth,o=r.onValue,s=r.offValue,u=be(a.shape),c=new cU(u,i,o,s),l=Vz({inputs:{x:a},backend:n,attrs:{shape:[u]}}),p=n.runWebGLProgram(c,[l],a.dtype);n.disposeIntermediateTensorInfo(l);var f=Vz({inputs:{x:p},backend:n,attrs:{shape:[].concat(Y(a.shape),[i])}});return n.disposeIntermediateTensorInfo(p),f}};function pU(e){var t=e.inputs,n=e.backend,r=t.x;if("complex64"===r.dtype){var a=nZ({inputs:{input:r},backend:n}),i=pU({inputs:{x:a},backend:n}),o=gZ({inputs:{input:r},backend:n}),s=pU({inputs:{x:o},backend:n}),u=Sz({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return RB({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}var fU={kernelName:la,backendName:"webgl",kernelFunc:pU};var hU={kernelName:ur,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===a.dtype){var i=nZ({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=gZ({inputs:{input:a},backend:r}),u=pU({inputs:{x:s},backend:r}),c=Sz({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return RB({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:r})}};var dU={kernelName:lr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return kB({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){ve(a,e.shape,"All tensors passed to stack must have matching shapes"),me(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=xZ({inputs:t.map((function(e){var t=kB({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),s}},mU=(0,ee.Z)((function e(t,n,r){(0,$.Z)(this,e),this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=FM(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ").concat(i," coords = outC - start;\n          setOutput(getX(").concat(u,"));\n        }\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")})),vU=(0,ee.Z)((function e(t,n,r){(0,$.Z)(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));for(var a=t.length,i=FM(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=KL("rc",a),c=KL("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),p=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),f=["".concat(i," rc = outputLoc;"),"".concat(u[a-1]," += 1;\n       if(").concat(l,") {\n      "),1===a?"":"}\n       rc = outputLoc;\n       ".concat(u[a-2]," += 1;\n       if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),1===a?"":"  ".concat(u[a-1]," += 1;\n         if(").concat(l,") {")],h=1===a?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",d="",m=0,v=1===a?2:4;m<v;m++)d+="\n        ".concat(f[m],"\n        if (").concat(h,") {\n          result[").concat(m,"] = float(value);\n        } else {\n          ").concat(i," source = rc - start;\n          result[").concat(m,"] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        }\n      ");d+=1===a?"} ":"}}",this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(d,"\n        setOutput(result);\n      }\n    ")})),gU=function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;if(0===be(a.shape)){var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]}));return RB({backend:n,attrs:{shape:s,value:o,dtype:a.dtype}})}var u=it().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new vU(a.shape,i,o):new mU(a.shape,i,o),c=[[o]];return n.runWebGLProgram(u,[a],a.dtype,c)},yU={kernelName:pr,backendName:"webgl",kernelFunc:gU},bU=Oz({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),xU={kernelName:hr,backendName:"webgl",kernelFunc:bU};var kU={kernelName:mr,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.axis,s=a.keepDims,u=i.shape.length,c=[],l=Ae(o,i.shape),p=l,f=gp(p,u),h=i;if(null!=f&&(h=$z({inputs:{x:i},backend:r,attrs:{perm:f}}),p=bp(p.length,u),c.push(h)),vp("prod",p,u),r.shouldExecuteOnCPU([h])){var d=r.texData.get(h.dataId).values,m=EL(h.shape,h.dtype,d,p),v=m.outVals,g=m.outShape,y=m.outDtype;t=r.makeTensorInfo(g,y,v)}else{var b=dp(h.shape,p),x=(0,oe.Z)(b,2),k=x[0],w=be(x[1]),N=Vz({inputs:{x:h},backend:r,attrs:{shape:[-1,w]}}),I=qz(N,Ni(i.dtype),"prod",r);t=Vz({inputs:{x:I},backend:r,attrs:{shape:k}}),c.push(N),c.push(I)}if(s){c.push(t);var S=mp(t.shape,l);t=Vz({inputs:{x:t},backend:r,attrs:{shape:S}})}return c.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),t}},wU=function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.step,o=n.dtype,s=AL(r,a,i,o);return t.makeTensorInfo([s.length],o,s)},NU={kernelName:vr,backendName:"webgl",kernelFunc:wU},IU=Dz({opSnippet:"return 1.0 / x;"}),SU={kernelName:yr,backendName:"webgl",kernelFunc:IU},TU=Dz({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),CU={kernelName:br,backendName:"webgl",kernelFunc:TU},EU=Dz({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),AU={kernelName:Sr,backendName:"webgl",kernelFunc:EU},RU=(0,ee.Z)((function e(t,n,r,a,i){(0,$.Z)(this,e),this.variableNames=["A"],this.outputShape=[];var o=(0,oe.Z)(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var p,f=[a&&n>1?u-1:u,a&&r>1?c-1:c],h=[a&&n>1?n-1:n,a&&r>1?r-1:r];p=i?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(f[0]/h[0],",\n          ").concat(f[1]/h[1],");\n      const vec2 inputShapeRC = vec2(").concat(u,".0, ").concat(c,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")})),_U=(0,ee.Z)((function e(t,n,r,a,i){(0,$.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=(0,oe.Z)(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var p,f=[a&&n>1?u-1:u,a&&r>1?c-1:c],h=[a&&n>1?n-1:n,a&&r>1?r-1:r];p=i?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(f[0]/h[0],",\n          ").concat(f[1]/h[1],",\n          ").concat(f[1]/h[1],");\n      const vec3 inputShapeRC = vec3(").concat(u,".0, ").concat(c,".0,\n                                     ").concat(c,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")}));var FU={kernelName:Nr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size,u=(0,oe.Z)(s,2),c=u[0],l=u[1],p=it().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new _U(a.shape,c,l,i,o):new RU(a.shape,c,l,i,o);return n.runWebGLProgram(p,[a],"float32")}},DU=(0,ee.Z)((function e(t,n,r){(0,$.Z)(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=(0,oe.Z)(n,3),i=a[1],o=a[2],s=(0,oe.Z)(t,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],p=[r&&u>1?u-1:u,r&&c>1?c-1:c],f=l[0]/p[0],h=l[1]/p[1],d=1/f,m=1/h,v=2*Math.ceil(d)+2,g=2*Math.ceil(m)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(f,");\n        const float widthScale = float(").concat(h,");\n\n        const float invHeightScale = float(").concat(d,");\n        const float invWidthScale = float(").concat(m,");\n\n        const int winHeight = int(").concat(v,");\n        const int winWidth = int(").concat(g,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(i-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(o-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}));var OU={kernelName:Ir,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new DU(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},MU=(0,ee.Z)((function e(t,n,r,a,i){(0,$.Z)(this,e),this.variableNames=["A"],this.outputShape=[];var o=(0,oe.Z)(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var p,f=[a&&n>1?u-1:u,a&&r>1?c-1:c],h=[a&&n>1?n-1:n,a&&r>1?r-1:r],d=a?"0.5":"0.0";p=i?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(f[0]/h[0],",\n          ").concat(f[1]/h[1],");\n      const vec2 inputShapeRC = vec2(").concat(u,".0, ").concat(c,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(d,")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")})),LU=(0,ee.Z)((function e(t,n,r,a,i){(0,$.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=(0,oe.Z)(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var p,f=[a&&n>1?u-1:u,a&&r>1?c-1:c],h=[a&&n>1?n-1:n,a&&r>1?r-1:r],d=a?"0.5":"0.0";p=i?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(f[0]/h[0],",\n          ").concat(f[1]/h[1],",\n          ").concat(f[1]/h[1],");\n      const vec3 inputShapeRC = vec3(").concat(u,".0, ").concat(c,".0,\n                                     ").concat(c,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(d,")));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    ")}));var zU={kernelName:kr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size,u=(0,oe.Z)(s,2),c=u[0],l=u[1],p=it().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new LU(a.shape,c,l,i,o):new MU(a.shape,c,l,i,o);return n.runWebGLProgram(p,[a],a.dtype)}},PU=(0,ee.Z)((function e(t,n,r){(0,$.Z)(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=(0,oe.Z)(n,3),i=a[1],o=a[2],s=(0,oe.Z)(t,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],p=[r&&u>1?u-1:u,r&&c>1?c-1:c],f=l[0]/p[0],h=l[1]/p[1],d=1/f,m=1/h,v=2*Math.ceil(d)+2,g=2*Math.ceil(m)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(f,");\n        const float widthScale = float(").concat(h,");\n\n        const float invHeightScale = float(").concat(d,");\n        const float invWidthScale = float(").concat(m,");\n\n        const int winHeight = int(").concat(v,");\n        const int winWidth = int(").concat(g,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(l[0],") *\n                (float(dyR) / float(").concat(p[0],"));\n\n            float sourceFracCol =\n                float(").concat(l[1],") *\n                  (float(dyC) / float(").concat(p[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(i,") - 1),\n                ").concat(r," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(o,") - 1),\n                ").concat(r," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}));var ZU={kernelName:wr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new PU(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},BU=(0,ee.Z)((function e(t,n){(0,$.Z)(this,e),this.variableNames=["x"];var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));if(this.outputShape=t,1!==r){var a=t.map((function(e,r){return function(e){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - coords[").concat(e,"] - 1"):"coords[".concat(e,"]")}(r)})).join(","),i=FM(r);this.userCode="\n      void main() {\n        ".concat(i," coords = getOutputCoords();\n        setOutput(getX(").concat(a,"));\n      }\n    ")}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(t[0]," - coord - 1));\n        }\n      ")})),WU=(0,ee.Z)((function e(t,n){(0,$.Z)(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));this.outputShape=t;var a=KL("rc",r),i="".concat(a[r-1]," + 1 < ").concat(this.outputShape[r-1]),o="".concat(a[r-2]," + 1 < ").concat(this.outputShape[r-2]),s=FM(r);function u(e){var r=t.map((function(r,a){return function(e,r){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - ").concat(r[e]," - 1"):"".concat(r[e])}(a,e)})),a=r.join(","),i=r.slice(-2).join(",");return"getChannel(getX(".concat(a,"), vec2(").concat(i,"))")}this.userCode=1===r?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(t[0]," - rc - 1),\n            ").concat(t[0]," - rc - 1);\n          if(").concat(i,"){\n              result.g = getChannel(getX(").concat(t[0]," - (rc  + 1) - 1),\n                ").concat(t[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(s," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat(function(e){return u(e)}(a.slice()),";\n          if(").concat(i,"){\n            result.g = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",u(e)}(a.slice()),";\n          }\n          if(").concat(o,") {\n            result.b = ").concat(function(e){return e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            if(").concat(i,") {\n              result.a = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")}));var UU={kernelName:Tr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims,o=a.shape.length,s=Ae(i,a.shape);if(0===o)return Nz({inputs:{x:a},backend:n});var u=it().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new WU(a.shape,s):new BU(a.shape,s);return n.runWebGLProgram(u,[a],a.dtype)}},VU=(0,ee.Z)((function e(t,n){(0,$.Z)(this,e),this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];var r=t[1],a=t[2];this.outputShape=t;var i="";i="number"===typeof n?"float outputValue = ".concat(n.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(n.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ".concat(i,"\n          if(coordX >= 0 && coordX < ").concat(a," && coordY >= 0 && coordY < ").concat(r,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),GU={kernelName:ha,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,c=new VU(a.shape,o),l=Vd(s,a.shape[1],a.shape[2]),p=(0,oe.Z)(l,2),f=[[p[0],p[1],Math.sin(i),Math.cos(i)]];return u.runWebGLProgram(c,[a],a.dtype,f)}},HU=Dz({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),jU={kernelName:Cr,backendName:"webgl",kernelFunc:HU},qU=Dz({opSnippet:"return inversesqrt(x);",cpuKernelImpl:RL}),KU={kernelName:Er,backendName:"webgl",kernelFunc:qU},XU=(0,ee.Z)((function e(t,n,r,a,i,o){(0,$.Z)(this,e),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=FM(i.length),u=FM(o.length),c="";1===r?c="i":2===r&&(c="i, j");var l="getIndices(".concat(c,")"),p="";1===a?p="i":2===a&&(p="i, coords[1]");var f="getUpdates(".concat(p,")"),h=n>1?"strides[j]":"strides";this.userCode="\n        ".concat(s," strides = ").concat(s,"(").concat(i,");\n\n        void main() {\n          ").concat(u," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(t,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(n,"; j++) {\n              int index = round(").concat(l,");\n              flattenedIndex += index * ").concat(h,";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ").concat(f,";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      ")}));var YU={kernelName:Ar,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=js(0,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,p=s.strides,f=s.outputSize,h=[f/l,l];if(0===f)return n.makeTensorInfo(o,a.dtype);var d=Vz({inputs:{x:a},backend:n,attrs:{shape:[c,u]}}),m=Vz({inputs:{x:i},backend:n,attrs:{shape:[c,l]}}),v=n.makeTensorInfo([],"float32",new Float32Array([0])),g=new XU(c,u,d.shape.length,m.shape.length,p,h),y=n.runWebGLProgram(g,[m,d,v],m.dtype),b=Vz({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(v),b}},QU=(0,ee.Z)((function e(t,n,r){var a,i;if((0,$.Z)(this,e),this.variableNames=["c","a","b"],this.outputShape=n,r>4)throw Error("Where for rank ".concat(r," is not yet supported"));if(1===r)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<n.length;c++)u.push("".concat(o[c])),c<t&&s.push("".concat(o[c]));a=s.join(),i=u.join()}var l=FM(r);this.userCode="\n      void main() {\n        ".concat(l," resRC = getOutputCoords();\n        float cVal = getC(").concat(a,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(i,"));\n        } else {\n          setOutput(getB(").concat(i,"));\n        }\n      }\n    ")}));var JU={kernelName:Rr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e,o=new QU(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(o,[r,a,i],wi(a.dtype,i.dtype))}},$U=Dz({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(Xd,";\n  float scale = ").concat(Yd,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n")}),eV={kernelName:_r,backendName:"webgl",kernelFunc:$U},tV=Dz({opSnippet:"if (isnan(x)) return x;\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:_L}),nV={kernelName:Lr,backendName:"webgl",kernelFunc:tV},rV=Dz({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),aV={kernelName:Mr,backendName:"webgl",kernelFunc:rV},iV=Dz({opSnippet:"if (isnan(x)) return x;\n  return sin(x);\n"}),oV={kernelName:Dr,backendName:"webgl",kernelFunc:iV},sV=Dz({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),uV={kernelName:Or,backendName:"webgl",kernelFunc:sV},cV=Dz({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),lV={kernelName:zr,backendName:"webgl",kernelFunc:cV},pV={kernelName:Br,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;me(a.shape.length<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=[[0,0]];u.push.apply(u,Y(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=[],p=gU({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),f=Gd(p.shape,i,s,!1),h=Hd(f.length,i.length,!1),d=jd(p.shape,i,s,!1),m=Vz({inputs:{x:p},backend:n,attrs:{shape:f}}),v=$z({inputs:{x:m},backend:n,attrs:{perm:h}}),g=Vz({inputs:{x:v},backend:n,attrs:{shape:d}});return l.push(p),l.push(m),l.push(v),l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}};var fV={kernelName:Vr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,i=t.denseShape,o=t.defaultValue;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n         ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n         ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n         ".concat(a.shape));if(0!==o.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(o.shape));var s=n.readSync(r.dataId),u=n.readSync(a.dataId),c=n.readSync(i.dataId),l=n.readSync(o.dataId)[0],p=OL(s,r.shape,r.dtype,u,a.dtype,c,l),f=(0,oe.Z)(p,5),h=f[0],d=f[1],m=f[2],v=f[3],g=f[4];return[n.makeTensorInfo(d,r.dtype,h),n.makeTensorInfo([d[0]],a.dtype,m),n.makeTensorInfo([v.length],"bool",new Uint8Array(v.map((function(e){return Number(e)})))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}};var hV={kernelName:Gr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,i=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(n.readSync(a.dataId)),s=n.readSync(r.dataId),u=Array.from(n.readSync(i.dataId)),c=ML(s,r.shape,r.dtype,o,u),l=(0,oe.Z)(c,3),p=l[0],f=l[1],h=l[2];return[n.makeTensorInfo(f,r.dtype,p),n.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}};var dV={kernelName:Hr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n              ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n              ".concat(i.shape));var o=n.readSync(r.dataId),s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=LL(o,r.shape,r.dtype,s,u,!0),l=(0,oe.Z)(c,2),p=l[0],f=l[1];return n.makeTensorInfo(f,r.dtype,p)}};var mV={kernelName:jr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n             ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n             ".concat(i.shape));var o=n.readSync(r.dataId),s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=LL(o,r.shape,r.dtype,s,u),l=(0,oe.Z)(c,2),p=l[0],f=l[1];return n.makeTensorInfo(f,r.dtype,p)}};var vV={kernelName:qr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sparseIndices,i=t.sparseValues,o=t.defaultValue,s=r.outputShape,u=js(0,a,s),c=u.sliceRank,l=u.numUpdates,p=u.strides,f=u.outputSize,h=new XU(l,c,a.shape.length,i.shape.length,p,[f,1],!1),d=n.runWebGLProgram(h,[i,a,o],i.dtype),m=Vz({inputs:{x:d},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(d),m}};var gV={kernelName:Wr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=Ae(r.axis,a.shape)[0],s=bm(a,i,o),u=a.shape.length,c=new Array(u).fill(0),l=a.shape.slice();return s.map((function(e){var t=Y(l);t[o]=e;var r=XP({inputs:{x:a},backend:n,attrs:{begin:c,size:t}});return c[o]+=e,r}))}},yV="return sqrt(x);",bV=Dz({opSnippet:yV,packedOpSnippet:yV,cpuKernelImpl:zL}),xV={kernelName:Pr,backendName:"webgl",kernelFunc:bV},kV=Dz({opSnippet:"return x * x;"}),wV={kernelName:Xr,backendName:"webgl",kernelFunc:kV},NV="return (a - b) * (a - b);",IV=Oz({opSnippet:NV,packedOpSnippet:NV}),SV={kernelName:Kr,backendName:"webgl",kernelFunc:IV};var TV={kernelName:pa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=nz+"\n    return x > 0.0 ? 1.0 : float(".concat(n.alpha,");\n  "),o=new tz(a.shape,i);return r.runWebGLProgram(o,[a],a.dtype)}},CV=(0,ee.Z)((function e(t,n,r){(0,$.Z)(this,e),this.variableNames=["x"],this.outputShape=r;var a=r.length,i=FM(r.length),o=FM(r.length),s="";if(1===a)s="coords * strides + begin";else{var u=0;s=r.map((function(e,t){return u++,1===r.length?"coords * strides[".concat(t,"] + begin[").concat(t,"]"):"coords[".concat(u-1,"] * strides[").concat(t,"] + begin[").concat(t,"]")})).join(",")}this.userCode="\n      ".concat(i," begin = ").concat(i,"(").concat(t,");\n      ").concat(i," strides = ").concat(i,"(").concat(n,");\n\n      void main() {\n        ").concat(o," coords = getOutputCoords();\n        setOutput(getX(").concat(s,"));\n      }\n    ")}));var EV={kernelName:Yr,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.begin,s=a.end,u=a.strides,c=a.beginMask,l=a.endMask,p=a.ellipsisMask,f=a.newAxisMask,h=a.shrinkAxisMask,d=uu(i.shape,o,s,u,c,l,p,f,h),m=d.finalShapeSparse,v=d.finalShape,g=d.isIdentity,y=d.sliceDim0,b=d.isSimpleSlice,x=d.begin,k=d.end,w=d.strides;if(g)t=Vz({inputs:{x:i},backend:r,attrs:{shape:v}});else if(y||b){me(i.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(i.shape.length)}));var N=Xs(x,k,w),I=XP({inputs:{x:i},backend:r,attrs:{begin:x,size:N}});t=Vz({inputs:{x:I},backend:r,attrs:{shape:v}}),r.disposeIntermediateTensorInfo(I)}else{if(r.shouldExecuteOnCPU([i])){var S=r.readSync(i.dataId),T=rs(i.shape,i.dtype,S),C=PL(m,T,w,x);t=r.makeTensorInfo(v,i.dtype,C.values)}else{var E=new CV(x,w,m);t=r.runWebGLProgram(E,[i],i.dtype)}}var A=Vz({inputs:{x:t},backend:r,attrs:{shape:v}});return r.disposeIntermediateTensorInfo(t),A}};var AV={kernelName:Qr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,c=r.preserveShortSequences,l=t.data,p=t.dataSplits,f=n.readSync(l.dataId),h=n.readSync(p.dataId),d=ZL(f,h,a,i,o,s,u,c),m=(0,oe.Z)(d,2),v=m[0],g=m[1];return[n.makeTensorInfo([v.length],"string",v),n.makeTensorInfo(p.shape,"int32",g)]}};var RV={kernelName:Jr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,i=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==i.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(i.shape));var o=n.readSync(a.dataId),s=n.readSync(i.dataId)[0],u=BL(o,s,r),c=(0,oe.Z)(u,3),l=c[0],p=c[1],f=c[2],h=p.length;return[n.makeTensorInfo([h,2],"int32",l),n.makeTensorInfo([h],"string",p),n.makeTensorInfo([2],"int32",new Int32Array(f))]}};var _V={kernelName:$r,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var i=n.readSync(a.dataId),o=WL(i,r);return n.makeTensorInfo(a.shape,"int32",o)}},FV=Dz({opSnippet:"return tan(x);"}),DV={kernelName:ta,backendName:"webgl",kernelFunc:FV},OV=Dz({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),MV={kernelName:na,backendName:"webgl",kernelFunc:OV},LV=(0,ee.Z)((function e(t,n){(0,$.Z)(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[a]*n[a];this.outputShape=r,this.rank=r.length;var i=FM(this.rank),o=function(e){var t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<e.length;a++)r.push("imod(".concat(n[a],", ").concat(e[a],")"));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        setOutput(getA(").concat(o,"));\n      }\n    ")}));function zV(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;if("string"===a.dtype||a.shape.length>5){var o=n.readSync(a.dataId),s="string"===a.dtype?o.map((function(e){return Ja(e)})):o,u=rs(a.shape,a.dtype,s),c=VL(u,i);return n.makeTensorInfo(c.shape,c.dtype,c.values)}var l=new LV(a.shape,i);return n.runWebGLProgram(l,[a],a.dtype)}var PV={kernelName:ra,backendName:"webgl",kernelFunc:zV},ZV=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "})),BV=(0,ee.Z)((function e(t){(0,$.Z)(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}));function WV(e,t){null!==t&&e.disposeIntermediateTensorInfo(t)}function UV(e){for(var t=1;t<e;)t*=2;return t}var VV={kernelName:aa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted,s=it().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=it().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=a.shape,l=c[c.length-1];if(n.shouldExecuteOnCPU([a])||l<s||i>u){var p=n.readSync(a.dataId),f=GL(p,c,a.dtype,i,o),h=(0,oe.Z)(f,2),d=h[0],m=h[1];return[n.makeTensorInfo(d.shape,d.dtype,d.values),n.makeTensorInfo(m.shape,m.dtype,m.values)]}if(0===i)return c[c.length-1]=0,[n.makeTensorInfo(c,a.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(1===l)return[a,RB({attrs:{shape:c,dtype:"int32",value:0},backend:n})];var v=n.texData.get(a.dataId),g=null!==v&&v.isPacked,y=g?n.unpackTensor(a):a,b=be(c)/l,x=Vz({inputs:{x:y},attrs:{shape:[b,l]},backend:n});g&&WV(n,y);for(var k=UV(i),w=UV(l),N=null,I=function(){return null===N?[x,x]:[x,N]},S=function(e,t,r){var a=I(),i=new ZV(r),o=[[l],[null===N?1:0],[Number.NEGATIVE_INFINITY],[e],[t]],s=N;N=n.runWebGLProgram(i,a,"int32",o),WV(n,s)},T=1;T<k;T*=2)for(var C=2*T,E=T;E>=1;E/=2)S(C,E,[b,w]);for(var A=w;A>k;A/=2){var R=I(),_=new BV([b,A/2]),F=[[l],[null===N?1:0],[k]],D=N;N=n.runWebGLProgram(_,R,"int32",F),WV(n,D);for(var O=k/2,M=2*O,L=O;L>=1;L/=2)S(M,L,N.shape)}var z=N;N=XP({inputs:{x:N},backend:n,attrs:{begin:0,size:[b,i]}}),WV(n,z);var P=KB({inputs:{x:x,indices:N},backend:n,attrs:{axis:1,batchDims:1}});WV(n,x);var Z=c.slice(0,-1);Z.push(i),z=N,N=Vz({inputs:{x:N},attrs:{shape:Z},backend:n}),WV(n,z);var B=P;return P=Vz({inputs:{x:P},attrs:{shape:Z},backend:n}),WV(n,B),[P,N]}},GV=(0,ee.Z)((function e(t,n,r,a,i,o){(0,$.Z)(this,e),this.variableNames=["Image","Transforms"],this.outputShape=o;var s,u="nearest"===r?1:2;switch(a){case"constant":default:s=1;break;case"reflect":s=2;break;case"wrap":s=3;break;case"nearest":s=4}this.userCode="\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(".concat(s," == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ").concat(t," && 0 <= coordX && coordX < ").concat(n,") {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(").concat(i,");\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(").concat(i,");\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(").concat(n,"));\n                float mapY = mapCoord(inY, float(").concat(t,"));\n\n                if (").concat(u," == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        ")}));var HV={kernelName:ia,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.transforms,o=r.interpolation,s=r.fillMode,u=r.fillValue,c=r.outputShape,l=(0,oe.Z)(a.shape,4),p=l[0],f=l[1],h=l[2],d=l[3],m=null!=c?c:[f,h],v=(0,oe.Z)(m,2),g=v[0],y=v[1],b=new GV(f,h,o,s,u,[p,g,y,d]);return n.runWebGLProgram(b,[a,i],"float32")}};var jV={kernelName:sa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;iM(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=r.readSync(i.dataId),s=jL(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[r.makeTensorInfo(c,i.dtype,u),r.makeTensorInfo([l.length],"int32",l)]}};var qV={kernelName:ua,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],c=new Array(s-1),l=0,p=0;p<s;p++)p!==i&&(c[l++]=o.shape[p]);var f=[],h=new Array(s).fill(0),d=o.shape.slice();d[i]=1;for(var m=new Array(u),v=0;v<m.length;v++){h[i]=v;var g=XP({inputs:{x:o},backend:n,attrs:{begin:h,size:d}}),y=Vz({inputs:{x:g},backend:n,attrs:{shape:c}});m[v]=y,f.push(g)}return f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),m}},KV=(0,ee.Z)((function e(t,n){(0,$.Z)(this,e),this.variableNames=["x","segmentIds"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.numSegments,s=o*Math.ceil(i/r);this.outputShape=[a,s];var u=4*Math.floor(r/4),c=r%4,l="\n        sumValue += dot(values, segFilter);\n    ",p="";i%r>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      "));var f="";i%r>0&&(f="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat("0.0",";\n\n      float getValue(int batch, int inIdx) {\n        ").concat(p,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(f,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(o,")) * float(").concat(r,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(o,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(u,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(u,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(l,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(l,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(l,"\n        }\n        setOutput(").concat("sumValue",");\n      }\n    ")}));for(var XV={kernelName:ca,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments,s=a.shape.length,u=[],c=0,l=gp([c],s),p=a;null!=l&&(p=$z({inputs:{x:a},backend:n,attrs:{perm:l}}),u.push(p),c=bp(1,s)[0]);var f=Dm(p.shape,c,o),h=be([p.shape[c]]),d=Vz({inputs:{x:p},backend:n,attrs:{shape:[-1,h]}});u.push(d);var m=function e(t,r,a,i,o){var s=t.shape[0],c=t.shape[1],l=Fm(c,o),p=new KV({windowSize:l,inSize:c,batchSize:s,numSegments:o},r),f=n.compileAndRun(p,[t,a],i);if(u.push(f),f.shape[1]===o)return f;var h=wU({backend:n,attrs:{start:0,stop:o,step:1,dtype:"float32"}}),d=zV({inputs:{x:h},backend:n,attrs:{reps:[c/l]}});return u.push(h),u.push(d),e(f,r,d,i,o)}(d,"unsortedSegmentSum",i,Ni(a.dtype),o),v=Vz({inputs:{x:m},backend:n,attrs:{shape:f}}),g=v;if(null!=l){u.push(v);var y=yp(l);g=$z({inputs:{x:g},backend:n,attrs:{perm:y}})}return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}},YV=0,QV=[nP,aP,oP,uP,pP,dP,mP,vP,wP,NP,SP,CP,AP,_P,DP,LP,zP,BP,WP,UP,HP,QP,JP,$P,aZ,sZ,lZ,Tz,hZ,kZ,CZ,FZ,DZ,OZ,MZ,LZ,PZ,BZ,UZ,jZ,YZ,QZ,$Z,nB,iB,oB,uB,lB,pB,hB,dB,vB,yB,xB,wB,SB,EB,FB,OB,zB,ZB,UB,VB,GB,jB,XB,QB,$B,Iz,eW,yZ,nW,aW,oW,Az,uW,lW,pW,hW,mW,gW,bW,kW,IW,TW,EW,RW,_W,FW,MW,LW,zW,PW,ZW,WW,GW,jW,tU,Uz,nU,aU,oU,uU,tZ,lU,hU,dU,yU,xU,Fz,kU,NU,rZ,XW,SU,CU,AU,Gz,FU,OU,zU,ZU,UU,GU,jU,KU,YU,JU,eV,nV,aV,oV,uV,YP,eU,lV,pV,fV,hV,dV,mV,vV,gV,xV,wV,SV,TV,EV,AV,RV,_V,JW,Jz,DV,MV,PV,VV,HV,eP,jV,qV,XV,fU];YV<QV.length;YV++){Ia(QV[YV])}var JV={"tfjs-core":Iu,"tfjs-backend-cpu":"3.15.0","tfjs-backend-webgl":"3.15.0","tfjs-data":hE,"tfjs-layers":_x,"tfjs-converter":QT,tfjs:"3.15.0"}},987:function(e){e.exports=n;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(S){}function n(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function r(e){return!0===(e&&e.__isLong__)}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=r;var a={},i={};function o(e,t){var n,r,o;return t?(o=0<=(e>>>=0)&&e<256)&&(r=i[e])?r:(n=u(e,(0|e)<0?-1:0,!0),o&&(i[e]=n),n):(o=-128<=(e|=0)&&e<128)&&(r=a[e])?r:(n=u(e,e<0?-1:0,!1),o&&(a[e]=n),n)}function s(e,t){if(isNaN(e))return t?g:v;if(t){if(e<0)return g;if(e>=h)return w}else{if(e<=-d)return N;if(e+1>=d)return k}return e<0?s(-e,t).neg():u(e%f|0,e/f|0,t)}function u(e,t,r){return new n(e,t,r)}n.fromInt=o,n.fromNumber=s,n.fromBits=u;var c=Math.pow;function l(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return v;if("number"===typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return l(e.substring(1),t,n).neg();for(var a=s(c(n,8)),i=v,o=0;o<e.length;o+=8){var u=Math.min(8,e.length-o),p=parseInt(e.substring(o,o+u),n);if(u<8){var f=s(c(n,u));i=i.mul(f).add(s(p))}else i=(i=i.mul(a)).add(s(p))}return i.unsigned=t,i}function p(e,t){return"number"===typeof e?s(e,t):"string"===typeof e?l(e,t):u(e.low,e.high,"boolean"===typeof t?t:e.unsigned)}n.fromString=l,n.fromValue=p;var f=4294967296,h=f*f,d=h/2,m=o(1<<24),v=o(0);n.ZERO=v;var g=o(0,!0);n.UZERO=g;var y=o(1);n.ONE=y;var b=o(1,!0);n.UONE=b;var x=o(-1);n.NEG_ONE=x;var k=u(-1,2147483647,!1);n.MAX_VALUE=k;var w=u(-1,-1,!0);n.MAX_UNSIGNED_VALUE=w;var N=u(0,-2147483648,!1);n.MIN_VALUE=N;var I=n.prototype;I.toInt=function(){return this.unsigned?this.low>>>0:this.low},I.toNumber=function(){return this.unsigned?(this.high>>>0)*f+(this.low>>>0):this.high*f+(this.low>>>0)},I.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(N)){var t=s(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var a=s(c(e,6),this.unsigned),i=this,o="";;){var u=i.div(a),l=(i.sub(u.mul(a)).toInt()>>>0).toString(e);if((i=u).isZero())return l+o;for(;l.length<6;)l="0"+l;o=""+l+o}},I.getHighBits=function(){return this.high},I.getHighBitsUnsigned=function(){return this.high>>>0},I.getLowBits=function(){return this.low},I.getLowBitsUnsigned=function(){return this.low>>>0},I.getNumBitsAbs=function(){if(this.isNegative())return this.eq(N)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},I.isZero=function(){return 0===this.high&&0===this.low},I.eqz=I.isZero,I.isNegative=function(){return!this.unsigned&&this.high<0},I.isPositive=function(){return this.unsigned||this.high>=0},I.isOdd=function(){return 1===(1&this.low)},I.isEven=function(){return 0===(1&this.low)},I.equals=function(e){return r(e)||(e=p(e)),(this.unsigned===e.unsigned||this.high>>>31!==1||e.high>>>31!==1)&&(this.high===e.high&&this.low===e.low)},I.eq=I.equals,I.notEquals=function(e){return!this.eq(e)},I.neq=I.notEquals,I.ne=I.notEquals,I.lessThan=function(e){return this.comp(e)<0},I.lt=I.lessThan,I.lessThanOrEqual=function(e){return this.comp(e)<=0},I.lte=I.lessThanOrEqual,I.le=I.lessThanOrEqual,I.greaterThan=function(e){return this.comp(e)>0},I.gt=I.greaterThan,I.greaterThanOrEqual=function(e){return this.comp(e)>=0},I.gte=I.greaterThanOrEqual,I.ge=I.greaterThanOrEqual,I.compare=function(e){if(r(e)||(e=p(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},I.comp=I.compare,I.negate=function(){return!this.unsigned&&this.eq(N)?N:this.not().add(y)},I.neg=I.negate,I.add=function(e){r(e)||(e=p(e));var t=this.high>>>16,n=65535&this.high,a=this.low>>>16,i=65535&this.low,o=e.high>>>16,s=65535&e.high,c=e.low>>>16,l=0,f=0,h=0,d=0;return h+=(d+=i+(65535&e.low))>>>16,f+=(h+=a+c)>>>16,l+=(f+=n+s)>>>16,l+=t+o,u((h&=65535)<<16|(d&=65535),(l&=65535)<<16|(f&=65535),this.unsigned)},I.subtract=function(e){return r(e)||(e=p(e)),this.add(e.neg())},I.sub=I.subtract,I.multiply=function(e){if(this.isZero())return v;if(r(e)||(e=p(e)),t)return u(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return v;if(this.eq(N))return e.isOdd()?N:v;if(e.eq(N))return this.isOdd()?N:v;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(m)&&e.lt(m))return s(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=65535&this.high,i=this.low>>>16,o=65535&this.low,c=e.high>>>16,l=65535&e.high,f=e.low>>>16,h=65535&e.low,d=0,g=0,y=0,b=0;return y+=(b+=o*h)>>>16,g+=(y+=i*h)>>>16,y&=65535,g+=(y+=o*f)>>>16,d+=(g+=a*h)>>>16,g&=65535,d+=(g+=i*f)>>>16,g&=65535,d+=(g+=o*l)>>>16,d+=n*h+a*f+i*l+o*c,u((y&=65535)<<16|(b&=65535),(d&=65535)<<16|(g&=65535),this.unsigned)},I.mul=I.multiply,I.divide=function(e){if(r(e)||(e=p(e)),e.isZero())throw Error("division by zero");var n,a,i;if(t)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?u((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?g:v;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return g;if(e.gt(this.shru(1)))return b;i=g}else{if(this.eq(N))return e.eq(y)||e.eq(x)?N:e.eq(N)?y:(n=this.shr(1).div(e).shl(1)).eq(v)?e.isNegative()?y:x:(a=this.sub(e.mul(n)),i=n.add(a.div(e)));if(e.eq(N))return this.unsigned?g:v;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=v}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),l=o<=48?1:c(2,o-48),f=s(n),h=f.mul(e);h.isNegative()||h.gt(a);)h=(f=s(n-=l,this.unsigned)).mul(e);f.isZero()&&(f=y),i=i.add(f),a=a.sub(h)}return i},I.div=I.divide,I.modulo=function(e){return r(e)||(e=p(e)),t?u((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},I.mod=I.modulo,I.rem=I.modulo,I.not=function(){return u(~this.low,~this.high,this.unsigned)},I.and=function(e){return r(e)||(e=p(e)),u(this.low&e.low,this.high&e.high,this.unsigned)},I.or=function(e){return r(e)||(e=p(e)),u(this.low|e.low,this.high|e.high,this.unsigned)},I.xor=function(e){return r(e)||(e=p(e)),u(this.low^e.low,this.high^e.high,this.unsigned)},I.shiftLeft=function(e){return r(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?u(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):u(0,this.low<<e-32,this.unsigned)},I.shl=I.shiftLeft,I.shiftRight=function(e){return r(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):u(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},I.shr=I.shiftRight,I.shiftRightUnsigned=function(e){if(r(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?u(this.low>>>e|t<<32-e,t>>>e,this.unsigned):u(32===e?t:t>>>e-32,0,this.unsigned)},I.shru=I.shiftRightUnsigned,I.shr_u=I.shiftRightUnsigned,I.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},I.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},I.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},I.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},I.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,r){return r?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},725:function(e){"use strict";var t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;function a(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(a){return!1}}()?Object.assign:function(e,i){for(var o,s,u=a(e),c=1;c<arguments.length;c++){for(var l in o=Object(arguments[c]))n.call(o,l)&&(u[l]=o[l]);if(t){s=t(o);for(var p=0;p<s.length;p++)r.call(o,s[p])&&(u[s[p]]=o[s[p]])}}return u}},463:function(e,t,n){"use strict";var r=n(791),a=n(725),i=n(990);function o(e,t,n,r,a,i,o,s){if(!e){if(e=void 0,void 0===t)e=Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var u=[n,r,a,i,o,s],c=0;(e=Error(t.replace(/%s/g,(function(){return u[c++]})))).name="Invariant Violation"}throw e.framesToPop=1,e}}function s(e){for(var t=arguments.length-1,n="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=0;r<t;r++)n+="&args[]="+encodeURIComponent(arguments[r+1]);o(!1,"Minified React error #"+e+"; visit %s for the full message or use the non-minified dev environment for full errors and additional helpful warnings. ",n)}function u(e,t,n,r,a,i,o,s,u){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(l){this.onError(l)}}r||s("227");var c=!1,l=null,p=!1,f=null,h={onError:function(e){c=!0,l=e}};function d(e,t,n,r,a,i,o,s,p){c=!1,l=null,u.apply(h,arguments)}var m=null,v={};function g(){if(m)for(var e in v){var t=v[e],n=m.indexOf(e);if(-1<n||s("96",e),!b[n])for(var r in t.extractEvents||s("97",e),b[n]=t,n=t.eventTypes){var a=void 0,i=n[r],o=t,u=r;x.hasOwnProperty(u)&&s("99",u),x[u]=i;var c=i.phasedRegistrationNames;if(c){for(a in c)c.hasOwnProperty(a)&&y(c[a],o,u);a=!0}else i.registrationName?(y(i.registrationName,o,u),a=!0):a=!1;a||s("98",r,e)}}}function y(e,t,n){k[e]&&s("100",e),k[e]=t,w[e]=t.eventTypes[n].dependencies}var b=[],x={},k={},w={},N=null,I=null,S=null;function T(e,t,n,r){t=e.type||"unknown-event",e.currentTarget=S(r),function(e,t,n,r,a,i,o,u,h){if(d.apply(this,arguments),c){if(c){var m=l;c=!1,l=null}else s("198"),m=void 0;p||(p=!0,f=m)}}(t,n,void 0,e),e.currentTarget=null}function C(e,t){return null==t&&s("30"),null==e?t:Array.isArray(e)?Array.isArray(t)?(e.push.apply(e,t),e):(e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}function E(e,t,n){Array.isArray(e)?e.forEach(t,n):e&&t.call(n,e)}var A=null;function R(e,t){if(e){var n=e._dispatchListeners,r=e._dispatchInstances;if(Array.isArray(n))for(var a=0;a<n.length&&!e.isPropagationStopped();a++)T(e,t,n[a],r[a]);else n&&T(e,t,n,r);e._dispatchListeners=null,e._dispatchInstances=null,e.isPersistent()||e.constructor.release(e)}}function _(e){return R(e,!0)}function F(e){return R(e,!1)}var D={injectEventPluginOrder:function(e){m&&s("101"),m=Array.prototype.slice.call(e),g()},injectEventPluginsByName:function(e){var t,n=!1;for(t in e)if(e.hasOwnProperty(t)){var r=e[t];v.hasOwnProperty(t)&&v[t]===r||(v[t]&&s("102",t),v[t]=r,n=!0)}n&&g()}};function O(e,t){var n=e.stateNode;if(!n)return null;var r=N(n);if(!r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}return e?null:(n&&"function"!==typeof n&&s("231",t,typeof n),n)}function M(e,t){if(null!==e&&(A=C(A,e)),e=A,A=null,e&&(E(e,t?_:F),A&&s("95"),p))throw t=f,p=!1,f=null,t}var L=Math.random().toString(36).slice(2),z="__reactInternalInstance$"+L,P="__reactEventHandlers$"+L;function Z(e){if(e[z])return e[z];for(;!e[z];){if(!e.parentNode)return null;e=e.parentNode}return 7===(e=e[z]).tag||8===e.tag?e:null}function B(e){return!(e=e[z])||7!==e.tag&&8!==e.tag?null:e}function W(e){if(7===e.tag||8===e.tag)return e.stateNode;s("33")}function U(e){return e[P]||null}function V(e){do{e=e.return}while(e&&7!==e.tag);return e||null}function G(e,t,n){(t=O(e,n.dispatchConfig.phasedRegistrationNames[t]))&&(n._dispatchListeners=C(n._dispatchListeners,t),n._dispatchInstances=C(n._dispatchInstances,e))}function H(e){if(e&&e.dispatchConfig.phasedRegistrationNames){for(var t=e._targetInst,n=[];t;)n.push(t),t=V(t);for(t=n.length;0<t--;)G(n[t],"captured",e);for(t=0;t<n.length;t++)G(n[t],"bubbled",e)}}function j(e,t,n){e&&n&&n.dispatchConfig.registrationName&&(t=O(e,n.dispatchConfig.registrationName))&&(n._dispatchListeners=C(n._dispatchListeners,t),n._dispatchInstances=C(n._dispatchInstances,e))}function q(e){e&&e.dispatchConfig.registrationName&&j(e._targetInst,null,e)}function K(e){E(e,H)}var X=!("undefined"===typeof window||!window.document||!window.document.createElement);function Y(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Q={animationend:Y("Animation","AnimationEnd"),animationiteration:Y("Animation","AnimationIteration"),animationstart:Y("Animation","AnimationStart"),transitionend:Y("Transition","TransitionEnd")},J={},$={};function ee(e){if(J[e])return J[e];if(!Q[e])return e;var t,n=Q[e];for(t in n)if(n.hasOwnProperty(t)&&t in $)return J[e]=n[t];return e}X&&($=document.createElement("div").style,"AnimationEvent"in window||(delete Q.animationend.animation,delete Q.animationiteration.animation,delete Q.animationstart.animation),"TransitionEvent"in window||delete Q.transitionend.transition);var te=ee("animationend"),ne=ee("animationiteration"),re=ee("animationstart"),ae=ee("transitionend"),ie="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),oe=null,se=null,ue=null;function ce(){if(ue)return ue;var e,t,n=se,r=n.length,a="value"in oe?oe.value:oe.textContent,i=a.length;for(e=0;e<r&&n[e]===a[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===a[i-t];t++);return ue=a.slice(e,1<t?1-t:void 0)}function le(){return!0}function pe(){return!1}function fe(e,t,n,r){for(var a in this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=n,e=this.constructor.Interface)e.hasOwnProperty(a)&&((t=e[a])?this[a]=t(n):"target"===a?this.target=r:this[a]=n[a]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?le:pe,this.isPropagationStopped=pe,this}function he(e,t,n,r){if(this.eventPool.length){var a=this.eventPool.pop();return this.call(a,e,t,n,r),a}return new this(e,t,n,r)}function de(e){e instanceof this||s("279"),e.destructor(),10>this.eventPool.length&&this.eventPool.push(e)}function me(e){e.eventPool=[],e.getPooled=he,e.release=de}a(fe.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=le)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=le)},persist:function(){this.isPersistent=le},isPersistent:pe,destructor:function(){var e,t=this.constructor.Interface;for(e in t)this[e]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=pe,this._dispatchInstances=this._dispatchListeners=null}}),fe.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},fe.extend=function(e){function t(){}function n(){return r.apply(this,arguments)}var r=this;t.prototype=r.prototype;var i=new t;return a(i,n.prototype),n.prototype=i,n.prototype.constructor=n,n.Interface=a({},r.Interface,e),n.extend=r.extend,me(n),n},me(fe);var ve=fe.extend({data:null}),ge=fe.extend({data:null}),ye=[9,13,27,32],be=X&&"CompositionEvent"in window,xe=null;X&&"documentMode"in document&&(xe=document.documentMode);var ke=X&&"TextEvent"in window&&!xe,we=X&&(!be||xe&&8<xe&&11>=xe),Ne=String.fromCharCode(32),Ie={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},Se=!1;function Te(e,t){switch(e){case"keyup":return-1!==ye.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function Ce(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Ee=!1;var Ae={eventTypes:Ie,extractEvents:function(e,t,n,r){var a=void 0,i=void 0;if(be)e:{switch(e){case"compositionstart":a=Ie.compositionStart;break e;case"compositionend":a=Ie.compositionEnd;break e;case"compositionupdate":a=Ie.compositionUpdate;break e}a=void 0}else Ee?Te(e,n)&&(a=Ie.compositionEnd):"keydown"===e&&229===n.keyCode&&(a=Ie.compositionStart);return a?(we&&"ko"!==n.locale&&(Ee||a!==Ie.compositionStart?a===Ie.compositionEnd&&Ee&&(i=ce()):(se="value"in(oe=r)?oe.value:oe.textContent,Ee=!0)),a=ve.getPooled(a,t,n,r),i?a.data=i:null!==(i=Ce(n))&&(a.data=i),K(a),i=a):i=null,(e=ke?function(e,t){switch(e){case"compositionend":return Ce(t);case"keypress":return 32!==t.which?null:(Se=!0,Ne);case"textInput":return(e=t.data)===Ne&&Se?null:e;default:return null}}(e,n):function(e,t){if(Ee)return"compositionend"===e||!be&&Te(e,t)?(e=ce(),ue=se=oe=null,Ee=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return we&&"ko"!==t.locale?null:t.data}}(e,n))?((t=ge.getPooled(Ie.beforeInput,t,n,r)).data=e,K(t)):t=null,null===i?t:null===t?i:[i,t]}},Re=null,_e=null,Fe=null;function De(e){if(e=I(e)){"function"!==typeof Re&&s("280");var t=N(e.stateNode);Re(e.stateNode,e.type,t)}}function Oe(e){_e?Fe?Fe.push(e):Fe=[e]:_e=e}function Me(){if(_e){var e=_e,t=Fe;if(Fe=_e=null,De(e),t)for(e=0;e<t.length;e++)De(t[e])}}function Le(e,t){return e(t)}function ze(e,t,n){return e(t,n)}function Pe(){}var Ze=!1;function Be(e,t){if(Ze)return e(t);Ze=!0;try{return Le(e,t)}finally{Ze=!1,(null!==_e||null!==Fe)&&(Pe(),Me())}}var We={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ue(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!We[e.type]:"textarea"===t}function Ve(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}function Ge(e){if(!X)return!1;var t=(e="on"+e)in document;return t||((t=document.createElement("div")).setAttribute(e,"return;"),t="function"===typeof t[e]),t}function He(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function je(e){e._valueTracker||(e._valueTracker=function(e){var t=He(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var a=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(e){r=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function qe(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=He(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}var Ke=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Xe=/^(.*)[\\\/]/,Ye="function"===typeof Symbol&&Symbol.for,Qe=Ye?Symbol.for("react.element"):60103,Je=Ye?Symbol.for("react.portal"):60106,$e=Ye?Symbol.for("react.fragment"):60107,et=Ye?Symbol.for("react.strict_mode"):60108,tt=Ye?Symbol.for("react.profiler"):60114,nt=Ye?Symbol.for("react.provider"):60109,rt=Ye?Symbol.for("react.context"):60110,at=Ye?Symbol.for("react.async_mode"):60111,it=Ye?Symbol.for("react.forward_ref"):60112,ot=Ye?Symbol.for("react.placeholder"):60113,st="function"===typeof Symbol&&Symbol.iterator;function ut(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=st&&e[st]||e["@@iterator"])?e:null}function ct(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case at:return"AsyncMode";case $e:return"Fragment";case Je:return"Portal";case tt:return"Profiler";case et:return"StrictMode";case ot:return"Placeholder"}if("object"===typeof e){switch(e.$$typeof){case rt:return"Context.Consumer";case nt:return"Context.Provider";case it:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef")}if("function"===typeof e.then&&(e=1===e._reactStatus?e._reactResult:null))return ct(e)}return null}function lt(e){var t="";do{e:switch(e.tag){case 4:case 0:case 1:case 2:case 3:case 7:case 10:var n=e._debugOwner,r=e._debugSource,a=ct(e.type),i=null;n&&(i=ct(n.type)),n=a,a="",r?a=" (at "+r.fileName.replace(Xe,"")+":"+r.lineNumber+")":i&&(a=" (created by "+i+")"),i="\n    in "+(n||"Unknown")+a;break e;default:i=""}t+=i,e=e.return}while(e);return t}var pt=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ft=Object.prototype.hasOwnProperty,ht={},dt={};function mt(e,t,n,r,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t}var vt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){vt[e]=new mt(e,0,!1,e,null)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];vt[t]=new mt(t,1,!1,e[1],null)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){vt[e]=new mt(e,2,!1,e.toLowerCase(),null)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){vt[e]=new mt(e,2,!1,e,null)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){vt[e]=new mt(e,3,!1,e.toLowerCase(),null)})),["checked","multiple","muted","selected"].forEach((function(e){vt[e]=new mt(e,3,!0,e,null)})),["capture","download"].forEach((function(e){vt[e]=new mt(e,4,!1,e,null)})),["cols","rows","size","span"].forEach((function(e){vt[e]=new mt(e,6,!1,e,null)})),["rowSpan","start"].forEach((function(e){vt[e]=new mt(e,5,!1,e.toLowerCase(),null)}));var gt=/[\-:]([a-z])/g;function yt(e){return e[1].toUpperCase()}function bt(e,t,n,r){var a=vt.hasOwnProperty(t)?vt[t]:null;(null!==a?0===a.type:!r&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1])))||(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,a,r)&&(n=null),r||null===a?function(e){return!!ft.call(dt,e)||!ft.call(ht,e)&&(pt.test(e)?dt[e]=!0:(ht[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=null===n?3!==a.type&&"":n:(t=a.attributeName,r=a.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(a=a.type)||4===a&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}function xt(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function kt(e,t){var n=t.checked;return a({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function wt(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=xt(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Nt(e,t){null!=(t=t.checked)&&bt(e,"checked",t,!1)}function It(e,t){Nt(e,t);var n=xt(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?Tt(e,t.type,n):t.hasOwnProperty("defaultValue")&&Tt(e,t.type,xt(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function St(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!e.defaultChecked,e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function Tt(e,t,n){"number"===t&&e.ownerDocument.activeElement===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(gt,yt);vt[t]=new mt(t,1,!1,e,null)})),"xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(gt,yt);vt[t]=new mt(t,1,!1,e,"http://www.w3.org/1999/xlink")})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(gt,yt);vt[t]=new mt(t,1,!1,e,"http://www.w3.org/XML/1998/namespace")})),vt.tabIndex=new mt("tabIndex",1,!1,"tabindex",null);var Ct={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function Et(e,t,n){return(e=fe.getPooled(Ct.change,e,t,n)).type="change",Oe(n),K(e),e}var At=null,Rt=null;function _t(e){M(e,!1)}function Ft(e){if(qe(W(e)))return e}function Dt(e,t){if("change"===e)return t}var Ot=!1;function Mt(){At&&(At.detachEvent("onpropertychange",Lt),Rt=At=null)}function Lt(e){"value"===e.propertyName&&Ft(Rt)&&Be(_t,e=Et(Rt,e,Ve(e)))}function zt(e,t,n){"focus"===e?(Mt(),Rt=n,(At=t).attachEvent("onpropertychange",Lt)):"blur"===e&&Mt()}function Pt(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Ft(Rt)}function Zt(e,t){if("click"===e)return Ft(t)}function Bt(e,t){if("input"===e||"change"===e)return Ft(t)}X&&(Ot=Ge("input")&&(!document.documentMode||9<document.documentMode));var Wt={eventTypes:Ct,_isInputEventSupported:Ot,extractEvents:function(e,t,n,r){var a=t?W(t):window,i=void 0,o=void 0,s=a.nodeName&&a.nodeName.toLowerCase();if("select"===s||"input"===s&&"file"===a.type?i=Dt:Ue(a)?Ot?i=Bt:(i=Pt,o=zt):(s=a.nodeName)&&"input"===s.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(i=Zt),i&&(i=i(e,t)))return Et(i,n,r);o&&o(e,a,t),"blur"===e&&(e=a._wrapperState)&&e.controlled&&"number"===a.type&&Tt(a,"number",a.value)}},Ut=fe.extend({view:null,detail:null}),Vt={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Gt(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Vt[e])&&!!t[e]}function Ht(){return Gt}var jt=0,qt=0,Kt=!1,Xt=!1,Yt=Ut.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:Ht,button:null,buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},movementX:function(e){if("movementX"in e)return e.movementX;var t=jt;return jt=e.screenX,Kt?"mousemove"===e.type?e.screenX-t:0:(Kt=!0,0)},movementY:function(e){if("movementY"in e)return e.movementY;var t=qt;return qt=e.screenY,Xt?"mousemove"===e.type?e.screenY-t:0:(Xt=!0,0)}}),Qt=Yt.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),Jt={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},$t={eventTypes:Jt,extractEvents:function(e,t,n,r){var a="mouseover"===e||"pointerover"===e,i="mouseout"===e||"pointerout"===e;if(a&&(n.relatedTarget||n.fromElement)||!i&&!a)return null;if(a=r.window===r?r:(a=r.ownerDocument)?a.defaultView||a.parentWindow:window,i?(i=t,t=(t=n.relatedTarget||n.toElement)?Z(t):null):i=null,i===t)return null;var o=void 0,s=void 0,u=void 0,c=void 0;"mouseout"===e||"mouseover"===e?(o=Yt,s=Jt.mouseLeave,u=Jt.mouseEnter,c="mouse"):"pointerout"!==e&&"pointerover"!==e||(o=Qt,s=Jt.pointerLeave,u=Jt.pointerEnter,c="pointer");var l=null==i?a:W(i);if(a=null==t?a:W(t),(e=o.getPooled(s,i,n,r)).type=c+"leave",e.target=l,e.relatedTarget=a,(n=o.getPooled(u,t,n,r)).type=c+"enter",n.target=a,n.relatedTarget=l,r=t,i&&r)e:{for(a=r,c=0,o=t=i;o;o=V(o))c++;for(o=0,u=a;u;u=V(u))o++;for(;0<c-o;)t=V(t),c--;for(;0<o-c;)a=V(a),o--;for(;c--;){if(t===a||t===a.alternate)break e;t=V(t),a=V(a)}t=null}else t=null;for(a=t,t=[];i&&i!==a&&(null===(c=i.alternate)||c!==a);)t.push(i),i=V(i);for(i=[];r&&r!==a&&(null===(c=r.alternate)||c!==a);)i.push(r),r=V(r);for(r=0;r<t.length;r++)j(t[r],"bubbled",e);for(r=i.length;0<r--;)j(i[r],"captured",n);return[e,n]}},en=Object.prototype.hasOwnProperty;function tn(e,t){return e===t?0!==e||0!==t||1/e===1/t:e!==e&&t!==t}function nn(e,t){if(tn(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!en.call(t,n[r])||!tn(e[n[r]],t[n[r]]))return!1;return!0}function rn(e){var t=e;if(e.alternate)for(;t.return;)t=t.return;else{if(0!==(2&t.effectTag))return 1;for(;t.return;)if(0!==(2&(t=t.return).effectTag))return 1}return 5===t.tag?2:3}function an(e){2!==rn(e)&&s("188")}function on(e){if(e=function(e){var t=e.alternate;if(!t)return 3===(t=rn(e))&&s("188"),1===t?null:e;for(var n=e,r=t;;){var a=n.return,i=a?a.alternate:null;if(!a||!i)break;if(a.child===i.child){for(var o=a.child;o;){if(o===n)return an(a),e;if(o===r)return an(a),t;o=o.sibling}s("188")}if(n.return!==r.return)n=a,r=i;else{o=!1;for(var u=a.child;u;){if(u===n){o=!0,n=a,r=i;break}if(u===r){o=!0,r=a,n=i;break}u=u.sibling}if(!o){for(u=i.child;u;){if(u===n){o=!0,n=i,r=a;break}if(u===r){o=!0,r=i,n=a;break}u=u.sibling}o||s("189")}}n.alternate!==r&&s("190")}return 5!==n.tag&&s("188"),n.stateNode.current===n?e:t}(e),!e)return null;for(var t=e;;){if(7===t.tag||8===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}var sn=fe.extend({animationName:null,elapsedTime:null,pseudoElement:null}),un=fe.extend({clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),cn=Ut.extend({relatedTarget:null});function ln(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}var pn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},hn=Ut.extend({key:function(e){if(e.key){var t=pn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=ln(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?fn[e.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:Ht,charCode:function(e){return"keypress"===e.type?ln(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?ln(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),dn=Yt.extend({dataTransfer:null}),mn=Ut.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:Ht}),vn=fe.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),gn=Yt.extend({deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null}),yn=[["abort","abort"],[te,"animationEnd"],[ne,"animationIteration"],[re,"animationStart"],["canplay","canPlay"],["canplaythrough","canPlayThrough"],["drag","drag"],["dragenter","dragEnter"],["dragexit","dragExit"],["dragleave","dragLeave"],["dragover","dragOver"],["durationchange","durationChange"],["emptied","emptied"],["encrypted","encrypted"],["ended","ended"],["error","error"],["gotpointercapture","gotPointerCapture"],["load","load"],["loadeddata","loadedData"],["loadedmetadata","loadedMetadata"],["loadstart","loadStart"],["lostpointercapture","lostPointerCapture"],["mousemove","mouseMove"],["mouseout","mouseOut"],["mouseover","mouseOver"],["playing","playing"],["pointermove","pointerMove"],["pointerout","pointerOut"],["pointerover","pointerOver"],["progress","progress"],["scroll","scroll"],["seeking","seeking"],["stalled","stalled"],["suspend","suspend"],["timeupdate","timeUpdate"],["toggle","toggle"],["touchmove","touchMove"],[ae,"transitionEnd"],["waiting","waiting"],["wheel","wheel"]],bn={},xn={};function kn(e,t){var n=e[0],r="on"+((e=e[1])[0].toUpperCase()+e.slice(1));t={phasedRegistrationNames:{bubbled:r,captured:r+"Capture"},dependencies:[n],isInteractive:t},bn[e]=t,xn[n]=t}[["blur","blur"],["cancel","cancel"],["click","click"],["close","close"],["contextmenu","contextMenu"],["copy","copy"],["cut","cut"],["auxclick","auxClick"],["dblclick","doubleClick"],["dragend","dragEnd"],["dragstart","dragStart"],["drop","drop"],["focus","focus"],["input","input"],["invalid","invalid"],["keydown","keyDown"],["keypress","keyPress"],["keyup","keyUp"],["mousedown","mouseDown"],["mouseup","mouseUp"],["paste","paste"],["pause","pause"],["play","play"],["pointercancel","pointerCancel"],["pointerdown","pointerDown"],["pointerup","pointerUp"],["ratechange","rateChange"],["reset","reset"],["seeked","seeked"],["submit","submit"],["touchcancel","touchCancel"],["touchend","touchEnd"],["touchstart","touchStart"],["volumechange","volumeChange"]].forEach((function(e){kn(e,!0)})),yn.forEach((function(e){kn(e,!1)}));var wn={eventTypes:bn,isInteractiveTopLevelEventType:function(e){return void 0!==(e=xn[e])&&!0===e.isInteractive},extractEvents:function(e,t,n,r){var a=xn[e];if(!a)return null;switch(e){case"keypress":if(0===ln(n))return null;case"keydown":case"keyup":e=hn;break;case"blur":case"focus":e=cn;break;case"click":if(2===n.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":e=Yt;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":e=dn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":e=mn;break;case te:case ne:case re:e=sn;break;case ae:e=vn;break;case"scroll":e=Ut;break;case"wheel":e=gn;break;case"copy":case"cut":case"paste":e=un;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":e=Qt;break;default:e=fe}return K(t=e.getPooled(a,t,n,r)),t}},Nn=wn.isInteractiveTopLevelEventType,In=[];function Sn(e){var t=e.targetInst,n=t;do{if(!n){e.ancestors.push(n);break}var r;for(r=n;r.return;)r=r.return;if(!(r=5!==r.tag?null:r.stateNode.containerInfo))break;e.ancestors.push(n),n=Z(r)}while(n);for(n=0;n<e.ancestors.length;n++){t=e.ancestors[n];var a=Ve(e.nativeEvent);r=e.topLevelType;for(var i=e.nativeEvent,o=null,s=0;s<b.length;s++){var u=b[s];u&&(u=u.extractEvents(r,t,i,a))&&(o=C(o,u))}M(o,!1)}}var Tn=!0;function Cn(e,t){if(!t)return null;var n=(Nn(e)?An:Rn).bind(null,e);t.addEventListener(e,n,!1)}function En(e,t){if(!t)return null;var n=(Nn(e)?An:Rn).bind(null,e);t.addEventListener(e,n,!0)}function An(e,t){ze(Rn,e,t)}function Rn(e,t){if(Tn){var n=Ve(t);if(null===(n=Z(n))||"number"!==typeof n.tag||2===rn(n)||(n=null),In.length){var r=In.pop();r.topLevelType=e,r.nativeEvent=t,r.targetInst=n,e=r}else e={topLevelType:e,nativeEvent:t,targetInst:n,ancestors:[]};try{Be(Sn,e)}finally{e.topLevelType=null,e.nativeEvent=null,e.targetInst=null,e.ancestors.length=0,10>In.length&&In.push(e)}}}var _n={},Fn=0,Dn="_reactListenersID"+(""+Math.random()).slice(2);function On(e){return Object.prototype.hasOwnProperty.call(e,Dn)||(e[Dn]=Fn++,_n[e[Dn]]={}),_n[e[Dn]]}function Mn(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Ln(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function zn(e,t){var n,r=Ln(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Ln(r)}}function Pn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?Pn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function Zn(){for(var e=window,t=Mn();t instanceof e.HTMLIFrameElement;){try{e=t.contentDocument.defaultView}catch(n){break}t=Mn(e.document)}return t}function Bn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var Wn=X&&"documentMode"in document&&11>=document.documentMode,Un={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},Vn=null,Gn=null,Hn=null,jn=!1;function qn(e,t){var n=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;return jn||null==Vn||Vn!==Mn(n)?null:("selectionStart"in(n=Vn)&&Bn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},Hn&&nn(Hn,n)?null:(Hn=n,(e=fe.getPooled(Un.select,Gn,e,t)).type="select",e.target=Vn,K(e),e))}var Kn={eventTypes:Un,extractEvents:function(e,t,n,r){var a,i=r.window===r?r.document:9===r.nodeType?r:r.ownerDocument;if(!(a=!i)){e:{i=On(i),a=w.onSelect;for(var o=0;o<a.length;o++){var s=a[o];if(!i.hasOwnProperty(s)||!i[s]){i=!1;break e}}i=!0}a=!i}if(a)return null;switch(i=t?W(t):window,e){case"focus":(Ue(i)||"true"===i.contentEditable)&&(Vn=i,Gn=t,Hn=null);break;case"blur":Hn=Gn=Vn=null;break;case"mousedown":jn=!0;break;case"contextmenu":case"mouseup":case"dragend":return jn=!1,qn(n,r);case"selectionchange":if(Wn)break;case"keydown":case"keyup":return qn(n,r)}return null}};function Xn(e,t){return e=a({children:void 0},t),(t=function(e){var t="";return r.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function Yn(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+xt(n),t=null,a=0;a<e.length;a++){if(e[a].value===n)return e[a].selected=!0,void(r&&(e[a].defaultSelected=!0));null!==t||e[a].disabled||(t=e[a])}null!==t&&(t.selected=!0)}}function Qn(e,t){return null!=t.dangerouslySetInnerHTML&&s("91"),a({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Jn(e,t){var n=t.value;null==n&&(n=t.defaultValue,null!=(t=t.children)&&(null!=n&&s("92"),Array.isArray(t)&&(1>=t.length||s("93"),t=t[0]),n=t),null==n&&(n="")),e._wrapperState={initialValue:xt(n)}}function $n(e,t){var n=xt(t.value),r=xt(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function er(e){var t=e.textContent;t===e._wrapperState.initialValue&&(e.value=t)}D.injectEventPluginOrder("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" ")),N=U,I=B,S=W,D.injectEventPluginsByName({SimpleEventPlugin:wn,EnterLeaveEventPlugin:$t,ChangeEventPlugin:Wt,SelectEventPlugin:Kn,BeforeInputEventPlugin:Ae});var tr="http://www.w3.org/1999/xhtml",nr="http://www.w3.org/2000/svg";function rr(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ar(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?rr(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ir,or=void 0,sr=(ir=function(e,t){if(e.namespaceURI!==nr||"innerHTML"in e)e.innerHTML=t;else{for((or=or||document.createElement("div")).innerHTML="<svg>"+t+"</svg>",t=or.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return ir(e,t)}))}:ir);function ur(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var cr={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},lr=["Webkit","ms","Moz","O"];function pr(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),a=n,i=t[n];a=null==i||"boolean"===typeof i||""===i?"":r||"number"!==typeof i||0===i||cr.hasOwnProperty(a)&&cr[a]?(""+i).trim():i+"px","float"===n&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}Object.keys(cr).forEach((function(e){lr.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),cr[t]=cr[e]}))}));var fr=a({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function hr(e,t){t&&(fr[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML)&&s("137",e,""),null!=t.dangerouslySetInnerHTML&&(null!=t.children&&s("60"),"object"===typeof t.dangerouslySetInnerHTML&&"__html"in t.dangerouslySetInnerHTML||s("61")),null!=t.style&&"object"!==typeof t.style&&s("62",""))}function dr(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function mr(e,t){var n=On(e=9===e.nodeType||11===e.nodeType?e:e.ownerDocument);t=w[t];for(var r=0;r<t.length;r++){var a=t[r];if(!n.hasOwnProperty(a)||!n[a]){switch(a){case"scroll":En("scroll",e);break;case"focus":case"blur":En("focus",e),En("blur",e),n.blur=!0,n.focus=!0;break;case"cancel":case"close":Ge(a)&&En(a,e);break;case"invalid":case"submit":case"reset":break;default:-1===ie.indexOf(a)&&Cn(a,e)}n[a]=!0}}}function vr(){}var gr=null,yr=null;function br(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function xr(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}function kr(e){for(e=e.nextSibling;e&&1!==e.nodeType&&3!==e.nodeType;)e=e.nextSibling;return e}function wr(e){for(e=e.firstChild;e&&1!==e.nodeType&&3!==e.nodeType;)e=e.nextSibling;return e}new Set;var Nr=[],Ir=-1;function Sr(e){0>Ir||(e.current=Nr[Ir],Nr[Ir]=null,Ir--)}function Tr(e,t){Ir++,Nr[Ir]=e.current,e.current=t}var Cr={},Er={current:Cr},Ar={current:!1},Rr=Cr;function _r(e,t){var n=e.type.contextTypes;if(!n)return Cr;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a,i={};for(a in n)i[a]=t[a];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function Fr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Dr(e){Sr(Ar),Sr(Er)}function Or(e){Sr(Ar),Sr(Er)}function Mr(e,t,n){Er.current!==Cr&&s("168"),Tr(Er,t),Tr(Ar,n)}function Lr(e,t,n){var r=e.stateNode;if(e=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())i in e||s("108",ct(t)||"Unknown",i);return a({},n,r)}function zr(e){var t=e.stateNode;return t=t&&t.__reactInternalMemoizedMergedChildContext||Cr,Rr=Er.current,Tr(Er,t),Tr(Ar,Ar.current),!0}function Pr(e,t,n){var r=e.stateNode;r||s("169"),n?(t=Lr(e,t,Rr),r.__reactInternalMemoizedMergedChildContext=t,Sr(Ar),Sr(Er),Tr(Er,t)):Sr(Ar),Tr(Ar,n)}var Zr=null,Br=null;function Wr(e){return function(t){try{return e(t)}catch(n){}}}function Ur(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=null,this.index=0,this.ref=null,this.pendingProps=t,this.firstContextDependency=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function Vr(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Gr(e,t,n){var r=e.alternate;return null===r?((r=new Ur(e.tag,t,e.key,e.mode)).type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.effectTag=0,r.nextEffect=null,r.firstEffect=null,r.lastEffect=null),r.childExpirationTime=e.childExpirationTime,r.expirationTime=t!==e.pendingProps?n:e.expirationTime,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,r.firstContextDependency=e.firstContextDependency,r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function Hr(e,t,n){var r=e.type,a=e.key;e=e.props;var i=void 0;if("function"===typeof r)i=Vr(r)?2:4;else if("string"===typeof r)i=7;else e:switch(r){case $e:return jr(e.children,t,n,a);case at:i=10,t|=3;break;case et:i=10,t|=2;break;case tt:return(r=new Ur(15,e,a,4|t)).type=tt,r.expirationTime=n,r;case ot:i=16;break;default:if("object"===typeof r&&null!==r)switch(r.$$typeof){case nt:i=12;break e;case rt:i=11;break e;case it:i=13;break e;default:if("function"===typeof r.then){i=4;break e}}s("130",null==r?r:typeof r,"")}return(t=new Ur(i,e,a,t)).type=r,t.expirationTime=n,t}function jr(e,t,n,r){return(e=new Ur(9,e,r,t)).expirationTime=n,e}function qr(e,t,n){return(e=new Ur(8,e,null,t)).expirationTime=n,e}function Kr(e,t,n){return(t=new Ur(6,null!==e.children?e.children:[],e.key,t)).expirationTime=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Xr(e,t){e.didError=!1;var n=e.earliestPendingTime;0===n?e.earliestPendingTime=e.latestPendingTime=t:n>t?e.earliestPendingTime=t:e.latestPendingTime<t&&(e.latestPendingTime=t),Yr(t,e)}function Yr(e,t){var n=t.earliestSuspendedTime,r=t.latestSuspendedTime,a=t.earliestPendingTime,i=t.latestPingedTime;0===(a=0!==a?a:i)&&(0===e||r>e)&&(a=r),0!==(e=a)&&0!==n&&n<e&&(e=n),t.nextExpirationTimeToWorkOn=a,t.expirationTime=e}var Qr=!1;function Jr(e){return{baseState:e,firstUpdate:null,lastUpdate:null,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function $r(e){return{baseState:e.baseState,firstUpdate:e.firstUpdate,lastUpdate:e.lastUpdate,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function ea(e){return{expirationTime:e,tag:0,payload:null,callback:null,next:null,nextEffect:null}}function ta(e,t){null===e.lastUpdate?e.firstUpdate=e.lastUpdate=t:(e.lastUpdate.next=t,e.lastUpdate=t)}function na(e,t){var n=e.alternate;if(null===n){var r=e.updateQueue,a=null;null===r&&(r=e.updateQueue=Jr(e.memoizedState))}else r=e.updateQueue,a=n.updateQueue,null===r?null===a?(r=e.updateQueue=Jr(e.memoizedState),a=n.updateQueue=Jr(n.memoizedState)):r=e.updateQueue=$r(a):null===a&&(a=n.updateQueue=$r(r));null===a||r===a?ta(r,t):null===r.lastUpdate||null===a.lastUpdate?(ta(r,t),ta(a,t)):(ta(r,t),a.lastUpdate=t)}function ra(e,t){var n=e.updateQueue;null===(n=null===n?e.updateQueue=Jr(e.memoizedState):aa(e,n)).lastCapturedUpdate?n.firstCapturedUpdate=n.lastCapturedUpdate=t:(n.lastCapturedUpdate.next=t,n.lastCapturedUpdate=t)}function aa(e,t){var n=e.alternate;return null!==n&&t===n.updateQueue&&(t=e.updateQueue=$r(t)),t}function ia(e,t,n,r,i,o){switch(n.tag){case 1:return"function"===typeof(e=n.payload)?e.call(o,r,i):e;case 3:e.effectTag=-1025&e.effectTag|64;case 0:if(null===(i="function"===typeof(e=n.payload)?e.call(o,r,i):e)||void 0===i)break;return a({},r,i);case 2:Qr=!0}return r}function oa(e,t,n,r,a){Qr=!1;for(var i=(t=aa(e,t)).baseState,o=null,s=0,u=t.firstUpdate,c=i;null!==u;){var l=u.expirationTime;l>a?(null===o&&(o=u,i=c),(0===s||s>l)&&(s=l)):(c=ia(e,0,u,c,n,r),null!==u.callback&&(e.effectTag|=32,u.nextEffect=null,null===t.lastEffect?t.firstEffect=t.lastEffect=u:(t.lastEffect.nextEffect=u,t.lastEffect=u))),u=u.next}for(l=null,u=t.firstCapturedUpdate;null!==u;){var p=u.expirationTime;p>a?(null===l&&(l=u,null===o&&(i=c)),(0===s||s>p)&&(s=p)):(c=ia(e,0,u,c,n,r),null!==u.callback&&(e.effectTag|=32,u.nextEffect=null,null===t.lastCapturedEffect?t.firstCapturedEffect=t.lastCapturedEffect=u:(t.lastCapturedEffect.nextEffect=u,t.lastCapturedEffect=u))),u=u.next}null===o&&(t.lastUpdate=null),null===l?t.lastCapturedUpdate=null:e.effectTag|=32,null===o&&null===l&&(i=c),t.baseState=i,t.firstUpdate=o,t.firstCapturedUpdate=l,e.expirationTime=s,e.memoizedState=c}function sa(e,t,n){null!==t.firstCapturedUpdate&&(null!==t.lastUpdate&&(t.lastUpdate.next=t.firstCapturedUpdate,t.lastUpdate=t.lastCapturedUpdate),t.firstCapturedUpdate=t.lastCapturedUpdate=null),ua(t.firstEffect,n),t.firstEffect=t.lastEffect=null,ua(t.firstCapturedEffect,n),t.firstCapturedEffect=t.lastCapturedEffect=null}function ua(e,t){for(;null!==e;){var n=e.callback;if(null!==n){e.callback=null;var r=t;"function"!==typeof n&&s("191",n),n.call(r)}e=e.nextEffect}}function ca(e,t){return{value:e,source:t,stack:lt(t)}}var la={current:null},pa=null,fa=null,ha=null;function da(e,t){var n=e.type._context;Tr(la,n._currentValue),n._currentValue=t}function ma(e){var t=la.current;Sr(la),e.type._context._currentValue=t}function va(e){pa=e,ha=fa=null,e.firstContextDependency=null}function ga(e,t){return ha!==e&&!1!==t&&0!==t&&("number"===typeof t&&1073741823!==t||(ha=e,t=1073741823),t={context:e,observedBits:t,next:null},null===fa?(null===pa&&s("277"),pa.firstContextDependency=fa=t):fa=fa.next=t),e._currentValue}var ya={},ba={current:ya},xa={current:ya},ka={current:ya};function wa(e){return e===ya&&s("174"),e}function Na(e,t){Tr(ka,t),Tr(xa,e),Tr(ba,ya);var n=t.nodeType;switch(n){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ar(null,"");break;default:t=ar(t=(n=8===n?t.parentNode:t).namespaceURI||null,n=n.tagName)}Sr(ba),Tr(ba,t)}function Ia(e){Sr(ba),Sr(xa),Sr(ka)}function Sa(e){wa(ka.current);var t=wa(ba.current),n=ar(t,e.type);t!==n&&(Tr(xa,e),Tr(ba,n))}function Ta(e){xa.current===e&&(Sr(ba),Sr(xa))}var Ca=(new r.Component).refs;function Ea(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:a({},t,n),e.memoizedState=n,null!==(r=e.updateQueue)&&0===e.expirationTime&&(r.baseState=n)}var Aa={isMounted:function(e){return!!(e=e._reactInternalFiber)&&2===rn(e)},enqueueSetState:function(e,t,n){e=e._reactInternalFiber;var r=uo(),a=ea(r=Mi(r,e));a.payload=t,void 0!==n&&null!==n&&(a.callback=n),na(e,a),Li(e,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternalFiber;var r=uo(),a=ea(r=Mi(r,e));a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),na(e,a),Li(e,r)},enqueueForceUpdate:function(e,t){e=e._reactInternalFiber;var n=uo(),r=ea(n=Mi(n,e));r.tag=2,void 0!==t&&null!==t&&(r.callback=t),na(e,r),Li(e,n)}};function Ra(e,t,n,r,a,i,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,i,o):!t.prototype||!t.prototype.isPureReactComponent||(!nn(n,r)||!nn(a,i))}function _a(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Aa.enqueueReplaceState(t,t.state,null)}function Fa(e,t,n,r){var a=e.stateNode,i=Fr(t)?Rr:Er.current;a.props=n,a.state=e.memoizedState,a.refs=Ca,a.context=_r(e,i),null!==(i=e.updateQueue)&&(oa(e,i,n,a,r),a.state=e.memoizedState),"function"===typeof(i=t.getDerivedStateFromProps)&&(Ea(e,t,i,n),a.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(t=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),t!==a.state&&Aa.enqueueReplaceState(a,a.state,null),null!==(i=e.updateQueue)&&(oa(e,i,n,a,r),a.state=e.memoizedState)),"function"===typeof a.componentDidMount&&(e.effectTag|=4)}var Da=Array.isArray;function Oa(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){n=n._owner;var r=void 0;n&&(2!==n.tag&&3!==n.tag&&s("110"),r=n.stateNode),r||s("147",e);var a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=r.refs;t===Ca&&(t=r.refs={}),null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}"string"!==typeof e&&s("284"),n._owner||s("254",e)}return e}function Ma(e,t){"textarea"!==e.type&&s("31","[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t,"")}function La(e){function t(t,n){if(e){var r=t.lastEffect;null!==r?(r.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.effectTag=8}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function a(e,t,n){return(e=Gr(e,t,n)).index=0,e.sibling=null,e}function i(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.effectTag=2,n):r:(t.effectTag=2,n):n}function o(t){return e&&null===t.alternate&&(t.effectTag=2),t}function u(e,t,n,r){return null===t||8!==t.tag?((t=qr(n,e.mode,r)).return=e,t):((t=a(t,n,r)).return=e,t)}function c(e,t,n,r){return null!==t&&t.type===n.type?((r=a(t,n.props,r)).ref=Oa(e,t,n),r.return=e,r):((r=Hr(n,e.mode,r)).ref=Oa(e,t,n),r.return=e,r)}function l(e,t,n,r){return null===t||6!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Kr(n,e.mode,r)).return=e,t):((t=a(t,n.children||[],r)).return=e,t)}function p(e,t,n,r,i){return null===t||9!==t.tag?((t=jr(n,e.mode,r,i)).return=e,t):((t=a(t,n,r)).return=e,t)}function f(e,t,n){if("string"===typeof t||"number"===typeof t)return(t=qr(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case Qe:return(n=Hr(t,e.mode,n)).ref=Oa(e,null,t),n.return=e,n;case Je:return(t=Kr(t,e.mode,n)).return=e,t}if(Da(t)||ut(t))return(t=jr(t,e.mode,n,null)).return=e,t;Ma(e,t)}return null}function h(e,t,n,r){var a=null!==t?t.key:null;if("string"===typeof n||"number"===typeof n)return null!==a?null:u(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case Qe:return n.key===a?n.type===$e?p(e,t,n.props.children,r,a):c(e,t,n,r):null;case Je:return n.key===a?l(e,t,n,r):null}if(Da(n)||ut(n))return null!==a?null:p(e,t,n,r,null);Ma(e,n)}return null}function d(e,t,n,r,a){if("string"===typeof r||"number"===typeof r)return u(t,e=e.get(n)||null,""+r,a);if("object"===typeof r&&null!==r){switch(r.$$typeof){case Qe:return e=e.get(null===r.key?n:r.key)||null,r.type===$e?p(t,e,r.props.children,a,r.key):c(t,e,r,a);case Je:return l(t,e=e.get(null===r.key?n:r.key)||null,r,a)}if(Da(r)||ut(r))return p(t,e=e.get(n)||null,r,a,null);Ma(t,r)}return null}function m(a,o,s,u){for(var c=null,l=null,p=o,m=o=0,v=null;null!==p&&m<s.length;m++){p.index>m?(v=p,p=null):v=p.sibling;var g=h(a,p,s[m],u);if(null===g){null===p&&(p=v);break}e&&p&&null===g.alternate&&t(a,p),o=i(g,o,m),null===l?c=g:l.sibling=g,l=g,p=v}if(m===s.length)return n(a,p),c;if(null===p){for(;m<s.length;m++)(p=f(a,s[m],u))&&(o=i(p,o,m),null===l?c=p:l.sibling=p,l=p);return c}for(p=r(a,p);m<s.length;m++)(v=d(p,a,m,s[m],u))&&(e&&null!==v.alternate&&p.delete(null===v.key?m:v.key),o=i(v,o,m),null===l?c=v:l.sibling=v,l=v);return e&&p.forEach((function(e){return t(a,e)})),c}function v(a,o,u,c){var l=ut(u);"function"!==typeof l&&s("150"),null==(u=l.call(u))&&s("151");for(var p=l=null,m=o,v=o=0,g=null,y=u.next();null!==m&&!y.done;v++,y=u.next()){m.index>v?(g=m,m=null):g=m.sibling;var b=h(a,m,y.value,c);if(null===b){m||(m=g);break}e&&m&&null===b.alternate&&t(a,m),o=i(b,o,v),null===p?l=b:p.sibling=b,p=b,m=g}if(y.done)return n(a,m),l;if(null===m){for(;!y.done;v++,y=u.next())null!==(y=f(a,y.value,c))&&(o=i(y,o,v),null===p?l=y:p.sibling=y,p=y);return l}for(m=r(a,m);!y.done;v++,y=u.next())null!==(y=d(m,a,v,y.value,c))&&(e&&null!==y.alternate&&m.delete(null===y.key?v:y.key),o=i(y,o,v),null===p?l=y:p.sibling=y,p=y);return e&&m.forEach((function(e){return t(a,e)})),l}return function(e,r,i,u){var c="object"===typeof i&&null!==i&&i.type===$e&&null===i.key;c&&(i=i.props.children);var l="object"===typeof i&&null!==i;if(l)switch(i.$$typeof){case Qe:e:{for(l=i.key,c=r;null!==c;){if(c.key===l){if(9===c.tag?i.type===$e:c.type===i.type){n(e,c.sibling),(r=a(c,i.type===$e?i.props.children:i.props,u)).ref=Oa(e,c,i),r.return=e,e=r;break e}n(e,c);break}t(e,c),c=c.sibling}i.type===$e?((r=jr(i.props.children,e.mode,u,i.key)).return=e,e=r):((u=Hr(i,e.mode,u)).ref=Oa(e,r,i),u.return=e,e=u)}return o(e);case Je:e:{for(c=i.key;null!==r;){if(r.key===c){if(6===r.tag&&r.stateNode.containerInfo===i.containerInfo&&r.stateNode.implementation===i.implementation){n(e,r.sibling),(r=a(r,i.children||[],u)).return=e,e=r;break e}n(e,r);break}t(e,r),r=r.sibling}(r=Kr(i,e.mode,u)).return=e,e=r}return o(e)}if("string"===typeof i||"number"===typeof i)return i=""+i,null!==r&&8===r.tag?(n(e,r.sibling),(r=a(r,i,u)).return=e,e=r):(n(e,r),(r=qr(i,e.mode,u)).return=e,e=r),o(e);if(Da(i))return m(e,r,i,u);if(ut(i))return v(e,r,i,u);if(l&&Ma(e,i),"undefined"===typeof i&&!c)switch(e.tag){case 2:case 3:case 0:s("152",(u=e.type).displayName||u.name||"Component")}return n(e,r)}}var za=La(!0),Pa=La(!1),Za=null,Ba=null,Wa=!1;function Ua(e,t){var n=new Ur(7,null,null,0);n.type="DELETED",n.stateNode=t,n.return=e,n.effectTag=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function Va(e,t){switch(e.tag){case 7:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 8:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);default:return!1}}function Ga(e){if(Wa){var t=Ba;if(t){var n=t;if(!Va(e,t)){if(!(t=kr(n))||!Va(e,t))return e.effectTag|=2,Wa=!1,void(Za=e);Ua(Za,n)}Za=e,Ba=wr(t)}else e.effectTag|=2,Wa=!1,Za=e}}function Ha(e){for(e=e.return;null!==e&&7!==e.tag&&5!==e.tag;)e=e.return;Za=e}function ja(e){if(e!==Za)return!1;if(!Wa)return Ha(e),Wa=!0,!1;var t=e.type;if(7!==e.tag||"head"!==t&&"body"!==t&&!xr(t,e.memoizedProps))for(t=Ba;t;)Ua(e,t),t=kr(t);return Ha(e),Ba=Za?kr(e.stateNode):null,!0}function qa(){Ba=Za=null,Wa=!1}var Ka=Ke.ReactCurrentOwner;function Xa(e,t,n,r){t.child=null===e?Pa(t,null,n,r):za(t,e.child,n,r)}function Ya(e,t,n,r,a){n=n.render;var i=t.ref;return Ar.current||t.memoizedProps!==r||i!==(null!==e?e.ref:null)?(Xa(e,t,n=n(r,i),a),t.memoizedProps=r,t.child):ri(e,t,a)}function Qa(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.effectTag|=128)}function Ja(e,t,n,r,a){var i=Fr(n)?Rr:Er.current;return i=_r(t,i),va(t),n=n(r,i),t.effectTag|=1,Xa(e,t,n,a),t.memoizedProps=r,t.child}function $a(e,t,n,r,a){if(Fr(n)){var i=!0;zr(t)}else i=!1;if(va(t),null===e)if(null===t.stateNode){var o=Fr(n)?Rr:Er.current,s=n.contextTypes,u=null!==s&&void 0!==s,c=new n(r,s=u?_r(t,o):Cr);t.memoizedState=null!==c.state&&void 0!==c.state?c.state:null,c.updater=Aa,t.stateNode=c,c._reactInternalFiber=t,u&&((u=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=o,u.__reactInternalMemoizedMaskedChildContext=s),Fa(t,n,r,a),r=!0}else{o=t.stateNode,s=t.memoizedProps,o.props=s;var l=o.context;u=_r(t,u=Fr(n)?Rr:Er.current);var p=n.getDerivedStateFromProps;(c="function"===typeof p||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||l!==u)&&_a(t,o,r,u),Qr=!1;var f=t.memoizedState;l=o.state=f;var h=t.updateQueue;null!==h&&(oa(t,h,r,o,a),l=t.memoizedState),s!==r||f!==l||Ar.current||Qr?("function"===typeof p&&(Ea(t,n,p,r),l=t.memoizedState),(s=Qr||Ra(t,n,s,r,f,l,u))?(c||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.effectTag|=4)):("function"===typeof o.componentDidMount&&(t.effectTag|=4),t.memoizedProps=r,t.memoizedState=l),o.props=r,o.state=l,o.context=u,r=s):("function"===typeof o.componentDidMount&&(t.effectTag|=4),r=!1)}else o=t.stateNode,s=t.memoizedProps,o.props=s,l=o.context,u=_r(t,u=Fr(n)?Rr:Er.current),(c="function"===typeof(p=n.getDerivedStateFromProps)||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||l!==u)&&_a(t,o,r,u),Qr=!1,l=t.memoizedState,f=o.state=l,null!==(h=t.updateQueue)&&(oa(t,h,r,o,a),f=t.memoizedState),s!==r||l!==f||Ar.current||Qr?("function"===typeof p&&(Ea(t,n,p,r),f=t.memoizedState),(p=Qr||Ra(t,n,s,r,l,f,u))?(c||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,f,u),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,f,u)),"function"===typeof o.componentDidUpdate&&(t.effectTag|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.effectTag|=256)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=256),t.memoizedProps=r,t.memoizedState=f),o.props=r,o.state=f,o.context=u,r=p):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=256),r=!1);return ei(e,t,n,r,i,a)}function ei(e,t,n,r,a,i){Qa(e,t);var o=0!==(64&t.effectTag);if(!r&&!o)return a&&Pr(t,n,!1),ri(e,t,i);r=t.stateNode,Ka.current=t;var s=o?null:r.render();return t.effectTag|=1,null!==e&&o&&(Xa(e,t,null,i),t.child=null),Xa(e,t,s,i),t.memoizedState=r.state,t.memoizedProps=r.props,a&&Pr(t,n,!0),t.child}function ti(e){var t=e.stateNode;t.pendingContext?Mr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Mr(0,t.context,!1),Na(e,t.containerInfo)}function ni(e,t){if(e&&e.defaultProps)for(var n in t=a({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}function ri(e,t,n){null!==e&&(t.firstContextDependency=e.firstContextDependency);var r=t.childExpirationTime;if(0===r||r>n)return null;if(null!==e&&t.child!==e.child&&s("153"),null!==t.child){for(n=Gr(e=t.child,e.pendingProps,e.expirationTime),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Gr(e,e.pendingProps,e.expirationTime)).return=t;n.sibling=null}return t.child}function ai(e,t,n){var r=t.expirationTime;if(!Ar.current&&(0===r||r>n)){switch(t.tag){case 5:ti(t),qa();break;case 7:Sa(t);break;case 2:Fr(t.type)&&zr(t);break;case 3:Fr(t.type._reactResult)&&zr(t);break;case 6:Na(t,t.stateNode.containerInfo);break;case 12:da(t,t.memoizedProps.value)}return ri(e,t,n)}switch(t.expirationTime=0,t.tag){case 4:return function(e,t,n,r){null!==e&&s("155");var a=t.pendingProps;if("object"===typeof n&&null!==n&&"function"===typeof n.then){n=function(e){switch(e._reactStatus){case 1:return e._reactResult;case 2:throw e._reactResult;case 0:throw e;default:throw e._reactStatus=0,e.then((function(t){if(0===e._reactStatus){if(e._reactStatus=1,"object"===typeof t&&null!==t){var n=t.default;t=void 0!==n&&null!==n?n:t}e._reactResult=t}}),(function(t){0===e._reactStatus&&(e._reactStatus=2,e._reactResult=t)})),e}}(n);var i=n;i="function"===typeof i?Vr(i)?3:1:void 0!==i&&null!==i&&i.$$typeof?14:4,i=t.tag=i;var o=ni(n,a);switch(i){case 1:return Ja(e,t,n,o,r);case 3:return $a(e,t,n,o,r);case 14:return Ya(e,t,n,o,r);default:s("283",n)}}if(i=_r(t,Er.current),va(t),i=n(a,i),t.effectTag|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof){t.tag=2,Fr(n)?(o=!0,zr(t)):o=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null;var u=n.getDerivedStateFromProps;return"function"===typeof u&&Ea(t,n,u,a),i.updater=Aa,t.stateNode=i,i._reactInternalFiber=t,Fa(t,n,a,r),ei(e,t,n,!0,o,r)}return t.tag=0,Xa(e,t,i,r),t.memoizedProps=a,t.child}(e,t,t.type,n);case 0:return Ja(e,t,t.type,t.pendingProps,n);case 1:var a=t.type._reactResult;return e=Ja(e,t,a,ni(a,r=t.pendingProps),n),t.memoizedProps=r,e;case 2:return $a(e,t,t.type,t.pendingProps,n);case 3:return e=$a(e,t,a=t.type._reactResult,ni(a,r=t.pendingProps),n),t.memoizedProps=r,e;case 5:return ti(t),null===(r=t.updateQueue)&&s("282"),a=null!==(a=t.memoizedState)?a.element:null,oa(t,r,t.pendingProps,null,n),(r=t.memoizedState.element)===a?(qa(),t=ri(e,t,n)):(a=t.stateNode,(a=(null===e||null===e.child)&&a.hydrate)&&(Ba=wr(t.stateNode.containerInfo),Za=t,a=Wa=!0),a?(t.effectTag|=2,t.child=Pa(t,null,r,n)):(Xa(e,t,r,n),qa()),t=t.child),t;case 7:Sa(t),null===e&&Ga(t),r=t.type,a=t.pendingProps;var i=null!==e?e.memoizedProps:null,o=a.children;return xr(r,a)?o=null:null!==i&&xr(r,i)&&(t.effectTag|=16),Qa(e,t),1073741823!==n&&1&t.mode&&a.hidden?(t.expirationTime=1073741823,t.memoizedProps=a,t=null):(Xa(e,t,o,n),t.memoizedProps=a,t=t.child),t;case 8:return null===e&&Ga(t),t.memoizedProps=t.pendingProps,null;case 16:return null;case 6:return Na(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=za(t,null,r,n):Xa(e,t,r,n),t.memoizedProps=r,t.child;case 13:return Ya(e,t,t.type,t.pendingProps,n);case 14:return e=Ya(e,t,a=t.type._reactResult,ni(a,r=t.pendingProps),n),t.memoizedProps=r,e;case 9:return Xa(e,t,r=t.pendingProps,n),t.memoizedProps=r,t.child;case 10:return Xa(e,t,r=t.pendingProps.children,n),t.memoizedProps=r,t.child;case 15:return Xa(e,t,(r=t.pendingProps).children,n),t.memoizedProps=r,t.child;case 12:e:{if(r=t.type._context,a=t.pendingProps,o=t.memoizedProps,i=a.value,t.memoizedProps=a,da(t,i),null!==o){var u=o.value;if(0===(i=u===i&&(0!==u||1/u===1/i)||u!==u&&i!==i?0:0|("function"===typeof r._calculateChangedBits?r._calculateChangedBits(u,i):1073741823))){if(o.children===a.children&&!Ar.current){t=ri(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){if(null!==(u=o.firstContextDependency))do{if(u.context===r&&0!==(u.observedBits&i)){if(2===o.tag||3===o.tag){var c=ea(n);c.tag=2,na(o,c)}(0===o.expirationTime||o.expirationTime>n)&&(o.expirationTime=n),null!==(c=o.alternate)&&(0===c.expirationTime||c.expirationTime>n)&&(c.expirationTime=n);for(var l=o.return;null!==l;){if(c=l.alternate,0===l.childExpirationTime||l.childExpirationTime>n)l.childExpirationTime=n,null!==c&&(0===c.childExpirationTime||c.childExpirationTime>n)&&(c.childExpirationTime=n);else{if(null===c||!(0===c.childExpirationTime||c.childExpirationTime>n))break;c.childExpirationTime=n}l=l.return}}c=o.child,u=u.next}while(null!==u);else c=12===o.tag&&o.type===t.type?null:o.child;if(null!==c)c.return=o;else for(c=o;null!==c;){if(c===t){c=null;break}if(null!==(o=c.sibling)){o.return=c.return,c=o;break}c=c.return}o=c}}Xa(e,t,a.children,n),t=t.child}return t;case 11:return i=t.type,a=(r=t.pendingProps).children,va(t),a=a(i=ga(i,r.unstable_observedBits)),t.effectTag|=1,Xa(e,t,a,n),t.memoizedProps=r,t.child;default:s("156")}}function ii(e){e.effectTag|=4}var oi,si;function ui(e,t){var n=t.source,r=t.stack;null===r&&null!==n&&(r=lt(n)),null!==n&&ct(n.type),t=t.value,null!==e&&2===e.tag&&ct(e.type);try{console.error(t)}catch(a){setTimeout((function(){throw a}))}}function ci(e){var t=e.ref;if(null!==t)if("function"===typeof t)try{t(null)}catch(n){Oi(e,n)}else t.current=null}function li(e){switch("function"===typeof Br&&Br(e),e.tag){case 2:case 3:ci(e);var t=e.stateNode;if("function"===typeof t.componentWillUnmount)try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(n){Oi(e,n)}break;case 7:ci(e);break;case 6:hi(e)}}function pi(e){return 7===e.tag||5===e.tag||6===e.tag}function fi(e){e:{for(var t=e.return;null!==t;){if(pi(t)){var n=t;break e}t=t.return}s("160"),n=void 0}var r=t=void 0;switch(n.tag){case 7:t=n.stateNode,r=!1;break;case 5:case 6:t=n.stateNode.containerInfo,r=!0;break;default:s("161")}16&n.effectTag&&(ur(t,""),n.effectTag&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||pi(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;7!==n.tag&&8!==n.tag;){if(2&n.effectTag)continue t;if(null===n.child||6===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.effectTag)){n=n.stateNode;break e}}for(var a=e;;){if(7===a.tag||8===a.tag)if(n)if(r){var i=t,o=a.stateNode,u=n;8===i.nodeType?i.parentNode.insertBefore(o,u):i.insertBefore(o,u)}else t.insertBefore(a.stateNode,n);else r?(i=t,o=a.stateNode,8===i.nodeType?(u=i.parentNode).insertBefore(o,i):(u=i).appendChild(o),null===u.onclick&&(u.onclick=vr)):t.appendChild(a.stateNode);else if(6!==a.tag&&null!==a.child){a.child.return=a,a=a.child;continue}if(a===e)break;for(;null===a.sibling;){if(null===a.return||a.return===e)return;a=a.return}a.sibling.return=a.return,a=a.sibling}}function hi(e){for(var t=e,n=!1,r=void 0,a=void 0;;){if(!n){n=t.return;e:for(;;){switch(null===n&&s("160"),n.tag){case 7:r=n.stateNode,a=!1;break e;case 5:case 6:r=n.stateNode.containerInfo,a=!0;break e}n=n.return}n=!0}if(7===t.tag||8===t.tag){e:for(var i=t,o=i;;)if(li(o),null!==o.child&&6!==o.tag)o.child.return=o,o=o.child;else{if(o===i)break;for(;null===o.sibling;){if(null===o.return||o.return===i)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}a?(i=r,o=t.stateNode,8===i.nodeType?i.parentNode.removeChild(o):i.removeChild(o)):r.removeChild(t.stateNode)}else if(6===t.tag?(r=t.stateNode.containerInfo,a=!0):li(t),null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return;6===(t=t.return).tag&&(n=!1)}t.sibling.return=t.return,t=t.sibling}}function di(e,t){switch(t.tag){case 2:case 3:case 5:case 15:case 16:break;case 7:var n=t.stateNode;if(null!=n){var r=t.memoizedProps,a=null!==e?e.memoizedProps:r;e=t.type;var i=t.updateQueue;if(t.updateQueue=null,null!==i){for(n[P]=r,"input"===e&&"radio"===r.type&&null!=r.name&&Nt(n,r),dr(e,a),t=dr(e,r),a=0;a<i.length;a+=2){var o=i[a],u=i[a+1];"style"===o?pr(n,u):"dangerouslySetInnerHTML"===o?sr(n,u):"children"===o?ur(n,u):bt(n,o,u,t)}switch(e){case"input":It(n,r);break;case"textarea":$n(n,r);break;case"select":e=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,null!=(i=r.value)?Yn(n,!!r.multiple,i,!1):e!==!!r.multiple&&(null!=r.defaultValue?Yn(n,!!r.multiple,r.defaultValue,!0):Yn(n,!!r.multiple,r.multiple?[]:"",!1))}}}break;case 8:null===t.stateNode&&s("162"),t.stateNode.nodeValue=t.memoizedProps;break;default:s("163")}}function mi(e,t,n){(n=ea(n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){vo(r),ui(e,t)},n}function vi(e,t,n){(n=ea(n)).tag=3;var r=e.stateNode;return null!==r&&"function"===typeof r.componentDidCatch&&(n.callback=function(){null===Ai?Ai=new Set([this]):Ai.add(this);var n=t.value,r=t.stack;ui(e,t),this.componentDidCatch(n,{componentStack:null!==r?r:""})}),n}function gi(e){switch(e.tag){case 2:Fr(e.type)&&Dr();var t=e.effectTag;return 1024&t?(e.effectTag=-1025&t|64,e):null;case 3:return Fr(e.type._reactResult)&&Dr(),1024&(t=e.effectTag)?(e.effectTag=-1025&t|64,e):null;case 5:return Ia(),Or(),0!==(64&(t=e.effectTag))&&s("285"),e.effectTag=-1025&t|64,e;case 7:return Ta(e),null;case 16:return 1024&(t=e.effectTag)?(e.effectTag=-1025&t|64,e):null;case 6:return Ia(),null;case 12:return ma(e),null;default:return null}}oi=function(e,t,n,r,i){var o=e.memoizedProps;if(o!==r){var s=t.stateNode;switch(wa(ba.current),e=null,n){case"input":o=kt(s,o),r=kt(s,r),e=[];break;case"option":o=Xn(s,o),r=Xn(s,r),e=[];break;case"select":o=a({},o,{value:void 0}),r=a({},r,{value:void 0}),e=[];break;case"textarea":o=Qn(s,o),r=Qn(s,r),e=[];break;default:"function"!==typeof o.onClick&&"function"===typeof r.onClick&&(s.onclick=vr)}hr(n,r),s=n=void 0;var u=null;for(n in o)if(!r.hasOwnProperty(n)&&o.hasOwnProperty(n)&&null!=o[n])if("style"===n){var c=o[n];for(s in c)c.hasOwnProperty(s)&&(u||(u={}),u[s]="")}else"dangerouslySetInnerHTML"!==n&&"children"!==n&&"suppressContentEditableWarning"!==n&&"suppressHydrationWarning"!==n&&"autoFocus"!==n&&(k.hasOwnProperty(n)?e||(e=[]):(e=e||[]).push(n,null));for(n in r){var l=r[n];if(c=null!=o?o[n]:void 0,r.hasOwnProperty(n)&&l!==c&&(null!=l||null!=c))if("style"===n)if(c){for(s in c)!c.hasOwnProperty(s)||l&&l.hasOwnProperty(s)||(u||(u={}),u[s]="");for(s in l)l.hasOwnProperty(s)&&c[s]!==l[s]&&(u||(u={}),u[s]=l[s])}else u||(e||(e=[]),e.push(n,u)),u=l;else"dangerouslySetInnerHTML"===n?(l=l?l.__html:void 0,c=c?c.__html:void 0,null!=l&&c!==l&&(e=e||[]).push(n,""+l)):"children"===n?c===l||"string"!==typeof l&&"number"!==typeof l||(e=e||[]).push(n,""+l):"suppressContentEditableWarning"!==n&&"suppressHydrationWarning"!==n&&(k.hasOwnProperty(n)?(null!=l&&mr(i,n),e||c===l||(e=[])):(e=e||[]).push(n,l))}u&&(e=e||[]).push("style",u),i=e,(t.updateQueue=i)&&ii(t)}},si=function(e,t,n,r){n!==r&&ii(t)};var yi={readContext:ga},bi=Ke.ReactCurrentOwner,xi=0,ki=0,wi=!1,Ni=null,Ii=null,Si=0,Ti=!1,Ci=null,Ei=!1,Ai=null;function Ri(){if(null!==Ni)for(var e=Ni.return;null!==e;){var t=e;switch(t.tag){case 2:var n=t.type.childContextTypes;null!==n&&void 0!==n&&Dr();break;case 3:null!==(n=t.type._reactResult.childContextTypes)&&void 0!==n&&Dr();break;case 5:Ia(),Or();break;case 7:Ta(t);break;case 6:Ia();break;case 12:ma(t)}e=e.return}Ii=null,Si=0,Ti=!1,Ni=null}function _i(e){for(;;){var t=e.alternate,n=e.return,r=e.sibling;if(0===(512&e.effectTag)){var i=t,o=(t=e).pendingProps;switch(t.tag){case 0:case 1:break;case 2:Fr(t.type)&&Dr();break;case 3:Fr(t.type._reactResult)&&Dr();break;case 5:Ia(),Or(),(o=t.stateNode).pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),null!==i&&null!==i.child||(ja(t),t.effectTag&=-3);break;case 7:Ta(t);var u=wa(ka.current),c=t.type;if(null!==i&&null!=t.stateNode)oi(i,t,c,o,u),i.ref!==t.ref&&(t.effectTag|=128);else if(o){var l=wa(ba.current);if(ja(t)){i=(o=t).stateNode;var p=o.type,f=o.memoizedProps,h=u;switch(i[z]=o,i[P]=f,c=void 0,u=p){case"iframe":case"object":Cn("load",i);break;case"video":case"audio":for(p=0;p<ie.length;p++)Cn(ie[p],i);break;case"source":Cn("error",i);break;case"img":case"image":case"link":Cn("error",i),Cn("load",i);break;case"form":Cn("reset",i),Cn("submit",i);break;case"details":Cn("toggle",i);break;case"input":wt(i,f),Cn("invalid",i),mr(h,"onChange");break;case"select":i._wrapperState={wasMultiple:!!f.multiple},Cn("invalid",i),mr(h,"onChange");break;case"textarea":Jn(i,f),Cn("invalid",i),mr(h,"onChange")}for(c in hr(u,f),p=null,f)f.hasOwnProperty(c)&&(l=f[c],"children"===c?"string"===typeof l?i.textContent!==l&&(p=["children",l]):"number"===typeof l&&i.textContent!==""+l&&(p=["children",""+l]):k.hasOwnProperty(c)&&null!=l&&mr(h,c));switch(u){case"input":je(i),St(i,f,!0);break;case"textarea":je(i),er(i);break;case"select":case"option":break;default:"function"===typeof f.onClick&&(i.onclick=vr)}c=p,o.updateQueue=c,(o=null!==c)&&ii(t)}else{f=t,i=c,h=o,p=9===u.nodeType?u:u.ownerDocument,l===tr&&(l=rr(i)),l===tr?"script"===i?((i=p.createElement("div")).innerHTML="<script><\/script>",p=i.removeChild(i.firstChild)):"string"===typeof h.is?p=p.createElement(i,{is:h.is}):(p=p.createElement(i),"select"===i&&h.multiple&&(p.multiple=!0)):p=p.createElementNS(l,i),(i=p)[z]=f,i[P]=o;e:for(f=i,h=t,p=h.child;null!==p;){if(7===p.tag||8===p.tag)f.appendChild(p.stateNode);else if(6!==p.tag&&null!==p.child){p.child.return=p,p=p.child;continue}if(p===h)break;for(;null===p.sibling;){if(null===p.return||p.return===h)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}h=i;var d=u,m=dr(p=c,f=o);switch(p){case"iframe":case"object":Cn("load",h),u=f;break;case"video":case"audio":for(u=0;u<ie.length;u++)Cn(ie[u],h);u=f;break;case"source":Cn("error",h),u=f;break;case"img":case"image":case"link":Cn("error",h),Cn("load",h),u=f;break;case"form":Cn("reset",h),Cn("submit",h),u=f;break;case"details":Cn("toggle",h),u=f;break;case"input":wt(h,f),u=kt(h,f),Cn("invalid",h),mr(d,"onChange");break;case"option":u=Xn(h,f);break;case"select":h._wrapperState={wasMultiple:!!f.multiple},u=a({},f,{value:void 0}),Cn("invalid",h),mr(d,"onChange");break;case"textarea":Jn(h,f),u=Qn(h,f),Cn("invalid",h),mr(d,"onChange");break;default:u=f}hr(p,u),l=void 0;var v=p,g=h,y=u;for(l in y)if(y.hasOwnProperty(l)){var b=y[l];"style"===l?pr(g,b):"dangerouslySetInnerHTML"===l?null!=(b=b?b.__html:void 0)&&sr(g,b):"children"===l?"string"===typeof b?("textarea"!==v||""!==b)&&ur(g,b):"number"===typeof b&&ur(g,""+b):"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&"autoFocus"!==l&&(k.hasOwnProperty(l)?null!=b&&mr(d,l):null!=b&&bt(g,l,b,m))}switch(p){case"input":je(h),St(h,f,!1);break;case"textarea":je(h),er(h);break;case"option":null!=f.value&&h.setAttribute("value",""+xt(f.value));break;case"select":(u=h).multiple=!!f.multiple,null!=(h=f.value)?Yn(u,!!f.multiple,h,!1):null!=f.defaultValue&&Yn(u,!!f.multiple,f.defaultValue,!0);break;default:"function"===typeof u.onClick&&(h.onclick=vr)}(o=br(c,o))&&ii(t),t.stateNode=i}null!==t.ref&&(t.effectTag|=128)}else null===t.stateNode&&s("166");break;case 8:i&&null!=t.stateNode?si(0,t,i.memoizedProps,o):("string"!==typeof o&&(null===t.stateNode&&s("166")),i=wa(ka.current),wa(ba.current),ja(t)?(c=(o=t).stateNode,i=o.memoizedProps,c[z]=o,(o=c.nodeValue!==i)&&ii(t)):(c=t,(o=(9===i.nodeType?i:i.ownerDocument).createTextNode(o))[z]=c,t.stateNode=o));break;case 13:case 14:case 16:case 9:case 10:case 15:break;case 6:Ia();break;case 12:ma(t);break;case 11:break;case 4:s("167");default:s("156")}if(t=Ni=null,o=e,1073741823===Si||1073741823!==o.childExpirationTime){for(c=0,i=o.child;null!==i;)u=i.expirationTime,f=i.childExpirationTime,(0===c||0!==u&&u<c)&&(c=u),(0===c||0!==f&&f<c)&&(c=f),i=i.sibling;o.childExpirationTime=c}if(null!==t)return t;null!==n&&0===(512&n.effectTag)&&(null===n.firstEffect&&(n.firstEffect=e.firstEffect),null!==e.lastEffect&&(null!==n.lastEffect&&(n.lastEffect.nextEffect=e.firstEffect),n.lastEffect=e.lastEffect),1<e.effectTag&&(null!==n.lastEffect?n.lastEffect.nextEffect=e:n.firstEffect=e,n.lastEffect=e))}else{if(null!==(e=gi(e)))return e.effectTag&=511,e;null!==n&&(n.firstEffect=n.lastEffect=null,n.effectTag|=512)}if(null!==r)return r;if(null===n)break;e=n}return null}function Fi(e){var t=ai(e.alternate,e,Si);return null===t&&(t=_i(e)),bi.current=null,t}function Di(e,t,n){wi&&s("243"),wi=!0,bi.currentDispatcher=yi;var r=e.nextExpirationTimeToWorkOn;r===Si&&e===Ii&&null!==Ni||(Ri(),Si=r,Ni=Gr((Ii=e).current,null,Si),e.pendingCommitExpirationTime=0);for(var a=!1;;){try{if(t)for(;null!==Ni&&!mo();)Ni=Fi(Ni);else for(;null!==Ni;)Ni=Fi(Ni)}catch(f){if(null===Ni)a=!0,vo(f);else{null===Ni&&s("271");var i=Ni,o=i.return;if(null!==o){e:{var u=o,c=i,l=f;o=Si,c.effectTag|=512,c.firstEffect=c.lastEffect=null,Ti=!0,l=ca(l,c);do{switch(u.tag){case 5:u.effectTag|=1024,u.expirationTime=o,ra(u,o=mi(u,l,o));break e;case 2:case 3:c=l;var p=u.stateNode;if(0===(64&u.effectTag)&&null!==p&&"function"===typeof p.componentDidCatch&&(null===Ai||!Ai.has(p))){u.effectTag|=1024,u.expirationTime=o,ra(u,o=vi(u,c,o));break e}}u=u.return}while(null!==u)}Ni=_i(i);continue}a=!0,vo(f)}}break}if(wi=!1,ha=fa=pa=bi.currentDispatcher=null,a)Ii=null,e.finishedWork=null;else if(null!==Ni)e.finishedWork=null;else{if(null===(t=e.current.alternate)&&s("281"),Ii=null,Ti){if(a=e.latestPendingTime,i=e.latestSuspendedTime,o=e.latestPingedTime,0!==a&&a>r||0!==i&&i>r||0!==o&&o>r)return e.didError=!1,0!==(n=e.latestPingedTime)&&n<=r&&(e.latestPingedTime=0),n=e.earliestPendingTime,t=e.latestPendingTime,n===r?e.earliestPendingTime=t===r?e.latestPendingTime=0:t:t===r&&(e.latestPendingTime=n),n=e.earliestSuspendedTime,t=e.latestSuspendedTime,0===n?e.earliestSuspendedTime=e.latestSuspendedTime=r:n>r?e.earliestSuspendedTime=r:t<r&&(e.latestSuspendedTime=r),Yr(r,e),void(e.expirationTime=e.expirationTime);if(!e.didError&&!n)return e.didError=!0,e.nextExpirationTimeToWorkOn=r,r=e.expirationTime=1,void(e.expirationTime=r)}e.pendingCommitExpirationTime=r,e.finishedWork=t}}function Oi(e,t){var n;e:{for(wi&&!Ei&&s("263"),n=e.return;null!==n;){switch(n.tag){case 2:case 3:var r=n.stateNode;if("function"===typeof n.type.getDerivedStateFromCatch||"function"===typeof r.componentDidCatch&&(null===Ai||!Ai.has(r))){na(n,e=vi(n,e=ca(t,e),1)),Li(n,1),n=void 0;break e}break;case 5:na(n,e=mi(n,e=ca(t,e),1)),Li(n,1),n=void 0;break e}n=n.return}5===e.tag&&(na(e,n=mi(e,n=ca(t,e),1)),Li(e,1)),n=void 0}return n}function Mi(e,t){return 0!==ki?e=ki:wi?e=Ei?1:Si:1&t.mode?(e=Ji?2+10*(1+((e-2+15)/10|0)):2+25*(1+((e-2+500)/25|0)),null!==Ii&&e===Si&&(e+=1)):e=1,Ji&&(0===Hi||e>Hi)&&(Hi=e),e}function Li(e,t){e:{(0===e.expirationTime||e.expirationTime>t)&&(e.expirationTime=t);var n=e.alternate;null!==n&&(0===n.expirationTime||n.expirationTime>t)&&(n.expirationTime=t);var r=e.return;if(null===r&&5===e.tag)e=e.stateNode;else{for(;null!==r;){if(n=r.alternate,(0===r.childExpirationTime||r.childExpirationTime>t)&&(r.childExpirationTime=t),null!==n&&(0===n.childExpirationTime||n.childExpirationTime>t)&&(n.childExpirationTime=t),null===r.return&&5===r.tag){e=r.stateNode;break e}r=r.return}e=null}}null!==e&&(!wi&&0!==Si&&t<Si&&Ri(),Xr(e,t),wi&&!Ei&&Ii===e||(t=e,e=e.expirationTime,null===t.nextScheduledRoot?(t.expirationTime=e,null===Zi?(Pi=Zi=t,t.nextScheduledRoot=t):(Zi=Zi.nextScheduledRoot=t).nextScheduledRoot=Pi):(0===(n=t.expirationTime)||e<n)&&(t.expirationTime=e),Ui||(Yi?Qi&&(Vi=t,Gi=1,fo(t,1,!0)):1===e?po(1,null):so(t,e))),ao>ro&&(ao=0,s("185")))}function zi(e,t,n,r,a){var i=ki;ki=1;try{return e(t,n,r,a)}finally{ki=i}}var Pi=null,Zi=null,Bi=0,Wi=void 0,Ui=!1,Vi=null,Gi=0,Hi=0,ji=!1,qi=!1,Ki=null,Xi=null,Yi=!1,Qi=!1,Ji=!1,$i=null,eo=i.unstable_now(),to=2+(eo/10|0),no=to,ro=50,ao=0,io=null;function oo(){to=2+((i.unstable_now()-eo)/10|0)}function so(e,t){if(0!==Bi){if(t>Bi)return;null!==Wi&&i.unstable_cancelScheduledWork(Wi)}Bi=t,e=i.unstable_now()-eo,Wi=i.unstable_scheduleWork(lo,{timeout:10*(t-2)-e})}function uo(){return Ui||(co(),0!==Gi&&1073741823!==Gi||(oo(),no=to)),no}function co(){var e=0,t=null;if(null!==Zi)for(var n=Zi,r=Pi;null!==r;){var a=r.expirationTime;if(0===a){if((null===n||null===Zi)&&s("244"),r===r.nextScheduledRoot){Pi=Zi=r.nextScheduledRoot=null;break}if(r===Pi)Pi=a=r.nextScheduledRoot,Zi.nextScheduledRoot=a,r.nextScheduledRoot=null;else{if(r===Zi){(Zi=n).nextScheduledRoot=Pi,r.nextScheduledRoot=null;break}n.nextScheduledRoot=r.nextScheduledRoot,r.nextScheduledRoot=null}r=n.nextScheduledRoot}else{if((0===e||a<e)&&(e=a,t=r),r===Zi)break;if(1===e)break;n=r,r=r.nextScheduledRoot}}Vi=t,Gi=e}function lo(e){if(e.didTimeout&&null!==Pi){oo();var t=Pi;do{var n=t.expirationTime;0!==n&&to>=n&&(t.nextExpirationTimeToWorkOn=to),t=t.nextScheduledRoot}while(t!==Pi)}po(0,e)}function po(e,t){if(Xi=t,co(),null!==Xi)for(oo(),no=to;null!==Vi&&0!==Gi&&(0===e||e>=Gi)&&(!ji||to>=Gi);)fo(Vi,Gi,to>=Gi),co(),oo(),no=to;else for(;null!==Vi&&0!==Gi&&(0===e||e>=Gi);)fo(Vi,Gi,!0),co();if(null!==Xi&&(Bi=0,Wi=null),0!==Gi&&so(Vi,Gi),Xi=null,ji=!1,ao=0,io=null,null!==$i)for(e=$i,$i=null,t=0;t<e.length;t++){var n=e[t];try{n._onComplete()}catch(r){qi||(qi=!0,Ki=r)}}if(qi)throw e=Ki,Ki=null,qi=!1,e}function fo(e,t,n){if(Ui&&s("245"),Ui=!0,null===Xi||n){var r=e.finishedWork;null!==r?ho(e,r,t):(e.finishedWork=null,Di(e,!1,n),null!==(r=e.finishedWork)&&ho(e,r,t))}else null!==(r=e.finishedWork)?ho(e,r,t):(e.finishedWork=null,Di(e,!0,n),null!==(r=e.finishedWork)&&(mo()?e.finishedWork=r:ho(e,r,t)));Ui=!1}function ho(e,t,n){var r=e.firstBatch;if(null!==r&&r._expirationTime<=n&&(null===$i?$i=[r]:$i.push(r),r._defer))return e.finishedWork=t,void(e.expirationTime=0);e.finishedWork=null,e===io?ao++:(io=e,ao=0),Ei=wi=!0,e.current===t&&s("177"),0===(n=e.pendingCommitExpirationTime)&&s("261"),e.pendingCommitExpirationTime=0,r=t.expirationTime;var a=t.childExpirationTime;if(r=0===r||0!==a&&a<r?a:r,e.didError=!1,0===r?(e.earliestPendingTime=0,e.latestPendingTime=0,e.earliestSuspendedTime=0,e.latestSuspendedTime=0,e.latestPingedTime=0):(0!==(a=e.latestPendingTime)&&(a<r?e.earliestPendingTime=e.latestPendingTime=0:e.earliestPendingTime<r&&(e.earliestPendingTime=e.latestPendingTime)),0===(a=e.earliestSuspendedTime)?Xr(e,r):r>e.latestSuspendedTime?(e.earliestSuspendedTime=0,e.latestSuspendedTime=0,e.latestPingedTime=0,Xr(e,r)):r<a&&Xr(e,r)),Yr(0,e),bi.current=null,1<t.effectTag?null!==t.lastEffect?(t.lastEffect.nextEffect=t,r=t.firstEffect):r=t:r=t.firstEffect,gr=Tn,Bn(a=Zn())){if("selectionStart"in a)var i={start:a.selectionStart,end:a.selectionEnd};else e:{var o=(i=(i=a.ownerDocument)&&i.defaultView||window).getSelection&&i.getSelection();if(o&&0!==o.rangeCount){i=o.anchorNode;var u=o.anchorOffset,c=o.focusNode;o=o.focusOffset;try{i.nodeType,c.nodeType}catch(P){i=null;break e}var l=0,p=-1,f=-1,h=0,d=0,m=a,v=null;t:for(;;){for(var g;m!==i||0!==u&&3!==m.nodeType||(p=l+u),m!==c||0!==o&&3!==m.nodeType||(f=l+o),3===m.nodeType&&(l+=m.nodeValue.length),null!==(g=m.firstChild);)v=m,m=g;for(;;){if(m===a)break t;if(v===i&&++h===u&&(p=l),v===c&&++d===o&&(f=l),null!==(g=m.nextSibling))break;v=(m=v).parentNode}m=g}i=-1===p||-1===f?null:{start:p,end:f}}else i=null}i=i||{start:0,end:0}}else i=null;for(yr={focusedElem:a,selectionRange:i},Tn=!1,Ci=r;null!==Ci;){a=!1,i=void 0;try{for(;null!==Ci;){if(256&Ci.effectTag){var y=Ci.alternate;e:switch(u=Ci,u.tag){case 2:case 3:if(256&u.effectTag&&null!==y){var b=y.memoizedProps,x=y.memoizedState,k=u.stateNode;k.props=u.memoizedProps,k.state=u.memoizedState;var w=k.getSnapshotBeforeUpdate(b,x);k.__reactInternalSnapshotBeforeUpdate=w}break e;case 5:case 7:case 8:case 6:break e;default:s("163")}}Ci=Ci.nextEffect}}catch(P){a=!0,i=P}a&&(null===Ci&&s("178"),Oi(Ci,i),null!==Ci&&(Ci=Ci.nextEffect))}for(Ci=r;null!==Ci;){y=!1,b=void 0;try{for(;null!==Ci;){var N=Ci.effectTag;if(16&N&&ur(Ci.stateNode,""),128&N){var I=Ci.alternate;if(null!==I){var S=I.ref;null!==S&&("function"===typeof S?S(null):S.current=null)}}switch(14&N){case 2:fi(Ci),Ci.effectTag&=-3;break;case 6:fi(Ci),Ci.effectTag&=-3,di(Ci.alternate,Ci);break;case 4:di(Ci.alternate,Ci);break;case 8:hi(x=Ci),x.return=null,x.child=null,x.alternate&&(x.alternate.child=null,x.alternate.return=null)}Ci=Ci.nextEffect}}catch(P){y=!0,b=P}y&&(null===Ci&&s("178"),Oi(Ci,b),null!==Ci&&(Ci=Ci.nextEffect))}if(S=yr,I=Zn(),N=S.focusedElem,b=S.selectionRange,I!==N&&N&&N.ownerDocument&&Pn(N.ownerDocument.documentElement,N)){null!==b&&Bn(N)&&(I=b.start,void 0===(S=b.end)&&(S=I),"selectionStart"in N?(N.selectionStart=I,N.selectionEnd=Math.min(S,N.value.length)):(I=((y=N.ownerDocument||document)&&y.defaultView||window).getSelection(),x=N.textContent.length,S=Math.min(b.start,x),b=void 0===b.end?S:Math.min(b.end,x),!I.extend&&S>b&&(x=b,b=S,S=x),x=zn(N,S),k=zn(N,b),x&&k&&(1!==I.rangeCount||I.anchorNode!==x.node||I.anchorOffset!==x.offset||I.focusNode!==k.node||I.focusOffset!==k.offset)&&((y=y.createRange()).setStart(x.node,x.offset),I.removeAllRanges(),S>b?(I.addRange(y),I.extend(k.node,k.offset)):(y.setEnd(k.node,k.offset),I.addRange(y))))),I=[];for(S=N;S=S.parentNode;)1===S.nodeType&&I.push({element:S,left:S.scrollLeft,top:S.scrollTop});for("function"===typeof N.focus&&N.focus(),N=0;N<I.length;N++)(S=I[N]).element.scrollLeft=S.left,S.element.scrollTop=S.top}for(yr=null,Tn=!!gr,gr=null,e.current=t,Ci=r;null!==Ci;){r=!1,N=void 0;try{for(I=n;null!==Ci;){var T=Ci.effectTag;if(36&T){var C=Ci.alternate;switch(y=I,(S=Ci).tag){case 2:case 3:var E=S.stateNode;if(4&S.effectTag)if(null===C)E.props=S.memoizedProps,E.state=S.memoizedState,E.componentDidMount();else{var A=C.memoizedProps,R=C.memoizedState;E.props=S.memoizedProps,E.state=S.memoizedState,E.componentDidUpdate(A,R,E.__reactInternalSnapshotBeforeUpdate)}var _=S.updateQueue;null!==_&&(E.props=S.memoizedProps,E.state=S.memoizedState,sa(0,_,E));break;case 5:var F=S.updateQueue;if(null!==F){if(b=null,null!==S.child)switch(S.child.tag){case 7:case 2:case 3:b=S.child.stateNode}sa(0,F,b)}break;case 7:var D=S.stateNode;null===C&&4&S.effectTag&&br(S.type,S.memoizedProps)&&D.focus();break;case 8:case 6:case 15:case 16:break;default:s("163")}}if(128&T){var O=Ci.ref;if(null!==O){var M=Ci.stateNode;if(7===Ci.tag)var L=M;else L=M;"function"===typeof O?O(L):O.current=L}}var z=Ci.nextEffect;Ci.nextEffect=null,Ci=z}}catch(P){r=!0,N=P}r&&(null===Ci&&s("178"),Oi(Ci,N),null!==Ci&&(Ci=Ci.nextEffect))}wi=Ei=!1,"function"===typeof Zr&&Zr(t.stateNode),T=t.expirationTime,t=t.childExpirationTime,0===(t=0===T||0!==t&&t<T?t:T)&&(Ai=null),e.expirationTime=t,e.finishedWork=null}function mo(){return!!ji||!(null===Xi||Xi.timeRemaining()>1)&&(ji=!0)}function vo(e){null===Vi&&s("246"),Vi.expirationTime=0,qi||(qi=!0,Ki=e)}function go(e,t){var n=Yi;Yi=!0;try{return e(t)}finally{(Yi=n)||Ui||po(1,null)}}function yo(e,t){if(Yi&&!Qi){Qi=!0;try{return e(t)}finally{Qi=!1}}return e(t)}function bo(e,t,n){if(Ji)return e(t,n);Yi||Ui||0===Hi||(po(Hi,null),Hi=0);var r=Ji,a=Yi;Yi=Ji=!0;try{return e(t,n)}finally{Ji=r,(Yi=a)||Ui||po(1,null)}}function xo(e,t,n,r,a){var i=t.current;return n=function(e){if(!e)return Cr;e:{(2!==rn(e=e._reactInternalFiber)||2!==e.tag&&3!==e.tag)&&s("170");var t=e;do{switch(t.tag){case 5:t=t.stateNode.context;break e;case 2:if(Fr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}break;case 3:if(Fr(t.type._reactResult)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);s("171"),t=void 0}if(2===e.tag){var n=e.type;if(Fr(n))return Lr(e,n,t)}else if(3===e.tag&&Fr(n=e.type._reactResult))return Lr(e,n,t);return t}(n),null===t.context?t.context=n:t.pendingContext=n,t=a,(a=ea(r)).payload={element:e},null!==(t=void 0===t?null:t)&&(a.callback=t),na(i,a),Li(i,r),r}function ko(e,t,n,r){var a=t.current;return xo(e,t,n,a=Mi(uo(),a),r)}function wo(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function No(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:Je,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}function Io(e){var t=2+25*(1+((uo()-2+500)/25|0));t<=xi&&(t=xi+1),this._expirationTime=xi=t,this._root=e,this._callbacks=this._next=null,this._hasChildren=this._didComplete=!1,this._children=null,this._defer=!0}function So(){this._callbacks=null,this._didCommit=!1,this._onCommit=this._onCommit.bind(this)}function To(e,t,n){e={current:t=new Ur(5,null,null,t?3:0),containerInfo:e,pendingChildren:null,earliestPendingTime:0,latestPendingTime:0,earliestSuspendedTime:0,latestSuspendedTime:0,latestPingedTime:0,didError:!1,pendingCommitExpirationTime:0,finishedWork:null,timeoutHandle:-1,context:null,pendingContext:null,hydrate:n,nextExpirationTimeToWorkOn:0,expirationTime:0,firstBatch:null,nextScheduledRoot:null},this._internalRoot=t.stateNode=e}function Co(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Eo(e,t,n,r,a){Co(n)||s("200");var i=n._reactRootContainer;if(i){if("function"===typeof a){var o=a;a=function(){var e=wo(i._internalRoot);o.call(e)}}null!=e?i.legacy_renderSubtreeIntoContainer(e,t,a):i.render(t,a)}else{if(i=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new To(e,!1,t)}(n,r),"function"===typeof a){var u=a;a=function(){var e=wo(i._internalRoot);u.call(e)}}yo((function(){null!=e?i.legacy_renderSubtreeIntoContainer(e,t,a):i.render(t,a)}))}return wo(i._internalRoot)}function Ao(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return Co(t)||s("200"),No(e,t,null,n)}Re=function(e,t,n){switch(t){case"input":if(It(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=U(r);a||s("90"),qe(r),It(r,a)}}}break;case"textarea":$n(e,n);break;case"select":null!=(t=n.value)&&Yn(e,!!n.multiple,t,!1)}},Io.prototype.render=function(e){this._defer||s("250"),this._hasChildren=!0,this._children=e;var t=this._root._internalRoot,n=this._expirationTime,r=new So;return xo(e,t,null,n,r._onCommit),r},Io.prototype.then=function(e){if(this._didComplete)e();else{var t=this._callbacks;null===t&&(t=this._callbacks=[]),t.push(e)}},Io.prototype.commit=function(){var e=this._root._internalRoot,t=e.firstBatch;if(this._defer&&null!==t||s("251"),this._hasChildren){var n=this._expirationTime;if(t!==this){this._hasChildren&&(n=this._expirationTime=t._expirationTime,this.render(this._children));for(var r=null,a=t;a!==this;)r=a,a=a._next;null===r&&s("251"),r._next=a._next,this._next=t,e.firstBatch=this}this._defer=!1,t=n,Ui&&s("253"),Vi=e,Gi=t,fo(e,t,!0),po(1,null),t=this._next,this._next=null,null!==(t=e.firstBatch=t)&&t._hasChildren&&t.render(t._children)}else this._next=null,this._defer=!1},Io.prototype._onComplete=function(){if(!this._didComplete){this._didComplete=!0;var e=this._callbacks;if(null!==e)for(var t=0;t<e.length;t++)(0,e[t])()}},So.prototype.then=function(e){if(this._didCommit)e();else{var t=this._callbacks;null===t&&(t=this._callbacks=[]),t.push(e)}},So.prototype._onCommit=function(){if(!this._didCommit){this._didCommit=!0;var e=this._callbacks;if(null!==e)for(var t=0;t<e.length;t++){var n=e[t];"function"!==typeof n&&s("191",n),n()}}},To.prototype.render=function(e,t){var n=this._internalRoot,r=new So;return null!==(t=void 0===t?null:t)&&r.then(t),ko(e,n,null,r._onCommit),r},To.prototype.unmount=function(e){var t=this._internalRoot,n=new So;return null!==(e=void 0===e?null:e)&&n.then(e),ko(null,t,null,n._onCommit),n},To.prototype.legacy_renderSubtreeIntoContainer=function(e,t,n){var r=this._internalRoot,a=new So;return null!==(n=void 0===n?null:n)&&a.then(n),ko(t,r,e,a._onCommit),a},To.prototype.createBatch=function(){var e=new Io(this),t=e._expirationTime,n=this._internalRoot,r=n.firstBatch;if(null===r)n.firstBatch=e,e._next=null;else{for(n=null;null!==r&&r._expirationTime<=t;)n=r,r=r._next;e._next=r,null!==n&&(n._next=e)}return e},Le=go,ze=bo,Pe=function(){Ui||0===Hi||(po(Hi,null),Hi=0)};var Ro={createPortal:Ao,findDOMNode:function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternalFiber;return void 0===t&&("function"===typeof e.render?s("188"):s("268",Object.keys(e))),e=null===(e=on(t))?null:e.stateNode},hydrate:function(e,t,n){return Eo(null,e,t,!0,n)},render:function(e,t,n){return Eo(null,e,t,!1,n)},unstable_renderSubtreeIntoContainer:function(e,t,n,r){return(null==e||void 0===e._reactInternalFiber)&&s("38"),Eo(e,t,n,!1,r)},unmountComponentAtNode:function(e){return Co(e)||s("40"),!!e._reactRootContainer&&(yo((function(){Eo(null,null,e,!1,(function(){e._reactRootContainer=null}))})),!0)},unstable_createPortal:function(){return Ao.apply(void 0,arguments)},unstable_batchedUpdates:go,unstable_interactiveUpdates:bo,flushSync:function(e,t){Ui&&s("187");var n=Yi;Yi=!0;try{return zi(e,t)}finally{Yi=n,po(1,null)}},unstable_flushControlled:function(e){var t=Yi;Yi=!0;try{zi(e)}finally{(Yi=t)||Ui||po(1,null)}},__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{Events:[B,W,U,D.injectEventPluginsByName,x,K,function(e){E(e,q)},Oe,Me,Rn,M]},unstable_createRoot:function(e,t){return Co(e)||s("278"),new To(e,!0,null!=t&&!0===t.hydrate)}};!function(e){var t=e.findFiberByHostInstance;(function(e){if("undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)return!0;try{var n=t.inject(e);Zr=Wr((function(e){return t.onCommitFiberRoot(n,e)})),Br=Wr((function(e){return t.onCommitFiberUnmount(n,e)}))}catch(r){}})(a({},e,{findHostInstanceByFiber:function(e){return null===(e=on(e))?null:e.stateNode},findFiberByHostInstance:function(e){return t?t(e):null}}))}({findFiberByHostInstance:Z,bundleType:0,version:"16.5.2",rendererPackageName:"react-dom"});var _o={default:Ro},Fo=_o&&Ro||_o;e.exports=Fo.default||Fo},164:function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(463)},555:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(791),s=(r=o)&&r.__esModule?r:{default:r},u=n(159);function c(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}function l(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var h=function(e){function t(){var e,n,r;p(this,t);for(var a=arguments.length,i=Array(a),o=0;o<a;o++)i[o]=arguments[o];return n=r=f(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.isFileDialogActive=!1,r.composeHandlers=function(e){return r.props.disabled?null:e},r.onDocumentDrop=function(e){r.node&&r.node.contains(e.target)||(e.preventDefault(),r.dragTargets=[])},r.onDragStart=function(e){var t=r.props.onDragStart;t&&t.call(r,e)},r.onDragEnter=function(e){var t=r.props.onDragEnter;e.preventDefault(),-1===r.dragTargets.indexOf(e.target)&&r.dragTargets.push(e.target);(0,u.getDataTransferItems)(e);t&&t.call(r,e)},r.onDragOver=function(e){var t=r.props.onDragOver;e.preventDefault(),e.stopPropagation();try{e.dataTransfer.dropEffect="copy"}catch(n){}return t&&t.call(r,e),!1},r.onDragLeave=function(e){var t=r.props.onDragLeave;e.preventDefault(),r.dragTargets=r.dragTargets.filter((function(t){return t!==e.target&&r.node.contains(t)})),r.dragTargets.length>0||t&&t.call(r,e)},r.onDrop=function(e){var t=r.props,n=t.onDrop,a=t.onDropAccepted,i=t.onDropRejected,o=t.multiple,s=t.disablePreview,c=t.minSize,p=t.maxSize,f=t.accept,h=(0,u.getDataTransferItems)(e),d=[],m=[];e.preventDefault(),0!==h.length?(r.dragTargets=[],r.isFileDialogActive=!1,h.forEach((function(e){if(!s)try{e.preview=window.URL.createObjectURL(e)}catch(t){0}(0,u.fileAccepted)(e,f)&&(0,u.fileMatchSize)(e,p,c)?d.push(e):m.push(e)})),o||m.push.apply(m,l(d.splice(1))),n&&n.call(r,d,m,[],e),m.length>0&&i&&i.call(r,m,e),d.length>0&&a&&a.call(r,d,e)):r.onLink(e)},r.onClick=function(e){var t=r.props,n=t.onClick;t.disableClick||(e.stopPropagation(),n&&n.call(r,e),setTimeout(r.open.bind(r),0))},r.onInputElementClick=function(e){var t=r.props.inputProps;e.stopPropagation(),t&&t.onClick&&t.onClick()},r.onFileDialogCancel=function(){var e=r.props.onFileDialogCancel,t=r.fileInputEl,n=r.isFileDialogActive;e&&n&&setTimeout((function(){t.files.length||(n=!1,e())}),300)},r.setRef=function(e){r.node=e},r.setRefs=function(e){r.fileInputEl=e},r.onLink=function(e){var t=r.props,n=t.onDrop,a=t.accept;if(a){var i=a.match(/(\.[^.]+)(?=[,]|$)/gi);if(i){var o="(https://|http://)((?!http).)*("+i.join("|")+")",s=new RegExp(o,"gi"),u=[];if(e.dataTransfer){var c=decodeURIComponent(e.dataTransfer.getData("text/uri-list")).match(s),p=e.dataTransfer.getData("text/html").match(s);c?u=[].concat(l(c)):p&&(u=[].concat(l(p.filter((function(e){return-1===e.indexOf('"')})).map((function(e){return decodeURIComponent(e)})))))}else u=[].concat(l(decodeURIComponent(e.target.value).match(s)));n&&n([],[],u,e)}else n&&n([],[],[],e)}else n&&n([],[],[],e)},f(r,n)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"componentDidMount",value:function(){var e=this.props.preventDropOnDocument;this.dragTargets=[],e&&(document.addEventListener("dragover",u.onDocumentDragOver,!1),document.addEventListener("drop",this.onDocumentDrop,!1)),this.fileInputEl.addEventListener("click",this.onInputElementClick,!1),document.body.onfocus=this.onFileDialogCancel}},{key:"componentWillUnmount",value:function(){this.props.preventDropOnDocument&&(document.removeEventListener("dragover",u.onDocumentDragOver),document.removeEventListener("drop",this.onDocumentDrop)),this.fileInputEl.removeEventListener("click",this.onInputElementClick,!1),document.body.onfocus=null}},{key:"open",value:function(){this.isFileDialogActive=!0,this.fileInputEl.value=null,this.fileInputEl.click()}},{key:"render",value:function(){var e=this.props,t=e.accept,n=e.children,r=e.disabled,i=e.multiple,o=c(e,["accept","children","disabled","multiple"]),l=(o.preventDropOnDocument,o.disablePreview,o.disableClick,o.maxSize,o.minSize,o.inputProps,o.onDropAccepted,o.onDropRejected,o.onFileDialogCancel,c(o,["preventDropOnDocument","disablePreview","disableClick","maxSize","minSize","inputProps","onDropAccepted","onDropRejected","onFileDialogCancel"]));return s.default.createElement("div",a({},l,{onClick:this.composeHandlers(this.onClick),onDragStart:this.composeHandlers(this.onDragStart),onDragEnter:this.composeHandlers(this.onDragEnter),onDragOver:this.composeHandlers(this.onDragOver),onDragLeave:this.composeHandlers(this.onDragLeave),onDrop:this.composeHandlers(this.onDrop),ref:this.setRef,"aria-disabled":r}),n,s.default.createElement("input",{disabled:r,accept:t,type:"file",style:{display:"none"},multiple:u.supportMultiple&&i,ref:this.setRefs,onChange:this.onDrop,autoComplete:"off"}))}}]),t}(o.Component);h.defaultProps={preventDropOnDocument:!0,disabled:!1,disablePreview:!1,disableClick:!1,multiple:!0,maxSize:1/0,minSize:0},t.default=h},203:function(e,t,n){"use strict";var r,a=n(555),i=(r=a)&&r.__esModule?r:{default:r};t.Z=i.default},159:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDataTransferItems=function(e){var t=[];if(e.dataTransfer){var n=e.dataTransfer;if(n.files&&n.files.length)t=n.files;else if(n.items&&n.items.length)return Array.prototype.slice.call(n.items).filter((function(e){return"file"===e.kind}))}else e.target&&e.target.files&&(t=e.target.files);return Array.prototype.slice.call(t)},t.fileAccepted=n,t.fileMatchSize=function(e,t,n){return e.size<=t&&e.size>=n},t.allFilesAccepted=function(e,t){return e.every((function(e){return n(e,t)}))},t.onDocumentDragOver=function(e){e.preventDefault()};t.supportMultiple="undefined"===typeof document||!document||!document.createElement||"multiple"in document.createElement("input");function n(e,t){return"application/x-moz-file"===e.type||function(e,t){if(e&&t){var n=Array.isArray(t)?t:t.split(","),r=e.name||"",a=e.type||"",i=a.replace(/\/.*$/,"");return n.some((function(e){var t=e.trim();return"."===t.charAt(0)?r.toLowerCase().endsWith(t.toLowerCase()):/\/\*$/.test(t)?i===t.replace(/\/.*$/,""):a===t}))}return!0}(e,t)}},117:function(e,t,n){"use strict";var r=n(725),a="function"===typeof Symbol&&Symbol.for,i=a?Symbol.for("react.element"):60103,o=a?Symbol.for("react.portal"):60106,s=a?Symbol.for("react.fragment"):60107,u=a?Symbol.for("react.strict_mode"):60108,c=a?Symbol.for("react.profiler"):60114,l=a?Symbol.for("react.provider"):60109,p=a?Symbol.for("react.context"):60110,f=a?Symbol.for("react.async_mode"):60111,h=a?Symbol.for("react.forward_ref"):60112;a&&Symbol.for("react.placeholder");var d="function"===typeof Symbol&&Symbol.iterator;function m(e,t,n,r,a,i,o,s){if(!e){if(e=void 0,void 0===t)e=Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var u=[n,r,a,i,o,s],c=0;(e=Error(t.replace(/%s/g,(function(){return u[c++]})))).name="Invariant Violation"}throw e.framesToPop=1,e}}function v(e){for(var t=arguments.length-1,n="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=0;r<t;r++)n+="&args[]="+encodeURIComponent(arguments[r+1]);m(!1,"Minified React error #"+e+"; visit %s for the full message or use the non-minified dev environment for full errors and additional helpful warnings. ",n)}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y={};function b(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||g}function x(){}function k(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||g}b.prototype.isReactComponent={},b.prototype.setState=function(e,t){"object"!==typeof e&&"function"!==typeof e&&null!=e&&v("85"),this.updater.enqueueSetState(this,e,t,"setState")},b.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},x.prototype=b.prototype;var w=k.prototype=new x;w.constructor=k,r(w,b.prototype),w.isPureReactComponent=!0;var N={current:null,currentDispatcher:null},I=Object.prototype.hasOwnProperty,S={key:!0,ref:!0,__self:!0,__source:!0};function T(e,t,n){var r=void 0,a={},o=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)I.call(t,r)&&!S.hasOwnProperty(r)&&(a[r]=t[r]);var u=arguments.length-2;if(1===u)a.children=n;else if(1<u){for(var c=Array(u),l=0;l<u;l++)c[l]=arguments[l+2];a.children=c}if(e&&e.defaultProps)for(r in u=e.defaultProps)void 0===a[r]&&(a[r]=u[r]);return{$$typeof:i,type:e,key:o,ref:s,props:a,_owner:N.current}}function C(e){return"object"===typeof e&&null!==e&&e.$$typeof===i}var E=/\/+/g,A=[];function R(e,t,n,r){if(A.length){var a=A.pop();return a.result=e,a.keyPrefix=t,a.func=n,a.context=r,a.count=0,a}return{result:e,keyPrefix:t,func:n,context:r,count:0}}function _(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>A.length&&A.push(e)}function F(e,t,n,r){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var s=!1;if(null===e)s=!0;else switch(a){case"string":case"number":s=!0;break;case"object":switch(e.$$typeof){case i:case o:s=!0}}if(s)return n(r,e,""===t?"."+O(e,0):t),1;if(s=0,t=""===t?".":t+":",Array.isArray(e))for(var u=0;u<e.length;u++){var c=t+O(a=e[u],u);s+=F(a,c,n,r)}else if(null===e||"object"!==typeof e?c=null:c="function"===typeof(c=d&&e[d]||e["@@iterator"])?c:null,"function"===typeof c)for(e=c.call(e),u=0;!(a=e.next()).done;)s+=F(a=a.value,c=t+O(a,u++),n,r);else"object"===a&&v("31","[object Object]"===(n=""+e)?"object with keys {"+Object.keys(e).join(", ")+"}":n,"");return s}function D(e,t,n){return null==e?0:F(e,"",t,n)}function O(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,(function(e){return t[e]}))}(e.key):t.toString(36)}function M(e,t){e.func.call(e.context,t,e.count++)}function L(e,t,n){var r=e.result,a=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?z(e,r,n,(function(e){return e})):null!=e&&(C(e)&&(e=function(e,t){return{$$typeof:i,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(e,a+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(E,"$&/")+"/")+n)),r.push(e))}function z(e,t,n,r,a){var i="";null!=n&&(i=(""+n).replace(E,"$&/")+"/"),D(e,L,t=R(t,i,r,a)),_(t)}function P(e,t){var n=N.currentDispatcher;return null===n&&v("277"),n.readContext(e,t)}var Z={Children:{map:function(e,t,n){if(null==e)return e;var r=[];return z(e,r,null,t,n),r},forEach:function(e,t,n){if(null==e)return e;D(e,M,t=R(null,null,t,n)),_(t)},count:function(e){return D(e,(function(){return null}),null)},toArray:function(e){var t=[];return z(e,t,null,(function(e){return e})),t},only:function(e){return C(e)||v("143"),e}},createRef:function(){return{current:null}},Component:b,PureComponent:k,createContext:function(e,t){return void 0===t&&(t=null),(e={$$typeof:p,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,Provider:null,Consumer:null,unstable_read:null}).Provider={$$typeof:l,_context:e},e.Consumer=e,e.unstable_read=P.bind(null,e),e},forwardRef:function(e){return{$$typeof:h,render:e}},Fragment:s,StrictMode:u,unstable_AsyncMode:f,unstable_Profiler:c,createElement:T,cloneElement:function(e,t,n){(null===e||void 0===e)&&v("267",e);var a=void 0,o=r({},e.props),s=e.key,u=e.ref,c=e._owner;if(null!=t){void 0!==t.ref&&(u=t.ref,c=N.current),void 0!==t.key&&(s=""+t.key);var l=void 0;for(a in e.type&&e.type.defaultProps&&(l=e.type.defaultProps),t)I.call(t,a)&&!S.hasOwnProperty(a)&&(o[a]=void 0===t[a]&&void 0!==l?l[a]:t[a])}if(1===(a=arguments.length-2))o.children=n;else if(1<a){l=Array(a);for(var p=0;p<a;p++)l[p]=arguments[p+2];o.children=l}return{$$typeof:i,type:e.type,key:s,ref:u,props:o,_owner:c}},createFactory:function(e){var t=T.bind(null,e);return t.type=e,t},isValidElement:C,version:"16.5.2",__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentOwner:N,assign:r}},B={default:Z},W=B&&Z||B;e.exports=W.default||W},791:function(e,t,n){"use strict";e.exports=n(117)},727:function(e){var t=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,a="function"===typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(_){u=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),o=new E(r||[]);return i._invoke=function(e,t,n){var r=p;return function(a,i){if(r===h)throw new Error("Generator is already running");if(r===d){if("throw"===a)throw i;return R()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var s=S(o,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===p)throw r=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=h;var u=l(e,t,n);if("normal"===u.type){if(r=n.done?d:f,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=d,n.method="throw",n.arg=u.arg)}}}(e,n,o),i}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(_){return{type:"throw",arg:_}}}e.wrap=c;var p="suspendedStart",f="suspendedYield",h="executing",d="completed",m={};function v(){}function g(){}function y(){}var b={};u(b,i,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(A([])));k&&k!==n&&r.call(k,i)&&(b=k);var w=y.prototype=v.prototype=Object.create(b);function N(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function I(e,t){function n(a,i,o,s){var u=l(e[a],e,i);if("throw"!==u.type){var c=u.arg,p=c.value;return p&&"object"===typeof p&&r.call(p,"__await")?t.resolve(p.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(p).then((function(e){c.value=e,o(c)}),(function(e){return n("throw",e,o,s)}))}s(u.arg)}var a;this._invoke=function(e,r){function i(){return new t((function(t,a){n(e,r,t,a)}))}return a=a?a.then(i,i):i()}}function S(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,S(e,n),"throw"===n.method))return m;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var a=l(r,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,m;var i=a.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function A(e){if(e){var n=e[i];if(n)return n.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var a=-1,o=function n(){for(;++a<e.length;)if(r.call(e,a))return n.value=e[a],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}return{next:R}}function R(){return{value:t,done:!0}}return g.prototype=y,u(w,"constructor",y),u(y,"constructor",g),g.displayName=u(y,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,u(e,s,"GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},N(I.prototype),u(I.prototype,o,(function(){return this})),e.AsyncIterator=I,e.async=function(t,n,r,a,i){void 0===i&&(i=Promise);var o=new I(c(t,n,r,a),i);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},N(w),u(w,s,"Generator"),u(w,i,(function(){return this})),u(w,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=A,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function a(r,a){return s.type="throw",s.arg=e,n.next=r,a&&(n.method="next",n.arg=t),!!a}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var u=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(u&&c){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),C(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;C(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:A(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),m}},e}(e.exports);try{regeneratorRuntime=t}catch(n){"object"===typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}},784:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=null,r=!1,a=!1,i="object"===typeof performance&&"function"===typeof performance.now,o={timeRemaining:i?function(){var e=d()-performance.now();return 0<e?e:0}:function(){var e=d()-Date.now();return 0<e?e:0},didTimeout:!1};function s(){if(!r){var e=n.timesOutAt;a?h():a=!0,f(c,e)}}function u(){var e=n,t=n.next;if(n===t)n=null;else{var r=n.previous;n=r.next=t,t.previous=r}e.next=e.previous=null,(e=e.callback)(o)}function c(e){r=!0,o.didTimeout=e;try{if(e)for(;null!==n;){var i=t.unstable_now();if(!(n.timesOutAt<=i))break;do{u()}while(null!==n&&n.timesOutAt<=i)}else if(null!==n)do{u()}while(null!==n&&0<d()-t.unstable_now())}finally{r=!1,null!==n?s():a=!1}}var l,p,f,h,d,m=Date,v="function"===typeof setTimeout?setTimeout:void 0,g="function"===typeof clearTimeout?clearTimeout:void 0,y="function"===typeof requestAnimationFrame?requestAnimationFrame:void 0,b="function"===typeof cancelAnimationFrame?cancelAnimationFrame:void 0;function x(e){l=y((function(t){g(p),e(t)})),p=v((function(){b(l),e(t.unstable_now())}),100)}if(i){var k=performance;t.unstable_now=function(){return k.now()}}else t.unstable_now=function(){return m.now()};if("undefined"===typeof window){var w=-1;f=function(e){w=setTimeout(e,0,!0)},h=function(){clearTimeout(w)},d=function(){return 0}}else if(window._schedMock){var N=window._schedMock;f=N[0],h=N[1],d=N[2]}else{"undefined"!==typeof console&&("function"!==typeof y&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!==typeof b&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"));var I=null,S=!1,T=-1,C=!1,E=!1,A=0,R=33,_=33;d=function(){return A};var F="__reactIdleCallback$"+Math.random().toString(36).slice(2);window.addEventListener("message",(function(e){if(e.source===window&&e.data===F){S=!1;var n=t.unstable_now();if(e=!1,0>=A-n){if(!(-1!==T&&T<=n))return void(C||(C=!0,x(D)));e=!0}if(T=-1,n=I,I=null,null!==n){E=!0;try{n(e)}finally{E=!1}}}}),!1);var D=function(e){C=!1;var t=e-A+_;t<_&&R<_?(8>t&&(t=8),_=t<R?R:t):R=t,A=e+_,S||(S=!0,window.postMessage(F,"*"))};f=function(e,t){I=e,T=t,E?window.postMessage(F,"*"):C||(C=!0,x(D))},h=function(){I=null,S=!1,T=-1}}t.unstable_scheduleWork=function(e,r){var a=t.unstable_now();if(e={callback:e,timesOutAt:r=void 0!==r&&null!==r&&null!==r.timeout&&void 0!==r.timeout?a+r.timeout:a+5e3,next:null,previous:null},null===n)n=e.next=e.previous=e,s();else{a=null;var i=n;do{if(i.timesOutAt>r){a=i;break}i=i.next}while(i!==n);null===a?a=n:a===n&&(n=e,s()),(r=a.previous).next=a.previous=e,e.next=a,e.previous=r}return e},t.unstable_cancelScheduledWork=function(e){var t=e.next;if(null!==t){if(t===e)n=null;else{e===n&&(n=t);var r=e.previous;r.next=t,t.previous=r}e.next=e.previous=null}}},990:function(e,t,n){"use strict";e.exports=n(784)},699:function(e,t,n){var r=n(501),a=n(112),i=n(132),o=n(890),s=n(113),u=n(350),c=n(411);c.alea=r,c.xor128=a,c.xorwow=i,c.xorshift7=o,c.xor4096=s,c.tychei=u,e.exports=c},501:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n=function(){var e=4022871197;return function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)}}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function u(e,t){var n=new o(e),r=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.alea=u}(0,e=n.nmd(e),n.amdD)},350:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.tychei=u}(0,e=n.nmd(e),n.amdD)},112:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xor128=u}(0,e=n.nmd(e),n.amdD)},113:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,i=-32;i<u;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=o+1640531527|0,a=0==(n=s[127&i]^=r+o)?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[a]=r^n;e.w=o,e.X=s,e.i=a}(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.X&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xor4096=u}(0,e=n.nmd(e),n.amdD)},890:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.x&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xorshift7=u}(0,e=n.nmd(e),n.amdD)},132:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xorwow=u}(0,e=n.nmd(e),n.amdD)},411:function(e,t,n){var r;!function(a,i){var o,s=this,u=256,c=i.pow(u,6),l=i.pow(2,52),p=2*l,f=255;function h(e,t,n){var r=[],f=g(v((t=1==t?{entropy:!0}:t||{}).entropy?[e,y(a)]:null==e?function(){try{var e;return o&&(e=o.randomBytes)?e=e(u):(e=new Uint8Array(u),(s.crypto||s.msCrypto).getRandomValues(e)),y(e)}catch(r){var t=s.navigator,n=t&&t.plugins;return[+new Date,s,n,s.screen,y(a)]}}():e,3),r),h=new d(r),b=function(){for(var e=h.g(6),t=c,n=0;e<l;)e=(e+n)*u,t*=u,n=h.g(1);for(;e>=p;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|h.g(4)},b.quick=function(){return h.g(4)/4294967296},b.double=b,g(y(h.S),a),(t.pass||n||function(e,t,n,r){return r&&(r.S&&m(r,h),e.state=function(){return m(h,{})}),n?(i.random=e,t):e})(b,f,"global"in t?t.global:this==i,t.state)}function d(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,o=r.S=[];for(n||(e=[n++]);a<u;)o[a]=a++;for(a=0;a<u;a++)o[a]=o[i=f&i+e[a%n]+(t=o[a])],o[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,o=r.S;e--;)t=o[a=f&a+1],n=n*u+o[f&(o[a]=o[i=f&i+t])+(o[i]=t)];return r.i=a,r.j=i,n})(u)}function m(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function v(e,t){var n,r=[],a=typeof e;if(t&&"object"==a)for(n in e)try{r.push(v(e[n],t-1))}catch(i){}return r.length?r:"string"==a?e:e+"\0"}function g(e,t){for(var n,r=e+"",a=0;a<r.length;)t[f&a]=f&(n^=19*t[f&a])+r.charCodeAt(a++);return y(t)}function y(e){return String.fromCharCode.apply(0,e)}if(i.seedrandom=h,g(i.random(),a),e.exports){e.exports=h;try{o=n(42)}catch(b){}}else void 0===(r=function(){return h}.call(t,n,t,e))||(e.exports=r)}([],Math)},410:function(){},628:function(){},601:function(){},792:function(){},977:function(){},42:function(){},907:function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,{Z:function(){return r}})},878:function(e,t,n){"use strict";function r(e){if(Array.isArray(e))return e}n.d(t,{Z:function(){return r}})},326:function(e,t,n){"use strict";function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n.d(t,{Z:function(){return r}})},671:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,{Z:function(){return r}})},144:function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}n.d(t,{Z:function(){return a}})},668:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var r=n(120),a=n(814);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}var o=n(326);function s(e,t){if(t&&("object"===i(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return(0,o.Z)(e)}function u(e){var t=(0,a.Z)();return function(){var n,a=(0,r.Z)(e);if(t){var i=(0,r.Z)(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return s(this,n)}}},120:function(e,t,n){"use strict";function r(e){return r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},r(e)}n.d(t,{Z:function(){return r}})},136:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(611);function a(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&(0,r.Z)(e,t)}},814:function(e,t,n){"use strict";function r(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}n.d(t,{Z:function(){return r}})},267:function(e,t,n){"use strict";function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}n.d(t,{Z:function(){return r}})},611:function(e,t,n){"use strict";function r(e,t){return r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},r(e,t)}n.d(t,{Z:function(){return r}})},439:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(878);var a=n(181),i=n(267);function o(e,t){return(0,r.Z)(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(u){s=!0,a=u}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}(e,t)||(0,a.Z)(e,t)||(0,i.Z)()}},181:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(907);function a(e,t){if(e){if("string"===typeof e)return(0,r.Z)(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?(0,r.Z)(e,t):void 0}}}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.amdD=function(){throw new Error("define cannot be used indirect")},n.amdO={},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},function(){"use strict";var e=n(439),t=n(671),r=n(144),a=n(136),i=n(668),o=n(791),s=n.n(o),u=n(164),c=n.n(u),l=n(203),p=n(20),f=["person","bicycle","car","motorcycle","airplane","bus","train","truck","boat","traffic light","fire hydrant","stop sign","parking meter","bench","bird","cat","dog","horse","sheep","cow","elephant","bear","zebra","giraffe","backpack","umbrella","handbag","tie","suitcase","frisbee","skis","snowboard","sports ball","kite","baseball bat","baseball glove","skateboard","surfboard","tennis racket","bottle","wine glass","cup","fork","knife","spoon","bowl","banana","apple","sandwich","orange","broccoli","carrot","hot dog","pizza","donut","cake","chair","couch","potted plant","bed","dining table","toilet","tv","laptop","mouse","remote","keyboard","cell phone","microwave","oven","toaster","sink","refrigerator","book","clock","vase","scissors","teddy bear","hair drier","toothbrush"],h=function(n){(0,a.Z)(u,n);var o=(0,i.Z)(u);function u(){var n;(0,t.Z)(this,u);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=o.call.apply(o,[this].concat(a))).state={model:null,preview:"",predictions:[]},n.onDrop=function(e,t,r){n.setState({preview:e[0].preview||r[0]})},n.cropToCanvas=function(e,t,n){var r=e.naturalWidth,a=e.naturalHeight;n.clearRect(0,0,n.canvas.width,n.canvas.height),n.fillStyle="#000000",n.fillRect(0,0,t.width,t.height);var i=Math.min(t.width/e.naturalWidth,t.height/e.naturalHeight),o=Math.round(r*i),s=Math.round(a*i);n.drawImage(e,0,0,r,a,(t.width-o)/2,(t.height-s)/2,o,s)},n.onImageChange=function(t){var r=document.getElementById("canvas"),a=r.getContext("2d");n.cropToCanvas(t.target,r,a);var i=n.state.model.inputs[0].shape.slice(1,3),o=(0,e.Z)(i,2),s=o[0],u=o[1],c=p.tidy((function(){return p.image.resizeBilinear(p.browser.fromPixels(r),[s,u]).div(255).expandDims(0)}));n.state.model.executeAsync(c).then((function(t){var n="16px sans-serif";a.font=n,a.textBaseline="top";var i,o=(0,e.Z)(t,4),s=o[0],u=o[1],c=o[2],l=o[3],h=s.dataSync(),d=u.dataSync(),m=c.dataSync(),v=l.dataSync()[0];for(p.dispose(t),i=0;i<v;++i){var g=h.slice(4*i,4*(i+1)),y=(0,e.Z)(g,4),b=y[0],x=y[1],k=y[2],w=y[3];b*=r.width,k*=r.width,x*=r.height;var N=k-b,I=(w*=r.height)-x,S=f[m[i]],T=d[i].toFixed(2);a.strokeStyle="#00FFFF",a.lineWidth=4,a.strokeRect(b,x,N,I),a.fillStyle="#00FFFF";var C=a.measureText(S+":"+T).width,E=parseInt(n,10);a.fillRect(b,x,C+4,E+4)}for(i=0;i<v;++i){var A=h.slice(4*i,4*(i+1)),R=(0,e.Z)(A,3),_=R[0],F=R[1];_*=r.width,F*=r.height;var D=f[m[i]],O=d[i].toFixed(2);a.fillStyle="#000000",a.fillText(D+":"+O,_,F)}}))},n}return(0,r.Z)(u,[{key:"componentDidMount",value:function(){var e=this;console.info("model init"),p.loadGraphModel("/web_model/model.json").then((function(t){e.setState({model:t})}))}},{key:"render",value:function(){return s().createElement("div",{className:"Dropzone-page"},this.state.model?s().createElement(l.Z,{className:"Dropzone",accept:"image/jpeg, image/png, .jpg, .jpeg, .png",multiple:!1,onDrop:this.onDrop},this.state.preview?s().createElement("img",{alt:"upload preview",onLoad:this.onImageChange,className:"Dropzone-img",src:this.state.preview}):"Choose or drop a file.",s().createElement("canvas",{id:"canvas",width:"640",height:"640"})):s().createElement("div",{className:"Dropzone"},"Loading model..."))}}]),u}(s().Component),d=document.getElementById("root");c().render(s().createElement(h,null),d)}()}();
//# sourceMappingURL=main.b03dd0cb.js.map